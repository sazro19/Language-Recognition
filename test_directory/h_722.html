<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/582464\/"},"headline":"Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger","datePublished":"2021-10-11T12:21:48+03:00","dateModified":"2021-10-11T14:21:35+03:00","author":{"@type":"Person","name":"Артур"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет м...","url":"https:\/\/habr.com\/ru\/post\/582464\/#post-content-body","about":["h_webdev","h_api","h_go","h_microservices","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/582464\/ed3a542e6132b654d2a798ce60e3cdaa\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/d67\/42d\/503\/d6742d503151d325627b2b361131e62e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c95\/70f\/56a\/c9570f56a842307ad2b02abf20bca498.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/d87\/501\/7f0\/d875017f010412edadf0d6a56f9c55d5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/39c\/eb8\/e05\/39ceb8e05011ae05ff3db3dee183aad8.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/003\/a14\/aaa\/003a14aaa3b0165628b79e74f3bb11ae.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1ff\/c23\/c8e\/1ffc23c8e06f34520a8606933e46d0c2.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/1b8/43f/3b8/1b843f3b814529c715da008f6c07c05a.jpg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/1b8/43f/3b8/1b843f3b814529c715da008f6c07c05a.jpg" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/1b8/43f/3b8/1b843f3b814529c715da008f6c07c05a.jpg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/1b8/43f/3b8/1b843f3b814529c715da008f6c07c05a.jpg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/1b8/43f/3b8/1b843f3b814529c715da008f6c07c05a.jpg" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="582464" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-11T09:21:48.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/582464/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/582464/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/1b8/43f/3b8/1b843f3b814529c715da008f6c07c05a.jpg" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/582464/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/dikkini/" title="dikkini" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/dikkini/" class="tm-user-info__username">
      dikkini
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-11T09:21:48.000Z" title="2021-10-11, 12:21">11  октября   в 12:21</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/webdev/" class="tm-article-snippet__hubs-item-link"><span>Разработка веб-сайтов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/api/" class="tm-article-snippet__hubs-item-link"><span>API</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/go/" class="tm-article-snippet__hubs-item-link"><span>Go</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/microservices/" class="tm-article-snippet__hubs-item-link"><span>Микросервисы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и даже немного интеграционных тестов.</p><p><a href="https://habr.com/ru/post/582294/" rel="noopener noreferrer nofollow">В первой части</a> мы спроектировали систему и посмотрели, какие сервисы требуются для построения микросервисной архитектуры.</p><p>Подробности в видео и текстовой расшифровке под ним.</p><div class="tm-iframe_temp" data-src="https://embedd.srv.habr.com/iframe/616063716a73daf6662a1b99" data-style="" id="616063716a73daf6662a1b99" width=""></div><h3>Прототипирование</h3><p>Начнём с макетов интерфейса. Нам нужно понять, какие ручки будут у нашего API и какой состав данных он должен отдавать. Макеты мы будем делать, чтобы понять, какие сущности, поля и эндпоинты нам нужны. Используем для этого онлайн-сервис <a href="https://ninjamock.com/" rel="noopener noreferrer nofollow">NinjaMock</a>. Он подходит, если макет надо сделать быстро и без лишних действий.</p><p>Страницу регистрации сделаем простую, с четырьмя полями: Name, Email, Password и Repeat Password. Лейблы делать не будем, обойдемся плейсходерами. Авторизацию сделаем по юзернейму и паролю.</p><p>После входа в приложение пользователь увидит список заметок, который будет выглядеть примерно так:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Интерфейс веб-приложения для работы с заметками" title="Интерфейс веб-приложения для работы с заметками" height="1260" data-src="https://habrastorage.org/getpro/habr/upload_files/d67/42d/503/d6742d503151d325627b2b361131e62e.png" data-width="1435"/><figcaption>Интерфейс веб-приложения для работы с заметками</figcaption></figure><p>Интерфейс, который будет у нашего веб-приложения</p><ul><li><p>Слева — список категорий любой вложенности.</p></li><li><p>Справа — список заметок в виде карточек, который делится на два списка: прикреплённые и обычные карточки.</p></li><li><p>Каждая карточка состоит из заголовка, который урезается, если он очень длинный.</p></li><li><p>Справа указано, сколько секунд/минут/часов/дней назад была создана заметка.</p></li><li><p>Тело заголовка — отрендеренный Markdown.</p></li><li><p>Панель инструментов. Через неё можно изменить цвет, прикрепить или удалить заметку.</p></li></ul><p>Тут важно отметить, что файлы заметки мы не отображаем и не будем запрашивать у API для списка заметок.</p><p>Полная карточка открывается по клику на заметку. Тут можно сразу отобразить полностью длинный заголовок. Высота заметки зависит от количества текста. Для файлов появляется отдельная секция. Мы их будем получать отдельным асинхронным запросом, который не помешает пользователю редактировать заметку. Файлы можно скачать по ссылке, также есть отдельная кнопка на добавление файлов.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Интерфейс заметки" title="Интерфейс заметки" height="542" data-src="https://habrastorage.org/getpro/habr/upload_files/c95/70f/56a/c9570f56a842307ad2b02abf20bca498.png" data-width="720"/><figcaption>Интерфейс заметки</figcaption></figure><p>Так будет выглядеть открытая заметка</p><p>В ходе прототипирования стало понятно, что в первой части мы забыли добавить еще один микросервис — TagsService. Он будет управлять тегами.</p><h3>Определение эндпоинтов</h3><p>Для страниц авторизации и регистрации нам нужны эндпоинты аутентификации и регистрации соответственно. В качестве аутентификации и сессий пользователя мы будем использовать JWT. Что это такое и как работает, разберём чуть позднее. Пока просто запомните эти 3 буквы.</p><p>Для страницы списка заметок нам нужны эндпоинты <code>/api/categories</code> для получения древовидного списка категорий и <code>/api/notes?category_id=?</code> для получения списка заметок текущей категории. Перемещаясь по другим категориям, мы будем отдельно запрашивать заметки для выбранной категории, а на фронтенде сделаем кэш на клиенте. В ходе работы с заметками нам нужно уметь создавать новую категорию. Это будет метод <code>POST</code> на URL <code>/api/categories</code>. Также мы будем создавать новый тег при помощи метода <code>POST</code> на URL <code>/api/tags</code>.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Эндпоинты" title="Эндпоинты" height="989" data-src="https://habrastorage.org/getpro/habr/upload_files/d87/501/7f0/d875017f010412edadf0d6a56f9c55d5.png" data-width="1919"/><figcaption>Эндпоинты</figcaption></figure><p>Определяем эндпоинты</p><p>Чтобы обновить заметку, используем метод <code>PATCH</code> на URL <code>/api/notes/:uuid</code> с измененными полями. Делаем <code>PATCH</code>, а не <code>PUT</code>, потому что <code>PUT</code> требует отправки всех полей сущности по спецификации HTTP, а <code>PATCH</code> как раз нужен для частичного обновления.  Для отображения заметки нам ещё нужен эндпоинт <code>/api/notes/:uuid/files</code> с методами <code>POST</code> и <code>GET</code>. Также нам нужно скачивать файл, поэтому сделаем метод <code>GET</code> на URL <code>/api/files/:uuid</code>.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Эндпоинты" title="Эндпоинты" height="1050" data-src="https://habrastorage.org/getpro/habr/upload_files/39c/eb8/e05/39ceb8e05011ae05ff3db3dee183aad8.png" data-width="1847"/><figcaption>Эндпоинты</figcaption></figure><p>Эндпоинты обновления заметки и работы с файлами</p><h3>Структура репозитория системы</h3><p>Ещё немного общей информации. Структура репозитория всей системы будет выглядеть следующим образом:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Структура" title="Структура" height="791" data-src="https://habrastorage.org/getpro/habr/upload_files/003/a14/aaa/003a14aaa3b0165628b79e74f3bb11ae.png" data-width="1532"/><figcaption>Структура</figcaption></figure><p>Структура проекта</p><p>В директории app будет исходный код сервиса (если он будет). На уровне с app будут другие директории других продуктов, которые используются с этим сервисом, например, MongoDB или ELK. Продукты, которые будут использоваться на уровне всей системы, например, Consul, будут в отдельных директориях на уровне с сервисами.</p><h3>Разработка сервиса</h3><p>Писать будем на Go<br/>Установка завершена, всё работает.</p><ol><li><p>Идём на <a href="https://golang.org/dl/" rel="noopener noreferrer nofollow">официальный сайт</a>.</p></li><li><p>Копируем ссылку до архива, скачиваем, проверяем хеш-сумму.</p></li><li><p>Распаковываем и добавляем в переменную PATH путь до бинарников Go</p></li><li><p>Пишем небольшой тест проверки работоспособности, собираем бинарник и запускаем.</p></li></ol><figure class="full-width "><img src="/img/image-loader.svg" height="1165" data-src="https://habrastorage.org/getpro/habr/upload_files/1ff/c23/c8e/1ffc23c8e06f34520a8606933e46d0c2.png" data-width="2041"/><figcaption></figcaption></figure><p>Установка завершена, всё работает</p><p>Теперь создаём проект. Структура стандартная:</p><ul><li><p>build — для сборок,</p></li><li><p>cmd — точка входа в приложение,</p></li><li><p>internal — внутренняя бизнес-логика приложения,</p></li><li><p>pkg — для кода, который можно переиспользовать из проекта в проект.</p></li></ul><p><strong>Исходники проекта — </strong><a href="https://github.com/theartofdevel/notes_system" rel="noopener noreferrer nofollow"><strong>в репозитории на GitHub</strong></a><strong>.</strong></p><p>Я очень люблю логировать ход работы приложения, поэтому перенесу свою обёртку над логером <code>logrus</code> из другого проекта. Основная функция здесь <code>Init</code>, которая создает логер, папку <code>logs</code> и в ней файл <code>all.log</code> со всеми логами. Кроме файла логи будут выводиться в <code>STDOUT</code>. Также в пакете реализована поддержка логирования в разные файлы с разным уровнем логирования, но в текущем проекте мы это использовать не будем.</p><p>APIService будет работать на сокете. Создаём роутер, затем файл с сокетом и начинаем его слушать. Также мы хотим перехватывать от системы сигналы завершения работы. Например, если кто-то пошлёт приложению сигнал <code>SIGHUP</code>, приложение должно корректно завершиться, закрыв все текущие соединения и сессии. Хотел перехватывать все сигналы, но линтер предупреждает, что <code>os.Kill</code> и <code>SIGSTOP</code> перехватить не получится, поэтому их удаляем из этого списка.</p><p>Теперь давайте добавим сразу стандартный <code>handler</code> для метрик. Я его копирую в директорию <code>pkg</code>, далее добавляю в роутер. Все последующие роутеры будем добавлять так же.</p><p>Далее создаём точку входа в приложение. В  директории <code>cmd</code> создаём директорию <code>main</code>, а в ней — файл <code>app.go</code>. В нём мы создаём функцию <code>main</code>, в которой инициализируем и создаём логер. Роутер создаём через ключевое слово <code>defer</code>, чтобы метод <code>Init</code> у роутера вызвался только тогда, когда завершится функция <code>main</code>. Таким образом можно выполнять очистку ресурсов, закрытие контекстов и отложенный запуск методов. Запускаем, проверяем логи и сокет, всё работает.</p><p>Но для разработки нам нужно запускать приложение на порту, а не на сокете. Поэтому давайте добавим запуск приложения на порту в наш роутер. Определять, как запускать приложение, мы будем с помощью конфига.</p><p>Создадим для приложения контекст. Сделаем его синглтоном при помощи механизма <code>sync.Once</code>. Пока что в нём будет только конфиг. Контекст в виде синглтона создаю исключительно в учебных целях, впоследствии он будет выпилен. В большинстве случаев синглтоны — необходимое зло, в нашем проекте они не нужны. Далее создаём конфиг. Это будет YAML-файл, который мы будем парсить в структуру.</p><p>В роутере мы вытаскиваем из контекста конфиг и на основании <code>listen.type</code> либо создаем сокет, либо вешаем приложение на порт. Код graceful shutdown выделяем в отдельный пакет и передаём на вход список сигналов и список интерфейсов <code>io.Close</code>, которые надо закрывать. Запускаем приложение и проверяем наш эндпоинт <code>heartbeat</code>.  Всё работает. Давайте и конфиг сделаем синглтоном через механизм <code>sync.Once</code>, чтобы потом безболезненно удалить контекст, который создавался в учебных целях.</p><p>Теперь переходим к API. Создаём эндпоинты, полученные при анализе прототипов интерфейса. Тут важно отметить, что у нас все данные привязаны к пользователю. На первый взгляд, все ручки должны начинаться с пользователя и его идентификатора <code>/api/users/:uuid</code>. Но у нас будет авторизация, иначе любой пользователь сможет программно запросить заметки любого другого пользователя. Авторизацию можно сделать следующим образом: Basic Auth, Digest Auth, JSON Web Token, сессии и OAuth2. У всех способов есть свои плюсы и минусы. Для этого проекта мы возьмём JSON Web Token.</p><h3>Работа с JSON Web Token</h3><p>JSON Web Token (JWT) — это JSON-объект, который определён в открытом стандарте <a href="https://datatracker.ietf.org/doc/html/rfc7519" rel="noopener noreferrer nofollow">RFC 7519</a>. Он считается одним из безопасных способов передачи информации между двумя участниками. Для его создания необходимо определить заголовок (header) с общей информацией по токену, полезные данные (payload), такие как id пользователя, его роль и т.д., а также подписи (signature).</p><p>JWT использует преимущества подхода цифровой подписи JWS (Signature) и кодирования JWE (Encrypting). Подпись не даёт кому-то подделать токен без информации о секретном ключе, а кодирование защищает от прочтения данных третьими лицами. Давайте разберёмся, как они могут нам помочь для аутентификации и авторизации пользователя.</p><ul><li><p>Аутентификация — процедура проверки подлинности.  Мы проверяем, есть ли пользователь с полученной связкой логин-пароль в нашей системе.</p></li><li><p>Авторизация — предоставление пользователю прав на выполнение определённых действий, а также процесс проверки (подтверждения) данных прав при попытке выполнения этих действий.</p></li></ul><p>Другими словами, аутентификация проверяет легальность пользователя. Пользователь становится авторизированным, если может выполнять разрешённые действия.</p><p>Важно понимать, что использование JWT <strong>не скрывает и не маскирует данные автоматически</strong>. Причина использования JWT — проверка, что отправленные данные были действительно отправлены авторизованным источником. Данные внутри JWT закодированы и подписаны, но не зашифрованы. Цель кодирования данных — преобразование структуры. Подписанные данные позволяют получателю данных проверить аутентификацию источника данных.</p><h3>Реализация JWT в нашем APIService</h3><ol><li><p>Создаём директории <code>middleware</code> и <code>jwt</code>, а также файл <code>jwt.go</code>.</p></li><li><p>Описываем кастомные <code>UserClaims</code> и сам <code>middlware</code>.</p></li><li><p>Получаем заголовок <code>Authorization</code>, оттуда берём токен.</p></li><li><p>Берём секрет из конфига.</p></li><li><p>Создаём верификатор HMAC.</p></li><li><p>Парсим и проверяем токен.</p></li><li><p>Анмаршалим полученные данные в модель <code>UserClaims</code>.</p></li><li><p>Проверяем, что токен валидный на текущий момент.</p></li></ol><p>При любой ошибке отдаём ответ с кодом <code>401 Unauthorized</code>. Если ошибок не было, в контекст сохраняем ID пользователя в параметр <code>user_id</code>, чтобы во всех хендлерах его можно было получить. Теперь надо этот токен сгенерировать. Это будет делать хендлер авторизации с методом <code>POST</code> и эндпоинтом <code>/api/auth</code>. Он получает входные данные в виде полей username и password, которые мы описываем отдельной структурой <code>user</code>. Здесь также будет взаимодействие с <code>UserService</code>, нам надо там искать пользователя по полученным данным. Если такой пользователь есть, то создаём для него <code>UserClaims</code>, в которых указываем все нужные для нас данные. Определяем время жизни токена при помощи переменной <code>ExpiresAt</code> — берём текущее время и добавляем 15 секунд. Билдим токен и отдаём в виде JSON в параметре <code>token</code>. Клиента к <code>UserService</code> у нас пока нет, поэтому делаем заглушку.</p><p>Добавим в хендлер с heartbeat еще один тестовый хендлер, чтобы проверить работу аутентификации. Пишем небольшой тест. Для этого используем инструмент <code>sketch</code>, встроенный в IDE. Делаем <code>POST</code>-запрос на <code>/api/auth</code>, получаем токен и подставляем его в следующий запрос. Получаем ответ от эндпоинта <code>/api/heartbeat</code>, по истечении 5 секунд мы начнём получать ошибку с кодом <code>401 Unauthorized</code>.</p><p>Наш токен действителен очень ограниченное время. Сейчас это 15 секунд, а будет минут 30. Но этого всё равно мало. Когда токен протухнет, пользователю необходимо будет заново авторизовываться в системе. Это сделано для того, чтобы защитить пользовательские данные. Если злоумышленник украдет токен авторизации, который будет действовать очень большой промежуток времени или вообще бессрочно, то это будет провал.</p><p>Чтобы этого избежать, прикрутим refresh-токен. Он позволит пересоздать основной токен доступа без запроса данных авторизации пользователя. Такие токены живут очень долго или вообще бессрочно. После того как только старый JWT истекает мы больше не можем обратиться к API. Тогда отправляем refresh-токен. Нам приходит новая пара токена доступа и refresh-токена.</p><p>Хранить refresh-токены на сервере мы будем в кэше. В качестве реализации возьмём <code>FreeCache</code>. Я использую свою обёртку над кэшем из другого проекта, которая позволяет заменить реализацию <code>FreeCache</code> на любую другую, так как отдает интерфейс Repository с методами, которые никак не связаны с библиотекой.</p><p>Пока рассуждал про кэш, решил зарефакторить существующий код, чтобы было удобней прокидывать объекты без dependency injection и синглтонов. Обернул хендлеры и роутер в структуры. В хендлерах сделал интерфейс с методом <code>Register</code>, которые регистрируют его в роутере. Все объекты теперь инициализируются в <code>main</code>, весь роутер переехал в мейн. Старт приложения выделили в отдельную функцию также в <code>main</code>-файле. Теперь, если хендлеру нужен какой-то объект, я его просто буду добавлять в конструктор структуры хендлера, а инициализировать в <code>main</code>. Плюс появилась возможность прокидывать всем хендлерам свой логер. Это будет удобно когда надо будет добавлять поле <code>trace_id</code> от Zipkin в строчку лога.</p><p>Вернемся к refresh_token. Теперь при создании токена доступа создадим <code>refresh_token</code> и отдадим его вместе с основным. Сделаем обработку метода <code>PUT</code> для эндпоинта <code>/api/auth</code>, а в теле запроса будем ожидать параметр <code>refresh_token</code>, чтобы сгенерировать новую пару токена доступа и refresh-токена. Refresh-токен мы кладём в кэш в качестве ключа. Значением будет <code>user_id</code>, чтобы по нему можно было запросить данные пользователя у <code>UserService</code> и сгенерировать новый токен доступа. Refresh-токен одноразовый, поэтому сразу после получения токена из кэша удаляем его.</p><h3>Описание API</h3><p>Для описания нашего API будем использовать спецификацию OpenAPI 3.0 и Swagger — YAML-файл, который описывает все схемы данных и все эндпоинты. По нему очень легко ориентироваться, у него приятный интерфейс. Но описывать вручную всё очень муторно, поэтому лучше генерировать его кодом.</p><ul><li><p>Создаём эндпоинты <code>/api/auth</code> с методами <code>POST</code> и <code>PUT</code> для получения токена по юзернейму и паролю и по Refresh-токену соответственно.</p></li><li><p>Добавляем схемы объектов <code>Token</code> и <code>User</code>.</p></li><li><p>Создаём эндпоинты <code>/api/users</code> с методом <code>POST</code> для регистрации нового пользователя. Для него создаём схему CreateUser.</p></li></ul><p>Понимаем, что забыли сделать хендлер для регистрации пользователя. Создаём метод <code>Signup</code> у хенлера <code>Auth</code> и структуру <code>newUser</code> со всеми полями для регистрации. Генерацию JWT выделяем в отдельный метод, чтобы можно было его вызывать как в <code>Auth</code>, так и в <code>Signup</code>-хендлерах. У нас всё еще нет <code>UserService</code>, поэтому проставляем TODO. Нам надо будет провалидировать полученные данные от пользователя и потом отправить их в <code>UserService</code>, чтобы он уже создал пользователя и ответил нам об успехе. Далее вызываем функцию создания пары токена доступа и refresh-токена и отдаём с кодом 201.</p><p>У нас есть подсказка в виде Swagger-файла. На его основе  создаём все нужные хендлеры. Там, где вызов микросервисов, будем проставлять комментарий с TODO.</p><p>Создаём хендлер для категорий, определяем URL в константах. Далее создаём структуры. Опираемся на Swagger-файл, который создали ранее. Далее создаём сам хендлер и реализуем метод <code>Register</code>, который регистрирует его в роутере. Затем создаём методы с логикой работы и сразу пишем тест API на этот метод. Проверяем, находим ошибки в сваггере. Таким образом мы создаём все методы по работе с категориями: получение и создание.</p><p>Далее создаём таким же образом хендлер для заметок. Понимаем, что забыли методы частичного обновления и удаления как для заметок, так и для категорий. Дописываем их в Swagger и реализуем методы в коде. Также обязательно тестируем Swagger в онлайн-редакторе.</p><p>Здесь надо обратить внимание на то, что методы создания сущности возвращают код ответа 201 и заголовок <code>Location</code>, в котором находится URL для получения сущности. Оттуда можно вытащить идентификатор созданной сущности.</p><p>В третьей части мы познакомимся с графовой базой данных Neo4j, а также будем работать над микросервисами CategoryService и APIService.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgo%5D" class="tm-tags-list__link">go</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bapi%5D" class="tm-tags-list__link">api</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Brest%5D" class="tm-tags-list__link">rest</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bswagger%5D" class="tm-tags-list__link">swagger</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmockups%5D" class="tm-tags-list__link">mockups</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bninjamock%5D" class="tm-tags-list__link">ninjamock</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjwt%5D" class="tm-tags-list__link">jwt</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bopenapi%5D" class="tm-tags-list__link">openapi</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bprogramming%5D" class="tm-tags-list__link">programming</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/webdev/" class="tm-hubs-list__link">
    Разработка веб-сайтов
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/api/" class="tm-hubs-list__link">
    API
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/go/" class="tm-hubs-list__link">
    Go
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/microservices/" class="tm-hubs-list__link">
    Микросервисы
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 6: ↑5 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 6: ↑5 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+4</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    66
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/dikkini/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 32 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    8
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">16</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Артур</span> <a href="/ru/users/dikkini/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @dikkini
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://www.youtube.com/c/TheArtofDevelopment" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a><a href="https://facebook.com/dikkini" rel="noopener" target="_blank" class="tm-article-author__contact">
      Facebook
    </a><a href="https://vk.com/theartofdevel" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a><a href="https://telegram.me/theartofdevel" rel="noopener" target="_blank" class="tm-article-author__contact">
      Telegram
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/582464/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 2 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section data-async-called="true" class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Работа</h2> <!----></header> <div class="tm-block__body"><div class="tm-vacancies-block__item"><a href="https://career.habr.com/vacancies/go_razrabotchik" target="_blank" class="tm-vacancies-block__vacancy-title">
        Go разработчик
      </a> <div class="tm-vacancies-block__vacancies-count">
        105
    вакансий
      </div></div></div> <footer class="tm-block__footer"><a href="https://career.habr.com/vacancies" class="tm-block-extralink">
      Все вакансии
    </a></footer></section></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/582464/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/582464/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"582464":{"id":"582464","timePublished":"2021-10-11T09:21:48+00:00","isCorporative":false,"lang":"ru","titleHtml":"Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger","leadData":{"textHtml":"\u003Cp\u003EПродолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Golang cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и даже немного интеграционных тестов.\u003C\u002Fp\u003E\u003Cp\u003EПодробности в видео и текстовой расшифровке под ним.\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F582294\u002F\" rel=\"noopener noreferrer nofollow\"\u003EВ первой части\u003C\u002Fa\u003E мы&nbsp;спроектировали систему&nbsp;и посмотрели, какие сервисы требуются для построения микросервисной архитектуры.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b8\u002F43f\u002F3b8\u002F1b843f3b814529c715da008f6c07c05a.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b8\u002F43f\u002F3b8\u002F1b843f3b814529c715da008f6c07c05a.jpg","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":8,"votesCount":32},"rating":16,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fwww.youtube.com\u002Fc\u002FTheArtofDevelopment","value":"https:\u002F\u002Fwww.youtube.com\u002Fc\u002FTheArtofDevelopment"},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Fdikkini","value":"dikkini"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Ftheartofdevel","value":"theartofdevel"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Ftheartofdevel","value":"theartofdevel"}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fwww.youtube.com\u002Fc\u002FTheArtofDevelopment","value":"https:\u002F\u002Fwww.youtube.com\u002Fc\u002FTheArtofDevelopment"},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Fdikkini","value":"dikkini"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Ftheartofdevel","value":"theartofdevel"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Ftheartofdevel","value":"theartofdevel"}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"65041","alias":"dikkini","fullname":"Артур","avatarUrl":null,"speciality":"Пользователь"},"statistics":{"commentsCount":2,"favoritesCount":66,"readingCount":4203,"score":4,"votesCount":6},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"17690","alias":"api","type":"collective","title":"API","titleHtml":"API","isProfiled":true},{"relatedData":null,"id":"17748","alias":"go","type":"collective","title":"Go","titleHtml":"Go","isProfiled":true},{"relatedData":null,"id":"22115","alias":"microservices","type":"collective","title":"Микросервисы","titleHtml":"Микросервисы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПродолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и даже немного интеграционных тестов.\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F582294\u002F\" rel=\"noopener noreferrer nofollow\"\u003EВ первой части\u003C\u002Fa\u003E мы спроектировали систему и посмотрели, какие сервисы требуются для построения микросервисной архитектуры.\u003C\u002Fp\u003E\u003Cp\u003EПодробности в видео и текстовой расшифровке под ним.\u003C\u002Fp\u003E\u003Cdiv class=\"tm-iframe_temp\" data-src=\"https:\u002F\u002Fembedd.srv.habr.com\u002Fiframe\u002F616063716a73daf6662a1b99\" data-style=\"\" id=\"616063716a73daf6662a1b99\" width=\"\"\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003EПрототипирование\u003C\u002Fh3\u003E\u003Cp\u003EНачнём с макетов интерфейса. Нам нужно понять, какие ручки будут у нашего API и какой состав данных он должен отдавать. Макеты мы будем делать, чтобы понять, какие сущности, поля и эндпоинты нам нужны. Используем для этого онлайн-сервис \u003Ca href=\"https:\u002F\u002Fninjamock.com\u002F\" rel=\"noopener noreferrer nofollow\"\u003ENinjaMock\u003C\u002Fa\u003E. Он подходит, если макет надо сделать быстро и без лишних действий.\u003C\u002Fp\u003E\u003Cp\u003EСтраницу регистрации сделаем простую, с четырьмя полями: Name, Email, Password и Repeat Password. Лейблы делать не будем, обойдемся плейсходерами. Авторизацию сделаем по юзернейму и паролю.\u003C\u002Fp\u003E\u003Cp\u003EПосле входа в приложение пользователь увидит список заметок, который будет выглядеть примерно так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Интерфейс веб-приложения для работы с заметками\" title=\"Интерфейс веб-приложения для работы с заметками\" height=\"1260\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd67\u002F42d\u002F503\u002Fd6742d503151d325627b2b361131e62e.png\" data-width=\"1435\"\u002F\u003E\u003Cfigcaption\u003EИнтерфейс веб-приложения для работы с заметками\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИнтерфейс, который будет у нашего веб-приложения\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EСлева — список категорий любой вложенности.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСправа — список заметок в виде карточек, который делится на два списка: прикреплённые и обычные карточки.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКаждая карточка состоит из заголовка, который урезается, если он очень длинный.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСправа указано, сколько секунд\u002Fминут\u002Fчасов\u002Fдней назад была создана заметка.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EТело заголовка — отрендеренный Markdown.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПанель инструментов. Через неё можно изменить цвет, прикрепить или удалить заметку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТут важно отметить, что файлы заметки мы не отображаем и не будем запрашивать у API для списка заметок.\u003C\u002Fp\u003E\u003Cp\u003EПолная карточка открывается по клику на заметку. Тут можно сразу отобразить полностью длинный заголовок. Высота заметки зависит от количества текста. Для файлов появляется отдельная секция. Мы их будем получать отдельным асинхронным запросом, который не помешает пользователю редактировать заметку. Файлы можно скачать по ссылке, также есть отдельная кнопка на добавление файлов.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Интерфейс заметки\" title=\"Интерфейс заметки\" height=\"542\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc95\u002F70f\u002F56a\u002Fc9570f56a842307ad2b02abf20bca498.png\" data-width=\"720\"\u002F\u003E\u003Cfigcaption\u003EИнтерфейс заметки\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТак будет выглядеть открытая заметка\u003C\u002Fp\u003E\u003Cp\u003EВ ходе прототипирования стало понятно, что в первой части мы забыли добавить еще один микросервис — TagsService. Он будет управлять тегами.\u003C\u002Fp\u003E\u003Ch3\u003EОпределение эндпоинтов\u003C\u002Fh3\u003E\u003Cp\u003EДля страниц авторизации и регистрации нам нужны эндпоинты аутентификации и регистрации соответственно. В качестве аутентификации и сессий пользователя мы будем использовать JWT. Что это такое и как работает, разберём чуть позднее. Пока просто запомните эти 3 буквы.\u003C\u002Fp\u003E\u003Cp\u003EДля страницы списка заметок нам нужны эндпоинты \u003Ccode\u003E\u002Fapi\u002Fcategories\u003C\u002Fcode\u003E для получения древовидного списка категорий и \u003Ccode\u003E\u002Fapi\u002Fnotes?category_id=?\u003C\u002Fcode\u003E для получения списка заметок текущей категории. Перемещаясь по другим категориям, мы будем отдельно запрашивать заметки для выбранной категории, а на фронтенде сделаем кэш на клиенте. В ходе работы с заметками нам нужно уметь создавать новую категорию. Это будет метод \u003Ccode\u003EPOST\u003C\u002Fcode\u003E на URL \u003Ccode\u003E\u002Fapi\u002Fcategories\u003C\u002Fcode\u003E. Также мы будем создавать новый тег при помощи метода \u003Ccode\u003EPOST\u003C\u002Fcode\u003E на URL \u003Ccode\u003E\u002Fapi\u002Ftags\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Эндпоинты\" title=\"Эндпоинты\" height=\"989\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd87\u002F501\u002F7f0\u002Fd875017f010412edadf0d6a56f9c55d5.png\" data-width=\"1919\"\u002F\u003E\u003Cfigcaption\u003EЭндпоинты\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EОпределяем эндпоинты\u003C\u002Fp\u003E\u003Cp\u003EЧтобы обновить заметку, используем метод \u003Ccode\u003EPATCH\u003C\u002Fcode\u003E на URL \u003Ccode\u003E\u002Fapi\u002Fnotes\u002F:uuid\u003C\u002Fcode\u003E с измененными полями. Делаем \u003Ccode\u003EPATCH\u003C\u002Fcode\u003E, а не \u003Ccode\u003EPUT\u003C\u002Fcode\u003E, потому что \u003Ccode\u003EPUT\u003C\u002Fcode\u003E требует отправки всех полей сущности по спецификации HTTP, а \u003Ccode\u003EPATCH\u003C\u002Fcode\u003E как раз нужен для частичного обновления.  Для отображения заметки нам ещё нужен эндпоинт \u003Ccode\u003E\u002Fapi\u002Fnotes\u002F:uuid\u002Ffiles\u003C\u002Fcode\u003E с методами \u003Ccode\u003EPOST\u003C\u002Fcode\u003E и \u003Ccode\u003EGET\u003C\u002Fcode\u003E. Также нам нужно скачивать файл, поэтому сделаем метод \u003Ccode\u003EGET\u003C\u002Fcode\u003E на URL \u003Ccode\u003E\u002Fapi\u002Ffiles\u002F:uuid\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Эндпоинты\" title=\"Эндпоинты\" height=\"1050\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F39c\u002Feb8\u002Fe05\u002F39ceb8e05011ae05ff3db3dee183aad8.png\" data-width=\"1847\"\u002F\u003E\u003Cfigcaption\u003EЭндпоинты\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЭндпоинты обновления заметки и работы с файлами\u003C\u002Fp\u003E\u003Ch3\u003EСтруктура репозитория системы\u003C\u002Fh3\u003E\u003Cp\u003EЕщё немного общей информации. Структура репозитория всей системы будет выглядеть следующим образом:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Структура\" title=\"Структура\" height=\"791\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F003\u002Fa14\u002Faaa\u002F003a14aaa3b0165628b79e74f3bb11ae.png\" data-width=\"1532\"\u002F\u003E\u003Cfigcaption\u003EСтруктура\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСтруктура проекта\u003C\u002Fp\u003E\u003Cp\u003EВ директории app будет исходный код сервиса (если он будет). На уровне с app будут другие директории других продуктов, которые используются с этим сервисом, например, MongoDB или ELK. Продукты, которые будут использоваться на уровне всей системы, например, Consul, будут в отдельных директориях на уровне с сервисами.\u003C\u002Fp\u003E\u003Ch3\u003EРазработка сервиса\u003C\u002Fh3\u003E\u003Cp\u003EПисать будем на Go\u003Cbr\u002F\u003EУстановка завершена, всё работает.\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EИдём на \u003Ca href=\"https:\u002F\u002Fgolang.org\u002Fdl\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eофициальный сайт\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКопируем ссылку до архива, скачиваем, проверяем хеш-сумму.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EРаспаковываем и добавляем в переменную PATH путь до бинарников Go\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПишем небольшой тест проверки работоспособности, собираем бинарник и запускаем.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"1165\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1ff\u002Fc23\u002Fc8e\u002F1ffc23c8e06f34520a8606933e46d0c2.png\" data-width=\"2041\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EУстановка завершена, всё работает\u003C\u002Fp\u003E\u003Cp\u003EТеперь создаём проект. Структура стандартная:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Ebuild — для сборок,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Ecmd — точка входа в приложение,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Einternal — внутренняя бизнес-логика приложения,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Epkg — для кода, который можно переиспользовать из проекта в проект.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EИсходники проекта — \u003C\u002Fstrong\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftheartofdevel\u002Fnotes_system\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cstrong\u003Eв репозитории на GitHub\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E\u003Cstrong\u003E.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EЯ очень люблю логировать ход работы приложения, поэтому перенесу свою обёртку над логером \u003Ccode\u003Elogrus\u003C\u002Fcode\u003E из другого проекта. Основная функция здесь \u003Ccode\u003EInit\u003C\u002Fcode\u003E, которая создает логер, папку \u003Ccode\u003Elogs\u003C\u002Fcode\u003E и в ней файл \u003Ccode\u003Eall.log\u003C\u002Fcode\u003E со всеми логами. Кроме файла логи будут выводиться в \u003Ccode\u003ESTDOUT\u003C\u002Fcode\u003E. Также в пакете реализована поддержка логирования в разные файлы с разным уровнем логирования, но в текущем проекте мы это использовать не будем.\u003C\u002Fp\u003E\u003Cp\u003EAPIService будет работать на сокете. Создаём роутер, затем файл с сокетом и начинаем его слушать. Также мы хотим перехватывать от системы сигналы завершения работы. Например, если кто-то пошлёт приложению сигнал \u003Ccode\u003ESIGHUP\u003C\u002Fcode\u003E, приложение должно корректно завершиться, закрыв все текущие соединения и сессии. Хотел перехватывать все сигналы, но линтер предупреждает, что \u003Ccode\u003Eos.Kill\u003C\u002Fcode\u003E и \u003Ccode\u003ESIGSTOP\u003C\u002Fcode\u003E перехватить не получится, поэтому их удаляем из этого списка.\u003C\u002Fp\u003E\u003Cp\u003EТеперь давайте добавим сразу стандартный \u003Ccode\u003Ehandler\u003C\u002Fcode\u003E для метрик. Я его копирую в директорию \u003Ccode\u003Epkg\u003C\u002Fcode\u003E, далее добавляю в роутер. Все последующие роутеры будем добавлять так же.\u003C\u002Fp\u003E\u003Cp\u003EДалее создаём точку входа в приложение. В  директории \u003Ccode\u003Ecmd\u003C\u002Fcode\u003E создаём директорию \u003Ccode\u003Emain\u003C\u002Fcode\u003E, а в ней — файл \u003Ccode\u003Eapp.go\u003C\u002Fcode\u003E. В нём мы создаём функцию \u003Ccode\u003Emain\u003C\u002Fcode\u003E, в которой инициализируем и создаём логер. Роутер создаём через ключевое слово \u003Ccode\u003Edefer\u003C\u002Fcode\u003E, чтобы метод \u003Ccode\u003EInit\u003C\u002Fcode\u003E у роутера вызвался только тогда, когда завершится функция \u003Ccode\u003Emain\u003C\u002Fcode\u003E. Таким образом можно выполнять очистку ресурсов, закрытие контекстов и отложенный запуск методов. Запускаем, проверяем логи и сокет, всё работает.\u003C\u002Fp\u003E\u003Cp\u003EНо для разработки нам нужно запускать приложение на порту, а не на сокете. Поэтому давайте добавим запуск приложения на порту в наш роутер. Определять, как запускать приложение, мы будем с помощью конфига.\u003C\u002Fp\u003E\u003Cp\u003EСоздадим для приложения контекст. Сделаем его синглтоном при помощи механизма \u003Ccode\u003Esync.Once\u003C\u002Fcode\u003E. Пока что в нём будет только конфиг. Контекст в виде синглтона создаю исключительно в учебных целях, впоследствии он будет выпилен. В большинстве случаев синглтоны — необходимое зло, в нашем проекте они не нужны. Далее создаём конфиг. Это будет YAML-файл, который мы будем парсить в структуру.\u003C\u002Fp\u003E\u003Cp\u003EВ роутере мы вытаскиваем из контекста конфиг и на основании \u003Ccode\u003Elisten.type\u003C\u002Fcode\u003E либо создаем сокет, либо вешаем приложение на порт. Код graceful shutdown выделяем в отдельный пакет и передаём на вход список сигналов и список интерфейсов \u003Ccode\u003Eio.Close\u003C\u002Fcode\u003E, которые надо закрывать. Запускаем приложение и проверяем наш эндпоинт \u003Ccode\u003Eheartbeat\u003C\u002Fcode\u003E.  Всё работает. Давайте и конфиг сделаем синглтоном через механизм \u003Ccode\u003Esync.Once\u003C\u002Fcode\u003E, чтобы потом безболезненно удалить контекст, который создавался в учебных целях.\u003C\u002Fp\u003E\u003Cp\u003EТеперь переходим к API. Создаём эндпоинты, полученные при анализе прототипов интерфейса. Тут важно отметить, что у нас все данные привязаны к пользователю. На первый взгляд, все ручки должны начинаться с пользователя и его идентификатора \u003Ccode\u003E\u002Fapi\u002Fusers\u002F:uuid\u003C\u002Fcode\u003E. Но у нас будет авторизация, иначе любой пользователь сможет программно запросить заметки любого другого пользователя. Авторизацию можно сделать следующим образом: Basic Auth, Digest Auth, JSON Web Token, сессии и OAuth2. У всех способов есть свои плюсы и минусы. Для этого проекта мы возьмём JSON Web Token.\u003C\u002Fp\u003E\u003Ch3\u003EРабота с JSON Web Token\u003C\u002Fh3\u003E\u003Cp\u003EJSON Web Token (JWT) — это JSON-объект, который определён в открытом стандарте \u003Ca href=\"https:\u002F\u002Fdatatracker.ietf.org\u002Fdoc\u002Fhtml\u002Frfc7519\" rel=\"noopener noreferrer nofollow\"\u003ERFC 7519\u003C\u002Fa\u003E. Он считается одним из безопасных способов передачи информации между двумя участниками. Для его создания необходимо определить заголовок (header) с общей информацией по токену, полезные данные (payload), такие как id пользователя, его роль и т.д., а также подписи (signature).\u003C\u002Fp\u003E\u003Cp\u003EJWT использует преимущества подхода цифровой подписи JWS (Signature) и кодирования JWE (Encrypting). Подпись не даёт кому-то подделать токен без информации о секретном ключе, а кодирование защищает от прочтения данных третьими лицами. Давайте разберёмся, как они могут нам помочь для аутентификации и авторизации пользователя.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EАутентификация — процедура проверки подлинности.  Мы проверяем, есть ли пользователь с полученной связкой логин-пароль в нашей системе.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EАвторизация — предоставление пользователю прав на выполнение определённых действий, а также процесс проверки (подтверждения) данных прав при попытке выполнения этих действий.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EДругими словами, аутентификация проверяет легальность пользователя. Пользователь становится авторизированным, если может выполнять разрешённые действия.\u003C\u002Fp\u003E\u003Cp\u003EВажно понимать, что использование JWT \u003Cstrong\u003Eне скрывает и не маскирует данные автоматически\u003C\u002Fstrong\u003E. Причина использования JWT — проверка, что отправленные данные были действительно отправлены авторизованным источником. Данные внутри JWT закодированы и подписаны, но не зашифрованы. Цель кодирования данных — преобразование структуры. Подписанные данные позволяют получателю данных проверить аутентификацию источника данных.\u003C\u002Fp\u003E\u003Ch3\u003EРеализация JWT в нашем APIService\u003C\u002Fh3\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EСоздаём директории \u003Ccode\u003Emiddleware\u003C\u002Fcode\u003E и \u003Ccode\u003Ejwt\u003C\u002Fcode\u003E, а также файл \u003Ccode\u003Ejwt.go\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОписываем кастомные \u003Ccode\u003EUserClaims\u003C\u002Fcode\u003E и сам \u003Ccode\u003Emiddlware\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПолучаем заголовок \u003Ccode\u003EAuthorization\u003C\u002Fcode\u003E, оттуда берём токен.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EБерём секрет из конфига.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздаём верификатор HMAC.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПарсим и проверяем токен.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EАнмаршалим полученные данные в модель \u003Ccode\u003EUserClaims\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПроверяем, что токен валидный на текущий момент.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EПри любой ошибке отдаём ответ с кодом \u003Ccode\u003E401 Unauthorized\u003C\u002Fcode\u003E. Если ошибок не было, в контекст сохраняем ID пользователя в параметр \u003Ccode\u003Euser_id\u003C\u002Fcode\u003E, чтобы во всех хендлерах его можно было получить. Теперь надо этот токен сгенерировать. Это будет делать хендлер авторизации с методом \u003Ccode\u003EPOST\u003C\u002Fcode\u003E и эндпоинтом \u003Ccode\u003E\u002Fapi\u002Fauth\u003C\u002Fcode\u003E. Он получает входные данные в виде полей username и password, которые мы описываем отдельной структурой \u003Ccode\u003Euser\u003C\u002Fcode\u003E. Здесь также будет взаимодействие с \u003Ccode\u003EUserService\u003C\u002Fcode\u003E, нам надо там искать пользователя по полученным данным. Если такой пользователь есть, то создаём для него \u003Ccode\u003EUserClaims\u003C\u002Fcode\u003E, в которых указываем все нужные для нас данные. Определяем время жизни токена при помощи переменной \u003Ccode\u003EExpiresAt\u003C\u002Fcode\u003E — берём текущее время и добавляем 15 секунд. Билдим токен и отдаём в виде JSON в параметре \u003Ccode\u003Etoken\u003C\u002Fcode\u003E. Клиента к \u003Ccode\u003EUserService\u003C\u002Fcode\u003E у нас пока нет, поэтому делаем заглушку.\u003C\u002Fp\u003E\u003Cp\u003EДобавим в хендлер с heartbeat еще один тестовый хендлер, чтобы проверить работу аутентификации. Пишем небольшой тест. Для этого используем инструмент \u003Ccode\u003Esketch\u003C\u002Fcode\u003E, встроенный в IDE. Делаем \u003Ccode\u003EPOST\u003C\u002Fcode\u003E-запрос на \u003Ccode\u003E\u002Fapi\u002Fauth\u003C\u002Fcode\u003E, получаем токен и подставляем его в следующий запрос. Получаем ответ от эндпоинта \u003Ccode\u003E\u002Fapi\u002Fheartbeat\u003C\u002Fcode\u003E, по истечении 5 секунд мы начнём получать ошибку с кодом \u003Ccode\u003E401 Unauthorized\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНаш токен действителен очень ограниченное время. Сейчас это 15 секунд, а будет минут 30. Но этого всё равно мало. Когда токен протухнет, пользователю необходимо будет заново авторизовываться в системе. Это сделано для того, чтобы защитить пользовательские данные. Если злоумышленник украдет токен авторизации, который будет действовать очень большой промежуток времени или вообще бессрочно, то это будет провал.\u003C\u002Fp\u003E\u003Cp\u003EЧтобы этого избежать, прикрутим refresh-токен. Он позволит пересоздать основной токен доступа без запроса данных авторизации пользователя. Такие токены живут очень долго или вообще бессрочно. После того как только старый JWT истекает мы больше не можем обратиться к API. Тогда отправляем refresh-токен. Нам приходит новая пара токена доступа и refresh-токена.\u003C\u002Fp\u003E\u003Cp\u003EХранить refresh-токены на сервере мы будем в кэше. В качестве реализации возьмём \u003Ccode\u003EFreeCache\u003C\u002Fcode\u003E. Я использую свою обёртку над кэшем из другого проекта, которая позволяет заменить реализацию \u003Ccode\u003EFreeCache\u003C\u002Fcode\u003E на любую другую, так как отдает интерфейс Repository с методами, которые никак не связаны с библиотекой.\u003C\u002Fp\u003E\u003Cp\u003EПока рассуждал про кэш, решил зарефакторить существующий код, чтобы было удобней прокидывать объекты без dependency injection и синглтонов. Обернул хендлеры и роутер в структуры. В хендлерах сделал интерфейс с методом \u003Ccode\u003ERegister\u003C\u002Fcode\u003E, которые регистрируют его в роутере. Все объекты теперь инициализируются в \u003Ccode\u003Emain\u003C\u002Fcode\u003E, весь роутер переехал в мейн. Старт приложения выделили в отдельную функцию также в \u003Ccode\u003Emain\u003C\u002Fcode\u003E-файле. Теперь, если хендлеру нужен какой-то объект, я его просто буду добавлять в конструктор структуры хендлера, а инициализировать в \u003Ccode\u003Emain\u003C\u002Fcode\u003E. Плюс появилась возможность прокидывать всем хендлерам свой логер. Это будет удобно когда надо будет добавлять поле \u003Ccode\u003Etrace_id\u003C\u002Fcode\u003E от Zipkin в строчку лога.\u003C\u002Fp\u003E\u003Cp\u003EВернемся к refresh_token. Теперь при создании токена доступа создадим \u003Ccode\u003Erefresh_token\u003C\u002Fcode\u003E и отдадим его вместе с основным. Сделаем обработку метода \u003Ccode\u003EPUT\u003C\u002Fcode\u003E для эндпоинта \u003Ccode\u003E\u002Fapi\u002Fauth\u003C\u002Fcode\u003E, а в теле запроса будем ожидать параметр \u003Ccode\u003Erefresh_token\u003C\u002Fcode\u003E, чтобы сгенерировать новую пару токена доступа и refresh-токена. Refresh-токен мы кладём в кэш в качестве ключа. Значением будет \u003Ccode\u003Euser_id\u003C\u002Fcode\u003E, чтобы по нему можно было запросить данные пользователя у \u003Ccode\u003EUserService\u003C\u002Fcode\u003E и сгенерировать новый токен доступа. Refresh-токен одноразовый, поэтому сразу после получения токена из кэша удаляем его.\u003C\u002Fp\u003E\u003Ch3\u003EОписание API\u003C\u002Fh3\u003E\u003Cp\u003EДля описания нашего API будем использовать спецификацию OpenAPI 3.0 и Swagger — YAML-файл, который описывает все схемы данных и все эндпоинты. По нему очень легко ориентироваться, у него приятный интерфейс. Но описывать вручную всё очень муторно, поэтому лучше генерировать его кодом.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EСоздаём эндпоинты \u003Ccode\u003E\u002Fapi\u002Fauth\u003C\u002Fcode\u003E с методами \u003Ccode\u003EPOST\u003C\u002Fcode\u003E и \u003Ccode\u003EPUT\u003C\u002Fcode\u003E для получения токена по юзернейму и паролю и по Refresh-токену соответственно.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДобавляем схемы объектов \u003Ccode\u003EToken\u003C\u002Fcode\u003E и \u003Ccode\u003EUser\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздаём эндпоинты \u003Ccode\u003E\u002Fapi\u002Fusers\u003C\u002Fcode\u003E с методом \u003Ccode\u003EPOST\u003C\u002Fcode\u003E для регистрации нового пользователя. Для него создаём схему CreateUser.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПонимаем, что забыли сделать хендлер для регистрации пользователя. Создаём метод \u003Ccode\u003ESignup\u003C\u002Fcode\u003E у хенлера \u003Ccode\u003EAuth\u003C\u002Fcode\u003E и структуру \u003Ccode\u003EnewUser\u003C\u002Fcode\u003E со всеми полями для регистрации. Генерацию JWT выделяем в отдельный метод, чтобы можно было его вызывать как в \u003Ccode\u003EAuth\u003C\u002Fcode\u003E, так и в \u003Ccode\u003ESignup\u003C\u002Fcode\u003E-хендлерах. У нас всё еще нет \u003Ccode\u003EUserService\u003C\u002Fcode\u003E, поэтому проставляем TODO. Нам надо будет провалидировать полученные данные от пользователя и потом отправить их в \u003Ccode\u003EUserService\u003C\u002Fcode\u003E, чтобы он уже создал пользователя и ответил нам об успехе. Далее вызываем функцию создания пары токена доступа и refresh-токена и отдаём с кодом 201.\u003C\u002Fp\u003E\u003Cp\u003EУ нас есть подсказка в виде Swagger-файла. На его основе  создаём все нужные хендлеры. Там, где вызов микросервисов, будем проставлять комментарий с TODO.\u003C\u002Fp\u003E\u003Cp\u003EСоздаём хендлер для категорий, определяем URL в константах. Далее создаём структуры. Опираемся на Swagger-файл, который создали ранее. Далее создаём сам хендлер и реализуем метод \u003Ccode\u003ERegister\u003C\u002Fcode\u003E, который регистрирует его в роутере. Затем создаём методы с логикой работы и сразу пишем тест API на этот метод. Проверяем, находим ошибки в сваггере. Таким образом мы создаём все методы по работе с категориями: получение и создание.\u003C\u002Fp\u003E\u003Cp\u003EДалее создаём таким же образом хендлер для заметок. Понимаем, что забыли методы частичного обновления и удаления как для заметок, так и для категорий. Дописываем их в Swagger и реализуем методы в коде. Также обязательно тестируем Swagger в онлайн-редакторе.\u003C\u002Fp\u003E\u003Cp\u003EЗдесь надо обратить внимание на то, что методы создания сущности возвращают код ответа 201 и заголовок \u003Ccode\u003ELocation\u003C\u002Fcode\u003E, в котором находится URL для получения сущности. Оттуда можно вытащить идентификатор созданной сущности.\u003C\u002Fp\u003E\u003Cp\u003EВ третьей части мы познакомимся с графовой базой данных Neo4j, а также будем работать над микросервисами CategoryService и APIService.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"go"},{"titleHtml":"api"},{"titleHtml":"rest"},{"titleHtml":"swagger"},{"titleHtml":"mockups"},{"titleHtml":"ninjamock"},{"titleHtml":"jwt"},{"titleHtml":"openapi"},{"titleHtml":"programming"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b8\u002F43f\u002F3b8\u002F1b843f3b814529c715da008f6c07c05a.jpg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b8\u002F43f\u002F3b8\u002F1b843f3b814529c715da008f6c07c05a.jpg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582464\\\u002F\"},\"headline\":\"Разработка системы заметок с нуля. Часть 2: REST API для RESTful API Service + JWT + Swagger\",\"datePublished\":\"2021-10-11T12:21:48+03:00\",\"dateModified\":\"2021-10-11T14:21:35+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Артур\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет м...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582464\\\u002F#post-content-body\",\"about\":[\"h_webdev\",\"h_api\",\"h_go\",\"h_microservices\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F582464\\\u002Fed3a542e6132b654d2a798ce60e3cdaa\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd67\\\u002F42d\\\u002F503\\\u002Fd6742d503151d325627b2b361131e62e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc95\\\u002F70f\\\u002F56a\\\u002Fc9570f56a842307ad2b02abf20bca498.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd87\\\u002F501\\\u002F7f0\\\u002Fd875017f010412edadf0d6a56f9c55d5.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F39c\\\u002Feb8\\\u002Fe05\\\u002F39ceb8e05011ae05ff3db3dee183aad8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F003\\\u002Fa14\\\u002Faaa\\\u002F003a14aaa3b0165628b79e74f3bb11ae.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1ff\\\u002Fc23\\\u002Fc8e\\\u002F1ffc23c8e06f34520a8606933e46d0c2.png\"]}","metaDescription":"Продолжаем серию материалов про создание системы заметок. В этой части мы спроектируем и разработаем RESTful API Service на Go cо Swagger и авторизацией. Будет много кода, ещё больше рефакторинга и...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[{"title":"Go разработчик","vacanciesCount":105,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fgo_razrabotchik","itemHubs":["go"]}],"hubs":"webdev,api,go,microservices"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
