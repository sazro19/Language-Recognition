<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Из Java в Kotlin: туда и обратно / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/583850\/"},"headline":"Из Java в Kotlin: туда и обратно","datePublished":"2021-10-24T18:00:02+03:00","dateModified":"2021-10-24T18:00:02+03:00","author":{"@type":"Person","name":"pyltsinm"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Jav...","url":"https:\/\/habr.com\/ru\/post\/583850\/#post-content-body","about":["h_java","h_kotlin","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/583850\/aedd0d6a692461ac1468efd261e0e0d9\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Из Java в Kotlin: туда и обратно" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Из Java в Kotlin: туда и обратно" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Из Java в Kotlin: туда и обратно" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/ced/0cf/77f/ced0cf77f1dfccc0fe388edc07c12d6a.jpg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/ced/0cf/77f/ced0cf77f1dfccc0fe388edc07c12d6a.jpg" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/ced/0cf/77f/ced0cf77f1dfccc0fe388edc07c12d6a.jpg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/ced/0cf/77f/ced0cf77f1dfccc0fe388edc07c12d6a.jpg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/ced/0cf/77f/ced0cf77f1dfccc0fe388edc07c12d6a.jpg" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="583850" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-24T15:00:02.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/583850/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/583850/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/ced/0cf/77f/ced0cf77f1dfccc0fe388edc07c12d6a.jpg" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/583850/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/pyltsinm/" title="pyltsinm" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/pyltsinm/" class="tm-user-info__username">
      pyltsinm
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-24T15:00:02.000Z" title="2021-10-24, 18:00">вчера в 18:00</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Из Java в Kotlin: туда и обратно</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/java/" class="tm-article-snippet__hubs-item-link"><span>Java</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/kotlin/" class="tm-article-snippet__hubs-item-link"><span>Kotlin</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут рассматриваться плюсы и минусы того или иного языка - здесь и так сломано много копий (некоторые статьи на habr: <a href="https://habr.com/ru/post/461877/" rel="noopener noreferrer nofollow">1</a>, <a href="https://habr.com/ru/company/funcorp/blog/558412/" rel="noopener noreferrer nofollow">2</a>, <a href="https://habr.com/ru/post/331280/" rel="noopener noreferrer nofollow">3</a>) и, как мне кажется, каждая команда должна это решать для себя. Рассматривается стандартный стек Spring WebMVC (не реактивный)</p><h4>Содержание</h4><ul><li><p><a href="#description" rel="noopener noreferrer nofollow">Краткое описание микросервиса, с которым будем работать</a></p></li><li><p>С чего начать</p><ul><li><p><a href="#test" rel="noopener noreferrer nofollow">Переводим тесты на Kotlin</a></p></li><li><p><a href="#on" rel="noopener noreferrer nofollow">Подключаем Kotlin в проект</a></p></li></ul></li><li><p><a href="#plugins" rel="noopener noreferrer nofollow">Kotlin plugins</a></p></li><li><p><a href="#Spring" rel="noopener noreferrer nofollow">Работа со Spring</a></p></li><li><p><a href="#hibernate" rel="noopener noreferrer nofollow">Работа с Hibernate</a></p></li><li><p>Остальные библиотеки</p><ul><li><p><a href="#Jackson" rel="noopener noreferrer nofollow">Jackson</a></p></li><li><p><a href="#MapStruct" rel="noopener noreferrer nofollow">MapStruct</a></p></li><li><p><a href="#Lombok" rel="noopener noreferrer nofollow">Lombok</a></p></li><li><p><a href="#mockito" rel="noopener noreferrer nofollow">Mockito</a></p></li><li><p><a href="#log" rel="noopener noreferrer nofollow">Логирование</a></p></li></ul></li><li><p><a href="#end" rel="noopener noreferrer nofollow">Выводы</a></p></li><li><p><a href="#reference" rel="noopener noreferrer nofollow">Использованные материалы</a></p></li></ul><h2>Краткое описание микросервиса, с которым будем работать</h2><p>До перевода на Kotlin использовался такой стек:</p><ul><li><p>Java 11</p></li><li><p>Spring Web MVC (в рамках Spring Boot)</p></li><li><p>Spring Data JPA</p></li><li><p>Map Struct</p></li><li><p>Lombook</p></li><li><p>Maven</p></li></ul><h2>С чего начать</h2><a class="anchor" name="test" id="test"></a><h3>Переводим тесты на Kotlin</h3><p>Первая рекомендация, которую вы найдете, - начинайте с тестов. В рамках своего проекта - подтверждаем, что это самый правильный путь. Пока вы будете добавлять тесты на Kotlin в проект, вы пройдете через следующие этапы:</p><ol><li><p>Настроите сборку совместно с Kotlin</p></li><li><p>Добавите требуемые библиотеки</p></li><li><p>Поймаете основные ошибки</p></li><li><p>Наконец-то напишите тесты на давно заброшенные участки кода</p></li></ol><p>И при этом основной код, отвечающий за бизнес-логику затронут не будет. Начать с тестов нам очень помогло, даже хотя бы тем, что поймали пару ошибок в нашей существующей бизнес-логике.</p><a class="anchor" name="on" id="on"></a><h3>Подключаем Kotlin в проект</h3><h4>Несколько слов о Gradle Kotlin DSL</h4><p>Дополнительно к стандартному набору для сборки пакетов (Maven и Gradle на Groovy) теперь добавился еще один - Gradle Kotlin DSL. Это может быть хорошим вариантом для тех, кто хотел бы использовать Gradle, но смущала необходимость использовать Groovy. </p><p>Из плюсов данного решения - более корректные подсказки в IDEA (хотя, если честно, IDEA сильно тормозит при анализе build.gradle.kt файлов). Одним из главных неудобств, как мне кажется, является то, что не все возможности Gradle на Groovy реализованы или реализованы не зеркально, и поэтому многие подсказки со stackoverflow не будут работать. Поэтому мы остались на привычном нам Maven.</p><h4>Maven</h4><p>Если вы используете стек Spring-boot, то рекомендую для начала создать тестовый проект с нуля через <a href="https://start.spring.io/" rel="noopener noreferrer nofollow">https://start.spring.io/</a>. </p><p>Ниже приведены 2 pom.xml файла, которые создает <a href="https://start.spring.io/" rel="noopener noreferrer nofollow">https://start.spring.io/</a> для Java и Kotlin.</p><details class="spoiler"><summary>pom.xml для Java</summary><div class="spoiler__content"><pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    &lt;modelVersion>4.0.0&lt;/modelVersion>
    &lt;parent>
        &lt;groupId>org.springframework.boot&lt;/groupId>
        &lt;artifactId>spring-boot-starter-parent&lt;/artifactId>
        &lt;version>2.5.5&lt;/version>
        &lt;relativePath/> &lt;!-- lookup parent from repository -->
    &lt;/parent>
    &lt;groupId>com.example&lt;/groupId>
    &lt;artifactId>demo-java&lt;/artifactId>
    &lt;version>0.0.1-SNAPSHOT&lt;/version>
    &lt;name>demo-java&lt;/name>
    &lt;description>demo-java&lt;/description>
    &lt;properties>
        &lt;java.version>11&lt;/java.version>
    &lt;/properties>
    &lt;dependencies>
        &lt;dependency>
            &lt;groupId>org.springframework.boot&lt;/groupId>
            &lt;artifactId>spring-boot-starter-data-jpa&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.springframework.boot&lt;/groupId>
            &lt;artifactId>spring-boot-starter-web&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.liquibase&lt;/groupId>
            &lt;artifactId>liquibase-core&lt;/artifactId>
        &lt;/dependency>

        &lt;dependency>
            &lt;groupId>com.h2database&lt;/groupId>
            &lt;artifactId>h2&lt;/artifactId>
            &lt;scope>runtime&lt;/scope>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.projectlombok&lt;/groupId>
            &lt;artifactId>lombok&lt;/artifactId>
            &lt;optional>true&lt;/optional>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.springframework.boot&lt;/groupId>
            &lt;artifactId>spring-boot-starter-test&lt;/artifactId>
            &lt;scope>test&lt;/scope>
        &lt;/dependency>
    &lt;/dependencies>

    &lt;build>
        &lt;plugins>
            &lt;plugin>
                &lt;groupId>org.springframework.boot&lt;/groupId>
                &lt;artifactId>spring-boot-maven-plugin&lt;/artifactId>
                &lt;configuration>
                    &lt;excludes>
                        &lt;exclude>
                            &lt;groupId>org.projectlombok&lt;/groupId>
                            &lt;artifactId>lombok&lt;/artifactId>
                        &lt;/exclude>
                    &lt;/excludes>
                &lt;/configuration>
            &lt;/plugin>
        &lt;/plugins>
    &lt;/build>

&lt;/project></code></pre></div></details><details class="spoiler"><summary>pom.xml для Kotlin</summary><div class="spoiler__content"><pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    &lt;modelVersion>4.0.0&lt;/modelVersion>
    &lt;parent>
        &lt;groupId>org.springframework.boot&lt;/groupId>
        &lt;artifactId>spring-boot-starter-parent&lt;/artifactId>
        &lt;version>2.5.5&lt;/version>
        &lt;relativePath/> &lt;!-- lookup parent from repository -->
    &lt;/parent>
    &lt;groupId>com.example&lt;/groupId>
    &lt;artifactId>demo-kotlin&lt;/artifactId>
    &lt;version>0.0.1-SNAPSHOT&lt;/version>
    &lt;name>demo-kotlin&lt;/name>
    &lt;description>demo-kotlin&lt;/description>
    &lt;properties>
        &lt;java.version>11&lt;/java.version>
        &lt;kotlin.version>1.5.31&lt;/kotlin.version>
    &lt;/properties>
    &lt;dependencies>
        &lt;dependency>
            &lt;groupId>org.springframework.boot&lt;/groupId>
            &lt;artifactId>spring-boot-starter-data-jpa&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.springframework.boot&lt;/groupId>
            &lt;artifactId>spring-boot-starter-web&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>com.fasterxml.jackson.module&lt;/groupId>
            &lt;artifactId>jackson-module-kotlin&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
            &lt;artifactId>kotlin-reflect&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
            &lt;artifactId>kotlin-stdlib-jdk8&lt;/artifactId>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.liquibase&lt;/groupId>
            &lt;artifactId>liquibase-core&lt;/artifactId>
        &lt;/dependency>

        &lt;dependency>
            &lt;groupId>com.h2database&lt;/groupId>
            &lt;artifactId>h2&lt;/artifactId>
            &lt;scope>runtime&lt;/scope>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.projectlombok&lt;/groupId>
            &lt;artifactId>lombok&lt;/artifactId>
            &lt;optional>true&lt;/optional>
        &lt;/dependency>
        &lt;dependency>
            &lt;groupId>org.springframework.boot&lt;/groupId>
            &lt;artifactId>spring-boot-starter-test&lt;/artifactId>
            &lt;scope>test&lt;/scope>
        &lt;/dependency>
    &lt;/dependencies>

    &lt;build>
        &lt;sourceDirectory>${project.basedir}/src/main/kotlin&lt;/sourceDirectory>
        &lt;testSourceDirectory>${project.basedir}/src/test/kotlin&lt;/testSourceDirectory>
        &lt;plugins>
            &lt;plugin>
                &lt;groupId>org.springframework.boot&lt;/groupId>
                &lt;artifactId>spring-boot-maven-plugin&lt;/artifactId>
                &lt;configuration>
                    &lt;excludes>
                        &lt;exclude>
                            &lt;groupId>org.projectlombok&lt;/groupId>
                            &lt;artifactId>lombok&lt;/artifactId>
                        &lt;/exclude>
                    &lt;/excludes>
                &lt;/configuration>
            &lt;/plugin>
            &lt;plugin>
                &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
                &lt;artifactId>kotlin-maven-plugin&lt;/artifactId>
                &lt;configuration>
                    &lt;args>
                        &lt;arg>-Xjsr305=strict&lt;/arg>
                    &lt;/args>
                    &lt;compilerPlugins>
                        &lt;plugin>spring&lt;/plugin>
                        &lt;plugin>jpa&lt;/plugin>
                    &lt;/compilerPlugins>
                &lt;/configuration>
                &lt;dependencies>
                    &lt;dependency>
                        &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
                        &lt;artifactId>kotlin-maven-allopen&lt;/artifactId>
                        &lt;version>${kotlin.version}&lt;/version>
                    &lt;/dependency>
                    &lt;dependency>
                        &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
                        &lt;artifactId>kotlin-maven-noarg&lt;/artifactId>
                        &lt;version>${kotlin.version}&lt;/version>
                    &lt;/dependency>
                &lt;/dependencies>
            &lt;/plugin>
        &lt;/plugins>
    &lt;/build>

&lt;/project></code></pre></div></details><p>Давайте рассмотрим, в чем разница с Java проектом по мнению <a href="https://start.spring.io/" rel="noopener noreferrer nofollow">https://start.spring.io/</a>:</p><ul><li><p>Добавилась версия Kotlin</p></li></ul><pre><code class="xml">&lt;properties>
 ....
  &lt;kotlin.version>1.5.31&lt;/kotlin.version>
&lt;/properties></code></pre><ul><li><p>Добавились 2 стандартных библиотеки для работы с Kotlin и библиотека для Jackson (про нее - <a href="#Jackson" rel="noopener noreferrer nofollow">ниже</a>)</p></li></ul><pre><code class="xml">&lt;dependency>
  &lt;groupId>com.fasterxml.jackson.module&lt;/groupId>
  &lt;artifactId>jackson-module-kotlin&lt;/artifactId>
&lt;/dependency>
&lt;dependency>
  &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
  &lt;artifactId>kotlin-reflect&lt;/artifactId>
&lt;/dependency>
&lt;dependency>
  &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
  &lt;artifactId>kotlin-stdlib-jdk8&lt;/artifactId>
&lt;/dependency></code></pre><ul><li><p>В раздел build добавился раздел про Kotlin</p></li></ul><pre><code class="xml">    &lt;build>
        &lt;sourceDirectory>${project.basedir}/src/main/kotlin&lt;/sourceDirectory>
        &lt;testSourceDirectory>${project.basedir}/src/test/kotlin&lt;/testSourceDirectory>
        &lt;plugins>
          .....
            &lt;plugin>
                &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
                &lt;artifactId>kotlin-maven-plugin&lt;/artifactId>
                &lt;configuration>
                    &lt;args>
                        &lt;arg>-Xjsr305=strict&lt;/arg>
                    &lt;/args>
                    &lt;compilerPlugins>
                        &lt;plugin>spring&lt;/plugin>
                        &lt;plugin>jpa&lt;/plugin>
                    &lt;/compilerPlugins>
                &lt;/configuration>
                &lt;dependencies>
                    &lt;dependency>
                        &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
                        &lt;artifactId>kotlin-maven-allopen&lt;/artifactId>
                        &lt;version>${kotlin.version}&lt;/version>
                    &lt;/dependency>
                    &lt;dependency>
                        &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
                        &lt;artifactId>kotlin-maven-noarg&lt;/artifactId>
                        &lt;version>${kotlin.version}&lt;/version>
                    &lt;/dependency>
                &lt;/dependencies>
            &lt;/plugin>
        &lt;/plugins>
    &lt;/build></code></pre><p>Подробнее про <em>kotlin-maven-plugin </em>можно прочитать <a href="https://kotlinlang.org/docs/maven.html" rel="noopener noreferrer nofollow">здесь</a>.</p><p>Данная конфигурация подойдет только, если у вас в проекте не будет кода на Java. Если вы хотите использовать оба языка (что и происходит при миграции), то нужно добавить и корректно настроить maven-compiler-plugin. (Пример можно посмотреть <a href="https://kotlinlang.org/docs/maven.html#compile-kotlin-and-java-sources" rel="noopener noreferrer nofollow">здесь </a>или <a href="https://www.baeldung.com/kotlin/maven-java-project" rel="noopener noreferrer nofollow">здесь</a>)</p><details class="spoiler"><summary>Пример для Kotlin и Java</summary><div class="spoiler__content"><pre><code class="xml">&lt;build>
  &lt;plugins>
    .....
    &lt;plugin>
      &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
      &lt;artifactId>kotlin-maven-plugin&lt;/artifactId>
      &lt;executions>
        &lt;execution>
          &lt;id>compile&lt;/id>
          &lt;goals>
            &lt;goal>compile&lt;/goal>
          &lt;/goals>
          &lt;configuration>
            &lt;sourceDirs>
              &lt;sourceDir>${project.basedir}/src/main/kotlin&lt;/sourceDir>
              &lt;sourceDir>${project.basedir}/src/main/java&lt;/sourceDir>
            &lt;/sourceDirs>
          &lt;/configuration>
        &lt;/execution>
        &lt;execution>
          &lt;id>test-compile&lt;/id>
          &lt;goals> &lt;goal>test-compile&lt;/goal> &lt;/goals>
          &lt;configuration>
            &lt;sourceDirs>
              &lt;sourceDir>${project.basedir}/src/test/kotlin&lt;/sourceDir>
              &lt;sourceDir>${project.basedir}/src/test/java&lt;/sourceDir>
            &lt;/sourceDirs>
          &lt;/configuration>
        &lt;/execution>
      &lt;/executions>
      &lt;configuration>
        &lt;args>
          &lt;arg>-Xjsr305=strict&lt;/arg>
        &lt;/args>
        &lt;compilerPlugins>
          &lt;plugin>spring&lt;/plugin>
          &lt;plugin>jpa&lt;/plugin>
        &lt;/compilerPlugins>
      &lt;/configuration>
      &lt;dependencies>
        &lt;dependency>
          &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
          &lt;artifactId>kotlin-maven-allopen&lt;/artifactId>
          &lt;version>${kotlin.version}&lt;/version>
        &lt;/dependency>
        &lt;dependency>
          &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
          &lt;artifactId>kotlin-maven-noarg&lt;/artifactId>
          &lt;version>${kotlin.version}&lt;/version>
        &lt;/dependency>
      &lt;/dependencies>
    &lt;/plugin>
    &lt;plugin>
      &lt;groupId>org.apache.maven.plugins&lt;/groupId>
      &lt;artifactId>maven-compiler-plugin&lt;/artifactId>
      &lt;executions>
        &lt;!-- Replacing default-compile as it is treated specially by maven -->
        &lt;execution>
          &lt;id>default-compile&lt;/id>
          &lt;phase>none&lt;/phase>
        &lt;/execution>
        &lt;!-- Replacing default-testCompile as it is treated specially by maven -->
        &lt;execution>
          &lt;id>default-testCompile&lt;/id>
          &lt;phase>none&lt;/phase>
        &lt;/execution>
        &lt;execution>
          &lt;id>java-compile&lt;/id>
          &lt;phase>compile&lt;/phase>
          &lt;goals>
            &lt;goal>compile&lt;/goal>
          &lt;/goals>
        &lt;/execution>
        &lt;execution>
          &lt;id>java-test-compile&lt;/id>
          &lt;phase>test-compile&lt;/phase>
          &lt;goals>
            &lt;goal>testCompile&lt;/goal>
          &lt;/goals>
        &lt;/execution>
      &lt;/executions>
    &lt;/plugin>
  &lt;/plugins>
&lt;/build>
</code></pre></div></details><p><code>-Xjsr305=strict</code> позволяет Kotlin корректно использоваться nullable-типы для некоторых api Spring (<a href="https://docs.spring.io/spring-boot/docs/2.0.x/reference/html/boot-features-kotlin.html#boot-features-kotlin-null-safety" rel="noopener noreferrer nofollow">ссылка</a>) </p><p>Про плагины All-open и No-arg будет подробнее рассказано нижe.</p><a class="anchor" name="plugins" id="plugins"></a><h3>Kotlin plugins</h3><p>Для изменения процесса компиляции в Kotlin используются <a href="https://kotlinlang.org/docs/all-open-plugin.html" rel="noopener noreferrer nofollow"><em>compiler plugins</em></a><em>.</em></p><p>По умолчанию spring-initializer добавляет 2 плагина: all-open и no-arg. Так же часто используются kapt и плагин для Lombok.</p><h4>all-open</h4><p>По умолчанию все классы и их члены в Kotlin имеют неявный модификатор <code>final</code> и, соответственно, они не могут быть наследованы и переопределены, что очень сильно ограничивает их использование в Spring. Чтобы решить эту проблему, используется plugin all-open (<a href="https://kotlinlang.org/docs/all-open-plugin.html" rel="noopener noreferrer nofollow">документация</a>), который добавляет <code>open</code> к указанным аннотациями классам и членам классов. Для работы со spring используется уже преднастроенный plugin <a href="https://kotlinlang.org/docs/all-open-plugin.html#spring-support" rel="noopener noreferrer nofollow"><em>kotlin-spring</em></a><em>. </em></p><p>Kotlin-spring работает со следующими аннотациями:</p><ul><li><p><code>@Component</code></p></li><li><p><code>@Async</code></p></li><li><p><code>@Transactional</code></p></li><li><p><code>@Cacheable</code></p></li><li><p><code>@SpringBootTest</code></p></li></ul><p>Если вы делаете свою аннотацию, то возможно вам стоит добавить plugin kotlin-allopen и настроить его для работы с этой аннотацией. </p><p>Обратите внимание, что в списке аннотаций <strong>нет </strong>аннотаций, относящихся к <em>JPA</em> и их нужно добавлять отдельно (см. <a href="https://habr.com/ru/company/haulmont/blog/572574/" rel="noopener noreferrer nofollow">статью от </a><a href="https://habr.com/ru/company/haulmont/profile/" rel="noopener noreferrer nofollow">Haulmont</a>).</p><h4>No-arg</h4><p>Плагин добавляет пустой конструктор к указанным аннотациями классам. Для jpa есть преднастроенный <a href="https://kotlinlang.org/docs/no-arg-plugin.html#jpa-support" rel="noopener noreferrer nofollow">kotlin-jpa</a> плагин. Он работает со следующими аннотациями: <code>@Entity</code>, <code>@Embeddable</code>, and <code>@MappedSuperclass</code>. При этом он <strong>не</strong> делает эти классы <code>open</code>, это требуется сделать руками с помощью плагина kotlin-allopen.</p><h4>Kapt</h4><p>Является адаптером для annotation processors (<a href="https://kotlinlang.org/docs/kapt.html" rel="noopener noreferrer nofollow">документация</a>). Используется, например, <a href="https://github.com/mapstruct/mapstruct-examples/tree/master/mapstruct-kotlin" rel="noopener noreferrer nofollow">mapstruct </a>для генерации кода для маперов на kotlin</p><details class="spoiler"><summary>Пример добавления mapstruct для Kotlin</summary><div class="spoiler__content"><pre><code class="xml">&lt;plugin>
  &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
  &lt;artifactId>kotlin-maven-plugin&lt;/artifactId>
  &lt;version>${kotlin.version}&lt;/version>
  &lt;executions>
    &lt;execution>
        &lt;id>kapt&lt;/id>
        &lt;goals>
            &lt;goal>kapt&lt;/goal>
        &lt;/goals>
        &lt;configuration>
            &lt;sourceDirs>
                &lt;sourceDir>src/main/kotlin&lt;/sourceDir>
                &lt;sourceDir>src/main/java&lt;/sourceDir>
            &lt;/sourceDirs>
            &lt;annotationProcessorPaths>
                &lt;annotationProcessorPath>
                    &lt;groupId>org.mapstruct&lt;/groupId>
                    &lt;artifactId>mapstruct-processor&lt;/artifactId>
                    &lt;version>${mapstruct.version}&lt;/version>
                &lt;/annotationProcessorPath>
            &lt;/annotationProcessorPaths>
        &lt;/configuration>
    &lt;/execution>
  ...
  &lt;/executions>
  ....
&lt;/plugin>
</code></pre></div></details><p>По опыту использования могу сказать, что довольно часто выдает ошибки и ломает сборку, особенно, если в проекте есть Lombok.</p><p>Lombok </p><p>Плагин позволяет корректно вызывать сгенерированные lombok методы из kotlin кода. (<a href="https://kotlinlang.org/docs/lombok.html" rel="noopener noreferrer nofollow">Документация</a>). Плагин находится еще в бете, и не поддерживает <code>@Builder</code>.</p><a class="anchor" name="Spring" id="Spring"></a><h2>Работа со Spring</h2><p>Spring уже хорошо оптимизирован для  работы с Kotlin. </p><p>По выступлениям можно посмотреть, как и что добавлялось для поддердки Kotlin:</p><ul><li><p><a href="https://blog.jetbrains.com/kotlin/2020/08/the-state-of-kotlin-support-in-spring/" rel="noopener noreferrer nofollow">выступление 2020 года (видео и расшифровка)</a></p></li><li><p><a href="https://www.youtube.com/watch?v=tt4cxR5onQU" rel="noopener noreferrer nofollow">выступление 2021 года (видео)</a></p></li></ul><p>В этой части статьи приведены небольшие рекомендации и различия по использования Kotlin со Spring по сранению с Java.</p><ul><li><p>Так как точка запуска в Kotlin является функция main, то запуск Spring-Boot приложения теперь выглядит так:</p></li></ul><pre><code class="kotlin">@SpringBootApplication
class DemoKotlinApplication

fun main(args: Array&lt;String>) {
    runApplication&lt;DemoKotlinApplication>(*args)
}</code></pre><ul><li><p>В Spring добавлены и добавляются функции расширения для удобства использования Kotlin, например, <a href="https://github.com/spring-projects/spring-framework/blob/main/spring-web/src/main/kotlin/org/springframework/web/client/RestOperationsExtensions.kt" rel="noopener noreferrer nofollow">RestOperationsExtensions.kt</a>. Поэтому стоит поискать новое API, адаптированное для Kotlin - возможно оно уже есть</p></li><li><p>Для Kotlin для внедрения зависимостей <em>рекомендуется</em> использовать  <code>val</code> аргументы в конструкторе,</p></li></ul><pre><code class="kotlin">@Component
class YourBean(
  private val mongoTemplate: MongoTemplate, 
  private val solrClient: SolrClient
)</code></pre><p>Но возможны и другие варианты.</p><p>Если требуется внедрить зависимость для поля, то можно использовать <code>latenit var</code></p><pre><code class="kotlin">@Component
class YourBean {

    @Autowired
    lateinit var mongoTemplate: MongoTemplate

    @Autowired
    lateinit var solrClient: SolrClient
}</code></pre><p>Эта запись эквивалентна такой записи в Java:</p><pre><code class="kotlin">@Component
public class YourBean {
   @Autowired
   public MongoTemplate mongoTemplate;
   @Autowired
   public SolrClient solrClient;
}</code></pre><p>Можно использовать инъекцию и через set-методы, но при этом поле становится  Nullable </p><pre><code class="kotlin">    var hello: HelloService? = null
        @Autowired
        set(value) {
            field = value
            println("test")
        }</code></pre><ul><li><p>Для конфигурации свойств требуется экранировать $: <code>@Value("\${property}")</code></p></li><li><p>Поддерживается создания классов конфигураций через конструктор при использовании <code>@ConstructorBinding</code></p></li></ul><pre><code class="kotlin">@ConfigurationProperties("test")
@ConstructorBinding
class TestConfig(
    val name:String
) </code></pre><p>Так же можно создавать через <code>lateinit var</code></p><pre><code class="kotlin">@ConfigurationProperties("test")
class TestConfig {
    lateinit var name: String
}</code></pre><ul><li><p>Для генерации мета-информации нужно настроить <em>spring-boot-configuration-processor </em>для работы с <em>kapt</em></p></li></ul><a class="anchor" name="#hibernate" id="#hibernate"></a><h3>Работа с Hibernate</h3><p>Основные ошибки и проблемы хорошо описаны в <a href="https://habr.com/ru/company/haulmont/blog/572574/" rel="noopener noreferrer nofollow">статье Haulmont</a>.</p><p>Еще раз обращу внимание на необходимость корректной настройки  плагинов no-args и all-open и на корректную реализацию методов hashCode и equals. </p><h2>Остальные библиотеки</h2><a class="anchor" name="Jakson" id="Jakson"></a><h4>Jackson</h4><p>Spring использует Jackson для сериализации/десериализации данных. Для работы с Kotlin требуется добавить зависимость <a href="https://github.com/FasterXML/jackson-module-kotlin" rel="noopener noreferrer nofollow">Jackson Module Kotlin</a>. После этого вы сможете работать с  Kotlin-специфичными типами. При этом нет необходимости явно указывать типа объектов.</p><pre><code class="kotlin">import com.fasterxml.jackson.module.kotlin.jacksonObjectMapper
import com.fasterxml.jackson.module.kotlin.readValue

data class MyStateObject(val name: String, val age: Int)

...
val mapper = jacksonObjectMapper()

val state = mapper.readValue&lt;MyStateObject>(json)
// or
val state: MyStateObject = mapper.readValue(json)
// or
myMemberWithType = mapper.readValue(json)</code></pre><a class="anchor" name="MapStruct" id="MapStruct"></a><h4>MapStruct</h4><p>MapStruct работает через annotation processor. Поэтому для его работы необходимо корректно <a href="https://github.com/mapstruct/mapstruct-examples/tree/master/mapstruct-kotlin" rel="noopener noreferrer nofollow">настроить</a> kapt. При этом если модели используют аннотации Lombok, то при генерации мапперов будут проблемы (см. <a href="#Lombok" rel="noopener noreferrer nofollow">Lombok</a>)</p><pre><code class="xml">&lt;plugin>
  &lt;groupId>org.jetbrains.kotlin&lt;/groupId>
  &lt;artifactId>kotlin-maven-plugin&lt;/artifactId>
  &lt;version>${kotlin.version}&lt;/version>
  &lt;executions>
    &lt;execution>
        &lt;id>kapt&lt;/id>
        &lt;goals>
            &lt;goal>kapt&lt;/goal>
        &lt;/goals>
        &lt;configuration>
            &lt;sourceDirs>
                &lt;sourceDir>src/main/kotlin&lt;/sourceDir>
                &lt;sourceDir>src/main/java&lt;/sourceDir>
            &lt;/sourceDirs>
            &lt;annotationProcessorPaths>
                &lt;annotationProcessorPath>
                    &lt;groupId>org.mapstruct&lt;/groupId>
                    &lt;artifactId>mapstruct-processor&lt;/artifactId>
                    &lt;version>${mapstruct.version}&lt;/version>
                &lt;/annotationProcessorPath>
            &lt;/annotationProcessorPaths>
        &lt;/configuration>
    &lt;/execution>
  ...
  &lt;/executions>
  ....
&lt;/plugin></code></pre><a class="anchor" name="Lombok" id="Lombok"></a><h4>Lombok</h4><p>Работа с Lombok-методами напрямую из Kotlin из коробки не работает. Для этого требуется использовать <a href="https://kotlinlang.org/docs/lombok.html" rel="noopener noreferrer nofollow">Lombok compiler plugin</a>. </p><p>При этом возникают большие проблемы при совместной работе Kapt и Lombok. По умолчанию kapt начинает запускать все  annotation processors и отключает их работу через javac. Для того чтобы Lombok продолжал работать, требуется явно это указать</p><pre><code class="xml">&lt;plugin>
    &lt;groupId>org.apache.maven.plugins&lt;/groupId>
    &lt;artifactId>maven-compiler-plugin&lt;/artifactId>
    &lt;version>3.5.1&lt;/version>
    &lt;configuration>
        &lt;source>1.8&lt;/source>
        &lt;target>1.8&lt;/target>
        &lt;annotationProcessorPaths>
            &lt;annotationProcessorPath>
                &lt;groupId>org.projectlombok&lt;/groupId>
                &lt;artifactId>lombok&lt;/artifactId>
                &lt;version>${lombok.version}&lt;/version>
            &lt;/annotationProcessorPath>
        &lt;/annotationProcessorPaths>
    &lt;/configuration>
&lt;/plugin></code></pre><p>При этом Lombok будет корректно работать с kapt только, если annotation processor, который используют kapt, не зависит от Lombok. В нашем случае это было не так, так как мы используем MapStruct, и поэтому пришлось в первую очередь всю доменную модель переводить на Kotlin. Так же одним из вариантов является использование <a href="https://projectlombok.org/features/delombok" rel="noopener noreferrer nofollow">Delombok</a>. Эта проблема известная и уже поднималась на <a href="https://habr.com/ru/post/421871/" rel="noopener noreferrer nofollow">habr</a>.</p><a class="anchor" name="mockito" id="mockito"></a><h3>Mockito</h3><p>Mockito некорректно работает с типами Kotlin из коробки. Поэтому Spring рекомендует использовать <a href="https://mockk.io/" rel="noopener noreferrer nofollow">Mockk</a>. Также для Mockito появился специальный модуль, добавляющий поддержку Kotlin - <a href="https://github.com/mockito/mockito-kotlin" rel="noopener noreferrer nofollow">Mockito-Kotlin</a>.</p><p>В нашем проекте мы использовали Mockito-Kotlin. Единственная проблема в нем, что нужно аккуратно следить, откуда что импортируется, так как, например, <code>any()</code> теперь будут в 2 местах - <code>org.mockito.kotlin</code> и <code>org.mockito.Mockito</code></p><a class="anchor" name="log" id="log"></a><h3>Логирование</h3><p>При разработке enterprise-приложений привыкаешь ставить аннотацию <code>@Slf4j</code> от Lombok и получать готовый логгер. Так как Lombok с Kotlin не дружит, то приходится искать другие пути. </p><p>Можно пойти по пути создания своей надстройки - как в этой <a href="https://www.baeldung.com/kotlin/logging" rel="noopener noreferrer nofollow">статье</a>. Но для нас оказалась очень удобной библиотека - <a href="https://github.com/MicroUtils/kotlin-logging" rel="noopener noreferrer nofollow">kotlin-logging</a>, которая предоставляет возможность делать, например, вот такие вещи:</p><pre><code class="kotlin">import mu.KotlinLogging
private val logger = KotlinLogging.logger {} 
class FooWithLogging {
    val message = "world"
    fun bar() {
        logger.debug { "hello $message" }
    }
}</code></pre><p>Как видно, нам здесь не нужно указывать явно класс и пакет. А также поддерживается ленивое создание сообщения. </p><a class="anchor" name="end" id="end"></a><h2>Выводы</h2><p>Хочется закончить статью краткими выводами. Использование Java и Kotlin совместно в одном проекте требует дополнительныx настроек, но практически все решается и мы получаем возможность использовать 2 языка в одном проекте. Самой большой проблемой для нас оказалось невозможность полностью подружить Lombok и Kotlin.</p><p>Kotlin приносит много полезных идей. Но, как мне кажется, полностью удобство Kotlin начинаешь ценить при разработке реактивного кода. В данной статье это не рассмотрено, но это хорошо показано, например, в этой <a href="https://habr.com/ru/post/537716/" rel="noopener noreferrer nofollow">статье</a>.</p><a class="anchor" name="reference" id="reference"></a><h2>Использованные материалы</h2><ul><li><p><a href="https://kotlinlang.org/docs/home.html" rel="noopener noreferrer nofollow">Документация по Kotlin</a></p></li><li><p><a href="https://blog.jetbrains.com/kotlin/2020/08/the-state-of-kotlin-support-in-spring/" rel="noopener noreferrer nofollow">Выступление 2020 года о поддержке Kotlin в Spring (видео и расшифровка)</a></p></li><li><p><a href="https://www.youtube.com/watch?v=tt4cxR5onQU" rel="noopener noreferrer nofollow">Выступление 2021 года о поддержке Kotlin в Spring (видео)</a></p></li><li><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#kotlin-resources" rel="noopener noreferrer nofollow">Документация о поддержке Kotlin в Spring</a></p></li><li><p><a href="https://docs.spring.io/spring-boot/docs/2.5.5/reference/htmlsingle/#features.kotlin" rel="noopener noreferrer nofollow">Документация о поддержке Kotlin в Spring Boot</a></p></li><li><p><a href="https://github.com/mapstruct/mapstruct-examples/tree/master/mapstruct-kotlin" rel="noopener noreferrer nofollow">Использование MapStruct с Kotlin</a></p></li><li><p><a href="https://github.com/FasterXML/jackson-module-kotlin" rel="noopener noreferrer nofollow">Использование Jackson с Kotlin</a></p></li><li><p><a href="https://github.com/mockito/mockito-kotlin" rel="noopener noreferrer nofollow">Использование Mockito с Kotlin</a></p></li><li><p><a href="https://github.com/MicroUtils/kotlin-logging" rel="noopener noreferrer nofollow">Библиотека kotlin-logging</a></p></li></ul></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BJava%5D" class="tm-tags-list__link">Java</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BKotlin%5D" class="tm-tags-list__link">Kotlin</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bspring%5D" class="tm-tags-list__link">spring</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bspring%20boot%5D" class="tm-tags-list__link">spring boot</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/java/" class="tm-hubs-list__link">
    Java
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/kotlin/" class="tm-hubs-list__link">
    Kotlin
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 5: ↑5 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 5: ↑5 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+5</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    47
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/pyltsinm/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 30 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    28
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">9</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/pyltsinm/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @pyltsinm
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/583850/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 8 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/583850/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/583850/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"583850":{"id":"583850","timePublished":"2021-10-24T15:00:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Из Java в Kotlin: туда и обратно","leadData":{"textHtml":"\u003Cp\u003EВ статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в небольшой существующий микросервис на Spring Boot, написанный на Java. В рамках статьи не будут рассматриваться плюсы и минусы того или иного языка - здесь и так сломано много копий. В рамках проекта мы хотели протестировать, как будет работать Kotlin в нашем обычном стеке. Рассматривается стандартный стек Spring WebMVC (не реактивный)\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fced\u002F0cf\u002F77f\u002Fced0cf77f1dfccc0fe388edc07c12d6a.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fced\u002F0cf\u002F77f\u002Fced0cf77f1dfccc0fe388edc07c12d6a.jpg","fit":"cover","positionY":2.7272727272727,"positionX":9.3589743589744}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":28,"votesCount":30},"rating":9,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2523969","alias":"pyltsinm","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":8,"favoritesCount":47,"readingCount":4622,"score":5,"votesCount":5},"hubs":[{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true},{"relatedData":null,"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВ статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут рассматриваться плюсы и минусы того или иного языка - здесь и так сломано много копий (некоторые статьи на habr: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F461877\u002F\" rel=\"noopener noreferrer nofollow\"\u003E1\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Ffuncorp\u002Fblog\u002F558412\u002F\" rel=\"noopener noreferrer nofollow\"\u003E2\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F331280\u002F\" rel=\"noopener noreferrer nofollow\"\u003E3\u003C\u002Fa\u003E) и, как мне кажется, каждая команда должна это решать для себя. Рассматривается стандартный стек Spring WebMVC (не реактивный)\u003C\u002Fp\u003E\u003Ch4\u003EСодержание\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#description\" rel=\"noopener noreferrer nofollow\"\u003EКраткое описание микросервиса, с которым будем работать\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EС чего начать\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#test\" rel=\"noopener noreferrer nofollow\"\u003EПереводим тесты на Kotlin\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#on\" rel=\"noopener noreferrer nofollow\"\u003EПодключаем Kotlin в проект\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#plugins\" rel=\"noopener noreferrer nofollow\"\u003EKotlin plugins\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#Spring\" rel=\"noopener noreferrer nofollow\"\u003EРабота со Spring\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#hibernate\" rel=\"noopener noreferrer nofollow\"\u003EРабота с Hibernate\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОстальные библиотеки\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#Jackson\" rel=\"noopener noreferrer nofollow\"\u003EJackson\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#MapStruct\" rel=\"noopener noreferrer nofollow\"\u003EMapStruct\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#Lombok\" rel=\"noopener noreferrer nofollow\"\u003ELombok\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#mockito\" rel=\"noopener noreferrer nofollow\"\u003EMockito\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#log\" rel=\"noopener noreferrer nofollow\"\u003EЛогирование\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#end\" rel=\"noopener noreferrer nofollow\"\u003EВыводы\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"#reference\" rel=\"noopener noreferrer nofollow\"\u003EИспользованные материалы\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EКраткое описание микросервиса, с которым будем работать\u003C\u002Fh2\u003E\u003Cp\u003EДо перевода на Kotlin использовался такой стек:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EJava 11\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ESpring Web MVC (в рамках Spring Boot)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ESpring Data JPA\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EMap Struct\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ELombook\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EMaven\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EС чего начать\u003C\u002Fh2\u003E\u003Ca class=\"anchor\" name=\"test\" id=\"test\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EПереводим тесты на Kotlin\u003C\u002Fh3\u003E\u003Cp\u003EПервая рекомендация, которую вы найдете, - начинайте с тестов. В рамках своего проекта - подтверждаем, что это самый правильный путь. Пока вы будете добавлять тесты на Kotlin в проект, вы пройдете через следующие этапы:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EНастроите сборку совместно с Kotlin\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДобавите требуемые библиотеки\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПоймаете основные ошибки\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНаконец-то напишите тесты на давно заброшенные участки кода\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EИ при этом основной код, отвечающий за бизнес-логику затронут не будет. Начать с тестов нам очень помогло, даже хотя бы тем, что поймали пару ошибок в нашей существующей бизнес-логике.\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"on\" id=\"on\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EПодключаем Kotlin в проект\u003C\u002Fh3\u003E\u003Ch4\u003EНесколько слов о Gradle Kotlin DSL\u003C\u002Fh4\u003E\u003Cp\u003EДополнительно к стандартному набору для сборки пакетов (Maven и Gradle на Groovy) теперь добавился еще один - Gradle Kotlin DSL. Это может быть хорошим вариантом для тех, кто хотел бы использовать Gradle, но смущала необходимость использовать Groovy. \u003C\u002Fp\u003E\u003Cp\u003EИз плюсов данного решения - более корректные подсказки в IDEA (хотя, если честно, IDEA сильно тормозит при анализе build.gradle.kt файлов). Одним из главных неудобств, как мне кажется, является то, что не все возможности Gradle на Groovy реализованы или реализованы не зеркально, и поэтому многие подсказки со stackoverflow не будут работать. Поэтому мы остались на привычном нам Maven.\u003C\u002Fp\u003E\u003Ch4\u003EMaven\u003C\u002Fh4\u003E\u003Cp\u003EЕсли вы используете стек Spring-boot, то рекомендую для начала создать тестовый проект с нуля через \u003Ca href=\"https:\u002F\u002Fstart.spring.io\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fstart.spring.io\u002F\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003EНиже приведены 2 pom.xml файла, которые создает \u003Ca href=\"https:\u002F\u002Fstart.spring.io\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fstart.spring.io\u002F\u003C\u002Fa\u003E для Java и Kotlin.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Epom.xml для Java\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?\u003E\n&lt;project xmlns=\"http:\u002F\u002Fmaven.apache.org\u002FPOM\u002F4.0.0\" xmlns:xsi=\"http:\u002F\u002Fwww.w3.org\u002F2001\u002FXMLSchema-instance\"\n         xsi:schemaLocation=\"http:\u002F\u002Fmaven.apache.org\u002FPOM\u002F4.0.0 https:\u002F\u002Fmaven.apache.org\u002Fxsd\u002Fmaven-4.0.0.xsd\"\u003E\n    &lt;modelVersion\u003E4.0.0&lt;\u002FmodelVersion\u003E\n    &lt;parent\u003E\n        &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n        &lt;artifactId\u003Espring-boot-starter-parent&lt;\u002FartifactId\u003E\n        &lt;version\u003E2.5.5&lt;\u002Fversion\u003E\n        &lt;relativePath\u002F\u003E &lt;!-- lookup parent from repository --\u003E\n    &lt;\u002Fparent\u003E\n    &lt;groupId\u003Ecom.example&lt;\u002FgroupId\u003E\n    &lt;artifactId\u003Edemo-java&lt;\u002FartifactId\u003E\n    &lt;version\u003E0.0.1-SNAPSHOT&lt;\u002Fversion\u003E\n    &lt;name\u003Edemo-java&lt;\u002Fname\u003E\n    &lt;description\u003Edemo-java&lt;\u002Fdescription\u003E\n    &lt;properties\u003E\n        &lt;java.version\u003E11&lt;\u002Fjava.version\u003E\n    &lt;\u002Fproperties\u003E\n    &lt;dependencies\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Espring-boot-starter-data-jpa&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Espring-boot-starter-web&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.liquibase&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Eliquibase-core&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n\n        &lt;dependency\u003E\n            &lt;groupId\u003Ecom.h2database&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Eh2&lt;\u002FartifactId\u003E\n            &lt;scope\u003Eruntime&lt;\u002Fscope\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.projectlombok&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Elombok&lt;\u002FartifactId\u003E\n            &lt;optional\u003Etrue&lt;\u002Foptional\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Espring-boot-starter-test&lt;\u002FartifactId\u003E\n            &lt;scope\u003Etest&lt;\u002Fscope\u003E\n        &lt;\u002Fdependency\u003E\n    &lt;\u002Fdependencies\u003E\n\n    &lt;build\u003E\n        &lt;plugins\u003E\n            &lt;plugin\u003E\n                &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n                &lt;artifactId\u003Espring-boot-maven-plugin&lt;\u002FartifactId\u003E\n                &lt;configuration\u003E\n                    &lt;excludes\u003E\n                        &lt;exclude\u003E\n                            &lt;groupId\u003Eorg.projectlombok&lt;\u002FgroupId\u003E\n                            &lt;artifactId\u003Elombok&lt;\u002FartifactId\u003E\n                        &lt;\u002Fexclude\u003E\n                    &lt;\u002Fexcludes\u003E\n                &lt;\u002Fconfiguration\u003E\n            &lt;\u002Fplugin\u003E\n        &lt;\u002Fplugins\u003E\n    &lt;\u002Fbuild\u003E\n\n&lt;\u002Fproject\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Epom.xml для Kotlin\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?\u003E\n&lt;project xmlns=\"http:\u002F\u002Fmaven.apache.org\u002FPOM\u002F4.0.0\" xmlns:xsi=\"http:\u002F\u002Fwww.w3.org\u002F2001\u002FXMLSchema-instance\"\n         xsi:schemaLocation=\"http:\u002F\u002Fmaven.apache.org\u002FPOM\u002F4.0.0 https:\u002F\u002Fmaven.apache.org\u002Fxsd\u002Fmaven-4.0.0.xsd\"\u003E\n    &lt;modelVersion\u003E4.0.0&lt;\u002FmodelVersion\u003E\n    &lt;parent\u003E\n        &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n        &lt;artifactId\u003Espring-boot-starter-parent&lt;\u002FartifactId\u003E\n        &lt;version\u003E2.5.5&lt;\u002Fversion\u003E\n        &lt;relativePath\u002F\u003E &lt;!-- lookup parent from repository --\u003E\n    &lt;\u002Fparent\u003E\n    &lt;groupId\u003Ecom.example&lt;\u002FgroupId\u003E\n    &lt;artifactId\u003Edemo-kotlin&lt;\u002FartifactId\u003E\n    &lt;version\u003E0.0.1-SNAPSHOT&lt;\u002Fversion\u003E\n    &lt;name\u003Edemo-kotlin&lt;\u002Fname\u003E\n    &lt;description\u003Edemo-kotlin&lt;\u002Fdescription\u003E\n    &lt;properties\u003E\n        &lt;java.version\u003E11&lt;\u002Fjava.version\u003E\n        &lt;kotlin.version\u003E1.5.31&lt;\u002Fkotlin.version\u003E\n    &lt;\u002Fproperties\u003E\n    &lt;dependencies\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Espring-boot-starter-data-jpa&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Espring-boot-starter-web&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Ecom.fasterxml.jackson.module&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Ejackson-module-kotlin&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Ekotlin-reflect&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Ekotlin-stdlib-jdk8&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.liquibase&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Eliquibase-core&lt;\u002FartifactId\u003E\n        &lt;\u002Fdependency\u003E\n\n        &lt;dependency\u003E\n            &lt;groupId\u003Ecom.h2database&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Eh2&lt;\u002FartifactId\u003E\n            &lt;scope\u003Eruntime&lt;\u002Fscope\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.projectlombok&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Elombok&lt;\u002FartifactId\u003E\n            &lt;optional\u003Etrue&lt;\u002Foptional\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n            &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n            &lt;artifactId\u003Espring-boot-starter-test&lt;\u002FartifactId\u003E\n            &lt;scope\u003Etest&lt;\u002Fscope\u003E\n        &lt;\u002Fdependency\u003E\n    &lt;\u002Fdependencies\u003E\n\n    &lt;build\u003E\n        &lt;sourceDirectory\u003E${project.basedir}\u002Fsrc\u002Fmain\u002Fkotlin&lt;\u002FsourceDirectory\u003E\n        &lt;testSourceDirectory\u003E${project.basedir}\u002Fsrc\u002Ftest\u002Fkotlin&lt;\u002FtestSourceDirectory\u003E\n        &lt;plugins\u003E\n            &lt;plugin\u003E\n                &lt;groupId\u003Eorg.springframework.boot&lt;\u002FgroupId\u003E\n                &lt;artifactId\u003Espring-boot-maven-plugin&lt;\u002FartifactId\u003E\n                &lt;configuration\u003E\n                    &lt;excludes\u003E\n                        &lt;exclude\u003E\n                            &lt;groupId\u003Eorg.projectlombok&lt;\u002FgroupId\u003E\n                            &lt;artifactId\u003Elombok&lt;\u002FartifactId\u003E\n                        &lt;\u002Fexclude\u003E\n                    &lt;\u002Fexcludes\u003E\n                &lt;\u002Fconfiguration\u003E\n            &lt;\u002Fplugin\u003E\n            &lt;plugin\u003E\n                &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n                &lt;artifactId\u003Ekotlin-maven-plugin&lt;\u002FartifactId\u003E\n                &lt;configuration\u003E\n                    &lt;args\u003E\n                        &lt;arg\u003E-Xjsr305=strict&lt;\u002Farg\u003E\n                    &lt;\u002Fargs\u003E\n                    &lt;compilerPlugins\u003E\n                        &lt;plugin\u003Espring&lt;\u002Fplugin\u003E\n                        &lt;plugin\u003Ejpa&lt;\u002Fplugin\u003E\n                    &lt;\u002FcompilerPlugins\u003E\n                &lt;\u002Fconfiguration\u003E\n                &lt;dependencies\u003E\n                    &lt;dependency\u003E\n                        &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n                        &lt;artifactId\u003Ekotlin-maven-allopen&lt;\u002FartifactId\u003E\n                        &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n                    &lt;\u002Fdependency\u003E\n                    &lt;dependency\u003E\n                        &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n                        &lt;artifactId\u003Ekotlin-maven-noarg&lt;\u002FartifactId\u003E\n                        &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n                    &lt;\u002Fdependency\u003E\n                &lt;\u002Fdependencies\u003E\n            &lt;\u002Fplugin\u003E\n        &lt;\u002Fplugins\u003E\n    &lt;\u002Fbuild\u003E\n\n&lt;\u002Fproject\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EДавайте рассмотрим, в чем разница с Java проектом по мнению \u003Ca href=\"https:\u002F\u002Fstart.spring.io\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fstart.spring.io\u002F\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EДобавилась версия Kotlin\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;properties\u003E\n ....\n  &lt;kotlin.version\u003E1.5.31&lt;\u002Fkotlin.version\u003E\n&lt;\u002Fproperties\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EДобавились 2 стандартных библиотеки для работы с Kotlin и библиотека для Jackson (про нее - \u003Ca href=\"#Jackson\" rel=\"noopener noreferrer nofollow\"\u003Eниже\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;dependency\u003E\n  &lt;groupId\u003Ecom.fasterxml.jackson.module&lt;\u002FgroupId\u003E\n  &lt;artifactId\u003Ejackson-module-kotlin&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E\n&lt;dependency\u003E\n  &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n  &lt;artifactId\u003Ekotlin-reflect&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E\n&lt;dependency\u003E\n  &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n  &lt;artifactId\u003Ekotlin-stdlib-jdk8&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВ раздел build добавился раздел про Kotlin\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E    &lt;build\u003E\n        &lt;sourceDirectory\u003E${project.basedir}\u002Fsrc\u002Fmain\u002Fkotlin&lt;\u002FsourceDirectory\u003E\n        &lt;testSourceDirectory\u003E${project.basedir}\u002Fsrc\u002Ftest\u002Fkotlin&lt;\u002FtestSourceDirectory\u003E\n        &lt;plugins\u003E\n          .....\n            &lt;plugin\u003E\n                &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n                &lt;artifactId\u003Ekotlin-maven-plugin&lt;\u002FartifactId\u003E\n                &lt;configuration\u003E\n                    &lt;args\u003E\n                        &lt;arg\u003E-Xjsr305=strict&lt;\u002Farg\u003E\n                    &lt;\u002Fargs\u003E\n                    &lt;compilerPlugins\u003E\n                        &lt;plugin\u003Espring&lt;\u002Fplugin\u003E\n                        &lt;plugin\u003Ejpa&lt;\u002Fplugin\u003E\n                    &lt;\u002FcompilerPlugins\u003E\n                &lt;\u002Fconfiguration\u003E\n                &lt;dependencies\u003E\n                    &lt;dependency\u003E\n                        &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n                        &lt;artifactId\u003Ekotlin-maven-allopen&lt;\u002FartifactId\u003E\n                        &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n                    &lt;\u002Fdependency\u003E\n                    &lt;dependency\u003E\n                        &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n                        &lt;artifactId\u003Ekotlin-maven-noarg&lt;\u002FartifactId\u003E\n                        &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n                    &lt;\u002Fdependency\u003E\n                &lt;\u002Fdependencies\u003E\n            &lt;\u002Fplugin\u003E\n        &lt;\u002Fplugins\u003E\n    &lt;\u002Fbuild\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПодробнее про \u003Cem\u003Ekotlin-maven-plugin \u003C\u002Fem\u003Eможно прочитать \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fmaven.html\" rel=\"noopener noreferrer nofollow\"\u003Eздесь\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EДанная конфигурация подойдет только, если у вас в проекте не будет кода на Java. Если вы хотите использовать оба языка (что и происходит при миграции), то нужно добавить и корректно настроить maven-compiler-plugin. (Пример можно посмотреть \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fmaven.html#compile-kotlin-and-java-sources\" rel=\"noopener noreferrer nofollow\"\u003Eздесь \u003C\u002Fa\u003Eили \u003Ca href=\"https:\u002F\u002Fwww.baeldung.com\u002Fkotlin\u002Fmaven-java-project\" rel=\"noopener noreferrer nofollow\"\u003Eздесь\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПример для Kotlin и Java\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;build\u003E\n  &lt;plugins\u003E\n    .....\n    &lt;plugin\u003E\n      &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n      &lt;artifactId\u003Ekotlin-maven-plugin&lt;\u002FartifactId\u003E\n      &lt;executions\u003E\n        &lt;execution\u003E\n          &lt;id\u003Ecompile&lt;\u002Fid\u003E\n          &lt;goals\u003E\n            &lt;goal\u003Ecompile&lt;\u002Fgoal\u003E\n          &lt;\u002Fgoals\u003E\n          &lt;configuration\u003E\n            &lt;sourceDirs\u003E\n              &lt;sourceDir\u003E${project.basedir}\u002Fsrc\u002Fmain\u002Fkotlin&lt;\u002FsourceDir\u003E\n              &lt;sourceDir\u003E${project.basedir}\u002Fsrc\u002Fmain\u002Fjava&lt;\u002FsourceDir\u003E\n            &lt;\u002FsourceDirs\u003E\n          &lt;\u002Fconfiguration\u003E\n        &lt;\u002Fexecution\u003E\n        &lt;execution\u003E\n          &lt;id\u003Etest-compile&lt;\u002Fid\u003E\n          &lt;goals\u003E &lt;goal\u003Etest-compile&lt;\u002Fgoal\u003E &lt;\u002Fgoals\u003E\n          &lt;configuration\u003E\n            &lt;sourceDirs\u003E\n              &lt;sourceDir\u003E${project.basedir}\u002Fsrc\u002Ftest\u002Fkotlin&lt;\u002FsourceDir\u003E\n              &lt;sourceDir\u003E${project.basedir}\u002Fsrc\u002Ftest\u002Fjava&lt;\u002FsourceDir\u003E\n            &lt;\u002FsourceDirs\u003E\n          &lt;\u002Fconfiguration\u003E\n        &lt;\u002Fexecution\u003E\n      &lt;\u002Fexecutions\u003E\n      &lt;configuration\u003E\n        &lt;args\u003E\n          &lt;arg\u003E-Xjsr305=strict&lt;\u002Farg\u003E\n        &lt;\u002Fargs\u003E\n        &lt;compilerPlugins\u003E\n          &lt;plugin\u003Espring&lt;\u002Fplugin\u003E\n          &lt;plugin\u003Ejpa&lt;\u002Fplugin\u003E\n        &lt;\u002FcompilerPlugins\u003E\n      &lt;\u002Fconfiguration\u003E\n      &lt;dependencies\u003E\n        &lt;dependency\u003E\n          &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n          &lt;artifactId\u003Ekotlin-maven-allopen&lt;\u002FartifactId\u003E\n          &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n        &lt;\u002Fdependency\u003E\n        &lt;dependency\u003E\n          &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n          &lt;artifactId\u003Ekotlin-maven-noarg&lt;\u002FartifactId\u003E\n          &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n        &lt;\u002Fdependency\u003E\n      &lt;\u002Fdependencies\u003E\n    &lt;\u002Fplugin\u003E\n    &lt;plugin\u003E\n      &lt;groupId\u003Eorg.apache.maven.plugins&lt;\u002FgroupId\u003E\n      &lt;artifactId\u003Emaven-compiler-plugin&lt;\u002FartifactId\u003E\n      &lt;executions\u003E\n        &lt;!-- Replacing default-compile as it is treated specially by maven --\u003E\n        &lt;execution\u003E\n          &lt;id\u003Edefault-compile&lt;\u002Fid\u003E\n          &lt;phase\u003Enone&lt;\u002Fphase\u003E\n        &lt;\u002Fexecution\u003E\n        &lt;!-- Replacing default-testCompile as it is treated specially by maven --\u003E\n        &lt;execution\u003E\n          &lt;id\u003Edefault-testCompile&lt;\u002Fid\u003E\n          &lt;phase\u003Enone&lt;\u002Fphase\u003E\n        &lt;\u002Fexecution\u003E\n        &lt;execution\u003E\n          &lt;id\u003Ejava-compile&lt;\u002Fid\u003E\n          &lt;phase\u003Ecompile&lt;\u002Fphase\u003E\n          &lt;goals\u003E\n            &lt;goal\u003Ecompile&lt;\u002Fgoal\u003E\n          &lt;\u002Fgoals\u003E\n        &lt;\u002Fexecution\u003E\n        &lt;execution\u003E\n          &lt;id\u003Ejava-test-compile&lt;\u002Fid\u003E\n          &lt;phase\u003Etest-compile&lt;\u002Fphase\u003E\n          &lt;goals\u003E\n            &lt;goal\u003EtestCompile&lt;\u002Fgoal\u003E\n          &lt;\u002Fgoals\u003E\n        &lt;\u002Fexecution\u003E\n      &lt;\u002Fexecutions\u003E\n    &lt;\u002Fplugin\u003E\n  &lt;\u002Fplugins\u003E\n&lt;\u002Fbuild\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003E\u003Ccode\u003E-Xjsr305=strict\u003C\u002Fcode\u003E позволяет Kotlin корректно использоваться nullable-типы для некоторых api Spring (\u003Ca href=\"https:\u002F\u002Fdocs.spring.io\u002Fspring-boot\u002Fdocs\u002F2.0.x\u002Freference\u002Fhtml\u002Fboot-features-kotlin.html#boot-features-kotlin-null-safety\" rel=\"noopener noreferrer nofollow\"\u003Eссылка\u003C\u002Fa\u003E) \u003C\u002Fp\u003E\u003Cp\u003EПро плагины All-open и No-arg будет подробнее рассказано нижe.\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"plugins\" id=\"plugins\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EKotlin plugins\u003C\u002Fh3\u003E\u003Cp\u003EДля изменения процесса компиляции в Kotlin используются \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fall-open-plugin.html\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cem\u003Ecompiler plugins\u003C\u002Fem\u003E\u003C\u002Fa\u003E\u003Cem\u003E.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EПо умолчанию spring-initializer добавляет 2 плагина: all-open и no-arg. Так же часто используются kapt и плагин для Lombok.\u003C\u002Fp\u003E\u003Ch4\u003Eall-open\u003C\u002Fh4\u003E\u003Cp\u003EПо умолчанию все классы и их члены в Kotlin имеют неявный модификатор \u003Ccode\u003Efinal\u003C\u002Fcode\u003E и, соответственно, они не могут быть наследованы и переопределены, что очень сильно ограничивает их использование в Spring. Чтобы решить эту проблему, используется plugin all-open (\u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fall-open-plugin.html\" rel=\"noopener noreferrer nofollow\"\u003Eдокументация\u003C\u002Fa\u003E), который добавляет \u003Ccode\u003Eopen\u003C\u002Fcode\u003E к указанным аннотациями классам и членам классов. Для работы со spring используется уже преднастроенный plugin \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fall-open-plugin.html#spring-support\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cem\u003Ekotlin-spring\u003C\u002Fem\u003E\u003C\u002Fa\u003E\u003Cem\u003E. \u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EKotlin-spring работает со следующими аннотациями:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E@Component\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E@Async\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E@Transactional\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E@Cacheable\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E@SpringBootTest\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЕсли вы делаете свою аннотацию, то возможно вам стоит добавить plugin kotlin-allopen и настроить его для работы с этой аннотацией. \u003C\u002Fp\u003E\u003Cp\u003EОбратите внимание, что в списке аннотаций \u003Cstrong\u003Eнет \u003C\u002Fstrong\u003Eаннотаций, относящихся к \u003Cem\u003EJPA\u003C\u002Fem\u003E и их нужно добавлять отдельно (см. \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fhaulmont\u002Fblog\u002F572574\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eстатью от \u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fhaulmont\u002Fprofile\u002F\" rel=\"noopener noreferrer nofollow\"\u003EHaulmont\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\u003Ch4\u003ENo-arg\u003C\u002Fh4\u003E\u003Cp\u003EПлагин добавляет пустой конструктор к указанным аннотациями классам. Для jpa есть преднастроенный \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fno-arg-plugin.html#jpa-support\" rel=\"noopener noreferrer nofollow\"\u003Ekotlin-jpa\u003C\u002Fa\u003E плагин. Он работает со следующими аннотациями: \u003Ccode\u003E@Entity\u003C\u002Fcode\u003E, \u003Ccode\u003E@Embeddable\u003C\u002Fcode\u003E, and \u003Ccode\u003E@MappedSuperclass\u003C\u002Fcode\u003E. При этом он \u003Cstrong\u003Eне\u003C\u002Fstrong\u003E делает эти классы \u003Ccode\u003Eopen\u003C\u002Fcode\u003E, это требуется сделать руками с помощью плагина kotlin-allopen.\u003C\u002Fp\u003E\u003Ch4\u003EKapt\u003C\u002Fh4\u003E\u003Cp\u003EЯвляется адаптером для annotation processors (\u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fkapt.html\" rel=\"noopener noreferrer nofollow\"\u003Eдокументация\u003C\u002Fa\u003E). Используется, например, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmapstruct\u002Fmapstruct-examples\u002Ftree\u002Fmaster\u002Fmapstruct-kotlin\" rel=\"noopener noreferrer nofollow\"\u003Emapstruct \u003C\u002Fa\u003Eдля генерации кода для маперов на kotlin\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПример добавления mapstruct для Kotlin\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;plugin\u003E\n  &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n  &lt;artifactId\u003Ekotlin-maven-plugin&lt;\u002FartifactId\u003E\n  &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n  &lt;executions\u003E\n    &lt;execution\u003E\n        &lt;id\u003Ekapt&lt;\u002Fid\u003E\n        &lt;goals\u003E\n            &lt;goal\u003Ekapt&lt;\u002Fgoal\u003E\n        &lt;\u002Fgoals\u003E\n        &lt;configuration\u003E\n            &lt;sourceDirs\u003E\n                &lt;sourceDir\u003Esrc\u002Fmain\u002Fkotlin&lt;\u002FsourceDir\u003E\n                &lt;sourceDir\u003Esrc\u002Fmain\u002Fjava&lt;\u002FsourceDir\u003E\n            &lt;\u002FsourceDirs\u003E\n            &lt;annotationProcessorPaths\u003E\n                &lt;annotationProcessorPath\u003E\n                    &lt;groupId\u003Eorg.mapstruct&lt;\u002FgroupId\u003E\n                    &lt;artifactId\u003Emapstruct-processor&lt;\u002FartifactId\u003E\n                    &lt;version\u003E${mapstruct.version}&lt;\u002Fversion\u003E\n                &lt;\u002FannotationProcessorPath\u003E\n            &lt;\u002FannotationProcessorPaths\u003E\n        &lt;\u002Fconfiguration\u003E\n    &lt;\u002Fexecution\u003E\n  ...\n  &lt;\u002Fexecutions\u003E\n  ....\n&lt;\u002Fplugin\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EПо опыту использования могу сказать, что довольно часто выдает ошибки и ломает сборку, особенно, если в проекте есть Lombok.\u003C\u002Fp\u003E\u003Cp\u003ELombok \u003C\u002Fp\u003E\u003Cp\u003EПлагин позволяет корректно вызывать сгенерированные lombok методы из kotlin кода. (\u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Flombok.html\" rel=\"noopener noreferrer nofollow\"\u003EДокументация\u003C\u002Fa\u003E). Плагин находится еще в бете, и не поддерживает \u003Ccode\u003E@Builder\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"Spring\" id=\"Spring\"\u003E\u003C\u002Fa\u003E\u003Ch2\u003EРабота со Spring\u003C\u002Fh2\u003E\u003Cp\u003ESpring уже хорошо оптимизирован для  работы с Kotlin. \u003C\u002Fp\u003E\u003Cp\u003EПо выступлениям можно посмотреть, как и что добавлялось для поддердки Kotlin:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fblog.jetbrains.com\u002Fkotlin\u002F2020\u002F08\u002Fthe-state-of-kotlin-support-in-spring\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eвыступление 2020 года (видео и расшифровка)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=tt4cxR5onQU\" rel=\"noopener noreferrer nofollow\"\u003Eвыступление 2021 года (видео)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВ этой части статьи приведены небольшие рекомендации и различия по использования Kotlin со Spring по сранению с Java.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EТак как точка запуска в Kotlin является функция main, то запуск Spring-Boot приложения теперь выглядит так:\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E@SpringBootApplication\nclass DemoKotlinApplication\n\nfun main(args: Array&lt;String\u003E) {\n    runApplication&lt;DemoKotlinApplication\u003E(*args)\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВ Spring добавлены и добавляются функции расширения для удобства использования Kotlin, например, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fspring-projects\u002Fspring-framework\u002Fblob\u002Fmain\u002Fspring-web\u002Fsrc\u002Fmain\u002Fkotlin\u002Forg\u002Fspringframework\u002Fweb\u002Fclient\u002FRestOperationsExtensions.kt\" rel=\"noopener noreferrer nofollow\"\u003ERestOperationsExtensions.kt\u003C\u002Fa\u003E. Поэтому стоит поискать новое API, адаптированное для Kotlin - возможно оно уже есть\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДля Kotlin для внедрения зависимостей \u003Cem\u003Eрекомендуется\u003C\u002Fem\u003E использовать  \u003Ccode\u003Eval\u003C\u002Fcode\u003E аргументы в конструкторе,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E@Component\nclass YourBean(\n  private val mongoTemplate: MongoTemplate, \n  private val solrClient: SolrClient\n)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНо возможны и другие варианты.\u003C\u002Fp\u003E\u003Cp\u003EЕсли требуется внедрить зависимость для поля, то можно использовать \u003Ccode\u003Elatenit var\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E@Component\nclass YourBean {\n\n    @Autowired\n    lateinit var mongoTemplate: MongoTemplate\n\n    @Autowired\n    lateinit var solrClient: SolrClient\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЭта запись эквивалентна такой записи в Java:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E@Component\npublic class YourBean {\n   @Autowired\n   public MongoTemplate mongoTemplate;\n   @Autowired\n   public SolrClient solrClient;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EМожно использовать инъекцию и через set-методы, но при этом поле становится  Nullable \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E    var hello: HelloService? = null\n        @Autowired\n        set(value) {\n            field = value\n            println(\"test\")\n        }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EДля конфигурации свойств требуется экранировать $: \u003Ccode\u003E@Value(\"\\${property}\")\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПоддерживается создания классов конфигураций через конструктор при использовании \u003Ccode\u003E@ConstructorBinding\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E@ConfigurationProperties(\"test\")\n@ConstructorBinding\nclass TestConfig(\n    val name:String\n) \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТак же можно создавать через \u003Ccode\u003Elateinit var\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003E@ConfigurationProperties(\"test\")\nclass TestConfig {\n    lateinit var name: String\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EДля генерации мета-информации нужно настроить \u003Cem\u003Espring-boot-configuration-processor \u003C\u002Fem\u003Eдля работы с \u003Cem\u003Ekapt\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ca class=\"anchor\" name=\"#hibernate\" id=\"#hibernate\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EРабота с Hibernate\u003C\u002Fh3\u003E\u003Cp\u003EОсновные ошибки и проблемы хорошо описаны в \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fhaulmont\u002Fblog\u002F572574\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eстатье Haulmont\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EЕще раз обращу внимание на необходимость корректной настройки  плагинов no-args и all-open и на корректную реализацию методов hashCode и equals. \u003C\u002Fp\u003E\u003Ch2\u003EОстальные библиотеки\u003C\u002Fh2\u003E\u003Ca class=\"anchor\" name=\"Jakson\" id=\"Jakson\"\u003E\u003C\u002Fa\u003E\u003Ch4\u003EJackson\u003C\u002Fh4\u003E\u003Cp\u003ESpring использует Jackson для сериализации\u002Fдесериализации данных. Для работы с Kotlin требуется добавить зависимость \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FFasterXML\u002Fjackson-module-kotlin\" rel=\"noopener noreferrer nofollow\"\u003EJackson Module Kotlin\u003C\u002Fa\u003E. После этого вы сможете работать с  Kotlin-специфичными типами. При этом нет необходимости явно указывать типа объектов.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eimport com.fasterxml.jackson.module.kotlin.jacksonObjectMapper\nimport com.fasterxml.jackson.module.kotlin.readValue\n\ndata class MyStateObject(val name: String, val age: Int)\n\n...\nval mapper = jacksonObjectMapper()\n\nval state = mapper.readValue&lt;MyStateObject\u003E(json)\n\u002F\u002F or\nval state: MyStateObject = mapper.readValue(json)\n\u002F\u002F or\nmyMemberWithType = mapper.readValue(json)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ca class=\"anchor\" name=\"MapStruct\" id=\"MapStruct\"\u003E\u003C\u002Fa\u003E\u003Ch4\u003EMapStruct\u003C\u002Fh4\u003E\u003Cp\u003EMapStruct работает через annotation processor. Поэтому для его работы необходимо корректно \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmapstruct\u002Fmapstruct-examples\u002Ftree\u002Fmaster\u002Fmapstruct-kotlin\" rel=\"noopener noreferrer nofollow\"\u003Eнастроить\u003C\u002Fa\u003E kapt. При этом если модели используют аннотации Lombok, то при генерации мапперов будут проблемы (см. \u003Ca href=\"#Lombok\" rel=\"noopener noreferrer nofollow\"\u003ELombok\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;plugin\u003E\n  &lt;groupId\u003Eorg.jetbrains.kotlin&lt;\u002FgroupId\u003E\n  &lt;artifactId\u003Ekotlin-maven-plugin&lt;\u002FartifactId\u003E\n  &lt;version\u003E${kotlin.version}&lt;\u002Fversion\u003E\n  &lt;executions\u003E\n    &lt;execution\u003E\n        &lt;id\u003Ekapt&lt;\u002Fid\u003E\n        &lt;goals\u003E\n            &lt;goal\u003Ekapt&lt;\u002Fgoal\u003E\n        &lt;\u002Fgoals\u003E\n        &lt;configuration\u003E\n            &lt;sourceDirs\u003E\n                &lt;sourceDir\u003Esrc\u002Fmain\u002Fkotlin&lt;\u002FsourceDir\u003E\n                &lt;sourceDir\u003Esrc\u002Fmain\u002Fjava&lt;\u002FsourceDir\u003E\n            &lt;\u002FsourceDirs\u003E\n            &lt;annotationProcessorPaths\u003E\n                &lt;annotationProcessorPath\u003E\n                    &lt;groupId\u003Eorg.mapstruct&lt;\u002FgroupId\u003E\n                    &lt;artifactId\u003Emapstruct-processor&lt;\u002FartifactId\u003E\n                    &lt;version\u003E${mapstruct.version}&lt;\u002Fversion\u003E\n                &lt;\u002FannotationProcessorPath\u003E\n            &lt;\u002FannotationProcessorPaths\u003E\n        &lt;\u002Fconfiguration\u003E\n    &lt;\u002Fexecution\u003E\n  ...\n  &lt;\u002Fexecutions\u003E\n  ....\n&lt;\u002Fplugin\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ca class=\"anchor\" name=\"Lombok\" id=\"Lombok\"\u003E\u003C\u002Fa\u003E\u003Ch4\u003ELombok\u003C\u002Fh4\u003E\u003Cp\u003EРабота с Lombok-методами напрямую из Kotlin из коробки не работает. Для этого требуется использовать \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Flombok.html\" rel=\"noopener noreferrer nofollow\"\u003ELombok compiler plugin\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003EПри этом возникают большие проблемы при совместной работе Kapt и Lombok. По умолчанию kapt начинает запускать все  annotation processors и отключает их работу через javac. Для того чтобы Lombok продолжал работать, требуется явно это указать\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;plugin\u003E\n    &lt;groupId\u003Eorg.apache.maven.plugins&lt;\u002FgroupId\u003E\n    &lt;artifactId\u003Emaven-compiler-plugin&lt;\u002FartifactId\u003E\n    &lt;version\u003E3.5.1&lt;\u002Fversion\u003E\n    &lt;configuration\u003E\n        &lt;source\u003E1.8&lt;\u002Fsource\u003E\n        &lt;target\u003E1.8&lt;\u002Ftarget\u003E\n        &lt;annotationProcessorPaths\u003E\n            &lt;annotationProcessorPath\u003E\n                &lt;groupId\u003Eorg.projectlombok&lt;\u002FgroupId\u003E\n                &lt;artifactId\u003Elombok&lt;\u002FartifactId\u003E\n                &lt;version\u003E${lombok.version}&lt;\u002Fversion\u003E\n            &lt;\u002FannotationProcessorPath\u003E\n        &lt;\u002FannotationProcessorPaths\u003E\n    &lt;\u002Fconfiguration\u003E\n&lt;\u002Fplugin\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПри этом Lombok будет корректно работать с kapt только, если annotation processor, который используют kapt, не зависит от Lombok. В нашем случае это было не так, так как мы используем MapStruct, и поэтому пришлось в первую очередь всю доменную модель переводить на Kotlin. Так же одним из вариантов является использование \u003Ca href=\"https:\u002F\u002Fprojectlombok.org\u002Ffeatures\u002Fdelombok\" rel=\"noopener noreferrer nofollow\"\u003EDelombok\u003C\u002Fa\u003E. Эта проблема известная и уже поднималась на \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F421871\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehabr\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"mockito\" id=\"mockito\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EMockito\u003C\u002Fh3\u003E\u003Cp\u003EMockito некорректно работает с типами Kotlin из коробки. Поэтому Spring рекомендует использовать \u003Ca href=\"https:\u002F\u002Fmockk.io\u002F\" rel=\"noopener noreferrer nofollow\"\u003EMockk\u003C\u002Fa\u003E. Также для Mockito появился специальный модуль, добавляющий поддержку Kotlin - \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmockito\u002Fmockito-kotlin\" rel=\"noopener noreferrer nofollow\"\u003EMockito-Kotlin\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EВ нашем проекте мы использовали Mockito-Kotlin. Единственная проблема в нем, что нужно аккуратно следить, откуда что импортируется, так как, например, \u003Ccode\u003Eany()\u003C\u002Fcode\u003E теперь будут в 2 местах - \u003Ccode\u003Eorg.mockito.kotlin\u003C\u002Fcode\u003E и \u003Ccode\u003Eorg.mockito.Mockito\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"log\" id=\"log\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EЛогирование\u003C\u002Fh3\u003E\u003Cp\u003EПри разработке enterprise-приложений привыкаешь ставить аннотацию \u003Ccode\u003E@Slf4j\u003C\u002Fcode\u003E от Lombok и получать готовый логгер. Так как Lombok с Kotlin не дружит, то приходится искать другие пути. \u003C\u002Fp\u003E\u003Cp\u003EМожно пойти по пути создания своей надстройки - как в этой \u003Ca href=\"https:\u002F\u002Fwww.baeldung.com\u002Fkotlin\u002Flogging\" rel=\"noopener noreferrer nofollow\"\u003Eстатье\u003C\u002Fa\u003E. Но для нас оказалась очень удобной библиотека - \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FMicroUtils\u002Fkotlin-logging\" rel=\"noopener noreferrer nofollow\"\u003Ekotlin-logging\u003C\u002Fa\u003E, которая предоставляет возможность делать, например, вот такие вещи:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eimport mu.KotlinLogging\nprivate val logger = KotlinLogging.logger {} \nclass FooWithLogging {\n    val message = \"world\"\n    fun bar() {\n        logger.debug { \"hello $message\" }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКак видно, нам здесь не нужно указывать явно класс и пакет. А также поддерживается ленивое создание сообщения. \u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"end\" id=\"end\"\u003E\u003C\u002Fa\u003E\u003Ch2\u003EВыводы\u003C\u002Fh2\u003E\u003Cp\u003EХочется закончить статью краткими выводами. Использование Java и Kotlin совместно в одном проекте требует дополнительныx настроек, но практически все решается и мы получаем возможность использовать 2 языка в одном проекте. Самой большой проблемой для нас оказалось невозможность полностью подружить Lombok и Kotlin.\u003C\u002Fp\u003E\u003Cp\u003EKotlin приносит много полезных идей. Но, как мне кажется, полностью удобство Kotlin начинаешь ценить при разработке реактивного кода. В данной статье это не рассмотрено, но это хорошо показано, например, в этой \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F537716\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eстатье\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"reference\" id=\"reference\"\u003E\u003C\u002Fa\u003E\u003Ch2\u003EИспользованные материалы\u003C\u002Fh2\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fhome.html\" rel=\"noopener noreferrer nofollow\"\u003EДокументация по Kotlin\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fblog.jetbrains.com\u002Fkotlin\u002F2020\u002F08\u002Fthe-state-of-kotlin-support-in-spring\u002F\" rel=\"noopener noreferrer nofollow\"\u003EВыступление 2020 года о поддержке Kotlin в Spring (видео и расшифровка)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=tt4cxR5onQU\" rel=\"noopener noreferrer nofollow\"\u003EВыступление 2021 года о поддержке Kotlin в Spring (видео)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdocs.spring.io\u002Fspring-framework\u002Fdocs\u002Fcurrent\u002Freference\u002Fhtml\u002Flanguages.html#kotlin-resources\" rel=\"noopener noreferrer nofollow\"\u003EДокументация о поддержке Kotlin в Spring\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdocs.spring.io\u002Fspring-boot\u002Fdocs\u002F2.5.5\u002Freference\u002Fhtmlsingle\u002F#features.kotlin\" rel=\"noopener noreferrer nofollow\"\u003EДокументация о поддержке Kotlin в Spring Boot\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmapstruct\u002Fmapstruct-examples\u002Ftree\u002Fmaster\u002Fmapstruct-kotlin\" rel=\"noopener noreferrer nofollow\"\u003EИспользование MapStruct с Kotlin\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FFasterXML\u002Fjackson-module-kotlin\" rel=\"noopener noreferrer nofollow\"\u003EИспользование Jackson с Kotlin\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmockito\u002Fmockito-kotlin\" rel=\"noopener noreferrer nofollow\"\u003EИспользование Mockito с Kotlin\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FMicroUtils\u002Fkotlin-logging\" rel=\"noopener noreferrer nofollow\"\u003EБиблиотека kotlin-logging\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"Java"},{"titleHtml":"Kotlin"},{"titleHtml":"spring"},{"titleHtml":"spring boot"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fced\u002F0cf\u002F77f\u002Fced0cf77f1dfccc0fe388edc07c12d6a.jpg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fced\u002F0cf\u002F77f\u002Fced0cf77f1dfccc0fe388edc07c12d6a.jpg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583850\\\u002F\"},\"headline\":\"Из Java в Kotlin: туда и обратно\",\"datePublished\":\"2021-10-24T18:00:02+03:00\",\"dateModified\":\"2021-10-24T18:00:02+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"pyltsinm\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Jav...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583850\\\u002F#post-content-body\",\"about\":[\"h_java\",\"h_kotlin\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F583850\\\u002Faedd0d6a692461ac1468efd261e0e0d9\\\u002F\"]}","metaDescription":"В статье рассмотрены проблемы и решения, которые возникли при добавлении Kotlin в существующий небольшой микросервис на Spring Boot, написанный изначально на Java. В рамках статьи не будут...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"java,kotlin"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
