<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Разбираемся с параллельными и конкурентными вычислениями в Python / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/wunderfund\/blog\/581994\/"},"headline":"Разбираемся с параллельными и конкурентными вычислениями в Python","datePublished":"2021-10-11T15:18:08+03:00","dateModified":"2021-10-11T15:18:50+03:00","author":{"@type":"Person","name":"mr-pickles"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где...","url":"https:\/\/habr.com\/ru\/company\/wunderfund\/blog\/581994\/#post-content-body","about":["c_wunderfund","h_python","h_programming","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/581994\/082843e02e6884ee902a0ce35193a885\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5b2\/c32\/507\/5b2c3250720adff113a3084155af5c2b.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/498\/317\/50e\/49831750eadff603bf89a0f527447004.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Разбираемся с параллельными и конкурентными вычислениями в Python" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Разбираемся с параллельными и конкурентными вычислениями в Python" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Разбираемся с параллельными и конкурентными вычислениями в Python" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где не критичны экстремально низкие..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где не критичны экстремально низкие..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где не критичны экстремально низкие..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где не критичны экстремально низкие..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где не критичны экстремально низкие..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/a11/1f5/aad/a111f5aad73a8be22ce3a668236d58e5.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/a11/1f5/aad/a111f5aad73a8be22ce3a668236d58e5.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/a11/1f5/aad/a111f5aad73a8be22ce3a668236d58e5.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/a11/1f5/aad/a111f5aad73a8be22ce3a668236d58e5.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/a11/1f5/aad/a111f5aad73a8be22ce3a668236d58e5.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="581994" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-11T12:18:08.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/581994/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/company/wunderfund/blog/581994/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/a11/1f5/aad/a111f5aad73a8be22ce3a668236d58e5.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/581994/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="wunderfund" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><!----></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-card tm-company-article__company-card"><div class="tm-company-card__info"><div class="tm-company-card__header"><a href="/ru/company/wunderfund/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="//habrastorage.org/getpro/habr/company/b1a/8c4/544/b1a8c4544d951f4ea9bad437589d958e.png" width="48" class="tm-entity-image__pic"></div></a> <!----> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">60.88</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div> <div class="tm-company-card__info"><a href="/ru/company/wunderfund/profile/" class="tm-company-card__name">
        Wunder Fund
      </a> <div class="tm-company-card__description">Мы занимаемся высокочастотной торговлей на бирже</div></div></div> <div class="tm-company-card__buttons"><!----> <!----></div></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/mr-pickles/" title="mr-pickles" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/a90/a35/fb7/a90a35fb73f6e7f05770af0978f90b11.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/mr-pickles/" class="tm-user-info__username">
      mr-pickles
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-11T12:18:08.000Z" title="2021-10-11, 15:18">11  октября   в 15:18</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Разбираемся с параллельными и конкурентными вычислениями в Python</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/company/wunderfund/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании Wunder Fund</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/python/" class="tm-article-snippet__hubs-item-link"><span>Python</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/programming/" class="tm-article-snippet__hubs-item-link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://sourcery.ai/blog/concurrency/" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Brendan Maginnis
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="/img/image-loader.svg" height="440" data-src="https://habrastorage.org/getpro/habr/upload_files/5b2/c32/507/5b2c3250720adff113a3084155af5c2b.png" data-width="780"/><figcaption></figcaption></figure><p>Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.<br/><br/><em>Прим. Wunder Fund: для задач, где не критичны экстремально низкие задержки — при сохранении и обработке биржевых данных, мы используем Питон, и естественно применяем описанные в статье подходы. Статья будет полезна начинающим разработчикам.</em></p><p>Мы увидим, что когда один человек одновременно делает несколько дел — это похоже на конкурентность, а когда несколько человек, работая бок о бок, заняты каждый собственным делом — это напоминает параллелизм. Эти ситуации мы разберём на простом и понятном примере закусочных, в которые люди заходят в обеденный перерыв. Такие заведения стремятся обслуживать клиентов как можно быстрее и эффективнее. Потом я покажу реализацию механизмов этих закусочных на Python, а в итоге мы сравним разные возможности одновременного «приготовления нескольких блюд», которые даёт нам этот язык, и разберёмся с тем, в каких ситуациях их применение наиболее оправдано.</p><p>А именно, я раскрою здесь следующие вопросы:</p><ul><li><p>Отличия конкурентности от параллелизма.</p></li><li><p>Различные варианты организации конкурентного выполнения кода (многопоточность, модуль <code>asyncio</code>, модуль <code>multiprocessing</code>, облачные функции) и их сравнение.</p></li><li><p>Сильные и слабые стороны каждого подхода к организации конкурентного выполнения кода.</p></li><li><p>Выбор конкретного варианта организации конкурентного выполнения кода с использованием специальной блок-схемы.</p></li></ul><h2>В чём отличие между конкурентным и параллельным выполнением кода?</h2><p>Начнём с определений:</p><blockquote><p>▪ Систему называют конкурентной, если она может поддерживать наличие двух или большего количества действий, находящихся в процессе выполнения в одно и то же время.</p><p>▪ Систему называют параллельной, если она может поддерживать наличие двух или большего количества действий, выполняемых в точности в одно и то же время.</p><p><em>Самое главное в этих определениях, их ключевое отличие друг от друга, заключается в словах «в процессе выполнения».</em></p><p><a href="https://www.oreilly.com/library/view/the-art-of/9780596802424/">The Art of Concurrency</a></p></blockquote><p>А теперь перейдём к нашей истории про еду.</p><p>В обеденный перерыв вы оказались на улице, на которую раньше не попадали. Там есть два места, где можно перекусить: палатка с надписью «Конкурентные бургеры» и ресторанчик, который называется «Параллельные салаты».</p><p>Изделия обоих заведений выглядят завлекательно, правда, перед ними стоят длинные очереди. Поэтому у вас возникает вопрос о том, в каком из них вас обслужат быстрее.</p><p>В «Конкурентных бургерах» работает дама среднего возраста. На её руке — татуировка «Python», она во время работы от души хохочет. Она выполняет следующие действия:</p><ul><li><p>Принимает заказы.</p></li><li><p>Переворачивает жарящиеся котлеты для бургеров.</p></li><li><p>Накладывает на булочки овощи и котлеты, поливает всё это соусом, выдаёт готовые заказы.</p></li></ul><p>Дама без остановки переключается между этими задачами. Вот она проверяет котлеты на гриле и убирает те, что уже сжарились, потом — принимает заказ, дальше, если есть готовые котлеты, делает бургер, после чего вручает клиенту аппетитный свёрток.</p><p>А «Параллельные салаты» укомплектованы командой одинаковых мужчин. На их лицах — дежурные улыбки, во время работы они вежливо переговариваются. Каждый из них делает салат лишь для одного клиента. А именно, каждый принимает заказ, кладёт ингредиенты в чистую миску, добавляет заправку, энергично всё перемешивает, пересыпает получившуюся у него здоровую еду в контейнер, который отдаёт клиенту, а миску отставляет в сторону. А тем временем ещё один работник, такой же, как и остальные, собирает грязные миски и моет их.</p><p>Главные различия этих двух заведений заключаются в количестве работников и в том, как именно в них решаются различные задачи:</p><ul><li><p>В «Конкурентных бургерах» одновременно (но не в точности в одно и то же время) выполняется несколько задач. Там имеется единственный работник, который переключается между задачами.</p></li><li><p>В «Параллельных салатах» несколько задач решается одновременно, в точности в одно и то же время. Здесь имеется несколько работников, каждый из которых в некий момент времени решает лишь одну какую-то задачу.</p></li></ul><p>Вы замечаете, что и там и там клиентов обслуживают с одинаковой скоростью. Женщина в «Конкурентных бургерах» ограничена скоростью, с которой её небольшой гриль способен жарить котлеты. А в «Параллельных салатах» используется труд нескольких мужчин, каждый из которых занят на одном салате и ограничен временем, необходимым на приготовление салата.</p><p>Вам становится понятно, что «Конкурентные бургеры» (Concurrent Burgers) ограничены скоростью подсистемы ввода/вывода (I/O bound), а «Параллельные салаты» (Parallel Salads) ограничены возможностями центрального процессора (CPU bound).</p><ul><li><p>Ограничения, связанные с подсистемой ввода/вывода — это когда скорость программы зависит от того, насколько быстро происходит чтение данных с диска или выполнение сетевых запросов. «Подсистемой ввода/вывода» в «Конкурентных бургерах» является процесс приготовления котлет.</p></li><li><p>Ограничения, связанные с возможностями центрального процессора, ослабляются при повышении быстродействия процессора. Чем он быстрее — тем быстрее работает программа. В «Параллельных салатах» «скорость процессора» — это скорость, с которой сотрудник способен приготовить салат.</p></li></ul><p>Вы не в состоянии принять решение, пять минут пребываете в глубокой задумчивости, а потом ваш товарищ, который уже кое-что знает о «Бургерах» и «Салатах», выводит вас из оцепенения и приглашает вас присоединиться к нему в одной из очередей.</p><p>Обратите внимание на то, что «Параллельные салаты» можно назвать и конкурентным и параллельным рестораном. Дело в том, что тут наблюдается «наличие двух или большего количества действий». Параллельное выполнение кода — это разновидность конкурентного выполнения кода.</p><p>Эти два заведения помогают осознать суть различия между конкурентным и параллельным выполнением задач. Сейчас мы поговорим о том, как всё это реализуется в Python.</p><h3>Варианты организации конкурентных вычислений в Python</h3><p>В Python имеется два механизма, которыми можно воспользоваться для организации конкурентного выполнения кода:</p><ul><li><p>Многопоточность</p></li><li><p>Модуль <code>asyncio</code></p></li></ul><p>Тут есть и возможность параллельного выполнения кода:</p><ul><li><p>Модуль <code>multiprocessing</code></p></li></ul><p>Есть и ещё один вариант организации параллельного выполнения кода, доступный при запуске Python-программ в облачной среде:</p><ul><li><p>Облачные функции</p></li></ul><h2>Конкурентное выполнение кода на практике</h2><p>Рассмотрим два возможных варианта реализации «Конкурентных бургеров» с использованием многопоточности и модуля <code>asyncio</code>. В обоих случаях имеется единственный рабочий процесс, который принимает заказы, жарит котлеты и делает бургеры.</p><p>И там и там используется лишь один процессор. Он переключается между различными задачами, которые ему нужно решить. Разница между применением многопоточности и модуля <code>asyncio</code> заключается в том, как принимаются решения о смене задач:</p><ul><li><p>При использовании многопоточности операционная система знает о наличии различных потоков и может в любое время прерывать их работу и переключать на другую задачу. Сама программа это не контролирует. Это — то, что называется «вытесняющей многозадачностью» (<a href="https://en.wikipedia.org/wiki/Preemption_%28computing%29#Preemptive_multitasking">preemptive multitasking</a>), так как операционная система может принудить поток выполнить переключение на другую задачу. В большинстве языков программирования потоки выполняются параллельно, но в Python в каждый конкретный момент времени позволено выполняться лишь одному потоку.</p></li><li><p>При использовании модуля <code>asyncio</code> программа сама принимает решение о том, когда ей нужно переключиться между задачами. Каждая задача взаимодействует с другими задачами, передавая им управление тогда, когда она к этому готова. Поэтому такая схема работы называется «кооперативной многозадачностью» (<a href="https://en.wikipedia.org/wiki/Cooperative_multitasking">cooperative multitasking</a>), так как каждая задача должна взаимодействовать с другими, передавая им управление в момент, когда она уже не может сделать ничего полезного.</p></li></ul><h3>Реализация «Конкурентных бургеров» с использованием многопоточности</h3><p>При использовании многопоточности рабочий процесс меняет задачи в любой момент выполнения кода. Сам рабочий процесс (в нашем случае — дама средних лет) может находиться в процессе приёма заказа, когда его внезапно отвлекают и предлагают проверить жарящиеся котлеты или сделать бургер, а после этого его могут «переключить» на выполнение любой другой задачи.</p><p>Взглянем на «Конкурентные бургеры», реализованные с использованием механизмов многопоточности:</p><pre><code class="python">from concurrent.futures import ThreadPoolExecutor
import queues
# Обратите внимание на то, что некоторые методы и переменные тут опущены
# для того чтобы уделить основное внимание вопросам многопоточности.
def run_concurrent_burgers():
    # Создание блокирующих очередей
    customers = queue.Queue()
    orders = queue.Queue(maxsize=5)  # Возможна одновременная обработка до 5 заказов
    cooked_patties = queue.Queue()
    # Гриль совершенно независим от работника,
    # он превращает сырые котлеты в котлеты жареные.
    # Это напоминает чтение данных с диска или выполнение сетевого запроса.
    grill = Grill()
    # Выполнить три задачи, используя пул потоков
    with ThreadPoolExecutor() as executor:
        executor.submit(take_orders, customers, orders)
        executor.submit(cook_patties, grill, cooked_patties)
        executor.submit(make_burgers, orders, cooked_patties)
def take_orders(customers, orders):
    while True:
        customer = customers.get()
        order = take_order(customer)
        orders.put(order)
def cook_patties(grill, cook_patties):
    for position in range(len(grill)):
        grill[position] = raw_patties.pop()
    while True:
        for position, patty in enumerate(grill):
            if patty.cooked:
                cooked_patties.put(patty)
                grill[position] = raw_patties.pop()
        # Не проверять снова в течение минуты
        threading.sleep(60)
def make_burgers(orders, cooked_patties):
    while True:
        patty = cooked_patties.get()
        order = orders.get()
        burger = order.make_burger(patty)
        customer = order.shout_for_customer()
        customer.serve(burger)</code></pre><p>Каждая из задач (принять заказ, пожарить котлету, сделать бургер) представляет собой бесконечный цикл, в котором выполняются соответствующие действия.</p><p>В <code>run_concurrent_burger</code> мы запускаем каждую из этих задач в отдельном потоке. Мы можем создать поток для каждой из задач и вручную, но есть гораздо более приятный способ это сделать, который заключается в использовании интерфейса <code>ThreadPoolExecutor</code>, который создаёт поток для каждой переданной ему задачи.</p><p>При использовании нескольких потоков мы должны обеспечить такую схему работы с состоянием программы, когда в каждый конкретный момент времени лишь один поток осуществляет чтение или запись данных, к которым могут иметь доступ несколько потоков. Иначе всё может закончиться ситуацией, когда два потока «схватят» одну и ту же котлету, что может очень раздосадовать клиента. Существует такое понятие, как «потокобезопасность» (thread safety), которое имеет отношение к этому вопросу.</p><p>Для того чтобы обеспечить безопасную работу потоков мы используем очереди (Queues), позволяющие передавать управление состоянием программы между потоками. В пределах отдельных задач очередь блокируется при вызове <code>get</code> до тех пор, пока мы не обслужим клиента, не выполним заказ или не сжарим котлету. Операционная система не пытается переключиться на заблокированный поток, что даёт нам безопасный способ передачи состояния между потоками. Поток, помещая состояние в очередь, не использует его, а затем сообщает о том, что, в процессе его использования, не будет его менять.</p><h4>Сильные стороны многопоточности</h4><ul><li><p>Операции ввода/вывода не останавливают выполнение других задач.</p></li><li><p>Отличная поддержка различными версиями Python и библиотеками — если нечто может быть запущено в однопоточном режиме — весьма вероятно то, что это заработает и в многопоточном режиме.</p></li></ul><h4>Слабые стороны многопоточности</h4><ul><li><p>Система работает медленнее, чем при применении модуля asyncio из-за того, что на неё ложится дополнительная нагрузка по переключению между системными потоками.</p></li><li><p>Не обеспечивается потокобезопасность.</p></li><li><p>Не ускоряется выполнение задач, зависящих от скорости центрального процессора, наподобие задачи по изготовлению салатов (это — из-за того, что Python поддерживает выполнение в каждый конкретный момент времени лишь <a href="https://wiki.python.org/moin/GlobalInterpreterLock">одного потока</a>). В результате один работник, одновременно готовящий несколько салатов, не сделает их быстрее, чем если бы делал их один за другим. Дело в том, что в итоге на приготовление одного салата при одновременном приготовлении нескольких салатов уйдёт столько же времени, сколько ушло бы, если салаты готовились бы по одному.</p></li></ul><h3>Реализация «Конкурентных бургеров» с использованием модуля asyncio</h3><p>При использовании модуля <code>asyncio</code> имеется единственный цикл событий, который занимается управлением всеми задачами. Задачи могут пребывать в некотором количестве различных состояний, самыми важными из которых можно назвать состояние готовности (ready) и состояние ожидания (waiting). Цикл событий на каждой итерации проверяет, имеются ли задачи, пребывающие в состоянии ожидания, которые завершены и оказались в состоянии готовности. Затем цикл берёт задачу, находящуюся в состоянии готовности, и выполняет её до тех пор, пока она не завершится, либо — до тех пор, пока не окажется, что ей нужно дождаться завершения другой задачи. Часто подобные задачи представлены операциями ввода/вывода наподобие чтения данных с диска или выполнения HTTP-запроса.</p><p>Есть пара ключевых слов, которые используются в большинстве вариантов применения <code>asyncio</code>. Это — <code>async</code> и <code>await</code>.</p><ul><li><p>Ключевое слово <code>async</code> используется при объявлении функций для указания на то, что эти функции нужно запускать в виде отдельных задач.</p></li><li><p>Ключевое слово <code>await</code> позволяет создавать новые задачи и передавать управление циклу событий. Это ключевое слово позволяет перевести задачу в состояние ожидания. После завершения новой задачи она оказывается в состоянии готовности.</p></li></ul><p>Посмотрим на реализацию «Конкурентных бургеров» с использованием модуля <code>asyncio</code>:</p><pre><code class="python">import asyncio
# Обратите внимание на то, что некоторые методы и переменные тут опущены
# для того чтобы уделить основное внимание вопросам использования asyncio.
def run_concurrent_burgers():
    # Осуществляется управление этими очередями
    customers = asyncio.Queue()
    orders = asyncio.Queue(maxsize=5)  # Возможна одновременная обработка до 5 заказов
    cooked_patties = asyncio.Queue()
    # Гриль совершенно независим от работника,
    # он превращает сырые котлеты в котлеты жареные.
    grill = Grill()
    # Выполняем все задачи с использованием стандартного цикла событий asyncio
    asyncio.gather(
        take_orders(customers, orders),
        cook_patties(grill, cooked_patties),
        make_burgers(orders, cooked_patties),
    )
# Объявляем задачи asyncio с использованием конструкции async def
async def take_orders(customers, orders):
    while True:
        # Разрешаем переключение на новые задачи и здесь, и
        # во всех других await
        customer = await customers.get()
        order = take_order(customer)
        await orders.put(order)
async def cook_patties(grill, cooked_patties):
    for position in range(len(grill)):
        grill[position] = raw_patties.pop()
    while True:
        for position, patty in enumerate(grill):
            if patty.cooked:
                # put_noawait позволяет нам пополнять очередь,
                # не создавая новых задач и не передавая управление
                cooked_patties.put_noawait(patty)
                grill[position] = raw_patties.pop()
        # Ждём 30 секунд перед повторной проверкой
        await asyncio.sleep(30)
async def make_burgers(orders, cooked_patties):
    while True:
        patty = await cooked_patties.get()
        order = await orders.get()
        burger = order.make_burger(patty)
        customer = await order.shout_for_customer()
        customer.serve(burger)</code></pre><p>Каждая из функций, олицетворяющих задачи приёма заказа, поджаривания котлеты и приготовления бургера, объявлена с использованием конструкции <code>async def</code>.</p><p>В пределах этих задач работник переключается на новую задачу каждый раз, когда используется ключевое слово <code>await</code>. А именно, это происходит в следующих ситуациях:</p><ul><li><p>В задаче приёма заказа:</p></li><li><p>В задаче поджаривания котлет:</p></li><li><p>В задаче изготовления бургеров:</p></li></ul><p>Последний кусок этой головоломки заключается в функции <code>run_concurrent_burger</code>, в которой вызывается <code>asyncio.gather</code> для планирования задач, которые должны быть запущены циклом событий, представленным работником «Конкурентных бургеров».</p><p>Как мы уже знаем, в точности тогда, когда осуществляется переключение задач, нам не нужно заботиться об управлении совместным доступом к состоянию программы. Мы можем это реализовать, всего лишь воспользовавшись списком очередей и зная то, что у нас не возникнет ситуации, когда две задачи случайно «ухватятся» за одну котлету. Но для решения подобных задач настоятельно рекомендуется пользоваться очередями <code>asyncio</code>, так как это позволит нам очень просто наладить взаимодействие между задачами, указывая на особые моменты в процессах выполнения задач, в которые их можно приостанавливать.</p><p>Одним из интересных аспектов использования модуля <code>asyncio</code> является то, что ключевое слово <code>async</code> меняет интерфейс функции, что приводит к невозможности вызова таких функций из обычных функций, не являющихся асинхронными. Это можно счесть как неудачным, так и удачным решением. С одной стороны, можно сказать, что это вредит возможностям по композиции функций, так как нельзя смешивать <code>asyncio</code>-функции с функциями обычными. А с другой стороны, если возможности <code>asyncio</code> используются лишь для организации операций ввода/вывода, это заставляет программиста чётко разделять логику ввода/вывода и бизнес-логику приложения, ограничивая применение <code>asyncio</code> теми частями приложения, которые взаимодействуют с внешним миром, делая код понятнее, упрощая его тестирование. Явное выделение операций, отвечающих за ввод/вывод данных — это довольно-таки распространённая практика в типизированных функциональных языках, а в Haskell это обязательно.</p><h4>Сильные стороны применения модуля asyncio</h4><ul><li><p>Обеспечение чрезвычайно высокой скорости работы при решении задач, зависящих от подсистемы ввода/вывода.</p></li><li><p>Потокобезопасность.</p></li></ul><h4>Слабые стороны применения модуля asyncio</h4><ul><li><p>Задачи, производительность которых зависит от процессора, не ускоряются.</p></li><li><p>Этот модуль появился в Python сравнительно недавно.</p></li></ul><h2>Параллельное выполнение кода на практике</h2><p>В ресторанчике «Параллельные салаты» есть несколько работников, которые делают салаты (все разом). Мы собираемся создать реализацию этого заведения с использованием модуля <code>multiprocessing</code>.</p><p>А потом мы ещё заглянем в кофейню, называемую «Облачный кофе» и взглянем на то, как для параллельного выполнения задач можно использовать облачные функции.</p><h4>Реализация «Параллельных салатов» с использованием модуля multiprocessing</h4><p>Механизм работы «Параллельных салатов» отлично демонстрирует возможности модуля <code>multiprocessing</code>.</p><p>Каждый работник в этом заведении представлен новым процессом, создаваемым операционной системой. Эти процессы создаются посредством класса <code>ProcessPoolExecutor</code>, который назначает каждому из них задачи.</p><pre><code class="python">import multiprocessing as mp
from concurrent.futures import ProcessPoolExecutor
# Обратите внимание на то, что некоторые методы и переменные тут опущены
# для того чтобы уделить основное внимание вопросам использования multiprocessing.
def run_parallel_salads():
    # Создаём многопроцессные очереди, которые
    # могут обмениваться данными через границы процессов.
    customers = mp.Queue()
    bowls = mp.Queue()
    dirty_bowls = mp.Queue()
    # Запускаем параллельное выполнение задач с использованием ProcessPoolExecutor
    with ProcessPoolExecutor(max_workers=NUM_STAFF) as executor:
        # Set all but one worker making salads
        for _ in range(NUM_STAFF - 1):
            executor.submit(make_salad, customers, bowls, dirty_bowls)
        # Поручаем ещё одному работнику мыть посуду
        executor.submit(wash_bowls, dirty_bowls, bowls)
def make_salad(customers, bowls):
    while True:
        customer = customers.get()
        order = take_order(customer)
        bowl = bowls.get()
        bowl.add(ingredients)
        bowl.add(dressing)
        bowl.mix()
        salad = fill_container(bowl)
        customer.serve(salad)
        dirty_bowls.put(bowl)
def wash_bowls(dirty_bowls, bowls):
    while True:
        bowl = dirty_bowls.get()
        wash(bowl)
        bowls.put(bowl)</code></pre><p>При использовании модуля <code>multiprocessing</code> каждая задача выполняется в отдельном процессе. Эти процессы параллельно и независимо друг от друга выполняются операционной системой и друг друга не блокируют. Количество процессов, которые реально можно выполнять параллельно, ограничено количеством ядер процессора. Поэтому мы ограничим соответствующим числом количество сотрудников ресторана, которые делают салаты.</p><p>Так как наши задачи выполняются в различных процессах — они не используют какое-либо обычное состояние Python-программы совместно. У каждого из процессов имеется независимая копия всего состояния программы. Для налаживания «общения» процессов необходимо использовать специальные очереди, поддерживаемые модулем <code>multiprocessing</code>.</p><h4>Попутная заметка: модули asyncio и multiprocessing</h4><p>Один из сценариев использования модуля <code>multiprocessing</code> заключается в том, чтобы снимать нагрузку, связанную с выполнением тяжёлых вычислительных задач, с <code>asyncio</code>-приложений, чтобы такие задачи не блокировали бы другие части приложения. Вот небольшой набросок, иллюстрирующий этот сценарий:</p><pre><code class="python">import asyncio
from concurrent.futures import ProcessPoolExecutor
process_pool = ProcessPoolExecutor()  # Значение, применяемое по умолчанию, соответствует количеству ядер процессора
async def handle_long_request(n):
    event_loop = asyncio.get_running_loop()
    # Функция calculate_n_pi будет запущена в отдельном процессе, что позволит
    # циклу событий asyncio продолжить параллельную обработку других асинхронных задач
    return await event_loop.run_in_executor(process_pool_executor, calculate_n_pi, n)
def calculate_n_pi(n):
    threading.sleep(60)
    return n * 3.14</code></pre><h4>Сильные стороны применения модуля multiprocessing</h4><ul><li><p>Ускорение задач, скорость выполнения которых ограничена возможностями процессора.</p></li><li><p>Потокобезопасность.</p></li><li><p>Этот модуль может быть использован для организации длительных вычислений, выполняемых на веб-серверах в отдельных процессах.</p></li></ul><h4>Слабые стороны применения модуля multiprocessing</h4><ul><li><p>Отсутствует механизм совместного использования ресурсов.</p></li><li><p>Создаётся большая дополнительная нагрузка на систему. Этот модуль не рекомендуется использовать в задачах, скорость выполнения которых привязана к подсистеме ввода/вывода.</p></li></ul><h3>Реализация «Облачного кофе» с использованием облачных функций</h3><p>Вы с другом пошли в парк, чтобы съесть то, что удалось раздобыть на обед, и заметили пушистое разноцветное облако, висящее над группой людей. Вы присмотрелись и поняли, что это — вывеска кофейни «Облачный кофе».</p><p>Ваш друг кофе не выносит, но вы, всё же, вместе решили взять по стаканчику — так сказать, забавы ради. Когда вы подошли к кофейне, каждый из вас попал за собственную стойку со своим баристой, которые медленно выплыли из облака. Баристы приняли у вас заказы, сделали кофе и подали его вам и вашему другу.</p><p>Вдруг в «Облачный кофе» влетела оживлённая толпа народа. Стоек на всех не хватило, но совсем скоро из облака выплыли новые стойки с баристами, после чего всех, кто хотел выпить кофе, быстро обслужили. Когда народ попил кофе и дополнительные стойки опустели, эти стойки ещё немного постояли (баристы совершенно не обращали внимания на другие стойки) после чего уплыли обратно в облако.</p><p>Когда вы попили кофе и вышли — вы обратили внимание на то, что в кофейне всегда находится примерно одинаковое количество стоек, так как туда постоянно подходят люди, делающие заказы. Если в кофейне оказывается больше людей, чем обычно, из облака выплывают новые стойки, а когда случается так, что заказ выполнен, клиент ушёл, а стойка оказалась никому не нужной, она ещё немного пустует, а потом возвращается в облако.</p><p>Ваш друг решил сделать абсурдно сложный заказ, чтобы попробовать что-то новое, такое, в чём что-то перебьёт вкус обычного кофе, но заказа он так и не дождался. Бариста добавлял в напиток зефир и шоколадные стружки, но вдруг бросил всё в корзину и крикнул: «Тайм-аут».</p><p>Вы, оба на грани нервного срыва, пошли прочь из парка.</p><p>Облачные функции — это ещё один механизм ускорения работы кода, на который стоит обратить внимание тем, кто занимается разработкой веб-сервисов. Их, пожалуй, писать легче всего, так как каждая из них отвечает лишь за выполнение отдельного «заказа» за один раз. Применяя их, можно совершенно забыть о конкурентности и о прочих подобных вещах.</p><pre><code class="python">def cloud_coffees(order):
    ground_coffee = grind_beans()
    coffee = brew_coffee(ground_coffee)
    coffee.add_embellishments(order)
    return coffee</code></pre><p>Каждый запрос обслуживается отдельным экземпляром всего приложения. Когда создаётся новый экземпляр приложения — имеется небольшая задержка, связанная с выделением ресурсов и запуском этого экземпляра приложения. Именно поэтому экземпляры приложения могут какое-то время простаивать, ожидая поступления новых запросов. Запросы, если пони поступают уже запущенному экземпляру приложения, могут быть выполнены практически мгновенно, без задержек. А вот после того, как новых запросов некоторое время не поступает — бездействующие экземпляры приложения уничтожаются, ресурсы, занятые ими, возвращаются системе.</p><p>Обработка каждого запроса через некоторое время, зависящее от реализации системы, завершается по тайм-ауту. Нужно обеспечить, чтобы задачи завершались бы до наступления этого тайм-аута, или они будут попросту исчезать, так и не выполнившись.</p><p>Экземпляры приложения не могут взаимодействовать с другими экземплярами приложения. Они ни при каких условиях не должны хранить состояние приложения между вызовами, так как они могут быть когда угодно уничтожены.</p><p>Наиболее известные реализации этого механизма представлены такими платформами, как AWS Lambda, Azure Functions и Google Cloud Functions.</p><h4>Сильные стороны облачных функций</h4><ul><li><p>Чрезвычайно простая модель организации вычислений.</p></li><li><p>Их использование может быть дешевле, чем применение постоянно работающего сервера.</p></li><li><p>Весьма лёгкое масштабирование систем, основанных на таких функциях.</p></li></ul><h4>Слабые стороны облачных функций</h4><ul><li><p>При запуске новых экземпляров приложений могут наблюдаться задержки.</p></li><li><p>Время выполнения вычислений, связанных с запросами, ограничено тайм-аутами.</p></li><li><p>У разработчика нет полного контроля над используемой версией Python — можно использовать лишь те версии, которые предоставлены облачным провайдером.</p></li></ul><h2>Какой вариант конкурентного выполнения кода выбрать?</h2><p>Давайте сведём всё, о чём мы говорили, в единую таблицу.</p><div><div class="table"><table><tbody><tr><td data-colwidth="150" width="150"><p></p><p></p></td><td data-colwidth="158" width="158"><p><strong><sup>Многопоточность</sup></strong></p></td><td><p><strong><sup>Модуль asyncio</sup></strong></p></td><td data-colwidth="147" width="147"><p><strong><sup>Модуль multithreading</sup></strong></p></td><td><p><strong><sup>Облачные функции</sup></strong></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Тип конкурентности</sup></p></td><td data-colwidth="158" width="158"><p><sup>Вытесняющая многозадачность</sup></p></td><td><p><sup>Кооперативная многозадачность</sup></p></td><td data-colwidth="147" width="147"><p><sup>Многопроцессность</sup></p></td><td><p><sup>Использование нескольких экземпляров приложения</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Конкурентное или параллельное выполнение кода</sup></p></td><td data-colwidth="158" width="158"><p><sup>Конкурентное</sup></p></td><td><p><sup>Конкурентное</sup></p></td><td data-colwidth="147" width="147"><p><sup>Параллельное</sup></p></td><td><p><sup>Параллельное</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Возможность самостоятельного управления конкурентностью</sup></p></td><td data-colwidth="158" width="158"><p><sup>Отсутствует</sup></p></td><td><p><sup>Присутствует</sup></p></td><td data-colwidth="147" width="147"><p><sup>Отсутствует</sup></p></td><td><p><sup>Отсутствует</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Принятие решения о переключении между задачами</sup></p></td><td data-colwidth="158" width="158"><p><sup>Операционная система сама выбирает момент переключения между задачами</sup></p></td><td><p><sup>Задача принимает решение о том, когда ей нужно передать управление другой сущности</sup></p></td><td data-colwidth="147" width="147"><p><sup>Процессы выполняются одновременно, на разных ядрах процессора</sup></p></td><td><p><sup>Запросы выполняются одновременно в различных экземплярах приложения</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Максимальное количество параллельно выполняемых процессов</sup></p></td><td data-colwidth="158" width="158"><p><sup>1</sup></p></td><td><p><sup>1</sup></p></td><td data-colwidth="147" width="147"><p><sup>Соответствует количеству ядер процессора</sup></p></td><td><p><sup>Без ограничений</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Взаимодействие между задачами</sup></p></td><td data-colwidth="158" width="158"><p><sup>Общее состояние</sup></p></td><td><p><sup>Общее состояние</sup></p></td><td data-colwidth="147" width="147"><p><sup>Многопроцессные очереди и возвращаемые значения</sup></p></td><td><p><sup>Невозможно</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Потокобезопасность</sup></p></td><td data-colwidth="158" width="158"><p><sup>Отсутствует</sup></p></td><td><p><sup>Присутствует</sup></p></td><td data-colwidth="147" width="147"><p><sup>Присутствует</sup></p></td><td><p><sup>Присутствует</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Задачи, которые решают с помощью данного подхода</sup></p></td><td data-colwidth="158" width="158"><p><sup>Те, производительность которых ограничена подсистемой ввода/вывода</sup></p></td><td><p><sup>Те, производительность которых ограничена подсистемой ввода/вывода</sup></p></td><td data-colwidth="147" width="147"><p><sup>Те, производительность которых ограничена возможностями процессора</sup></p></td><td><p><sup>Те, производительность которых ограничена подсистемой ввода/вывода в том случае, если они выполняются быстрее, чем истекает тайм-аут (около 5 минут)</sup></p></td></tr><tr><td data-colwidth="150" width="150"><p><sup>Дополнительная нагрузка на систему</sup></p></td><td data-colwidth="158" width="158"><p><sup>Использование одного системного потока для решения задач означает необходимость в оперативной памяти и увеличивает время переключения между задачами</sup></p></td><td><p><sup>Максимально низкая, все задачи выполняются в одном процессе и в одном потоке</sup></p></td><td data-colwidth="147" width="147"><p><sup>Использование отдельного системного процесса на каждую задачу приводит к потреблению памяти, превышающему то, что характерно для многопоточных систем</sup></p></td><td><p><sup>При запуске новых экземпляров приложения наблюдаются задержки</sup></p></td></tr></tbody></table></div></div><p>Теперь, когда вы видите общую картину, вы без труда подберёте именно то, что вам нужно.</p><p>Но, правда, прежде чем делать окончательный выбор, нужно как следует подумать о самой необходимости ускорения задач. Если некая задача запускается раз в неделю, а на её выполнение нужно 10 минут — есть ли смысл в её ускорении?</p><p>Если же вы выяснили, что смысл в ускорении какой-то задачи определённо есть, можете воспользоваться следующей блок-схемой для того, чтобы точно определиться с выбором подхода к её выполнению, который подойдёт именно вам.</p><figure class="full-width "><img src="/img/image-loader.svg" height="1024" data-src="https://habrastorage.org/getpro/habr/upload_files/498/317/50e/49831750eadff603bf89a0f527447004.png" data-width="780"/><figcaption></figcaption></figure><h2>Итоги</h2><p>Мы рассмотрели различные варианты организации конкурентного выполнения кода в Python:</p><ul><li><p>Многопоточность.</p></li><li><p>Использование модуля <code>asyncio</code>.</p></li><li><p>Использование модуля <code>multiprocessing</code>.</p></li></ul><p>Мы, кроме того, уделили некоторое внимание одной из возможностей развёртывания приложений, использование которой упрощает параллельное выполнение Python-кода:</p><ul><li><p>Облачные функции.</p></li></ul><p>Теперь вы знакомы с особенностями этих подходов к написанию программ и с их сильными и слабыми сторонами, знаете о том, для решения каких задач они подходят лучше всего.</p><details class="spoiler"><summary>О, а приходите к нам работать? 😏</summary><div class="spoiler__content"><p>Мы в <a href="http://wunderfund.io/"><strong>wunderfund.io</strong></a> занимаемся <a href="https://en.wikipedia.org/wiki/High-frequency_trading">высокочастотной алготорговлей</a> с 2014 года. Высокочастотная торговля — это непрерывное соревнование лучших программистов и математиков всего мира. Присоединившись к нам, вы станете частью этой увлекательной схватки.</p><p>Мы предлагаем интересные и сложные задачи по анализу данных и low latency разработке для увлеченных исследователей и программистов. Гибкий график и никакой бюрократии, решения быстро принимаются и воплощаются в жизнь.</p><p>Сейчас мы ищем плюсовиков, питонистов, дата-инженеров и мл-рисерчеров.<br/><a href="http://wunderfund.io/#join_us">Присоединяйтесь к нашей команде.</a></p></div></details></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BPython%5D" class="tm-tags-list__link">Python</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0%5D" class="tm-tags-list__link">разработка</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Basyncio%5D" class="tm-tags-list__link">asyncio</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bparallelism%5D" class="tm-tags-list__link">parallelism</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bconcurrency%5D" class="tm-tags-list__link">concurrency</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmultithreading%5D" class="tm-tags-list__link">multithreading</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/company/wunderfund/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании Wunder Fund
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/python/" class="tm-hubs-list__link">
    Python
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/programming/" class="tm-hubs-list__link">
    Программирование
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 25: ↑24 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 25: ↑24 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+23</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">9.3K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    130
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/company/wunderfund/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/b1a/8c4/544/b1a8c4544d951f4ea9bad437589d958e.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/company/wunderfund/profile/" class="tm-company-snippet__title">Wunder Fund</a> <div class="tm-company-snippet__description">Мы занимаемся высокочастотной торговлей на бирже</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="http://wunderfund.io" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/mr-pickles/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/a90/a35/fb7/a90a35fb73f6e7f05770af0978f90b11.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 19 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    17
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">38.8</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/mr-pickles/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @mr-pickles
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/company/wunderfund/blog/581994/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 6 
    </span></a> <!----></div></div></div>  <!---->  <!----> <!----></div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2013-12-31T20:00:00.000Z" title="2014-01-01, 00:00">1  января  2014</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="http://wunderfund.io" target="_blank" class="tm-company-basic-info__link">
      wunderfund.io
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    11–30 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2015-11-22T01:25:19.000Z" title="2015-11-22, 04:25">22  ноября  2015</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="/ru/users/xopxe/" class="tm-company-basic-info__link">
      xopxe
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/company/wunderfund/blog/581994/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/company/wunderfund/blog/581994/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"581994":{"id":"581994","timePublished":"2021-10-11T12:18:08+00:00","isCorporative":true,"lang":"ru","titleHtml":"Разбираемся с параллельными и конкурентными вычислениями в Python","leadData":{"textHtml":"\u003Cp\u003EЯ собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.\u003Cbr\u003E\u003Cbr\u003E\u003Cem\u003EПрим. Wunder Fund: для задач, где не критичны экстремально низкие задержки — при сохранении и обработке биржевых данных, мы используем Питон, и естественно применяем описанные в статье подходы. Статья будет полезна начинающим разработчикам.\u003Cbr\u003E\u003C\u002Fem\u003E\u003Cbr\u003EМы увидим, что когда один человек одновременно делает несколько дел — это похоже на конкурентность, а когда несколько человек, работая бок о бок, заняты каждый собственным делом — это напоминает параллелизм. Эти ситуации мы разберём на простом и понятном примере закусочных, в которые люди заходят в обеденный перерыв. Такие заведения стремятся обслуживать клиентов как можно быстрее и эффективнее. Потом я покажу реализацию механизмов этих закусочных на Python, а в итоге мы сравним разные возможности одновременного «приготовления нескольких блюд», которые даёт нам этот язык, и разберёмся с тем, в каких ситуациях их применение наиболее оправдано.\u003C\u002Fp\u003E\u003Cp\u003EА именно, я раскрою здесь следующие вопросы:\u003C\u002Fp\u003E\u003Cp\u003E▪ Отличия конкурентности от параллелизма.\u003Cbr\u003E▪ Различные варианты организации конкурентного выполнения кода (многопоточность, модуль&nbsp;\u003Ccode\u003Easyncio\u003C\u002Fcode\u003E, модуль&nbsp;\u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E, облачные функции) и их сравнение.\u003Cbr\u003E▪ Сильные и слабые стороны каждого подхода к организации конкурентного выполнения кода.\u003Cbr\u003E▪ Выбор конкретного варианта организации конкурентного выполнения кода с использованием специальной блок-схемы.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa11\u002F1f5\u002Faad\u002Fa111f5aad73a8be22ce3a668236d58e5.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa11\u002F1f5\u002Faad\u002Fa111f5aad73a8be22ce3a668236d58e5.png","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Brendan Maginnis","originalUrl":"https:\u002F\u002Fsourcery.ai\u002Fblog\u002Fconcurrency\u002F"}}],"author":{"scoreStats":{"score":17,"votesCount":19},"rating":38.8,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1521341","alias":"mr-pickles","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa90\u002Fa35\u002Ffb7\u002Fa90a35fb73f6e7f05770af0978f90b11.png","speciality":null},"statistics":{"commentsCount":6,"favoritesCount":130,"readingCount":9304,"score":23,"votesCount":25},"hubs":[{"relatedData":null,"id":"19715","alias":"wunderfund","type":"corporative","title":"Блог компании Wunder Fund","titleHtml":"Блог компании Wunder Fund","isProfiled":false},{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"440\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5b2\u002Fc32\u002F507\u002F5b2c3250720adff113a3084155af5c2b.png\" data-width=\"780\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЯ собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.\u003Cbr\u002F\u003E\u003Cbr\u002F\u003E\u003Cem\u003EПрим. Wunder Fund: для задач, где не критичны экстремально низкие задержки — при сохранении и обработке биржевых данных, мы используем Питон, и естественно применяем описанные в статье подходы. Статья будет полезна начинающим разработчикам.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EМы увидим, что когда один человек одновременно делает несколько дел — это похоже на конкурентность, а когда несколько человек, работая бок о бок, заняты каждый собственным делом — это напоминает параллелизм. Эти ситуации мы разберём на простом и понятном примере закусочных, в которые люди заходят в обеденный перерыв. Такие заведения стремятся обслуживать клиентов как можно быстрее и эффективнее. Потом я покажу реализацию механизмов этих закусочных на Python, а в итоге мы сравним разные возможности одновременного «приготовления нескольких блюд», которые даёт нам этот язык, и разберёмся с тем, в каких ситуациях их применение наиболее оправдано.\u003C\u002Fp\u003E\u003Cp\u003EА именно, я раскрою здесь следующие вопросы:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОтличия конкурентности от параллелизма.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EРазличные варианты организации конкурентного выполнения кода (многопоточность, модуль \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E, модуль \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E, облачные функции) и их сравнение.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСильные и слабые стороны каждого подхода к организации конкурентного выполнения кода.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВыбор конкретного варианта организации конкурентного выполнения кода с использованием специальной блок-схемы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EВ чём отличие между конкурентным и параллельным выполнением кода?\u003C\u002Fh2\u003E\u003Cp\u003EНачнём с определений:\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E▪ Систему называют конкурентной, если она может поддерживать наличие двух или большего количества действий, находящихся в процессе выполнения в одно и то же время.\u003C\u002Fp\u003E\u003Cp\u003E▪ Систему называют параллельной, если она может поддерживать наличие двух или большего количества действий, выполняемых в точности в одно и то же время.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cem\u003EСамое главное в этих определениях, их ключевое отличие друг от друга, заключается в словах «в процессе выполнения».\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.oreilly.com\u002Flibrary\u002Fview\u002Fthe-art-of\u002F9780596802424\u002F\"\u003EThe Art of Concurrency\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EА теперь перейдём к нашей истории про еду.\u003C\u002Fp\u003E\u003Cp\u003EВ обеденный перерыв вы оказались на улице, на которую раньше не попадали. Там есть два места, где можно перекусить: палатка с надписью «Конкурентные бургеры» и ресторанчик, который называется «Параллельные салаты».\u003C\u002Fp\u003E\u003Cp\u003EИзделия обоих заведений выглядят завлекательно, правда, перед ними стоят длинные очереди. Поэтому у вас возникает вопрос о том, в каком из них вас обслужат быстрее.\u003C\u002Fp\u003E\u003Cp\u003EВ «Конкурентных бургерах» работает дама среднего возраста. На её руке — татуировка «Python», она во время работы от души хохочет. Она выполняет следующие действия:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EПринимает заказы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПереворачивает жарящиеся котлеты для бургеров.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНакладывает на булочки овощи и котлеты, поливает всё это соусом, выдаёт готовые заказы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EДама без остановки переключается между этими задачами. Вот она проверяет котлеты на гриле и убирает те, что уже сжарились, потом — принимает заказ, дальше, если есть готовые котлеты, делает бургер, после чего вручает клиенту аппетитный свёрток.\u003C\u002Fp\u003E\u003Cp\u003EА «Параллельные салаты» укомплектованы командой одинаковых мужчин. На их лицах — дежурные улыбки, во время работы они вежливо переговариваются. Каждый из них делает салат лишь для одного клиента. А именно, каждый принимает заказ, кладёт ингредиенты в чистую миску, добавляет заправку, энергично всё перемешивает, пересыпает получившуюся у него здоровую еду в контейнер, который отдаёт клиенту, а миску отставляет в сторону. А тем временем ещё один работник, такой же, как и остальные, собирает грязные миски и моет их.\u003C\u002Fp\u003E\u003Cp\u003EГлавные различия этих двух заведений заключаются в количестве работников и в том, как именно в них решаются различные задачи:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВ «Конкурентных бургерах» одновременно (но не в точности в одно и то же время) выполняется несколько задач. Там имеется единственный работник, который переключается между задачами.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВ «Параллельных салатах» несколько задач решается одновременно, в точности в одно и то же время. Здесь имеется несколько работников, каждый из которых в некий момент времени решает лишь одну какую-то задачу.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВы замечаете, что и там и там клиентов обслуживают с одинаковой скоростью. Женщина в «Конкурентных бургерах» ограничена скоростью, с которой её небольшой гриль способен жарить котлеты. А в «Параллельных салатах» используется труд нескольких мужчин, каждый из которых занят на одном салате и ограничен временем, необходимым на приготовление салата.\u003C\u002Fp\u003E\u003Cp\u003EВам становится понятно, что «Конкурентные бургеры» (Concurrent Burgers) ограничены скоростью подсистемы ввода\u002Fвывода (I\u002FO bound), а «Параллельные салаты» (Parallel Salads) ограничены возможностями центрального процессора (CPU bound).\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОграничения, связанные с подсистемой ввода\u002Fвывода — это когда скорость программы зависит от того, насколько быстро происходит чтение данных с диска или выполнение сетевых запросов. «Подсистемой ввода\u002Fвывода» в «Конкурентных бургерах» является процесс приготовления котлет.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОграничения, связанные с возможностями центрального процессора, ослабляются при повышении быстродействия процессора. Чем он быстрее — тем быстрее работает программа. В «Параллельных салатах» «скорость процессора» — это скорость, с которой сотрудник способен приготовить салат.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВы не в состоянии принять решение, пять минут пребываете в глубокой задумчивости, а потом ваш товарищ, который уже кое-что знает о «Бургерах» и «Салатах», выводит вас из оцепенения и приглашает вас присоединиться к нему в одной из очередей.\u003C\u002Fp\u003E\u003Cp\u003EОбратите внимание на то, что «Параллельные салаты» можно назвать и конкурентным и параллельным рестораном. Дело в том, что тут наблюдается «наличие двух или большего количества действий». Параллельное выполнение кода — это разновидность конкурентного выполнения кода.\u003C\u002Fp\u003E\u003Cp\u003EЭти два заведения помогают осознать суть различия между конкурентным и параллельным выполнением задач. Сейчас мы поговорим о том, как всё это реализуется в Python.\u003C\u002Fp\u003E\u003Ch3\u003EВарианты организации конкурентных вычислений в Python\u003C\u002Fh3\u003E\u003Cp\u003EВ Python имеется два механизма, которыми можно воспользоваться для организации конкурентного выполнения кода:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EМногопоточность\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EМодуль \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТут есть и возможность параллельного выполнения кода:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EМодуль \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЕсть и ещё один вариант организации параллельного выполнения кода, доступный при запуске Python-программ в облачной среде:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОблачные функции\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EКонкурентное выполнение кода на практике\u003C\u002Fh2\u003E\u003Cp\u003EРассмотрим два возможных варианта реализации «Конкурентных бургеров» с использованием многопоточности и модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E. В обоих случаях имеется единственный рабочий процесс, который принимает заказы, жарит котлеты и делает бургеры.\u003C\u002Fp\u003E\u003Cp\u003EИ там и там используется лишь один процессор. Он переключается между различными задачами, которые ему нужно решить. Разница между применением многопоточности и модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E заключается в том, как принимаются решения о смене задач:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EПри использовании многопоточности операционная система знает о наличии различных потоков и может в любое время прерывать их работу и переключать на другую задачу. Сама программа это не контролирует. Это — то, что называется «вытесняющей многозадачностью» (\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FPreemption_%28computing%29#Preemptive_multitasking\"\u003Epreemptive multitasking\u003C\u002Fa\u003E), так как операционная система может принудить поток выполнить переключение на другую задачу. В большинстве языков программирования потоки выполняются параллельно, но в Python в каждый конкретный момент времени позволено выполняться лишь одному потоку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПри использовании модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E программа сама принимает решение о том, когда ей нужно переключиться между задачами. Каждая задача взаимодействует с другими задачами, передавая им управление тогда, когда она к этому готова. Поэтому такая схема работы называется «кооперативной многозадачностью» (\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FCooperative_multitasking\"\u003Ecooperative multitasking\u003C\u002Fa\u003E), так как каждая задача должна взаимодействовать с другими, передавая им управление в момент, когда она уже не может сделать ничего полезного.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003EРеализация «Конкурентных бургеров» с использованием многопоточности\u003C\u002Fh3\u003E\u003Cp\u003EПри использовании многопоточности рабочий процесс меняет задачи в любой момент выполнения кода. Сам рабочий процесс (в нашем случае — дама средних лет) может находиться в процессе приёма заказа, когда его внезапно отвлекают и предлагают проверить жарящиеся котлеты или сделать бургер, а после этого его могут «переключить» на выполнение любой другой задачи.\u003C\u002Fp\u003E\u003Cp\u003EВзглянем на «Конкурентные бургеры», реализованные с использованием механизмов многопоточности:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Efrom concurrent.futures import ThreadPoolExecutor\nimport queues\n# Обратите внимание на то, что некоторые методы и переменные тут опущены\n# для того чтобы уделить основное внимание вопросам многопоточности.\ndef run_concurrent_burgers():\n    # Создание блокирующих очередей\n    customers = queue.Queue()\n    orders = queue.Queue(maxsize=5)  # Возможна одновременная обработка до 5 заказов\n    cooked_patties = queue.Queue()\n    # Гриль совершенно независим от работника,\n    # он превращает сырые котлеты в котлеты жареные.\n    # Это напоминает чтение данных с диска или выполнение сетевого запроса.\n    grill = Grill()\n    # Выполнить три задачи, используя пул потоков\n    with ThreadPoolExecutor() as executor:\n        executor.submit(take_orders, customers, orders)\n        executor.submit(cook_patties, grill, cooked_patties)\n        executor.submit(make_burgers, orders, cooked_patties)\ndef take_orders(customers, orders):\n    while True:\n        customer = customers.get()\n        order = take_order(customer)\n        orders.put(order)\ndef cook_patties(grill, cook_patties):\n    for position in range(len(grill)):\n        grill[position] = raw_patties.pop()\n    while True:\n        for position, patty in enumerate(grill):\n            if patty.cooked:\n                cooked_patties.put(patty)\n                grill[position] = raw_patties.pop()\n        # Не проверять снова в течение минуты\n        threading.sleep(60)\ndef make_burgers(orders, cooked_patties):\n    while True:\n        patty = cooked_patties.get()\n        order = orders.get()\n        burger = order.make_burger(patty)\n        customer = order.shout_for_customer()\n        customer.serve(burger)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКаждая из задач (принять заказ, пожарить котлету, сделать бургер) представляет собой бесконечный цикл, в котором выполняются соответствующие действия.\u003C\u002Fp\u003E\u003Cp\u003EВ \u003Ccode\u003Erun_concurrent_burger\u003C\u002Fcode\u003E мы запускаем каждую из этих задач в отдельном потоке. Мы можем создать поток для каждой из задач и вручную, но есть гораздо более приятный способ это сделать, который заключается в использовании интерфейса \u003Ccode\u003EThreadPoolExecutor\u003C\u002Fcode\u003E, который создаёт поток для каждой переданной ему задачи.\u003C\u002Fp\u003E\u003Cp\u003EПри использовании нескольких потоков мы должны обеспечить такую схему работы с состоянием программы, когда в каждый конкретный момент времени лишь один поток осуществляет чтение или запись данных, к которым могут иметь доступ несколько потоков. Иначе всё может закончиться ситуацией, когда два потока «схватят» одну и ту же котлету, что может очень раздосадовать клиента. Существует такое понятие, как «потокобезопасность» (thread safety), которое имеет отношение к этому вопросу.\u003C\u002Fp\u003E\u003Cp\u003EДля того чтобы обеспечить безопасную работу потоков мы используем очереди (Queues), позволяющие передавать управление состоянием программы между потоками. В пределах отдельных задач очередь блокируется при вызове \u003Ccode\u003Eget\u003C\u002Fcode\u003E до тех пор, пока мы не обслужим клиента, не выполним заказ или не сжарим котлету. Операционная система не пытается переключиться на заблокированный поток, что даёт нам безопасный способ передачи состояния между потоками. Поток, помещая состояние в очередь, не использует его, а затем сообщает о том, что, в процессе его использования, не будет его менять.\u003C\u002Fp\u003E\u003Ch4\u003EСильные стороны многопоточности\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОперации ввода\u002Fвывода не останавливают выполнение других задач.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОтличная поддержка различными версиями Python и библиотеками — если нечто может быть запущено в однопоточном режиме — весьма вероятно то, что это заработает и в многопоточном режиме.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch4\u003EСлабые стороны многопоточности\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EСистема работает медленнее, чем при применении модуля asyncio из-за того, что на неё ложится дополнительная нагрузка по переключению между системными потоками.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНе обеспечивается потокобезопасность.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНе ускоряется выполнение задач, зависящих от скорости центрального процессора, наподобие задачи по изготовлению салатов (это — из-за того, что Python поддерживает выполнение в каждый конкретный момент времени лишь \u003Ca href=\"https:\u002F\u002Fwiki.python.org\u002Fmoin\u002FGlobalInterpreterLock\"\u003Eодного потока\u003C\u002Fa\u003E). В результате один работник, одновременно готовящий несколько салатов, не сделает их быстрее, чем если бы делал их один за другим. Дело в том, что в итоге на приготовление одного салата при одновременном приготовлении нескольких салатов уйдёт столько же времени, сколько ушло бы, если салаты готовились бы по одному.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003EРеализация «Конкурентных бургеров» с использованием модуля asyncio\u003C\u002Fh3\u003E\u003Cp\u003EПри использовании модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E имеется единственный цикл событий, который занимается управлением всеми задачами. Задачи могут пребывать в некотором количестве различных состояний, самыми важными из которых можно назвать состояние готовности (ready) и состояние ожидания (waiting). Цикл событий на каждой итерации проверяет, имеются ли задачи, пребывающие в состоянии ожидания, которые завершены и оказались в состоянии готовности. Затем цикл берёт задачу, находящуюся в состоянии готовности, и выполняет её до тех пор, пока она не завершится, либо — до тех пор, пока не окажется, что ей нужно дождаться завершения другой задачи. Часто подобные задачи представлены операциями ввода\u002Fвывода наподобие чтения данных с диска или выполнения HTTP-запроса.\u003C\u002Fp\u003E\u003Cp\u003EЕсть пара ключевых слов, которые используются в большинстве вариантов применения \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E. Это — \u003Ccode\u003Easync\u003C\u002Fcode\u003E и \u003Ccode\u003Eawait\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EКлючевое слово \u003Ccode\u003Easync\u003C\u002Fcode\u003E используется при объявлении функций для указания на то, что эти функции нужно запускать в виде отдельных задач.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКлючевое слово \u003Ccode\u003Eawait\u003C\u002Fcode\u003E позволяет создавать новые задачи и передавать управление циклу событий. Это ключевое слово позволяет перевести задачу в состояние ожидания. После завершения новой задачи она оказывается в состоянии готовности.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПосмотрим на реализацию «Конкурентных бургеров» с использованием модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport asyncio\n# Обратите внимание на то, что некоторые методы и переменные тут опущены\n# для того чтобы уделить основное внимание вопросам использования asyncio.\ndef run_concurrent_burgers():\n    # Осуществляется управление этими очередями\n    customers = asyncio.Queue()\n    orders = asyncio.Queue(maxsize=5)  # Возможна одновременная обработка до 5 заказов\n    cooked_patties = asyncio.Queue()\n    # Гриль совершенно независим от работника,\n    # он превращает сырые котлеты в котлеты жареные.\n    grill = Grill()\n    # Выполняем все задачи с использованием стандартного цикла событий asyncio\n    asyncio.gather(\n        take_orders(customers, orders),\n        cook_patties(grill, cooked_patties),\n        make_burgers(orders, cooked_patties),\n    )\n# Объявляем задачи asyncio с использованием конструкции async def\nasync def take_orders(customers, orders):\n    while True:\n        # Разрешаем переключение на новые задачи и здесь, и\n        # во всех других await\n        customer = await customers.get()\n        order = take_order(customer)\n        await orders.put(order)\nasync def cook_patties(grill, cooked_patties):\n    for position in range(len(grill)):\n        grill[position] = raw_patties.pop()\n    while True:\n        for position, patty in enumerate(grill):\n            if patty.cooked:\n                # put_noawait позволяет нам пополнять очередь,\n                # не создавая новых задач и не передавая управление\n                cooked_patties.put_noawait(patty)\n                grill[position] = raw_patties.pop()\n        # Ждём 30 секунд перед повторной проверкой\n        await asyncio.sleep(30)\nasync def make_burgers(orders, cooked_patties):\n    while True:\n        patty = await cooked_patties.get()\n        order = await orders.get()\n        burger = order.make_burger(patty)\n        customer = await order.shout_for_customer()\n        customer.serve(burger)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКаждая из функций, олицетворяющих задачи приёма заказа, поджаривания котлеты и приготовления бургера, объявлена с использованием конструкции \u003Ccode\u003Easync def\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EВ пределах этих задач работник переключается на новую задачу каждый раз, когда используется ключевое слово \u003Ccode\u003Eawait\u003C\u002Fcode\u003E. А именно, это происходит в следующих ситуациях:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВ задаче приёма заказа:\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВ задаче поджаривания котлет:\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВ задаче изготовления бургеров:\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПоследний кусок этой головоломки заключается в функции \u003Ccode\u003Erun_concurrent_burger\u003C\u002Fcode\u003E, в которой вызывается \u003Ccode\u003Easyncio.gather\u003C\u002Fcode\u003E для планирования задач, которые должны быть запущены циклом событий, представленным работником «Конкурентных бургеров».\u003C\u002Fp\u003E\u003Cp\u003EКак мы уже знаем, в точности тогда, когда осуществляется переключение задач, нам не нужно заботиться об управлении совместным доступом к состоянию программы. Мы можем это реализовать, всего лишь воспользовавшись списком очередей и зная то, что у нас не возникнет ситуации, когда две задачи случайно «ухватятся» за одну котлету. Но для решения подобных задач настоятельно рекомендуется пользоваться очередями \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E, так как это позволит нам очень просто наладить взаимодействие между задачами, указывая на особые моменты в процессах выполнения задач, в которые их можно приостанавливать.\u003C\u002Fp\u003E\u003Cp\u003EОдним из интересных аспектов использования модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E является то, что ключевое слово \u003Ccode\u003Easync\u003C\u002Fcode\u003E меняет интерфейс функции, что приводит к невозможности вызова таких функций из обычных функций, не являющихся асинхронными. Это можно счесть как неудачным, так и удачным решением. С одной стороны, можно сказать, что это вредит возможностям по композиции функций, так как нельзя смешивать \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E-функции с функциями обычными. А с другой стороны, если возможности \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E используются лишь для организации операций ввода\u002Fвывода, это заставляет программиста чётко разделять логику ввода\u002Fвывода и бизнес-логику приложения, ограничивая применение \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E теми частями приложения, которые взаимодействуют с внешним миром, делая код понятнее, упрощая его тестирование. Явное выделение операций, отвечающих за ввод\u002Fвывод данных — это довольно-таки распространённая практика в типизированных функциональных языках, а в Haskell это обязательно.\u003C\u002Fp\u003E\u003Ch4\u003EСильные стороны применения модуля asyncio\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОбеспечение чрезвычайно высокой скорости работы при решении задач, зависящих от подсистемы ввода\u002Fвывода.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПотокобезопасность.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch4\u003EСлабые стороны применения модуля asyncio\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EЗадачи, производительность которых зависит от процессора, не ускоряются.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EЭтот модуль появился в Python сравнительно недавно.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EПараллельное выполнение кода на практике\u003C\u002Fh2\u003E\u003Cp\u003EВ ресторанчике «Параллельные салаты» есть несколько работников, которые делают салаты (все разом). Мы собираемся создать реализацию этого заведения с использованием модуля \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EА потом мы ещё заглянем в кофейню, называемую «Облачный кофе» и взглянем на то, как для параллельного выполнения задач можно использовать облачные функции.\u003C\u002Fp\u003E\u003Ch4\u003EРеализация «Параллельных салатов» с использованием модуля multiprocessing\u003C\u002Fh4\u003E\u003Cp\u003EМеханизм работы «Параллельных салатов» отлично демонстрирует возможности модуля \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EКаждый работник в этом заведении представлен новым процессом, создаваемым операционной системой. Эти процессы создаются посредством класса \u003Ccode\u003EProcessPoolExecutor\u003C\u002Fcode\u003E, который назначает каждому из них задачи.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport multiprocessing as mp\nfrom concurrent.futures import ProcessPoolExecutor\n# Обратите внимание на то, что некоторые методы и переменные тут опущены\n# для того чтобы уделить основное внимание вопросам использования multiprocessing.\ndef run_parallel_salads():\n    # Создаём многопроцессные очереди, которые\n    # могут обмениваться данными через границы процессов.\n    customers = mp.Queue()\n    bowls = mp.Queue()\n    dirty_bowls = mp.Queue()\n    # Запускаем параллельное выполнение задач с использованием ProcessPoolExecutor\n    with ProcessPoolExecutor(max_workers=NUM_STAFF) as executor:\n        # Set all but one worker making salads\n        for _ in range(NUM_STAFF - 1):\n            executor.submit(make_salad, customers, bowls, dirty_bowls)\n        # Поручаем ещё одному работнику мыть посуду\n        executor.submit(wash_bowls, dirty_bowls, bowls)\ndef make_salad(customers, bowls):\n    while True:\n        customer = customers.get()\n        order = take_order(customer)\n        bowl = bowls.get()\n        bowl.add(ingredients)\n        bowl.add(dressing)\n        bowl.mix()\n        salad = fill_container(bowl)\n        customer.serve(salad)\n        dirty_bowls.put(bowl)\ndef wash_bowls(dirty_bowls, bowls):\n    while True:\n        bowl = dirty_bowls.get()\n        wash(bowl)\n        bowls.put(bowl)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПри использовании модуля \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E каждая задача выполняется в отдельном процессе. Эти процессы параллельно и независимо друг от друга выполняются операционной системой и друг друга не блокируют. Количество процессов, которые реально можно выполнять параллельно, ограничено количеством ядер процессора. Поэтому мы ограничим соответствующим числом количество сотрудников ресторана, которые делают салаты.\u003C\u002Fp\u003E\u003Cp\u003EТак как наши задачи выполняются в различных процессах — они не используют какое-либо обычное состояние Python-программы совместно. У каждого из процессов имеется независимая копия всего состояния программы. Для налаживания «общения» процессов необходимо использовать специальные очереди, поддерживаемые модулем \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Ch4\u003EПопутная заметка: модули asyncio и multiprocessing\u003C\u002Fh4\u003E\u003Cp\u003EОдин из сценариев использования модуля \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E заключается в том, чтобы снимать нагрузку, связанную с выполнением тяжёлых вычислительных задач, с \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E-приложений, чтобы такие задачи не блокировали бы другие части приложения. Вот небольшой набросок, иллюстрирующий этот сценарий:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport asyncio\nfrom concurrent.futures import ProcessPoolExecutor\nprocess_pool = ProcessPoolExecutor()  # Значение, применяемое по умолчанию, соответствует количеству ядер процессора\nasync def handle_long_request(n):\n    event_loop = asyncio.get_running_loop()\n    # Функция calculate_n_pi будет запущена в отдельном процессе, что позволит\n    # циклу событий asyncio продолжить параллельную обработку других асинхронных задач\n    return await event_loop.run_in_executor(process_pool_executor, calculate_n_pi, n)\ndef calculate_n_pi(n):\n    threading.sleep(60)\n    return n * 3.14\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch4\u003EСильные стороны применения модуля multiprocessing\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EУскорение задач, скорость выполнения которых ограничена возможностями процессора.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПотокобезопасность.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EЭтот модуль может быть использован для организации длительных вычислений, выполняемых на веб-серверах в отдельных процессах.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch4\u003EСлабые стороны применения модуля multiprocessing\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОтсутствует механизм совместного использования ресурсов.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздаётся большая дополнительная нагрузка на систему. Этот модуль не рекомендуется использовать в задачах, скорость выполнения которых привязана к подсистеме ввода\u002Fвывода.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003EРеализация «Облачного кофе» с использованием облачных функций\u003C\u002Fh3\u003E\u003Cp\u003EВы с другом пошли в парк, чтобы съесть то, что удалось раздобыть на обед, и заметили пушистое разноцветное облако, висящее над группой людей. Вы присмотрелись и поняли, что это — вывеска кофейни «Облачный кофе».\u003C\u002Fp\u003E\u003Cp\u003EВаш друг кофе не выносит, но вы, всё же, вместе решили взять по стаканчику — так сказать, забавы ради. Когда вы подошли к кофейне, каждый из вас попал за собственную стойку со своим баристой, которые медленно выплыли из облака. Баристы приняли у вас заказы, сделали кофе и подали его вам и вашему другу.\u003C\u002Fp\u003E\u003Cp\u003EВдруг в «Облачный кофе» влетела оживлённая толпа народа. Стоек на всех не хватило, но совсем скоро из облака выплыли новые стойки с баристами, после чего всех, кто хотел выпить кофе, быстро обслужили. Когда народ попил кофе и дополнительные стойки опустели, эти стойки ещё немного постояли (баристы совершенно не обращали внимания на другие стойки) после чего уплыли обратно в облако.\u003C\u002Fp\u003E\u003Cp\u003EКогда вы попили кофе и вышли — вы обратили внимание на то, что в кофейне всегда находится примерно одинаковое количество стоек, так как туда постоянно подходят люди, делающие заказы. Если в кофейне оказывается больше людей, чем обычно, из облака выплывают новые стойки, а когда случается так, что заказ выполнен, клиент ушёл, а стойка оказалась никому не нужной, она ещё немного пустует, а потом возвращается в облако.\u003C\u002Fp\u003E\u003Cp\u003EВаш друг решил сделать абсурдно сложный заказ, чтобы попробовать что-то новое, такое, в чём что-то перебьёт вкус обычного кофе, но заказа он так и не дождался. Бариста добавлял в напиток зефир и шоколадные стружки, но вдруг бросил всё в корзину и крикнул: «Тайм-аут».\u003C\u002Fp\u003E\u003Cp\u003EВы, оба на грани нервного срыва, пошли прочь из парка.\u003C\u002Fp\u003E\u003Cp\u003EОблачные функции — это ещё один механизм ускорения работы кода, на который стоит обратить внимание тем, кто занимается разработкой веб-сервисов. Их, пожалуй, писать легче всего, так как каждая из них отвечает лишь за выполнение отдельного «заказа» за один раз. Применяя их, можно совершенно забыть о конкурентности и о прочих подобных вещах.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef cloud_coffees(order):\n    ground_coffee = grind_beans()\n    coffee = brew_coffee(ground_coffee)\n    coffee.add_embellishments(order)\n    return coffee\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКаждый запрос обслуживается отдельным экземпляром всего приложения. Когда создаётся новый экземпляр приложения — имеется небольшая задержка, связанная с выделением ресурсов и запуском этого экземпляра приложения. Именно поэтому экземпляры приложения могут какое-то время простаивать, ожидая поступления новых запросов. Запросы, если пони поступают уже запущенному экземпляру приложения, могут быть выполнены практически мгновенно, без задержек. А вот после того, как новых запросов некоторое время не поступает — бездействующие экземпляры приложения уничтожаются, ресурсы, занятые ими, возвращаются системе.\u003C\u002Fp\u003E\u003Cp\u003EОбработка каждого запроса через некоторое время, зависящее от реализации системы, завершается по тайм-ауту. Нужно обеспечить, чтобы задачи завершались бы до наступления этого тайм-аута, или они будут попросту исчезать, так и не выполнившись.\u003C\u002Fp\u003E\u003Cp\u003EЭкземпляры приложения не могут взаимодействовать с другими экземплярами приложения. Они ни при каких условиях не должны хранить состояние приложения между вызовами, так как они могут быть когда угодно уничтожены.\u003C\u002Fp\u003E\u003Cp\u003EНаиболее известные реализации этого механизма представлены такими платформами, как AWS Lambda, Azure Functions и Google Cloud Functions.\u003C\u002Fp\u003E\u003Ch4\u003EСильные стороны облачных функций\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EЧрезвычайно простая модель организации вычислений.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EИх использование может быть дешевле, чем применение постоянно работающего сервера.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВесьма лёгкое масштабирование систем, основанных на таких функциях.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch4\u003EСлабые стороны облачных функций\u003C\u002Fh4\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EПри запуске новых экземпляров приложений могут наблюдаться задержки.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВремя выполнения вычислений, связанных с запросами, ограничено тайм-аутами.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EУ разработчика нет полного контроля над используемой версией Python — можно использовать лишь те версии, которые предоставлены облачным провайдером.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EКакой вариант конкурентного выполнения кода выбрать?\u003C\u002Fh2\u003E\u003Cp\u003EДавайте сведём всё, о чём мы говорили, в единую таблицу.\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Csup\u003EМногопоточность\u003C\u002Fsup\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Csup\u003EМодуль asyncio\u003C\u002Fsup\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Csup\u003EМодуль multithreading\u003C\u002Fsup\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Csup\u003EОблачные функции\u003C\u002Fsup\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EТип конкурентности\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EВытесняющая многозадачность\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EКооперативная многозадачность\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EМногопроцессность\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EИспользование нескольких экземпляров приложения\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EКонкурентное или параллельное выполнение кода\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EКонкурентное\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EКонкурентное\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EПараллельное\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EПараллельное\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EВозможность самостоятельного управления конкурентностью\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EОтсутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EПрисутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EОтсутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EОтсутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EПринятие решения о переключении между задачами\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EОперационная система сама выбирает момент переключения между задачами\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EЗадача принимает решение о том, когда ей нужно передать управление другой сущности\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EПроцессы выполняются одновременно, на разных ядрах процессора\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EЗапросы выполняются одновременно в различных экземплярах приложения\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EМаксимальное количество параллельно выполняемых процессов\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003E1\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003E1\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EСоответствует количеству ядер процессора\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EБез ограничений\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EВзаимодействие между задачами\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EОбщее состояние\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EОбщее состояние\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EМногопроцессные очереди и возвращаемые значения\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EНевозможно\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EПотокобезопасность\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EОтсутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EПрисутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EПрисутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EПрисутствует\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EЗадачи, которые решают с помощью данного подхода\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EТе, производительность которых ограничена подсистемой ввода\u002Fвывода\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EТе, производительность которых ограничена подсистемой ввода\u002Fвывода\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EТе, производительность которых ограничена возможностями процессора\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EТе, производительность которых ограничена подсистемой ввода\u002Fвывода в том случае, если они выполняются быстрее, чем истекает тайм-аут (около 5 минут)\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"150\" width=\"150\"\u003E\u003Cp\u003E\u003Csup\u003EДополнительная нагрузка на систему\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"158\" width=\"158\"\u003E\u003Cp\u003E\u003Csup\u003EИспользование одного системного потока для решения задач означает необходимость в оперативной памяти и увеличивает время переключения между задачами\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EМаксимально низкая, все задачи выполняются в одном процессе и в одном потоке\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"147\" width=\"147\"\u003E\u003Cp\u003E\u003Csup\u003EИспользование отдельного системного процесса на каждую задачу приводит к потреблению памяти, превышающему то, что характерно для многопоточных систем\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003E\u003Csup\u003EПри запуске новых экземпляров приложения наблюдаются задержки\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EТеперь, когда вы видите общую картину, вы без труда подберёте именно то, что вам нужно.\u003C\u002Fp\u003E\u003Cp\u003EНо, правда, прежде чем делать окончательный выбор, нужно как следует подумать о самой необходимости ускорения задач. Если некая задача запускается раз в неделю, а на её выполнение нужно 10 минут — есть ли смысл в её ускорении?\u003C\u002Fp\u003E\u003Cp\u003EЕсли же вы выяснили, что смысл в ускорении какой-то задачи определённо есть, можете воспользоваться следующей блок-схемой для того, чтобы точно определиться с выбором подхода к её выполнению, который подойдёт именно вам.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"1024\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F498\u002F317\u002F50e\u002F49831750eadff603bf89a0f527447004.png\" data-width=\"780\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003EИтоги\u003C\u002Fh2\u003E\u003Cp\u003EМы рассмотрели различные варианты организации конкурентного выполнения кода в Python:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EМногопоточность.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EИспользование модуля \u003Ccode\u003Easyncio\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EИспользование модуля \u003Ccode\u003Emultiprocessing\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EМы, кроме того, уделили некоторое внимание одной из возможностей развёртывания приложений, использование которой упрощает параллельное выполнение Python-кода:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОблачные функции.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТеперь вы знакомы с особенностями этих подходов к написанию программ и с их сильными и слабыми сторонами, знаете о том, для решения каких задач они подходят лучше всего.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EО, а приходите к нам работать? 😏\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EМы в \u003Ca href=\"http:\u002F\u002Fwunderfund.io\u002F\"\u003E\u003Cstrong\u003Ewunderfund.io\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E занимаемся \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FHigh-frequency_trading\"\u003Eвысокочастотной алготорговлей\u003C\u002Fa\u003E с 2014 года. Высокочастотная торговля — это непрерывное соревнование лучших программистов и математиков всего мира. Присоединившись к нам, вы станете частью этой увлекательной схватки.\u003C\u002Fp\u003E\u003Cp\u003EМы предлагаем интересные и сложные задачи по анализу данных и low latency разработке для увлеченных исследователей и программистов. Гибкий график и никакой бюрократии, решения быстро принимаются и воплощаются в жизнь.\u003C\u002Fp\u003E\u003Cp\u003EСейчас мы ищем плюсовиков, питонистов, дата-инженеров и мл-рисерчеров.\u003Cbr\u002F\u003E\u003Ca href=\"http:\u002F\u002Fwunderfund.io\u002F#join_us\"\u003EПрисоединяйтесь к нашей команде.\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"Python"},{"titleHtml":"разработка"},{"titleHtml":"asyncio"},{"titleHtml":"parallelism"},{"titleHtml":"concurrency"},{"titleHtml":"multithreading"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa11\u002F1f5\u002Faad\u002Fa111f5aad73a8be22ce3a668236d58e5.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa11\u002F1f5\u002Faad\u002Fa111f5aad73a8be22ce3a668236d58e5.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fwunderfund\\\u002Fblog\\\u002F581994\\\u002F\"},\"headline\":\"Разбираемся с параллельными и конкурентными вычислениями в Python\",\"datePublished\":\"2021-10-11T15:18:08+03:00\",\"dateModified\":\"2021-10-11T15:18:50+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"mr-pickles\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fwunderfund\\\u002Fblog\\\u002F581994\\\u002F#post-content-body\",\"about\":[\"c_wunderfund\",\"h_python\",\"h_programming\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F581994\\\u002F082843e02e6884ee902a0ce35193a885\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5b2\\\u002Fc32\\\u002F507\\\u002F5b2c3250720adff113a3084155af5c2b.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F498\\\u002F317\\\u002F50e\\\u002F49831750eadff603bf89a0f527447004.png\"]}","metaDescription":"Я собираюсь рассказать историю о еде, раскрывающую различные возможности конкурентного и параллельного выполнения кода в Python.Прим. Wunder Fund: для задач, где не критичны экстремально низкие...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"wunderfund":{"alias":"wunderfund","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002Fb1a\u002F8c4\u002F544\u002Fb1a8c4544d951f4ea9bad437589d958e.png","titleHtml":"Wunder Fund","descriptionHtml":"Мы занимаемся высокочастотной торговлей на бирже","relatedData":null,"statistics":{"postsCount":29,"newsCount":0,"vacanciesCount":1,"employeesCount":3,"careerRating":null,"subscribersCount":436,"rating":60.88,"invest":null},"foundationDate":{"year":"2014","month":"01","day":"01"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Fwunderfund.io","staffNumber":"11–30 человек","registrationDate":"2015-11-22T01:25:19+00:00","representativeUser":{"alias":"xopxe","fullname":null},"contacts":[{"title":"Сайт","url":"http:\u002F\u002Fwunderfund.io"}],"settings":{"analyticsSettings":[{"type":"ym","trackingId":"85710558"}],"branding":null,"status":"active"},"metadata":{"titleHtml":"Wunder Fund, Москва - Мы занимаемся высокочастотной торговлей на бирже с 1 января 2014 г.","title":"Wunder Fund, Москва - Мы занимаемся высокочастотной торговлей на бирже с 1 января 2014 г.","keywords":["Программирование","Алгоритмы","Математика","Natural Language Processing","Python"],"descriptionHtml":"29 статей от авторов компании Wunder Fund","description":"29 статей от авторов компании Wunder Fund"},"aDeskSettings":null,"careerAlias":"wunderfund","maxCustomTrackerLinks":0}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
