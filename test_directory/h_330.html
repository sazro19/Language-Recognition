<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Бинарный протокол для JavaScript / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/580922\/"},"headline":"Бинарный протокол для JavaScript","datePublished":"2021-10-19T10:52:49+03:00","dateModified":"2021-10-19T11:50:04+03:00","author":{"@type":"Person","name":"Митя Камаев"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества...","url":"https:\/\/habr.com\/ru\/post\/580922\/#post-content-body","about":["h_webdev","h_javascript","h_nodejs","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/580922\/84a376e565ca89704a63a911dbfb654e\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Бинарный протокол для JavaScript" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Бинарный протокол для JavaScript" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Бинарный протокол для JavaScript" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/93c/ef3/752/93cef3752001aa9ea52e33724701d964.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/93c/ef3/752/93cef3752001aa9ea52e33724701d964.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/93c/ef3/752/93cef3752001aa9ea52e33724701d964.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/93c/ef3/752/93cef3752001aa9ea52e33724701d964.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/93c/ef3/752/93cef3752001aa9ea52e33724701d964.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="580922" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-19T07:52:49.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/580922/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/580922/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/93c/ef3/752/93cef3752001aa9ea52e33724701d964.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/580922/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/mitya_k/" title="mitya_k" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/37e/901/7ad/37e9017adfefa7230e42053d593ff159.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/mitya_k/" class="tm-user-info__username">
      mitya_k
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-19T07:52:49.000Z" title="2021-10-19, 10:52">19  октября   в 10:52</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Бинарный протокол для JavaScript</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/webdev/" class="tm-article-snippet__hubs-item-link"><span>Разработка веб-сайтов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/javascript/" class="tm-article-snippet__hubs-item-link"><span>JavaScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/nodejs/" class="tm-article-snippet__hubs-item-link"><span>Node.JS</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://itnext.io/binary-protocol-for-javascript-cc409e144a3c#6073" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Maga D. Zandaqo
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии разработки, когда ваша модель данных подвержена частым изменениям. Однако за все надо платить, а именно размером и скоростью обработки данных.</p><p>JSON будучи текстовым форматом кодирует все значения как UTF-8, что приводит к увеличению размера данных при работе с нетекстовыми данными. Отсутствие схемы означает, что мы должны кодировать нашу структуру данных (ключи объекта) вместе с самими данными. Мы также делаем дополнительную работу при обработке данных, поскольку нам необходимо преобразовать бинарные данные в их текстовое представление до превращения в JSON и соответственно наоборот в случае декодирования. </p><p>Очевидно, что эти затраты не проблема для среднестатистического web приложения. И это компенсируется компрессией и тем, что JavaScript движки хорошо оптимизированы для парсинга JSON. Однако есть случаи, когда эти накладные расходы являются проблемой, и компрессия не эффективна и может увеличить размер сообщения, например, при обмене сообщениями в телеметрии, обмене данными в real-time приложениях или при отправке уведомлений. Для решения этих проблем JSON, мы можем использовать бинарный формат.</p><h2>Бинарный формат</h2><p>Существует множество <a href="https://en.wikipedia.org/wiki/Comparison_of_data-serialization_formats" rel="noopener noreferrer nofollow">бинарных форматов</a> с различными свойствами. Для того чтобы обойти недостатки JSON, нам необходимы следующие свойства:  наличие схемы данных и отсутствие избыточного выделения памяти (<a href="https://ru.wikipedia.org/wiki/Zero-copy" rel="noopener noreferrer nofollow">Zero-copy</a>).</p><p>Бинарные форматы, не требующие схемы, такие как MessagePack или FlexBuffers, обеспечивают меньший размер данных в сравнении с JSON. Главное преимущество таких форматов, что они могут использованы в качестве замены JSON с минимальными затратами. Однако, есть но:</p><ul><li><p>мы все еще должны кодировать структуру вместе с данными, а это значительные накладные расходы </p></li><li><p>мы не избавляемся от избыточного копирования данных (no zero-copy) </p></li></ul><p>С протоколами, использующими схему данных, такими, как Protocol Buffers, FlatBuffers или Cap’n Proto, мы избавляемся от кодирования информации о структуре в самих сообщениях, хотя присутствуют некоторые накладные расходы на передачу указателей смещения.</p><p>Zero-copy операции в данном контексте означают нашу способность с помощью указателей смещения прочитать необходимый кусок сообщения без полного копирования данных или декодированная всего тела.  Например, на сервере, мы можем сперва проверить важные части запроса без парсинга всего тела сообщения, а на клиенте, мы можем парсить и отрисовывать большие данные, пришедшие с сервера, по частям для уменьшения времени отрисовки (<a href="https://developer.mozilla.org/en-US/docs/Glossary/First_contentful_paint" rel="noopener noreferrer nofollow">First Contentful Paint</a>) . Это означает, что время обработки сообщений в некоторых случаях сократится на порядки. Среди бинарных форматов,  Cap’n Proto и FlatBuffers поддерживают zero-copy операции, в то время как Protocol Buffers, JSON и форматы без схемы нет. Однако, Cap’n Proto и FlatBuffers ставят в приоритет быстрый доступ в памяти, но расплачиваются за это большим размером передаваемых данных из-за <a href="https://medium.com/german-gorelkin/go-alignment-a359ff54f272" rel="noopener noreferrer nofollow">выравнивания структур</a>.</p><h2>Raw Buffers with View</h2><p>Для достижения минимального размера данных при использовании подхода  zero-copy мы можем применить так называемые  «сырые» буфферы. Например, для кодирования JavaScript объекта, мы рассчитаем необходимый размер для каждого его поля, последовательно их соединим для получения схемы, а затем  c помощью нее закодируем наши поля в ArrayBuffer.  Результирующий буффер имеет «сырые» данные и не содержит какой-либо информации об их структуре. Мы можем декодировать его целиком или получить доступ к отдельному полю, используя схему данных, поскольку она общая для всех объектов заданного типа. Нам требуются указатели смещения для опциональных полей или полей переменной длины, но все же накладные расходы значительно меньше, чем в случае кодирования ключей вместе с данными или применения выравнивания структур. </p><p>Библиотека <a href="https://github.com/zandaqo/structurae#binary-protocol" rel="noopener noreferrer nofollow">Structurae’s View</a> обеспечивает именно это. Она получает на вход JSON схему объекта (или массива, или другого поддерживаемого типа), View вычислит схему компоновки, чтобы сохранить в виде буфера, и создаст класс для работы с ним, который наследуется от <code>DataView</code>:</p><pre><code class="javascript">import { View } from "structurae";

type Animal = { name: string; age: number; }

const AnimalView = View.create&lt;Animal>({
  $id: "Animal",
  type: "object",
  properties: {
    name: { type: "string", maxLength: 10 },
    age: { type: "number", btype: "uint8" },
  },
});

const animal = AnimalView.from({ name: "Gaspode", age: 10 });
animal instanceof DataView; //=> true
animal.byteLength; //=> 14
animal.get("age"); //=> 10
animal.set("age", 20);
animal.toJSON(); //=> { name: "Gaspode", age: 20 }</code></pre><p>View использует JSON Schema для декларации схемы. Помимо того, что JSON схема знакома многим разработчикам, ее можно переиспользовать в других утилитах, например JSON валидаторах, в качестве единственного «источника правды». Схемы и все порожденные классы строго типизированные, что обеспечивает возможность IDE показывать подсказки для типов данных. В отличие от других бинарных форматов основанных на схеме данных, View не требует предварительной компиляции - схема вычисляется один раз на этапе инициализации. В целом View предназначен для архитектур, выстроенных вокруг JSON, и процессов разработки современных web-приложений. </p><p>Важно отметить, что основная цель View не заменить JSON в fullstack JavaScript приложениях. А максимизировать производительность в тех частях приложения, которые могут получить выгоду от радикального уменьшения размера сообщений, и избежать дополнительных шагов в виде парсинга с помощью zero-copy. Мы можем использовать его во всех тех случаях, где JSON не подходит:</p><ul><li><p>передача больших числовых данных, которые станут компактнее при использовании бинарного формата</p></li><li><p>высокочастотный обмен сообщениями в реал-тайм приложении или между workers процесса/процессов</p></li><li><p>частичная обработка сообщений для валидации</p></li></ul><h2>Пример Full Stack </h2><p>Для демонстрации View в действии, мы будем использовать многим знакомый пример доски объявлений. Это не лучший пример для применения бинарного формата, но более специфичные примеры будут более привязаны к конкретному контексту и сложны для понимания. </p><p>Представьте, что вы разрабатываете доску объявлений. Давайте задекларируем нашу структуру сообщений:</p><pre><code class="javascript">class BoardMessage {
    id: number;
    authorId: number;
    threadId: number;
    created: number;
    text: string;
    ...
}

const MessageView = View.create({
    $id: 'BoardMessage',
    type: 'object',
    properties: {
        id: { type: 'integer' },
        authorId: { type: 'integer' },
        threadId: { type: 'integer' },
        created: { type: 'number' },
        text: { type: 'string', maxLength: 1000 }
    }
}, BoardMessage);</code></pre><p>Теперь на клиенте мы можем закодировать наши сообщения с помощью класса <code>MessageView</code>. Поскольку он и есть <code>DataView</code>, мы можем просто отправить его как  тело запроса с помощью Fetch API:</p><pre><code class="javascript">const message = new BoardMessage();

window.fetch('/messages', {
    method: 'POST',
    body: MessageView.from({ id: 1, authorId: 26, threadId: 1035, created: Date.now(), text: 'not one drop!'}),
    headers: {
        'content-type': 'application/octet-stream',
    },
});</code></pre><p>На сервере, например, с помощью Node JS (используя, фреймворк Express js), мы можем получить сообщение, как буффер, и работать с ним без парсинга и копирования всего тела сообщения.</p><pre><code class="javascript">app.post('/messages', (req, res) => {
    const view = new MessageView(req.body.buffer, req.body.byteOffset, req.body.length);
    ...
})</code></pre><p>Теперь, например, мы можем сделать проверку прав доступа: может ли автор опубликовать сообщение в соответствующий раздел доски объявлений и если нет, то вернуть ошибку без парсинга всего тела сообщения. </p><pre><code class="javascript">...
const view = new MessageView(req.body.buffer, req.body.byteOffset, req.body.length);
const hasAuthorization = getAuthrorization(view.get('authorId'), view.get('threadId'));
if (!hasAuthorization) return res.sendStatus(403);
...</code></pre><p>Получение чисел из буфера напрямую напорядок быстрее, чем парсинг JSON, не говоря уже об уменьшении нагрузки на GC (garbare collector) для долгоживущих процессов.</p><p>Мы можем усложнить логику и пойти дальше. View использует специальный класс <a href="https://github.com/zandaqo/structurae#strings" rel="noopener noreferrer nofollow">StringView</a> для работы с UTF-8 строками, который является наследником <code>DataView</code>, имеющим набор методов для работы с бинарными данными без превращения их в JavaScript строки. Представим, что мы решили  ввести немного цензуры и блокировать сообщения содержащие слова из «черного списка». </p><pre><code class="javascript">const bVord = new TextEncoder().encode('blood');

app.post('/messages', (req, res) => {
    const view = new MessageView(req.body.buffer, req.body.byteOffset, req.body.length);
    ...
    const textView = view.getView('text');
    if (textView.includes(bVord)) return res.sendStatus(400);
    ...
})</code></pre><p>C помощью <code>view.getView</code>, мы создаем экземляр класса <code>DataView</code> (<code>StringView</code> в нашeм случае) для части буффера без декодирования в строку, а затем используем метод для поиска в буффере. Опять же мы экономим ресурсы при парсинге тела невалидных запросов, а также уменьшаем работу для GC.</p><p>Ну и конечно, мы можем декодировать наше сообщение целиком в JavaScript объект. В данном случае, это будет экземпляр класса <code>BoardMessage</code>, так как мы передали ссылку на него при создании представления (<code>Veiw.create</code>).</p><pre><code class="javascript">...
const message = view.toJSON();
...
</code></pre><p>View также использует преимущества оптимизации <a href="https://engineering.linecorp.com/en/blog/v8-hidden-class/" rel="noopener noreferrer nofollow">hidden class</a>, который используют движки JavaScript, а именно: вместо создания пустых объектов <code>{}</code> и наполнения их декодированными значениями, View либо использует конструктор переданного класса (как в примере выше), либо генерит код для такого конструктора, чтобы каждый объект создавался с таким же количеством полей в том же порядке. Это приводит к более быстрым операциям с объектами и уменьшению количества работы для GC.</p><p>Таким образом, с помощью уменьшения размера сообщений, валидации через zero-copy и оптимизации сериализации данных мы значительно увеличили пропускную способность нашей доски объявлений в плане обработки сообщений. Пусть эти бездельники только попробуют нас заспамить! 😃</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjavascript%5D" class="tm-tags-list__link">javascript</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bnode%5D" class="tm-tags-list__link">node</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Btypescript%5D" class="tm-tags-list__link">typescript</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbinary%5D" class="tm-tags-list__link">binary</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B1%D0%B8%D0%BD%D0%B0%D1%80%D0%BD%D1%8B%D0%B5%20%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D1%8B%5D" class="tm-tags-list__link">бинарные протоколы</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/webdev/" class="tm-hubs-list__link">
    Разработка веб-сайтов
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/javascript/" class="tm-hubs-list__link">
    JavaScript
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/nodejs/" class="tm-hubs-list__link">
    Node.JS
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 7: ↑7 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 7: ↑7 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+7</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    38
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/mitya_k/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/37e/901/7ad/37e9017adfefa7230e42053d593ff159.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 10 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    6
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">2.8</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Митя Камаев</span> <a href="/ru/users/mitya_k/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @mitya_k
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">SuperPuper Backend Developer</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <button type="submit" class="tm-user-card__button btn btn_transparent btn_small">
      Задонатить
    </button> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/580922/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 6 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/580922/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/580922/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"580922":{"id":"580922","timePublished":"2021-10-19T07:52:49+00:00","isCorporative":false,"lang":"ru","titleHtml":"Бинарный протокол для JavaScript","leadData":{"textHtml":"\u003Cp\u003EНативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым - качества особенно ценимые на ранней стадии разработки, когда ваша модель данных подвержена частым изменениям. Однако за все надо платить, а именно размером и скоростью обработки данных.\u003C\u002Fp\u003E\u003Cp\u003EJSON будучи текстовым форматом кодирует все значения как UTF-8, что приводит к увеличению размера данных при работе с нетекстовыми данными. Отсутствие схемы означает, что мы должны кодировать нашу структуру данных (ключи объекта) вместе с самими данными. Мы также делаем дополнительную работу при обработке данных, поскольку нам необходимо преобразовать бинарные данные в их текстовое представление до превращения в JSON и соответственно наоборот в случае декодирования.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F93c\u002Fef3\u002F752\u002F93cef3752001aa9ea52e33724701d964.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F93c\u002Fef3\u002F752\u002F93cef3752001aa9ea52e33724701d964.png","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Maga D. Zandaqo","originalUrl":"https:\u002F\u002Fitnext.io\u002Fbinary-protocol-for-javascript-cc409e144a3c#6073"}}],"author":{"scoreStats":{"score":6,"votesCount":10},"rating":2.8,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":"410014388029444","paymentPayPalMe":null,"paymentWebmoney":null},"id":"1924789","alias":"mitya_k","fullname":"Митя Камаев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F37e\u002F901\u002F7ad\u002F37e9017adfefa7230e42053d593ff159.jpg","speciality":"SuperPuper Backend Developer"},"statistics":{"commentsCount":6,"favoritesCount":38,"readingCount":4575,"score":7,"votesCount":7},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"17110","alias":"nodejs","type":"collective","title":"Node.JS","titleHtml":"Node.JS","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии разработки, когда ваша модель данных подвержена частым изменениям. Однако за все надо платить, а именно размером и скоростью обработки данных.\u003C\u002Fp\u003E\u003Cp\u003EJSON будучи текстовым форматом кодирует все значения как UTF-8, что приводит к увеличению размера данных при работе с нетекстовыми данными. Отсутствие схемы означает, что мы должны кодировать нашу структуру данных (ключи объекта) вместе с самими данными. Мы также делаем дополнительную работу при обработке данных, поскольку нам необходимо преобразовать бинарные данные в их текстовое представление до превращения в JSON и соответственно наоборот в случае декодирования. \u003C\u002Fp\u003E\u003Cp\u003EОчевидно, что эти затраты не проблема для среднестатистического web приложения. И это компенсируется компрессией и тем, что JavaScript движки хорошо оптимизированы для парсинга JSON. Однако есть случаи, когда эти накладные расходы являются проблемой, и компрессия не эффективна и может увеличить размер сообщения, например, при обмене сообщениями в телеметрии, обмене данными в real-time приложениях или при отправке уведомлений. Для решения этих проблем JSON, мы можем использовать бинарный формат.\u003C\u002Fp\u003E\u003Ch2\u003EБинарный формат\u003C\u002Fh2\u003E\u003Cp\u003EСуществует множество \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FComparison_of_data-serialization_formats\" rel=\"noopener noreferrer nofollow\"\u003Eбинарных форматов\u003C\u002Fa\u003E с различными свойствами. Для того чтобы обойти недостатки JSON, нам необходимы следующие свойства:  наличие схемы данных и отсутствие избыточного выделения памяти (\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FZero-copy\" rel=\"noopener noreferrer nofollow\"\u003EZero-copy\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\u003Cp\u003EБинарные форматы, не требующие схемы, такие как MessagePack или FlexBuffers, обеспечивают меньший размер данных в сравнении с JSON. Главное преимущество таких форматов, что они могут использованы в качестве замены JSON с минимальными затратами. Однако, есть но:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eмы все еще должны кодировать структуру вместе с данными, а это значительные накладные расходы \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eмы не избавляемся от избыточного копирования данных (no zero-copy) \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EС протоколами, использующими схему данных, такими, как Protocol Buffers, FlatBuffers или Cap’n Proto, мы избавляемся от кодирования информации о структуре в самих сообщениях, хотя присутствуют некоторые накладные расходы на передачу указателей смещения.\u003C\u002Fp\u003E\u003Cp\u003EZero-copy операции в данном контексте означают нашу способность с помощью указателей смещения прочитать необходимый кусок сообщения без полного копирования данных или декодированная всего тела.  Например, на сервере, мы можем сперва проверить важные части запроса без парсинга всего тела сообщения, а на клиенте, мы можем парсить и отрисовывать большие данные, пришедшие с сервера, по частям для уменьшения времени отрисовки (\u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FGlossary\u002FFirst_contentful_paint\" rel=\"noopener noreferrer nofollow\"\u003EFirst Contentful Paint\u003C\u002Fa\u003E) . Это означает, что время обработки сообщений в некоторых случаях сократится на порядки. Среди бинарных форматов,  Cap’n Proto и FlatBuffers поддерживают zero-copy операции, в то время как Protocol Buffers, JSON и форматы без схемы нет. Однако, Cap’n Proto и FlatBuffers ставят в приоритет быстрый доступ в памяти, но расплачиваются за это большим размером передаваемых данных из-за \u003Ca href=\"https:\u002F\u002Fmedium.com\u002Fgerman-gorelkin\u002Fgo-alignment-a359ff54f272\" rel=\"noopener noreferrer nofollow\"\u003Eвыравнивания структур\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Ch2\u003ERaw Buffers with View\u003C\u002Fh2\u003E\u003Cp\u003EДля достижения минимального размера данных при использовании подхода  zero-copy мы можем применить так называемые  «сырые» буфферы. Например, для кодирования JavaScript объекта, мы рассчитаем необходимый размер для каждого его поля, последовательно их соединим для получения схемы, а затем  c помощью нее закодируем наши поля в ArrayBuffer.  Результирующий буффер имеет «сырые» данные и не содержит какой-либо информации об их структуре. Мы можем декодировать его целиком или получить доступ к отдельному полю, используя схему данных, поскольку она общая для всех объектов заданного типа. Нам требуются указатели смещения для опциональных полей или полей переменной длины, но все же накладные расходы значительно меньше, чем в случае кодирования ключей вместе с данными или применения выравнивания структур. \u003C\u002Fp\u003E\u003Cp\u003EБиблиотека \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fzandaqo\u002Fstructurae#binary-protocol\" rel=\"noopener noreferrer nofollow\"\u003EStructurae’s View\u003C\u002Fa\u003E обеспечивает именно это. Она получает на вход JSON схему объекта (или массива, или другого поддерживаемого типа), View вычислит схему компоновки, чтобы сохранить в виде буфера, и создаст класс для работы с ним, который наследуется от \u003Ccode\u003EDataView\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport { View } from \"structurae\";\n\ntype Animal = { name: string; age: number; }\n\nconst AnimalView = View.create&lt;Animal\u003E({\n  $id: \"Animal\",\n  type: \"object\",\n  properties: {\n    name: { type: \"string\", maxLength: 10 },\n    age: { type: \"number\", btype: \"uint8\" },\n  },\n});\n\nconst animal = AnimalView.from({ name: \"Gaspode\", age: 10 });\nanimal instanceof DataView; \u002F\u002F=\u003E true\nanimal.byteLength; \u002F\u002F=\u003E 14\nanimal.get(\"age\"); \u002F\u002F=\u003E 10\nanimal.set(\"age\", 20);\nanimal.toJSON(); \u002F\u002F=\u003E { name: \"Gaspode\", age: 20 }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EView использует JSON Schema для декларации схемы. Помимо того, что JSON схема знакома многим разработчикам, ее можно переиспользовать в других утилитах, например JSON валидаторах, в качестве единственного «источника правды». Схемы и все порожденные классы строго типизированные, что обеспечивает возможность IDE показывать подсказки для типов данных. В отличие от других бинарных форматов основанных на схеме данных, View не требует предварительной компиляции - схема вычисляется один раз на этапе инициализации. В целом View предназначен для архитектур, выстроенных вокруг JSON, и процессов разработки современных web-приложений. \u003C\u002Fp\u003E\u003Cp\u003EВажно отметить, что основная цель View не заменить JSON в fullstack JavaScript приложениях. А максимизировать производительность в тех частях приложения, которые могут получить выгоду от радикального уменьшения размера сообщений, и избежать дополнительных шагов в виде парсинга с помощью zero-copy. Мы можем использовать его во всех тех случаях, где JSON не подходит:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eпередача больших числовых данных, которые станут компактнее при использовании бинарного формата\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eвысокочастотный обмен сообщениями в реал-тайм приложении или между workers процесса\u002Fпроцессов\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eчастичная обработка сообщений для валидации\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EПример Full Stack \u003C\u002Fh2\u003E\u003Cp\u003EДля демонстрации View в действии, мы будем использовать многим знакомый пример доски объявлений. Это не лучший пример для применения бинарного формата, но более специфичные примеры будут более привязаны к конкретному контексту и сложны для понимания. \u003C\u002Fp\u003E\u003Cp\u003EПредставьте, что вы разрабатываете доску объявлений. Давайте задекларируем нашу структуру сообщений:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eclass BoardMessage {\n    id: number;\n    authorId: number;\n    threadId: number;\n    created: number;\n    text: string;\n    ...\n}\n\nconst MessageView = View.create({\n    $id: 'BoardMessage',\n    type: 'object',\n    properties: {\n        id: { type: 'integer' },\n        authorId: { type: 'integer' },\n        threadId: { type: 'integer' },\n        created: { type: 'number' },\n        text: { type: 'string', maxLength: 1000 }\n    }\n}, BoardMessage);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь на клиенте мы можем закодировать наши сообщения с помощью класса \u003Ccode\u003EMessageView\u003C\u002Fcode\u003E. Поскольку он и есть \u003Ccode\u003EDataView\u003C\u002Fcode\u003E, мы можем просто отправить его как  тело запроса с помощью Fetch API:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst message = new BoardMessage();\n\nwindow.fetch('\u002Fmessages', {\n    method: 'POST',\n    body: MessageView.from({ id: 1, authorId: 26, threadId: 1035, created: Date.now(), text: 'not one drop!'}),\n    headers: {\n        'content-type': 'application\u002Foctet-stream',\n    },\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНа сервере, например, с помощью Node JS (используя, фреймворк Express js), мы можем получить сообщение, как буффер, и работать с ним без парсинга и копирования всего тела сообщения.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eapp.post('\u002Fmessages', (req, res) =\u003E {\n    const view = new MessageView(req.body.buffer, req.body.byteOffset, req.body.length);\n    ...\n})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь, например, мы можем сделать проверку прав доступа: может ли автор опубликовать сообщение в соответствующий раздел доски объявлений и если нет, то вернуть ошибку без парсинга всего тела сообщения. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E...\nconst view = new MessageView(req.body.buffer, req.body.byteOffset, req.body.length);\nconst hasAuthorization = getAuthrorization(view.get('authorId'), view.get('threadId'));\nif (!hasAuthorization) return res.sendStatus(403);\n...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПолучение чисел из буфера напрямую напорядок быстрее, чем парсинг JSON, не говоря уже об уменьшении нагрузки на GC (garbare collector) для долгоживущих процессов.\u003C\u002Fp\u003E\u003Cp\u003EМы можем усложнить логику и пойти дальше. View использует специальный класс \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fzandaqo\u002Fstructurae#strings\" rel=\"noopener noreferrer nofollow\"\u003EStringView\u003C\u002Fa\u003E для работы с UTF-8 строками, который является наследником \u003Ccode\u003EDataView\u003C\u002Fcode\u003E, имеющим набор методов для работы с бинарными данными без превращения их в JavaScript строки. Представим, что мы решили  ввести немного цензуры и блокировать сообщения содержащие слова из «черного списка». \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst bVord = new TextEncoder().encode('blood');\n\napp.post('\u002Fmessages', (req, res) =\u003E {\n    const view = new MessageView(req.body.buffer, req.body.byteOffset, req.body.length);\n    ...\n    const textView = view.getView('text');\n    if (textView.includes(bVord)) return res.sendStatus(400);\n    ...\n})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EC помощью \u003Ccode\u003Eview.getView\u003C\u002Fcode\u003E, мы создаем экземляр класса \u003Ccode\u003EDataView\u003C\u002Fcode\u003E (\u003Ccode\u003EStringView\u003C\u002Fcode\u003E в нашeм случае) для части буффера без декодирования в строку, а затем используем метод для поиска в буффере. Опять же мы экономим ресурсы при парсинге тела невалидных запросов, а также уменьшаем работу для GC.\u003C\u002Fp\u003E\u003Cp\u003EНу и конечно, мы можем декодировать наше сообщение целиком в JavaScript объект. В данном случае, это будет экземпляр класса \u003Ccode\u003EBoardMessage\u003C\u002Fcode\u003E, так как мы передали ссылку на него при создании представления (\u003Ccode\u003EVeiw.create\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E...\nconst message = view.toJSON();\n...\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EView также использует преимущества оптимизации \u003Ca href=\"https:\u002F\u002Fengineering.linecorp.com\u002Fen\u002Fblog\u002Fv8-hidden-class\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehidden class\u003C\u002Fa\u003E, который используют движки JavaScript, а именно: вместо создания пустых объектов \u003Ccode\u003E{}\u003C\u002Fcode\u003E и наполнения их декодированными значениями, View либо использует конструктор переданного класса (как в примере выше), либо генерит код для такого конструктора, чтобы каждый объект создавался с таким же количеством полей в том же порядке. Это приводит к более быстрым операциям с объектами и уменьшению количества работы для GC.\u003C\u002Fp\u003E\u003Cp\u003EТаким образом, с помощью уменьшения размера сообщений, валидации через zero-copy и оптимизации сериализации данных мы значительно увеличили пропускную способность нашей доски объявлений в плане обработки сообщений. Пусть эти бездельники только попробуют нас заспамить! 😃\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"javascript"},{"titleHtml":"node"},{"titleHtml":"typescript"},{"titleHtml":"binary"},{"titleHtml":"бинарные протоколы"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F93c\u002Fef3\u002F752\u002F93cef3752001aa9ea52e33724701d964.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F93c\u002Fef3\u002F752\u002F93cef3752001aa9ea52e33724701d964.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F580922\\\u002F\"},\"headline\":\"Бинарный протокол для JavaScript\",\"datePublished\":\"2021-10-19T10:52:49+03:00\",\"dateModified\":\"2021-10-19T11:50:04+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Митя Камаев\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F580922\\\u002F#post-content-body\",\"about\":[\"h_webdev\",\"h_javascript\",\"h_nodejs\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F580922\\\u002F84a376e565ca89704a63a911dbfb654e\\\u002F\"]}","metaDescription":"Нативная поддержка JSON одно из преимуществ разработки full-stack JavaScript приложений. JSON является простым, не требующим схемы и человекочитаемым -  качества особенно ценимые на ранней стадии...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"webdev,javascript,nodejs"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
