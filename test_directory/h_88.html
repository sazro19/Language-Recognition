<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Postgresso 35 — спецвыпуск: PostgreSQL 14 / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/postgrespro\/blog\/581552\/"},"headline":"Postgresso 35 — спецвыпуск: PostgreSQL 14","datePublished":"2021-10-24T00:03:46+03:00","dateModified":"2021-10-25T00:22:29+03:00","author":{"@type":"Person","name":"Igor_Le"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.  Статей о 14-й много...","url":"https:\/\/habr.com\/ru\/company\/postgrespro\/blog\/581552\/#post-content-body","about":["c_postgrespro","h_postgresql","f_develop"],"image":["https:\/\/habrastorage.org\/webt\/zu\/vp\/wh\/zuvpwh7brmwvj_zblctdxovvl4q.jpeg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Postgresso 35 — спецвыпуск: PostgreSQL 14" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Postgresso 35 — спецвыпуск: PostgreSQL 14" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Postgresso 35 — спецвыпуск: PostgreSQL 14" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.

Статей о 14-й много. Мы смотрели и разрозненные статьи..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.

Статей о 14-й много. Мы смотрели и разрозненные статьи..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.

Статей о 14-й много. Мы смотрели и разрозненные статьи..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.

Статей о 14-й много. Мы смотрели и разрозненные статьи..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.

Статей о 14-й много. Мы смотрели и разрозненные статьи..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/581552/efc58a2fb1188084dafaa26c19ca55b3/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/581552/efc58a2fb1188084dafaa26c19ca55b3/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/581552/efc58a2fb1188084dafaa26c19ca55b3/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/581552/efc58a2fb1188084dafaa26c19ca55b3/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/581552/efc58a2fb1188084dafaa26c19ca55b3/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="581552" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-23T21:03:46.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/581552/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/company/postgrespro/blog/581552/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/581552/efc58a2fb1188084dafaa26c19ca55b3/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="postgrespro" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><!----></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-card tm-company-article__company-card"><div class="tm-company-card__info"><div class="tm-company-card__header"><a href="/ru/company/postgrespro/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="//habrastorage.org/getpro/habr/company/4e0/339/621/4e0339621abc865fefb88f9e9f44748f.jpg" width="48" class="tm-entity-image__pic"></div></a> <!----> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">214.71</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div> <div class="tm-company-card__info"><a href="/ru/company/postgrespro/profile/" class="tm-company-card__name">
        Postgres Professional
      </a> <div class="tm-company-card__description">Разработчик СУБД Postgres Pro</div></div></div> <div class="tm-company-card__buttons"><!----> <!----></div></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Igor_Le/" title="Igor_Le" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/Igor_Le/" class="tm-user-info__username">
      Igor_Le
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-23T21:03:46.000Z" title="2021-10-24, 00:03">вчера в 00:03</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Postgresso 35 — спецвыпуск: PostgreSQL 14</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/company/postgrespro/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании Postgres Professional</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/postgresql/" class="tm-article-snippet__hubs-item-link"><span>PostgreSQL</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><img src="https://habrastorage.org/r/w780q1/webt/zu/vp/wh/zuvpwh7brmwvj_zblctdxovvl4q.jpeg" data-src="https://habrastorage.org/webt/zu/vp/wh/zuvpwh7brmwvj_zblctdxovvl4q.jpeg" data-blurred="true"/><br/>
<br/>
Пресс-релиз PostgreSQL <a href="https://www.postgresql.org/docs/14/release-14.html">обширен и основателен</a>. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках <a href="https://www.postgresql.org/about/news/postgresql-14-released-2318/">выделили главное</a>.<br/>
<br/>
Статей о 14-й много. Мы смотрели и разрозненные статьи и целые сериалы:<br/>
<b><a href="https://habr.com/ru/company/postgrespro/blog/510124/">обзоры коммитфестов</a></b> <i>Павла Лузанова</i> (5 серий),<br/>
<b><a href="https://www.depesz.com/tag/pg14/">waiting for PostgreSQL 14</a></b> <i>Хуберта 'depesz' Любашевского</i> (18),<br/>
<b><a href="https://paquier.xyz/">микрообзоры Postgres 14 highlights</a></b> <i>Мишеля Пакье</i> (Michael Paquier) (5),<br/>
<b><a href="https://www.postgresql.fastware.com/blog">в блоге Fujitsu OSS</a></b> (5).<br/>
<br/>
Кроме того есть пространная статья-справочник от HPE: <b><a href="https://h50146.www5.hpe.com/products/software/oe/linux/mainstream/support/lcc/pdf/PostgreSQL14Beta1_New_Features_en_20210521-1.pdf?fbclid=IwAR31FmcaXMIOv5jvIkGiiy-lrBLhEW6jggur2zMmUnirPvfDZnwJvNgGsIg">PostgreSQL 14 New Features With Examples (Beta 1)</a></b>.<br/>
<br/>
Начнём со статей, в которых авторы стараются охватить версию 14 в целом. Но перед этим разомнёмся <br/>
<br/>
<h2>в облаках и контейнерах</h2><a name="habracut"></a><br/>
<b><a href="https://blog.crunchydata.com/blog/postgresql-14-on-kubernetes">PostgreSQL 14 on Kubernetes (with examples!)</a></b><br/>
<a name="katz"></a><br/>
Джонатан Кац (Jonathan S. Katz, Crunchy data) показывает, как инсталлировать кранчевский оператор <a href="https://access.crunchydata.com/documentation/postgres-operator/v5/installation/">PGO</a> (горячо рекомендует с <a href="https://access.crunchydata.com/documentation/postgres-operator/v5/quickstart/">quickstart</a>) и запускает PostgreSQL 14.<br/>
<br/>
После этого в качестве примера он демонстрирует асинхронные запросы к сторонним таблицам — возможность, появившуюся в 14-й версии (через <a href="https://www.postgresql.org/docs/14/fdw-callbacks.html#FDW-CALLBACKS-ASYNC">postgres_fdw</a>, который научился исполнять запросы параллельно). Он создаёт целых 3 кластера: Носорог-1, Носорог-2 и Гиппопотам, настраивает postgres_fdw на Гиппо, создаём на Носорогах таблички через <a href="https://postgrespro.ru/docs/postgresql/13/sql-importforeignschema">IMPORT FOREIGN SCHEMA</a> (тоже новая фича 14-й) и, наконец, собирая данные с обоих носорогов, убеждается, что данные собираются асинхронно:<br/>
<pre><code class="pgsql">EXPLAIN ANALYZE SELECT avg(x.stat) FROM (
  SELECT data['stat']::float AS stat FROM rhino1.stats
  UNION ALL
  SELECT data['stat']::float AS stat FROM rhino2.stats
) x;</code></pre><br/>
<pre><code class="pgsql">                                QUERY PLAN                                                                 
-----------------------------------------------------------------------------------------------------------------
 Aggregate  (cost=424.80..424.81 rows=1 width=8) (actual time=13700.998..13701.000 rows=1 loops=1)
   ->  Append  (cost=100.00..412.00 rows=5120 width=8) (actual time=2.937..13410.193 rows=4000000 loops=1)
        ->  Async Foreign Scan on stats  (cost=100.00..193.20 rows=2560 width=8) (actual time=1.394..5337.504 rows=2000000 loops=1)
        ->  Async Foreign Scan on stats stats_1  (cost=100.00..193.20 rows=2560 width=8) (actual time=1.760..4807.722 rows=2000000 loops=1)
Planning Time: 1.019 ms
Execution Time: 13704.199 ms</code></pre><br/>
<br/>
Чуть позже Джонатан написал статью-апдейт: с использованием <a href="https://blog.crunchydata.com/blog/the-next-generation-of-kubernetes-native-postgres">вышедшего PGO 5.0</a>: <b><a href="https://blog.crunchydata.com/blog/multi-cluster-postgres-federation-on-kubernetes-with-postgres-14-using-gitops">Multi-Cluster Postgres Federation on Kubernetes with Postgres 14 Using GitOps</a></b>.<br/>
<br/>
Неспроста автор придумал пароль для серверов — <b>datalake</b>. Он явно намекает: для озёр данных такая архитектура годная. Делает он во второй статье вот что:<br/>
<br/>
создаёт на 3 кластерах по 3 секции (используя заодно подтип <code>datemultirange</code> типа <a href="https://postgrespro.ru/docs/postgresql/14/functions-range">multirange</a>, появившегося в 14-й ), чтобы не без изящества автоматически раскладывать по ним данные с соответствующих 3 кластеров. А дальше при помощи логической репликации обустраивает простенький мультимастер — на все 3 ноды пишутся данные и сразу синхронизируются по всем 3 кластерам. Не успокоившись, он «масштабирует» «мультимастер» до 4 узлов — тоже раскладывая данные по полочкам. Это, конечно, только наглядный пример, никакой настоящей гарантии консистентности там нет, но вообще в релизе PostgreSQL 14 аж 10 пунктов <a href="https://habr.com/ru/company/postgrespro/blog/581552#replic">относятся к логической репликации</a>. <br/>
<br/>
<b><a href="https://www.citusdata.com/blog/2021/10/01/how-we-shipped-postgres-14-on-azure-within-a-day/">How We Shipped PostgreSQL 14 on Azure Within One Day of its Release</a></b><br/>
<a name="citus"></a><br/>
В Citus хвалятся тем, что новую версию развернули как <a href="https://docs.microsoft.com/ru-ru/azure/postgresql/hyperscale/">«Гипермосштабирование»</a> в облаках Azure за 1 день — как только был опубликован релиз. <i>Озгун Эрдоган</i> (Sic! — Ozgun Erdogan, Citus Data) пишет о любимых новых фичах 14-й, а они, конечно, связаны с задачами Citus. То есть работают на производительность и параллелизм. Поэтому полюбит их не только Citus.<br/>
<br/>
Прежде всего полюбилось всё, связанное с масштабированием по числу соединений (connection scaling). В компании считают, что самое узкое место PostgreSQL это масштабирование по снеэпшотам. И что их патчи помогли значительно улучшить ситуацию, особенно в случаях, когда в соединениях ничего не делается (<code>idle</code>).<br/>
<br/>
Также компания внесла вклад в ускорение восстановления (в 2.4 раза) и ускорение VACUUM на 25% в случае нагрузок, сильно завязанных на процессор.<br/>
<br/>
Совместимость с PostgreSQL 14 они обеспечили не только для самого <a href="https://github.com/citusdata/citus">Citus</a>, но и для других опенсорсных расширений, к которым приложили руку: <a href="https://github.com/citusdata/pg_cron">pg_cron</a>, <a href="https://github.com/citusdata/postgresql-hll">postgresql-hll</a> (HyperLogLog) и <a href="https://github.com/citusdata/postgresql-topn">postgresql-topn</a>.<br/>
<br/>
<h2>О PostgreSQL 14, едином и неделимом</h2><br/>
<b><a href="https://www.instaclustr.com/postgresql-14/">PostgreSQL 14: PostgreSQL Is Still a Teenager</a></b><br/>
<a name="kirk"></a><br/>
<i>Кирк Ройбол</i> (Kirk Roybal, instaclustr) считает, что Postgres повзрослел до тинейджера — или не считает: в первоначальной версии статьи, следы которой есть в интернете, название было <i>… Is Still a Tweeny</i> — то есть ребёнок лет 6-12. Но главная причина его удивления — отсутствие фокуса на каких-то направлениях разработки. <i>Я надеялся</i> — говорит Кирк — <i>услышать что-то ошарашивающее, вроде </i>VACUUM больше не нужен!<i> Услышал же я, что </i>множество людей приложило громадные усилия, чтобы улучшить вещи, которые надо было улучшить.<br/>
<br/>
Об этих многочисленных, но не достаточно радикальных (для него) изменениях Кирк и говорит, демонстрируя наблюдательность и взгляд немного под другим углом, чем у многих других. Кажется, это действительно незамыленный взгляд, хотя, по многим пунктам его голос звучит в унисон с голосами, которые мы дальше цитируем. Самым ярким достижением 14-й он считает резкое улучшение масштабируемости по соединениям, когда число соединений переваливает через 5000. Хотя VACUUM и не отменили, но улучшения его, оставшиеся под капотом, он считает, были из самых востребованных сообществом. О некоторых других его соображениях мы упомянем в соответствующем контексте. <br/>
<br/>
Новый GUC — <a href="https://www.postgresql.org/docs/14/runtime-config-statistics.html#GUC-COMPUTE-QUERY-ID">compute_query_id</a> — тоже упомянут. Он позволяет, когда включён, получать id запроса даже без обращения к <a href="https://postgrespro.ru/docs/postgresql/14/pgstatstatements">pg_stat_statements</a>. id запроса вычисляется средствами ядра. Посмотреть его можно и в <a href="https://postgrespro.ru/docs/postgresql/14/monitoring-stats#MONITORING-PG-STAT-ACTIVITY-VIEW">pg_stat_activity</a>, откуда его берёт EXPLAIN. Или его можно сбросить в лог если сконфигурирован параметр <a href="https://postgrespro.ru/docs/postgresql/14/runtime-config-logging#GUC-LOG-LINE-PREFIX">log_line_prefix</a>.<br/>
<br/>
Об этом целая статья <a href="https://habr.com/ru/company/postgrespro/blog/581552#query_id">ниже</a>.<br/>
<br/>
<b><a href="https://momjian.us/main/writings/pgsql/features.pdf">Major Features: Postgres 14</a></b><br/>
<br/>
Этот PDF <i>Брюса Момджана</i> (Bruce Momjian, EDB) — коротенькая презентация. Стоящая внимания: по каждому из пунктов всего-то по схемке (только к btree-индексам — 3), зато они очень наглядные.<ol>
<li>предотвращение распухания btree-индексов;</li>
<li>улучшения в индексах BRIN;</li>
<li>масштабирование снэпшотов;</li>
<li>глобальный id запроса;</li>
<li>idle_session_timeout;</li>
<li>роли для операций read-only и write-only;</li>
<li>улучшения в оптимизаторе;</li>
<li>параллельное сканирование сторонних таблиц.</li>
</ol><br/>
<br/>
<h3>Матрица</h3><br/>
Любопытная картина складывается, если глянуть на <a href="https://www.postgresql.org/about/featurematrix/">матрицу фич</a>. Пожалуй, это иллюстрация того, как иногда картина крупными мазками не слишком адекватна реальности.<br/>
<br/>
<h3>Статистика коммитфестов</h3><br/>
<b><a href="https://www.highgo.ca/2021/06/28/some-interesting-statistics-about-pg-14-contributions/">Some Interesting statistics about PG-14 contributions</a></b><br/>
<a name="ahsan"></a><br/>
<i>Асан Хади</i> (Ahsan Hadi) из HighGo (вице-президент по разработкам, был старшим директором по продукту Postgres Plus Advanced Server в EDB) решил собрать статистику по коммитам в PostgreSQL 14. Дело доброе: до него этим любил побаловаться Роберт Хаас (Robert Haas), но он считал по годам.<br/>
<br/>
А вот <b>его выбор</b>: <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">top7 фич PostgreSQL 14</b>
                        <div class="spoiler_text">1. <a href="https://commitfest.postgresql.org/32/2491/">Asynchronous execution of PostgreSQL_FDW Append node</a><br/>
2. <a href="https://commitfest.postgresql.org/29/2500/"> Improving connection scalability: GetSnapshotData()</a> <i>[это правильная ссылка, в статье </i>Асана<i> Some Interesting… — битая]</i><br/>
3. <a href="https://commitfest.postgresql.org/32/2575/">Overhaul UPDATE/DELETE processing (making update/delete of inheritance trees scale better</a><br/>
4. <a href="https://commitfest.postgresql.org/29/1927/"> logical streaming for large in-progress transactions</a><br/>
5. <a href="https://commitfest.postgresql.org/31/2112/">Add support for multirange data types</a><br/>
6. <a href="https://www.postgresql.org/message-id/flat/CAH2-Wzm+maE3apHB8NOtmM=p-DO65j2V5GzAWCOEEuy3JZgb2g@mail.gmail.com">Allow btree index additions to remove expired index entries to prevent page splits</a><br/>
7. <a href="https://commitfest.postgresql.org/31/2620/">PostgreSQL_FDW Batching</a><br/>
</div>
                    </div><br/>
<br/>
Ну а <i>Деврим Гюндюз</i> (Devrim Gündüz) поможет<br/>
<br/>
<h3>установить 14-ю версию из rpm</h3><br/>
<b><a href="https://people.planetpostgresql.org/devrim/index.php?/archives/115-Installing-PostgreSQL-14-betaRC-on-RHEL-Rocky-Linux-Fedora-and-SLES.html">Installing PostgreSQL 14 beta/RC on RHEL / Rocky Linux / Fedora and SLES</a></b>.<br/>
<br/>
<h2>Производительность</h2><br/>
<b><a href="https://www.highload.ru/spring/2021/abstracts/6542">Postgres 14 и высокие нагрузки</a></b><br/>
<br/>
Это видео и презентация <i>Ивана Панченко</i> (зам. гендира Postgres Professional) на весеннем <a href="https://www.highload.ru/spring/2021/abstracts/6542">Highload++</a> в Крокусе-Экспо. Первым пунктом у Ивана стоит <i>повышение масштабируемости по<br/>
коннектам</i>. Второе и третье места заняли <i>восходящее удаление (bottom-up delition)</i> и <i>Асинхронный APPEND</i> соответственно.<br/>
<br/>
Между прочим, в своём интервью <b><a href="https://postgresql.life/post/ivan_panchenko/?fbclid=IwAR18aBPNqSi18CVaHZ3_cJTn55J593LZXkqSAsSOrn1C3Qu8B2MZkgx2RWc">в качестве Персоны недели</a></b> Иван на вопрос о любимой фиче отвечает:<br/>
<br/>
<i>Много полезных и важных фич — что в 13-й, что в 14-й — но ни одна из них не выглядит наиболее важной в сравнении с другими.</i><br/>
<br/>
(Но почитайте всё интервью: там есть даже про собаку и блоху, объясняющих, <a href="https://www.labirint.ru/books/799209/">как устроено Солнце</a>)<br/>
<br/>
<b><a href="https://pganalyze.com/blog/postgres-14-performance-monitoring">An early look at Postgres 14: Performance and Monitoring Improvements</a></b><br/>
<br/>
<i>Лукас Фиттл</i> (Lukas Fittl, pgAnalyze), как и Иван, как и Citus, говорит прежде всего о масштабировании активных и свободных соединений.<br/>
<br/>
Очень понравилось ему новое представление <a href="https://www.postgresql.org/docs/devel/view-pg-backend-memory-contexts.html">pg_backend_memory_contexts</a> и функция <a href="https://www.postgresql.org/docs/14/functions-admin.html">pg_log_backend_memory_contexts()</a>, которые дают возможность заглянуть в память, чтобы понять, какое соединение сжирает больше всего памяти. Другая полезная вещь для диагностики — представление <a href="https://www.postgresql.org/docs/14/monitoring-stats.html">pg_stat_wal</a>. И очень автору понравилось, что <code>guery_id</code>, которое было в любимом дотошными админами представлении <a href="https://postgrespro.ru/docs/postgresql/13/pgstatstatements">pg_stat_statements</a>, теперь можно использовать и в представлении <a href="https://postgrespro.ru/docs/postgresql/13/monitoring-stats#MONITORING-PG-STAT-ACTIVITY-VIEW">pg_stat_activity</a>.<br/>
<br/>
О коннектах есть и у Депеша в <b><a href="https://www.depesz.com/2020/08/25/waiting-for-postgresql-14-improvements-for-handling-large-number-of-connections/">Waiting for PostgreSQL 14 – Improvements for handling large number of connections</a></b>:<br/>
<br/>
Депеш приводит список из 7 ссылок на патчи, которые должны обеспечить масштабируемость соединений. Сам он не тестировал, но в комментариях есть <a href="https://github.com/digoal/blog/blob/master/202008/20200817_01.md">ссылка на тесты</a>. По ссылке немало иероглифов, но, вроде, ясно, что на 5000 соединений 14-й выиграл у 13-го 37% на TPS.<br/>
<br/>
<h2>Мониторинг и «прозрачность»</h2><br/>
<br/>
В упомянутой <a href="https://habr.com/ru/company/postgrespro/blog/581552#kirk">статье Кирка</a> <i>прозрачность</i> (переведу таким вольным образом <b><i>visibility</i></b>) отобразилась в виде <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">огромного списка (15 пунктов):</b>
                        <div class="spoiler_text"> <ul>
<li>Статус операции COPY появился в <code>pg_stat_progress_copy</code>.</li>
<li>Статус WAL в <code>pg_stat_wal</code>.</li>
<li>Статус репликации в <code>pg_stat_replication_slots</code>.</li>
<li>Статус обработки запроса бэкендом в <code>pg_backend_memory_contexts</code> (его также можно сбросить в лог, используя <code>pg_log_backend_memory_contexts</code>.</li>
<li>Новые колонки в <code>pg_stat_database</code>.</li>
<li>Архиватор в <code>pg_stat_activity</code>.</li>
<li>В <code>pg_locks</code> добавлено время начала ожидания блокировки (lock wait start time).</li>
<li>Добавлено представление <code>routine_column_usage</code> в <code>information_schema</code> для отслеживания колонок, на которые ссылаются в выражениях по умолчанию у функций или процедур.</li>
<li>Добавлено <code>%P</code> к <code>log_line_prefix</code>, чтобы виден был PID лидера группы.</li>
<li>Добавлен серверный параметр <code>log_recovery_conflict_waits</code> для отчётов о долгих временах разрешения конфликтов при восстановлении (to report long recovery conflict wait times).</li>
<li>Функция <code>pg_get_wal_replay_pause_state()</code> для отчётов о состоянии восстановления.</li>
<li>Функция <code>pg_xact_commit_timestamp_origin()</code>, возвращающая timestamp коммитта и источника репликации заданной транзакции.</li>
<li>К записи, возвращаемой <code>pg_last_committed_xact()</code> добавлен источник репликации.</li>
<li><code>pg_stat_statements</code> теперь отслеживает инструкции верхнего уровня и вложенные инструкции отдельно.</li>
<li>Для некоторых утилит добавлены кумулятивные флаги –verbose (-vvv) для вывода на экран</li>
</ul></div>
                    </div><br/>
Однако список <i>Алексея Лесовского</i> ещё больше: 17 пунктов — <b><a href="https://habr.com/ru/post/558792/">Что нового в плане мониторинга в PostgreSQL 14</a></b>.<br/>
<br/>
И это не просто перечисление, некоторые пункты сопровождаются примерами кода, а некоторые даже эмоциями:<br/>
<i>Новое представление pg_backend_memory_contexts — одно из нововведений, которое вызвало у меня противоречивые эмоции… как мне кажется, разработчики перемудрили — достаточно было бы сделать только одну эту [<code>pg_log_backend_memory_contexts()</code>] функцию (без вьюхи) которая бы принимала идентификатор процесса, но при этом вместо логирования, выводила бы статистику в виде строк.</i><br/>
<br/>
<b><a href="https://paquier.xyz/postgresql-2/postgres-14-monitoring-copy/">Monitoring for COPY</a></b><br/>
<br/>
Возможность мониторинга операции COPY привлекла внимание <i>Мишеля Пакье</i> (Michael Paquier). COPY TO и COPY FROM нередко занимают много времени, поэтому возможность посмотреть, как идут дела с копированием, не прихоть. В новом системном представлении <code>pg_stat_progress_copy</code> по одной строке с 8 полями (в статье есть подробности) на каждый бэкенд.<br/>
<br/>
depesz в своих waiting-ах тоже не прошёл мимо COPY: <b><a href="https://www.depesz.com/2021/01/12/waiting-for-postgresql-14-report-progress-of-copy-commands/">Report progress of COPY commands</a></b><br/>
<br/>
Он предупреждает, между прочим, что общее количество байтов в некоторых случаях недоступно — когда ввод идёт с клиента, например.<br/>
<a name="query_id"></a><br/>
<b><a href="https://blog.rustprooflabs.com/2021/10/postgres-14-query-id">Using Query ID in Postgres 14</a></b> — этому параметру статью посвятили RustProoflabs. <i>Райан Лэмберт</i> (Ryan Lambert) запускает <b>pgbench</b> и сначала смотрит id в <code>pg_stat_statements</code> (для такой возможности <code>compute_query_id</code> надо установить в <code>postgresql.conf</code> в <code>auto</code> или <code>on</code>).<br/>
<br/>
После этого Райан открывает параллельно 3 сессии: в двух он сталкивает UPDATE-транзакции так, что вторая натыкается на блокировку первой и висит, а в третьей он запускает запрос к <code>pg_stat_statments</code> и <code>pg_stat_activity</code>. И убеждается, что так удаётся выловить запрос, который выполняется дольше предыдущих и так и не завершён. Затем Райан демонстрирует два оставшихся способа использования guery_id: в EXPLAIN и в логах, не умолчав о некоторой принципиально нерешаемой (но не слишком критичной) <a href="https://postgrespro.ru/list/thread-id/2432133#CA+8PKvQnMfOE-c3YLRwxOsCYXQDyP8VXs6CDtMZp1V4=D4LuFA@mail.gmail.com">проблеме</a>.<br/>
<br/>
<h2>VACUUM</h2><br/>
Хорошо <a href="https://habr.com/ru/company/postgrespro/blog/581552#kirk">сказал выше Кирк</a>, мол, революции не произошло — VACUUM жив, — но под капотом поменялось немало. <br/>
<br/>
Анализ прочитанного на эту тему показал, что наиболее толковое описание улучшений, связанных с VACUUM, удалось сделать нашему <i>Павлу Лузанову</i> :) в его 5-й серии <b><a href="https://habr.com/ru/company/postgrespro/blog/550632/">Заморозки</a></b> обзоров коммитфестов. Там и много (но концентрированно), и примеры есть. Как, впрочем, и в других его аналогичных обзорах — обзор без VACUUM это каша без соли.<br/>
<br/>
Давно идут разговоры, что VACUUM нужно сделать более <i>агрессивным</i> (и был даже <a href="https://www.postgresql.org/message-id/flat/a6b9a97b4b1dfcb61b6e3ccd66566d2da005eac3.camel%40cybertec.at#7f962359f30d8e96a00672734cbb0500">берсерк-автовакуум</a>, предложенный <i>Дорофеем 'Котярой' Пролесковским</i>) — как экстренную меру, когда счётчики xid или multixact приближаются к wraparound. В PostgreSQL 14 в этом случае откладываются до лучших времён чистки индексов, уступая дорогу вакууму. Поведение его управляется константами <code>vacuum_failsafe_age</code> и <code>vacuum_multixact_failsafe_age</code>. Но подробных разборов этих ситуаций мы пока не нашли.<br/>
(Напомним, что о 64-разрядных идентификаторах транзакций говорят давно, но пока они есть <a href="https://postgrespro.ru/docs/enterprise/13/intro-pgpro-vs-pg">только</a> в коммерческой версии — Postgres Pro Enterprise.)<br/>
<br/>
Выше в Citus <a href="https://habr.com/ru/company/postgrespro/blog/581552#citus">хвалились</a>, что ускорили VACUUM на 25% своими патчами. Но об этом (и о восстановлении) у них была и целая статья, которую мы <a href="https://habr.com/ru/company/postgrespro/blog/545796#citus">упоминали ещё в Postgresso 30</a>:<br/>
<br/>
<b><a href="https://www.citusdata.com/blog/2021/03/25/speeding-up-recovery-and-vacuum-in-postgres-14/">Speeding up recovery &amp; VACUUM in Postgres 14</a></b><br/>
<br/>
Это статья о патче Citus в основную ветку PostgreSQL, написанная (как и сам <a href="https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=19c60ad69a91f346edf66996b2cf726f594d3d2b">патч</a>) Дэвидом Роули (David Rowley), работавшим над этим уже внутри Microsoft. Он переписал внутреннюю функцию <code>compactify_tuples</code>, которая используется, когда PostgreSQL стартует после внештатного (нечистого) шатдауна (crash recovery), и когда идёт восстановление standby-сервера проигрыванием WAL по их прибытии с primary-сервера.<br/>
<br/>
Эти случаи Дэвид и расписывает, поясняя схемами. Новая версия функции избавляет от ненужной внутренней сортировки кортежей в <code>heap</code>, поэтому и работает быстрее.<br/>
<br/>
<h2>FDW</h2><br/>
Эта тема вызвала немало откликов. Прежде всего заинтересовались те, кто движется в сторону шардинга и вообще распараллеливания вычислений.<br/>
<br/>
В <a href="https://habr.com/ru/company/postgrespro/blog/581552#ahsan">статье</a>, которая выше, <i>Асан Хади</i> ставит FDW на первое место в своём списке достижений Postgres 14. И напомним, что <i>Джонатан Кац</i> <a href="https://habr.com/ru/company/postgrespro/blog/581552#katz">выбрал</a> асинхронную работу FDW для своего кубернетного примера.<br/>
<br/>
В <a href="https://www.postgresonline.com/">Postgres OnLine Journal</a> пишут об FDW для Windows: <b><a href="https://www.postgresonline.com/journal/index.php?/archives/402-PostgreSQL-14-64-bit-for-Windows-FDWs.html">PostgreSQL 14 64-bit for Windows FDWs</a></b><br/>
<br/>
Речь о бинарниках <b><a href="https://github.com/adunstan/file_text_array_fdw">file_text_array_fdw</a></b> и <b><a href="https://github.com/CartoDB/odbc_fdw">odbc_fdw</a></b> для PostgreSQL 14 под 64-бытные Windows.<br/>
<br/>
<b><a href="https://www.percona.com/blog/2021/06/02/postgres_fdw-enhancement-in-postgresql-14/">postgres_fdw Enhancement in PostgreSQL 14</a></b><br/>
<br/>
<i>Ибрар Ахмед</i> (Ibrar Ahmed, Percona) демонстрирует достижения в PostgreSQL 14 по части FDW на примерах.<br/>
<br/>
<h2>Типы (новорожденный и старички)</h2><br/>
<b><a href="https://www.postgresonline.com/journal/index.php?/archives/401-Multirange-types-in-PostgreSQL-14.html">Multirange Types in Postgres 14</a></b><br/>
<br/>
<i>Джонатан Кац</i> (Jonathan S. Katz, Crunchy Data) пишет о <a href="https://www.postgresql.org/docs/14/rangetypes.html#RANGETYPES-BUILTIN">мультидиапазонах</a> (multirange) — в PostgreSQL 14 именно они упростили ему и упростят многим их SQL-жизнь: приводит пример «из жизни» — с бронированием встреч. Действительно всего 3 строчки нужно для того, чтобы посмотреть, какие дни свободны. Сначала, конечно, надо забить необходимые данные в таблицу, но сложный рекурсивный запрос не потребуется.<br/>
<br/>
Про <i>мультидиапазонные типы данных</i> довольно развёрнуто пишет и <i>Павел Лузанов</i> в <a href="https://habr.com/ru/company/postgrespro/blog/541252#commit_6df7a969">4-й части</a> коммитфест-обзоров.<br/>
<br/>
<b><a href="https://www.depesz.com/2020/12/21/waiting-for-postgresql-14-multirange-datatypes/">Multirange datatypes</a></b><br/>
 <br/>
В этой заметке Депеш не удовлетворился демонстрационным примером — как создавать колонки multirange и как выглядят результаты запросов к ним, — а решил разобраться, что с индексами для нового типа. <code>btree</code> можно создать и использовать для простеньких SELECT. Но depesz хотелось большего — операторов вроде <code>@></code>, а вот с этим пока никак. <code>gist/spgist</code> и <code>gin</code> тоже отложили на будущее. В комментариях к статье автор патча, <i>Александр Коротков</i>, пояснил, что и <code>btree</code> пока работает так, как будто дыр между диапазонами нет, используя код для обычных <code>range</code>, без <code>multi</code>.<br/>
<br/>
<b><a href="https://blog.crunchydata.com/blog/postgres-14-its-the-little-things">Postgres 14: It's The Little Things</a></b><br/>
<br/>
Типы <code>JSON/JSONB</code> уже в возрасте, а новость в удобном синтаксисе. <i>Крейг Кирстинс</i> (Creig Kirstiens, Crunchy Data) радуется синтаксису с индексной нотацией <b>JSON</b> (JSON subscripting) — она простая, наглядная, интуитивная. Надо было писать так:<br/>
<pre><code class="pgsql">WHERE details->'attributes'->>'color' = 'neon yellow'</code></pre><br/>
а теперь можно так:<br/>
<pre><code class="pgsql">WHERE details['attributes']['color'] = '"neon yellow"'</code></pre><br/>
<br/>
<i>Лузанов</i> <a href="https://habr.com/ru/company/postgrespro/blog/541252#commit_c7aba7c1">поясняет</a> интенции разработчиков более технологично и более исторично: <i>с идеи сделать поддержку индексной нотации для json начался длинный путь [с зимы 2017] работы над <a href="https://www.postgresql.org/message-id/flat/20200801143334.d7d3tsb7gaezx6vq%40localhost#61fae982900fdfa283a665c63e93a8c3">этим патчем</a> </i>Дмитрия Долгова<i>. И вот спустя несколько лет такая поддержка появилась. Первый патч создает необходимую инфраструктуру индексной нотации для произвольных типов данных. Второй патч добавляет индексную нотацию к типу <b>hstore</b>, а третий ― к типу JSONB. Теперь вместо специальных функций и операторов можно извлекать необходимые части из JSON-значения. Найдем телефон в контактных данных одного из билетов:</i><br/>
<br/>
<pre><code class="pgsql">SELECT contact_data, contact_data['phone'] AS phone;</code></pre><br/>
<br/>
А можно ещё посмотреть статью самого <i>Дмитрия Долгова</i> <b><a href="https://erthalion.info/2021/03/03/subscripting/">How many engineers does it take to make subscripting work?</a></b><br/>
<br/>
<h2>Бэкап и репликация</h2><br/>
В <b><a href="https://www.postgresql.fastware.com/blog"> блоге Fujitsu</a></b> обсуждались не все новшества 14-й версии, а те, в разработке которых Fujitsu OSS принимала участие. Они существенные.<br/>
<br/>
<b><a href="https://www.postgresql.fastware.com/blog/logical-decoding-of-two-phase-commits">Logical decoding of two-phase commits in PostgreSQL 14</a></b><br/>
<br/>
PostgreSQL поддерживает двухфазные транзакции аж с версии 8.0, а логическую репликацию с 10.0, но двухфазные коммиты до этого не поддерживались логической репликацией. Команды PREPARE TRANSACTION, COMMIT PREPARED и ROLLBACK PREPARED поддерживались на уровне инстанса, но их не могли корректно декодировать при передаче на реплику. Теперь всё работает. Изменились плагин <b>test_decoding</b> и API.<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">ДРУГИЕ ФИЧИ В БЛОГЕ FUJITSU (ссылки)</b>
                        <div class="spoiler_text"><b><a href="https://www.postgresql.fastware.com/blog/improved-logging-by-libpq-in-postgresql-14">Improved logging by libpq in PostgreSQL 14</a></b><br/>
<br/>
<b><a href="https://www.postgresql.fastware.com/blog/enhancement-to-target-session-attrs">Enhancements to the target_session_attrs database connection parameter in PostgreSQL 14</a></b><br/>
<br/>
<b><a href="https://www.postgresql.fastware.com/blog/speeding-up-recovery-by-optimizing-dropping-of-relation-buffers">Speeding up recovery by optimizing the dropping of relation buffers – Sneak peek on features committed in PostgreSQL 14</a></b><br/>
</div>
                    </div><br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">ДРУГИЕ МИКРООБЗОРЫ МИШЕЛЯ ПАКЬЕ</b>
                        <div class="spoiler_text"><b><a href="https://paquier.xyz/postgresql-2/postgres-14-memory-dumps/">Memory dumps</a></b><br/>
<br/>
PostgreSQL работает с памятью в рамках программной архитектуры контекстов. Представление pg_backend_memory_contexts позволяет заглядывать в память, доступную сессии, не используя дебаггер, (это особенно полезно в облачных средах) начиная с TopMemoryContext и спускаясь по деревьям. Это можно сделать не только от суперюзера, но и от ролей, которым это дозволено по GRANT. Кроме того, добавлена одноименная функция pg_backend_memory_contexts(), которая может заглядывать и в чужие сессии (она только под суперюзером). Значения не возвращаются клиенту, а сбрасываются в лог.<br/>
<br/>
<b><a href="https://paquier.xyz/postgresql-2/postgres-14-reindex-tbspace/">REINDEX TABLESPACE</a></b><br/>
<br/>
Это значит, что индекс можно перемещать CONCURRENTLY, так как индекс можно перестраивать, перемещая в другое табличное пространство, а не в два этапа: перестройка, потом перемещение — меньше вероятность, что пространства не хватит. При этом разрешая одновременное чтение и запись во время переиндексации, поскольку операция накладывает блокировку SHARE UPDATE EXCLUSIVE на индекс и родительскую таблицу. Подобная судьба (добавка CONCURRENTLY) ждала CLUSTER и VACUUM FULL, но не дождалась: релиз вышел.<br/>
<br/>
<b><a href="https://paquier.xyz/postgresql-2/postgres-14-hashes/">Fun with Hashes</a></b><br/>
<br/>
Здесь даже есть небольшой исторический экскурс в криптографию Postgres.<br/>
<br/>
<b><a href="https://paquier.xyz/postgresql-2/postgres-14-table-compression/">CREATE TABLE COMPRESSION</a></b><br/>
<br/>
Тоже с историей вопроса. Сейчас SET COMPRESSION можно задать как lz4. По умолчанию GUC default_toast_compression = «pglz».<br/>
<br/>
Интересная ситуация с репликацией: при физической репликации можно проигрывать на реплике WALы ведущего сервера, сжатые LZ4, даже если реплика не поддерживает LZ4. Но прочитать данные из таких таблиц не получится: Postgres выдаст ошибку. При логический репликации на каждом сервере всё будет сжато в соответствии с настройками сервера.<br/>
</div>
                    </div><br/>
<br/>
С Depesz не просто: уж больно он <i>prolific</i>, так сказать, в своих <a href="https://www.depesz.com/tag/pg14/">Waiting for PostgreSQL 14</a>. 18 заметок обозреть не можем, поэтому<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">просто ссылки.</b>
                        <div class="spoiler_text"><b><a href="https://www.depesz.com/2021/04/01/waiting-for-postgresql-14-add-unistr-function/">Add unistr function</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2021/04/01/waiting-for-postgresql-14-add-pg_database_owner-default-role/">Add «pg_database_owner» default role.</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2021/03/31/waiting-for-postgresql-14-add-date_bin-function/">Add date_bin function</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2021/03/22/waiting-for-postgresql-14-allow-configurable-lz4-toast-compression/">Allow configurable LZ4 TOAST compression.</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2021/02/04/waiting-for-postgresql-14-search-and-cycle-clauses/">SEARCH and CYCLE clauses</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2021/01/18/waiting-for-postgresql-14-add-pg_stat_database-counters-for-sessions-and-session-time/">Add pg_stat_database counters for sessions and session time</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2021/01/12/waiting-for-postgresql-14-add-idle_session_timeout/">Add idle_session_timeout.</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/12/21/waiting-for-postgresql-14-pg_stat_statements-track-time-at-which-all-statistics-were-last-reset/">pg_stat_statements: Track time at which all statistics were last reset.</a></b> <br/>
<br/>
<b><a href="https://www.depesz.com/2020/12/20/waiting-for-postgresql-14-allow-subscripting-of-hstore-values/">Allow subscripting of hstore values.</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/11/19/3851/">Provide the OR REPLACE option for CREATE TRIGGER.</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/11/18/waiting-for-postgresql-14-support-negative-indexes-in-split_part/">Support negative indexes in split_part().</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/10/05/waiting-for-postgresql-14-support-for-out-parameters-in-procedures/">Support for OUT parameters in procedures</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/09/08/waiting-for-postgresql-14-add-support-for-partitioned-tables-and-indexes-in-reindex/">Add support for partitioned tables and indexes in REINDEX</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/08/24/waiting-for-postgresql-14-pg_stat_statements-track-number-of-rows-processed-by-some-utility-commands/">pg_stat_statements: track number of rows processed by some utility commands.</a></b><br/>
<br/>
<b><a href="https://www.depesz.com/2020/07/27/waiting-for-postgresql-14-rename-wal_keep_segments-to-wal_keep_size/">Rename wal_keep_segments to wal_keep_size.</a></b><br/>
<br/>
</div>
                    </div><br/>
<br/>
<h2>Задавайте вопросы</h2><br/>
В смысле здесь, а ещё лучше и на докладе <i>Павла Лузанова</i> <b><a href="https://pgconf.ru/202110/309791">PostgreSQL 14. Финальный обзор</a></b>, который можно будет послушать на <a href="https://pgconf.ru/">PGConf.Russia 2021</a>, которая состоится назло вирусу (но с QR- и экспресс ПЦР-тестами) 25-26-го октября.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpostgresql%5D" class="tm-tags-list__link">postgresql</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpostgres%5D" class="tm-tags-list__link">postgres</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdbms%5D" class="tm-tags-list__link">dbms</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Brdbms%5D" class="tm-tags-list__link">rdbms</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdata%20bases%5D" class="tm-tags-list__link">data bases</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D1%83%D0%B1%D0%B4%5D" class="tm-tags-list__link">субд</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%80%D1%81%D1%83%D0%B1%D0%B4%5D" class="tm-tags-list__link">рсубд</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%5D" class="tm-tags-list__link">базы данных</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/company/postgrespro/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании Postgres Professional
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/postgresql/" class="tm-hubs-list__link">
    PostgreSQL
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 11: ↑11 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 11: ↑11 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+11</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    16
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/company/postgrespro/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/4e0/339/621/4e0339621abc865fefb88f9e9f44748f.jpg" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/company/postgrespro/profile/" class="tm-company-snippet__title">Postgres Professional</a> <div class="tm-company-snippet__description">Разработчик СУБД Postgres Pro</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://facebook.com/PostgresProfessional" rel="noopener" target="_blank" class="tm-article-author__contact">
      Facebook
    </a><a href="https://twitter.com/PostgresPro" rel="noopener" target="_blank" class="tm-article-author__contact">
      Twitter
    </a><a href="https://vk.com/public101507899" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a><a href="https://plus.google.com/+PostgresproRuCompany" rel="noopener" target="_blank" class="tm-article-author__contact">
      Google+
    </a><a href="https://postgrespro.livejournal.com/" rel="noopener" target="_blank" class="tm-article-author__contact">
      LiveJournal
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Igor_Le/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 91 голос " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    83
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">12</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/Igor_Le/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Igor_Le
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/company/postgrespro/blog/581552/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!----></div></div></div>  <!---->  <!----> <!----></div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2015-01-26T21:00:00.000Z" title="2015-01-27, 00:00">27  января  2015</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="http://www.postgrespro.ru/" target="_blank" class="tm-company-basic-info__link">
      www.postgrespro.ru
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    51–100 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2015-09-30T07:41:09.000Z" title="2015-09-30, 10:41">30  сентября  2015</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="/ru/users/x-wao/" class="tm-company-basic-info__link">
      Иван Панченко
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/company/postgrespro/blog/581552/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/company/postgrespro/blog/581552/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"581552":{"id":"581552","timePublished":"2021-10-23T21:03:46+00:00","isCorporative":true,"lang":"ru","titleHtml":"Postgresso 35 — спецвыпуск: PostgreSQL 14","leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzu\u002Fvp\u002Fwh\u002Fzuvpwh7brmwvj_zblctdxovvl4q.jpeg\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПресс-релиз PostgreSQL \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Frelease-14.html\" rel=\"nofollow noopener noreferrer\"\u003Eобширен и основателен\u003C\u002Fa\u003E. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fabout\u002Fnews\u002Fpostgresql-14-released-2318\u002F\" rel=\"nofollow noopener noreferrer\"\u003Eвыделили главное\u003C\u002Fa\u003E.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nСтатей о 14-й много. Мы смотрели и разрозненные статьи и целые сериалы:\u003Cbr\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F510124\u002F\"\u003Eобзоры коммитфестов\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Ci\u003EПавла Лузанова\u003C\u002Fi\u003E (5 серий),\u003Cbr\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002Ftag\u002Fpg14\u002F\" rel=\"nofollow noopener noreferrer\"\u003Ewaiting for PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Ci\u003EХуберта 'depesz' Любашевского\u003C\u002Fi\u003E (18),\u003Cbr\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002F\" rel=\"nofollow noopener noreferrer\"\u003Eмикрообзоры Postgres 14 highlights\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Ci\u003EМишеля Пакье\u003C\u002Fi\u003E (Michael Paquier) (5),\u003Cbr\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\" rel=\"nofollow noopener noreferrer\"\u003Eв блоге Fujitsu OSS\u003C\u002Fa\u003E\u003C\u002Fb\u003E (5).\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКроме того есть пространная статья-справочник от HPE: \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fh50146.www5.hpe.com\u002Fproducts\u002Fsoftware\u002Foe\u002Flinux\u002Fmainstream\u002Fsupport\u002Flcc\u002Fpdf\u002FPostgreSQL14Beta1_New_Features_en_20210521-1.pdf?fbclid=IwAR31FmcaXMIOv5jvIkGiiy-lrBLhEW6jggur2zMmUnirPvfDZnwJvNgGsIg\" rel=\"nofollow noopener noreferrer\"\u003EPostgreSQL 14 New Features With Examples (Beta 1)\u003C\u002Fa\u003E\u003C\u002Fb\u003E.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНачнём со статей, в которых авторы стараются охватить версию 14 в целом. Но перед этим разомнёмся \u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ch2\u003Eв облаках и контейнерах\u003C\u002Fh2\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":83,"votesCount":91},"rating":12,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1380392","alias":"Igor_Le","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":0,"favoritesCount":16,"readingCount":2613,"score":11,"votesCount":11},"hubs":[{"relatedData":null,"id":"19663","alias":"postgrespro","type":"corporative","title":"Блог компании Postgres Professional","titleHtml":"Блог компании Postgres Professional","isProfiled":false},{"relatedData":null,"id":"358","alias":"postgresql","type":"collective","title":"PostgreSQL","titleHtml":"PostgreSQL","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzu\u002Fvp\u002Fwh\u002Fzuvpwh7brmwvj_zblctdxovvl4q.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzu\u002Fvp\u002Fwh\u002Fzuvpwh7brmwvj_zblctdxovvl4q.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПресс-релиз PostgreSQL \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Frelease-14.html\"\u003Eобширен и основателен\u003C\u002Fa\u003E. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fabout\u002Fnews\u002Fpostgresql-14-released-2318\u002F\"\u003Eвыделили главное\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСтатей о 14-й много. Мы смотрели и разрозненные статьи и целые сериалы:\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F510124\u002F\"\u003Eобзоры коммитфестов\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Ci\u003EПавла Лузанова\u003C\u002Fi\u003E (5 серий),\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002Ftag\u002Fpg14\u002F\"\u003Ewaiting for PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Ci\u003EХуберта 'depesz' Любашевского\u003C\u002Fi\u003E (18),\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002F\"\u003Eмикрообзоры Postgres 14 highlights\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Ci\u003EМишеля Пакье\u003C\u002Fi\u003E (Michael Paquier) (5),\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\"\u003Eв блоге Fujitsu OSS\u003C\u002Fa\u003E\u003C\u002Fb\u003E (5).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКроме того есть пространная статья-справочник от HPE: \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fh50146.www5.hpe.com\u002Fproducts\u002Fsoftware\u002Foe\u002Flinux\u002Fmainstream\u002Fsupport\u002Flcc\u002Fpdf\u002FPostgreSQL14Beta1_New_Features_en_20210521-1.pdf?fbclid=IwAR31FmcaXMIOv5jvIkGiiy-lrBLhEW6jggur2zMmUnirPvfDZnwJvNgGsIg\"\u003EPostgreSQL 14 New Features With Examples (Beta 1)\u003C\u002Fa\u003E\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНачнём со статей, в которых авторы стараются охватить версию 14 в целом. Но перед этим разомнёмся \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003Eв облаках и контейнерах\u003C\u002Fh2\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fblog.crunchydata.com\u002Fblog\u002Fpostgresql-14-on-kubernetes\"\u003EPostgreSQL 14 on Kubernetes (with examples!)\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"katz\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nДжонатан Кац (Jonathan S. Katz, Crunchy data) показывает, как инсталлировать кранчевский оператор \u003Ca href=\"https:\u002F\u002Faccess.crunchydata.com\u002Fdocumentation\u002Fpostgres-operator\u002Fv5\u002Finstallation\u002F\"\u003EPGO\u003C\u002Fa\u003E (горячо рекомендует с \u003Ca href=\"https:\u002F\u002Faccess.crunchydata.com\u002Fdocumentation\u002Fpostgres-operator\u002Fv5\u002Fquickstart\u002F\"\u003Equickstart\u003C\u002Fa\u003E) и запускает PostgreSQL 14.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле этого в качестве примера он демонстрирует асинхронные запросы к сторонним таблицам — возможность, появившуюся в 14-й версии (через \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Ffdw-callbacks.html#FDW-CALLBACKS-ASYNC\"\u003Epostgres_fdw\u003C\u002Fa\u003E, который научился исполнять запросы параллельно). Он создаёт целых 3 кластера: Носорог-1, Носорог-2 и Гиппопотам, настраивает postgres_fdw на Гиппо, создаём на Носорогах таблички через \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F13\u002Fsql-importforeignschema\"\u003EIMPORT FOREIGN SCHEMA\u003C\u002Fa\u003E (тоже новая фича 14-й) и, наконец, собирая данные с обоих носорогов, убеждается, что данные собираются асинхронно:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"pgsql\"\u003EEXPLAIN ANALYZE SELECT avg(x.stat) FROM (\n  SELECT data['stat']::float AS stat FROM rhino1.stats\n  UNION ALL\n  SELECT data['stat']::float AS stat FROM rhino2.stats\n) x;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"pgsql\"\u003E                                QUERY PLAN                                                                 \n-----------------------------------------------------------------------------------------------------------------\n Aggregate  (cost=424.80..424.81 rows=1 width=8) (actual time=13700.998..13701.000 rows=1 loops=1)\n   -\u003E  Append  (cost=100.00..412.00 rows=5120 width=8) (actual time=2.937..13410.193 rows=4000000 loops=1)\n        -\u003E  Async Foreign Scan on stats  (cost=100.00..193.20 rows=2560 width=8) (actual time=1.394..5337.504 rows=2000000 loops=1)\n        -\u003E  Async Foreign Scan on stats stats_1  (cost=100.00..193.20 rows=2560 width=8) (actual time=1.760..4807.722 rows=2000000 loops=1)\nPlanning Time: 1.019 ms\nExecution Time: 13704.199 ms\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧуть позже Джонатан написал статью-апдейт: с использованием \u003Ca href=\"https:\u002F\u002Fblog.crunchydata.com\u002Fblog\u002Fthe-next-generation-of-kubernetes-native-postgres\"\u003Eвышедшего PGO 5.0\u003C\u002Fa\u003E: \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fblog.crunchydata.com\u002Fblog\u002Fmulti-cluster-postgres-federation-on-kubernetes-with-postgres-14-using-gitops\"\u003EMulti-Cluster Postgres Federation on Kubernetes with Postgres 14 Using GitOps\u003C\u002Fa\u003E\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНеспроста автор придумал пароль для серверов — \u003Cb\u003Edatalake\u003C\u002Fb\u003E. Он явно намекает: для озёр данных такая архитектура годная. Делает он во второй статье вот что:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nсоздаёт на 3 кластерах по 3 секции (используя заодно подтип \u003Ccode\u003Edatemultirange\u003C\u002Fcode\u003E типа \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F14\u002Ffunctions-range\"\u003Emultirange\u003C\u002Fa\u003E, появившегося в 14-й ), чтобы не без изящества автоматически раскладывать по ним данные с соответствующих 3 кластеров. А дальше при помощи логической репликации обустраивает простенький мультимастер — на все 3 ноды пишутся данные и сразу синхронизируются по всем 3 кластерам. Не успокоившись, он «масштабирует» «мультимастер» до 4 узлов — тоже раскладывая данные по полочкам. Это, конечно, только наглядный пример, никакой настоящей гарантии консистентности там нет, но вообще в релизе PostgreSQL 14 аж 10 пунктов \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#replic\"\u003Eотносятся к логической репликации\u003C\u002Fa\u003E. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.citusdata.com\u002Fblog\u002F2021\u002F10\u002F01\u002Fhow-we-shipped-postgres-14-on-azure-within-a-day\u002F\"\u003EHow We Shipped PostgreSQL 14 on Azure Within One Day of its Release\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"citus\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nВ Citus хвалятся тем, что новую версию развернули как \u003Ca href=\"https:\u002F\u002Fdocs.microsoft.com\u002Fru-ru\u002Fazure\u002Fpostgresql\u002Fhyperscale\u002F\"\u003E«Гипермосштабирование»\u003C\u002Fa\u003E в облаках Azure за 1 день — как только был опубликован релиз. \u003Ci\u003EОзгун Эрдоган\u003C\u002Fi\u003E (Sic! — Ozgun Erdogan, Citus Data) пишет о любимых новых фичах 14-й, а они, конечно, связаны с задачами Citus. То есть работают на производительность и параллелизм. Поэтому полюбит их не только Citus.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПрежде всего полюбилось всё, связанное с масштабированием по числу соединений (connection scaling). В компании считают, что самое узкое место PostgreSQL это масштабирование по снеэпшотам. И что их патчи помогли значительно улучшить ситуацию, особенно в случаях, когда в соединениях ничего не делается (\u003Ccode\u003Eidle\u003C\u002Fcode\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТакже компания внесла вклад в ускорение восстановления (в 2.4 раза) и ускорение VACUUM на 25% в случае нагрузок, сильно завязанных на процессор.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСовместимость с PostgreSQL 14 они обеспечили не только для самого \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcitusdata\u002Fcitus\"\u003ECitus\u003C\u002Fa\u003E, но и для других опенсорсных расширений, к которым приложили руку: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcitusdata\u002Fpg_cron\"\u003Epg_cron\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcitusdata\u002Fpostgresql-hll\"\u003Epostgresql-hll\u003C\u002Fa\u003E (HyperLogLog) и \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcitusdata\u002Fpostgresql-topn\"\u003Epostgresql-topn\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EО PostgreSQL 14, едином и неделимом\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.instaclustr.com\u002Fpostgresql-14\u002F\"\u003EPostgreSQL 14: PostgreSQL Is Still a Teenager\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"kirk\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EКирк Ройбол\u003C\u002Fi\u003E (Kirk Roybal, instaclustr) считает, что Postgres повзрослел до тинейджера — или не считает: в первоначальной версии статьи, следы которой есть в интернете, название было \u003Ci\u003E… Is Still a Tweeny\u003C\u002Fi\u003E — то есть ребёнок лет 6-12. Но главная причина его удивления — отсутствие фокуса на каких-то направлениях разработки. \u003Ci\u003EЯ надеялся\u003C\u002Fi\u003E — говорит Кирк — \u003Ci\u003Eуслышать что-то ошарашивающее, вроде \u003C\u002Fi\u003EVACUUM больше не нужен!\u003Ci\u003E Услышал же я, что \u003C\u002Fi\u003Eмножество людей приложило громадные усилия, чтобы улучшить вещи, которые надо было улучшить.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОб этих многочисленных, но не достаточно радикальных (для него) изменениях Кирк и говорит, демонстрируя наблюдательность и взгляд немного под другим углом, чем у многих других. Кажется, это действительно незамыленный взгляд, хотя, по многим пунктам его голос звучит в унисон с голосами, которые мы дальше цитируем. Самым ярким достижением 14-й он считает резкое улучшение масштабируемости по соединениям, когда число соединений переваливает через 5000. Хотя VACUUM и не отменили, но улучшения его, оставшиеся под капотом, он считает, были из самых востребованных сообществом. О некоторых других его соображениях мы упомянем в соответствующем контексте. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНовый GUC — \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Fruntime-config-statistics.html#GUC-COMPUTE-QUERY-ID\"\u003Ecompute_query_id\u003C\u002Fa\u003E — тоже упомянут. Он позволяет, когда включён, получать id запроса даже без обращения к \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F14\u002Fpgstatstatements\"\u003Epg_stat_statements\u003C\u002Fa\u003E. id запроса вычисляется средствами ядра. Посмотреть его можно и в \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F14\u002Fmonitoring-stats#MONITORING-PG-STAT-ACTIVITY-VIEW\"\u003Epg_stat_activity\u003C\u002Fa\u003E, откуда его берёт EXPLAIN. Или его можно сбросить в лог если сконфигурирован параметр \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F14\u002Fruntime-config-logging#GUC-LOG-LINE-PREFIX\"\u003Elog_line_prefix\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОб этом целая статья \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#query_id\"\u003Eниже\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fmomjian.us\u002Fmain\u002Fwritings\u002Fpgsql\u002Ffeatures.pdf\"\u003EMajor Features: Postgres 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот PDF \u003Ci\u003EБрюса Момджана\u003C\u002Fi\u003E (Bruce Momjian, EDB) — коротенькая презентация. Стоящая внимания: по каждому из пунктов всего-то по схемке (только к btree-индексам — 3), зато они очень наглядные.\u003Col\u003E\r\n\u003Cli\u003Eпредотвращение распухания btree-индексов;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eулучшения в индексах BRIN;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eмасштабирование снэпшотов;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eглобальный id запроса;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eidle_session_timeout;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eроли для операций read-only и write-only;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eулучшения в оптимизаторе;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eпараллельное сканирование сторонних таблиц.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EМатрица\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЛюбопытная картина складывается, если глянуть на \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fabout\u002Ffeaturematrix\u002F\"\u003Eматрицу фич\u003C\u002Fa\u003E. Пожалуй, это иллюстрация того, как иногда картина крупными мазками не слишком адекватна реальности.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EСтатистика коммитфестов\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.highgo.ca\u002F2021\u002F06\u002F28\u002Fsome-interesting-statistics-about-pg-14-contributions\u002F\"\u003ESome Interesting statistics about PG-14 contributions\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"ahsan\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EАсан Хади\u003C\u002Fi\u003E (Ahsan Hadi) из HighGo (вице-президент по разработкам, был старшим директором по продукту Postgres Plus Advanced Server в EDB) решил собрать статистику по коммитам в PostgreSQL 14. Дело доброе: до него этим любил побаловаться Роберт Хаас (Robert Haas), но он считал по годам.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА вот \u003Cb\u003Eего выбор\u003C\u002Fb\u003E: \u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Etop7 фич PostgreSQL 14\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E1. \u003Ca href=\"https:\u002F\u002Fcommitfest.postgresql.org\u002F32\u002F2491\u002F\"\u003EAsynchronous execution of PostgreSQL_FDW Append node\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n2. \u003Ca href=\"https:\u002F\u002Fcommitfest.postgresql.org\u002F29\u002F2500\u002F\"\u003E Improving connection scalability: GetSnapshotData()\u003C\u002Fa\u003E \u003Ci\u003E[это правильная ссылка, в статье \u003C\u002Fi\u003EАсана\u003Ci\u003E Some Interesting… — битая]\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n3. \u003Ca href=\"https:\u002F\u002Fcommitfest.postgresql.org\u002F32\u002F2575\u002F\"\u003EOverhaul UPDATE\u002FDELETE processing (making update\u002Fdelete of inheritance trees scale better\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n4. \u003Ca href=\"https:\u002F\u002Fcommitfest.postgresql.org\u002F29\u002F1927\u002F\"\u003E logical streaming for large in-progress transactions\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n5. \u003Ca href=\"https:\u002F\u002Fcommitfest.postgresql.org\u002F31\u002F2112\u002F\"\u003EAdd support for multirange data types\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n6. \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fmessage-id\u002Fflat\u002FCAH2-Wzm+maE3apHB8NOtmM=p-DO65j2V5GzAWCOEEuy3JZgb2g@mail.gmail.com\"\u003EAllow btree index additions to remove expired index entries to prevent page splits\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n7. \u003Ca href=\"https:\u002F\u002Fcommitfest.postgresql.org\u002F31\u002F2620\u002F\"\u003EPostgreSQL_FDW Batching\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНу а \u003Ci\u003EДеврим Гюндюз\u003C\u002Fi\u003E (Devrim Gündüz) поможет\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003Eустановить 14-ю версию из rpm\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpeople.planetpostgresql.org\u002Fdevrim\u002Findex.php?\u002Farchives\u002F115-Installing-PostgreSQL-14-betaRC-on-RHEL-Rocky-Linux-Fedora-and-SLES.html\"\u003EInstalling PostgreSQL 14 beta\u002FRC on RHEL \u002F Rocky Linux \u002F Fedora and SLES\u003C\u002Fa\u003E\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EПроизводительность\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.highload.ru\u002Fspring\u002F2021\u002Fabstracts\u002F6542\"\u003EPostgres 14 и высокие нагрузки\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто видео и презентация \u003Ci\u003EИвана Панченко\u003C\u002Fi\u003E (зам. гендира Postgres Professional) на весеннем \u003Ca href=\"https:\u002F\u002Fwww.highload.ru\u002Fspring\u002F2021\u002Fabstracts\u002F6542\"\u003EHighload++\u003C\u002Fa\u003E в Крокусе-Экспо. Первым пунктом у Ивана стоит \u003Ci\u003Eповышение масштабируемости по\u003Cbr\u002F\u003E\r\nконнектам\u003C\u002Fi\u003E. Второе и третье места заняли \u003Ci\u003Eвосходящее удаление (bottom-up delition)\u003C\u002Fi\u003E и \u003Ci\u003EАсинхронный APPEND\u003C\u002Fi\u003E соответственно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМежду прочим, в своём интервью \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpostgresql.life\u002Fpost\u002Fivan_panchenko\u002F?fbclid=IwAR18aBPNqSi18CVaHZ3_cJTn55J593LZXkqSAsSOrn1C3Qu8B2MZkgx2RWc\"\u003Eв качестве Персоны недели\u003C\u002Fa\u003E\u003C\u002Fb\u003E Иван на вопрос о любимой фиче отвечает:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003EМного полезных и важных фич — что в 13-й, что в 14-й — но ни одна из них не выглядит наиболее важной в сравнении с другими.\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n(Но почитайте всё интервью: там есть даже про собаку и блоху, объясняющих, \u003Ca href=\"https:\u002F\u002Fwww.labirint.ru\u002Fbooks\u002F799209\u002F\"\u003Eкак устроено Солнце\u003C\u002Fa\u003E)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpganalyze.com\u002Fblog\u002Fpostgres-14-performance-monitoring\"\u003EAn early look at Postgres 14: Performance and Monitoring Improvements\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003EЛукас Фиттл\u003C\u002Fi\u003E (Lukas Fittl, pgAnalyze), как и Иван, как и Citus, говорит прежде всего о масштабировании активных и свободных соединений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОчень понравилось ему новое представление \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002Fdevel\u002Fview-pg-backend-memory-contexts.html\"\u003Epg_backend_memory_contexts\u003C\u002Fa\u003E и функция \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Ffunctions-admin.html\"\u003Epg_log_backend_memory_contexts()\u003C\u002Fa\u003E, которые дают возможность заглянуть в память, чтобы понять, какое соединение сжирает больше всего памяти. Другая полезная вещь для диагностики — представление \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Fmonitoring-stats.html\"\u003Epg_stat_wal\u003C\u002Fa\u003E. И очень автору понравилось, что \u003Ccode\u003Eguery_id\u003C\u002Fcode\u003E, которое было в любимом дотошными админами представлении \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F13\u002Fpgstatstatements\"\u003Epg_stat_statements\u003C\u002Fa\u003E, теперь можно использовать и в представлении \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fpostgresql\u002F13\u002Fmonitoring-stats#MONITORING-PG-STAT-ACTIVITY-VIEW\"\u003Epg_stat_activity\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nО коннектах есть и у Депеша в \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F08\u002F25\u002Fwaiting-for-postgresql-14-improvements-for-handling-large-number-of-connections\u002F\"\u003EWaiting for PostgreSQL 14 – Improvements for handling large number of connections\u003C\u002Fa\u003E\u003C\u002Fb\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДепеш приводит список из 7 ссылок на патчи, которые должны обеспечить масштабируемость соединений. Сам он не тестировал, но в комментариях есть \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fdigoal\u002Fblog\u002Fblob\u002Fmaster\u002F202008\u002F20200817_01.md\"\u003Eссылка на тесты\u003C\u002Fa\u003E. По ссылке немало иероглифов, но, вроде, ясно, что на 5000 соединений 14-й выиграл у 13-го 37% на TPS.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EМониторинг и «прозрачность»\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ упомянутой \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#kirk\"\u003Eстатье Кирка\u003C\u002Fa\u003E \u003Ci\u003Eпрозрачность\u003C\u002Fi\u003E (переведу таким вольным образом \u003Cb\u003E\u003Ci\u003Evisibility\u003C\u002Fi\u003E\u003C\u002Fb\u003E) отобразилась в виде \u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eогромного списка (15 пунктов):\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E \u003Cul\u003E\r\n\u003Cli\u003EСтатус операции COPY появился в \u003Ccode\u003Epg_stat_progress_copy\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСтатус WAL в \u003Ccode\u003Epg_stat_wal\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСтатус репликации в \u003Ccode\u003Epg_stat_replication_slots\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСтатус обработки запроса бэкендом в \u003Ccode\u003Epg_backend_memory_contexts\u003C\u002Fcode\u003E (его также можно сбросить в лог, используя \u003Ccode\u003Epg_log_backend_memory_contexts\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНовые колонки в \u003Ccode\u003Epg_stat_database\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EАрхиватор в \u003Ccode\u003Epg_stat_activity\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ \u003Ccode\u003Epg_locks\u003C\u002Fcode\u003E добавлено время начала ожидания блокировки (lock wait start time).\u003C\u002Fli\u003E\r\n\u003Cli\u003EДобавлено представление \u003Ccode\u003Eroutine_column_usage\u003C\u002Fcode\u003E в \u003Ccode\u003Einformation_schema\u003C\u002Fcode\u003E для отслеживания колонок, на которые ссылаются в выражениях по умолчанию у функций или процедур.\u003C\u002Fli\u003E\r\n\u003Cli\u003EДобавлено \u003Ccode\u003E%P\u003C\u002Fcode\u003E к \u003Ccode\u003Elog_line_prefix\u003C\u002Fcode\u003E, чтобы виден был PID лидера группы.\u003C\u002Fli\u003E\r\n\u003Cli\u003EДобавлен серверный параметр \u003Ccode\u003Elog_recovery_conflict_waits\u003C\u002Fcode\u003E для отчётов о долгих временах разрешения конфликтов при восстановлении (to report long recovery conflict wait times).\u003C\u002Fli\u003E\r\n\u003Cli\u003EФункция \u003Ccode\u003Epg_get_wal_replay_pause_state()\u003C\u002Fcode\u003E для отчётов о состоянии восстановления.\u003C\u002Fli\u003E\r\n\u003Cli\u003EФункция \u003Ccode\u003Epg_xact_commit_timestamp_origin()\u003C\u002Fcode\u003E, возвращающая timestamp коммитта и источника репликации заданной транзакции.\u003C\u002Fli\u003E\r\n\u003Cli\u003EК записи, возвращаемой \u003Ccode\u003Epg_last_committed_xact()\u003C\u002Fcode\u003E добавлен источник репликации.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Epg_stat_statements\u003C\u002Fcode\u003E теперь отслеживает инструкции верхнего уровня и вложенные инструкции отдельно.\u003C\u002Fli\u003E\r\n\u003Cli\u003EДля некоторых утилит добавлены кумулятивные флаги –verbose (-vvv) для вывода на экран\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nОднако список \u003Ci\u003EАлексея Лесовского\u003C\u002Fi\u003E ещё больше: 17 пунктов — \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F558792\u002F\"\u003EЧто нового в плане мониторинга в PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ это не просто перечисление, некоторые пункты сопровождаются примерами кода, а некоторые даже эмоциями:\u003Cbr\u002F\u003E\r\n\u003Ci\u003EНовое представление pg_backend_memory_contexts — одно из нововведений, которое вызвало у меня противоречивые эмоции… как мне кажется, разработчики перемудрили — достаточно было бы сделать только одну эту [\u003Ccode\u003Epg_log_backend_memory_contexts()\u003C\u002Fcode\u003E] функцию (без вьюхи) которая бы принимала идентификатор процесса, но при этом вместо логирования, выводила бы статистику в виде строк.\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002Fpostgresql-2\u002Fpostgres-14-monitoring-copy\u002F\"\u003EMonitoring for COPY\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВозможность мониторинга операции COPY привлекла внимание \u003Ci\u003EМишеля Пакье\u003C\u002Fi\u003E (Michael Paquier). COPY TO и COPY FROM нередко занимают много времени, поэтому возможность посмотреть, как идут дела с копированием, не прихоть. В новом системном представлении \u003Ccode\u003Epg_stat_progress_copy\u003C\u002Fcode\u003E по одной строке с 8 полями (в статье есть подробности) на каждый бэкенд.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\ndepesz в своих waiting-ах тоже не прошёл мимо COPY: \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F01\u002F12\u002Fwaiting-for-postgresql-14-report-progress-of-copy-commands\u002F\"\u003EReport progress of COPY commands\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОн предупреждает, между прочим, что общее количество байтов в некоторых случаях недоступно — когда ввод идёт с клиента, например.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"query_id\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fblog.rustprooflabs.com\u002F2021\u002F10\u002Fpostgres-14-query-id\"\u003EUsing Query ID in Postgres 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E — этому параметру статью посвятили RustProoflabs. \u003Ci\u003EРайан Лэмберт\u003C\u002Fi\u003E (Ryan Lambert) запускает \u003Cb\u003Epgbench\u003C\u002Fb\u003E и сначала смотрит id в \u003Ccode\u003Epg_stat_statements\u003C\u002Fcode\u003E (для такой возможности \u003Ccode\u003Ecompute_query_id\u003C\u002Fcode\u003E надо установить в \u003Ccode\u003Epostgresql.conf\u003C\u002Fcode\u003E в \u003Ccode\u003Eauto\u003C\u002Fcode\u003E или \u003Ccode\u003Eon\u003C\u002Fcode\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле этого Райан открывает параллельно 3 сессии: в двух он сталкивает UPDATE-транзакции так, что вторая натыкается на блокировку первой и висит, а в третьей он запускает запрос к \u003Ccode\u003Epg_stat_statments\u003C\u002Fcode\u003E и \u003Ccode\u003Epg_stat_activity\u003C\u002Fcode\u003E. И убеждается, что так удаётся выловить запрос, который выполняется дольше предыдущих и так и не завершён. Затем Райан демонстрирует два оставшихся способа использования guery_id: в EXPLAIN и в логах, не умолчав о некоторой принципиально нерешаемой (но не слишком критичной) \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Flist\u002Fthread-id\u002F2432133#CA+8PKvQnMfOE-c3YLRwxOsCYXQDyP8VXs6CDtMZp1V4=D4LuFA@mail.gmail.com\"\u003Eпроблеме\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EVACUUM\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nХорошо \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#kirk\"\u003Eсказал выше Кирк\u003C\u002Fa\u003E, мол, революции не произошло — VACUUM жив, — но под капотом поменялось немало. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nАнализ прочитанного на эту тему показал, что наиболее толковое описание улучшений, связанных с VACUUM, удалось сделать нашему \u003Ci\u003EПавлу Лузанову\u003C\u002Fi\u003E :) в его 5-й серии \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F550632\u002F\"\u003EЗаморозки\u003C\u002Fa\u003E\u003C\u002Fb\u003E обзоров коммитфестов. Там и много (но концентрированно), и примеры есть. Как, впрочем, и в других его аналогичных обзорах — обзор без VACUUM это каша без соли.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДавно идут разговоры, что VACUUM нужно сделать более \u003Ci\u003Eагрессивным\u003C\u002Fi\u003E (и был даже \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fmessage-id\u002Fflat\u002Fa6b9a97b4b1dfcb61b6e3ccd66566d2da005eac3.camel%40cybertec.at#7f962359f30d8e96a00672734cbb0500\"\u003Eберсерк-автовакуум\u003C\u002Fa\u003E, предложенный \u003Ci\u003EДорофеем 'Котярой' Пролесковским\u003C\u002Fi\u003E) — как экстренную меру, когда счётчики xid или multixact приближаются к wraparound. В PostgreSQL 14 в этом случае откладываются до лучших времён чистки индексов, уступая дорогу вакууму. Поведение его управляется константами \u003Ccode\u003Evacuum_failsafe_age\u003C\u002Fcode\u003E и \u003Ccode\u003Evacuum_multixact_failsafe_age\u003C\u002Fcode\u003E. Но подробных разборов этих ситуаций мы пока не нашли.\u003Cbr\u002F\u003E\r\n(Напомним, что о 64-разрядных идентификаторах транзакций говорят давно, но пока они есть \u003Ca href=\"https:\u002F\u002Fpostgrespro.ru\u002Fdocs\u002Fenterprise\u002F13\u002Fintro-pgpro-vs-pg\"\u003Eтолько\u003C\u002Fa\u003E в коммерческой версии — Postgres Pro Enterprise.)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВыше в Citus \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#citus\"\u003Eхвалились\u003C\u002Fa\u003E, что ускорили VACUUM на 25% своими патчами. Но об этом (и о восстановлении) у них была и целая статья, которую мы \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F545796#citus\"\u003Eупоминали ещё в Postgresso 30\u003C\u002Fa\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.citusdata.com\u002Fblog\u002F2021\u002F03\u002F25\u002Fspeeding-up-recovery-and-vacuum-in-postgres-14\u002F\"\u003ESpeeding up recovery &amp; VACUUM in Postgres 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто статья о патче Citus в основную ветку PostgreSQL, написанная (как и сам \u003Ca href=\"https:\u002F\u002Fgit.postgresql.org\u002Fgitweb\u002F?p=postgresql.git;a=commit;h=19c60ad69a91f346edf66996b2cf726f594d3d2b\"\u003Eпатч\u003C\u002Fa\u003E) Дэвидом Роули (David Rowley), работавшим над этим уже внутри Microsoft. Он переписал внутреннюю функцию \u003Ccode\u003Ecompactify_tuples\u003C\u002Fcode\u003E, которая используется, когда PostgreSQL стартует после внештатного (нечистого) шатдауна (crash recovery), и когда идёт восстановление standby-сервера проигрыванием WAL по их прибытии с primary-сервера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭти случаи Дэвид и расписывает, поясняя схемами. Новая версия функции избавляет от ненужной внутренней сортировки кортежей в \u003Ccode\u003Eheap\u003C\u002Fcode\u003E, поэтому и работает быстрее.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EFDW\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nЭта тема вызвала немало откликов. Прежде всего заинтересовались те, кто движется в сторону шардинга и вообще распараллеливания вычислений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#ahsan\"\u003Eстатье\u003C\u002Fa\u003E, которая выше, \u003Ci\u003EАсан Хади\u003C\u002Fi\u003E ставит FDW на первое место в своём списке достижений Postgres 14. И напомним, что \u003Ci\u003EДжонатан Кац\u003C\u002Fi\u003E \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F581552#katz\"\u003Eвыбрал\u003C\u002Fa\u003E асинхронную работу FDW для своего кубернетного примера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ \u003Ca href=\"https:\u002F\u002Fwww.postgresonline.com\u002F\"\u003EPostgres OnLine Journal\u003C\u002Fa\u003E пишут об FDW для Windows: \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresonline.com\u002Fjournal\u002Findex.php?\u002Farchives\u002F402-PostgreSQL-14-64-bit-for-Windows-FDWs.html\"\u003EPostgreSQL 14 64-bit for Windows FDWs\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРечь о бинарниках \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fadunstan\u002Ffile_text_array_fdw\"\u003Efile_text_array_fdw\u003C\u002Fa\u003E\u003C\u002Fb\u003E и \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FCartoDB\u002Fodbc_fdw\"\u003Eodbc_fdw\u003C\u002Fa\u003E\u003C\u002Fb\u003E для PostgreSQL 14 под 64-бытные Windows.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.percona.com\u002Fblog\u002F2021\u002F06\u002F02\u002Fpostgres_fdw-enhancement-in-postgresql-14\u002F\"\u003Epostgres_fdw Enhancement in PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003EИбрар Ахмед\u003C\u002Fi\u003E (Ibrar Ahmed, Percona) демонстрирует достижения в PostgreSQL 14 по части FDW на примерах.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EТипы (новорожденный и старички)\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresonline.com\u002Fjournal\u002Findex.php?\u002Farchives\u002F401-Multirange-types-in-PostgreSQL-14.html\"\u003EMultirange Types in Postgres 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003EДжонатан Кац\u003C\u002Fi\u003E (Jonathan S. Katz, Crunchy Data) пишет о \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002F14\u002Frangetypes.html#RANGETYPES-BUILTIN\"\u003Eмультидиапазонах\u003C\u002Fa\u003E (multirange) — в PostgreSQL 14 именно они упростили ему и упростят многим их SQL-жизнь: приводит пример «из жизни» — с бронированием встреч. Действительно всего 3 строчки нужно для того, чтобы посмотреть, какие дни свободны. Сначала, конечно, надо забить необходимые данные в таблицу, но сложный рекурсивный запрос не потребуется.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПро \u003Ci\u003Eмультидиапазонные типы данных\u003C\u002Fi\u003E довольно развёрнуто пишет и \u003Ci\u003EПавел Лузанов\u003C\u002Fi\u003E в \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F541252#commit_6df7a969\"\u003E4-й части\u003C\u002Fa\u003E коммитфест-обзоров.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F12\u002F21\u002Fwaiting-for-postgresql-14-multirange-datatypes\u002F\"\u003EMultirange datatypes\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n \u003Cbr\u002F\u003E\r\nВ этой заметке Депеш не удовлетворился демонстрационным примером — как создавать колонки multirange и как выглядят результаты запросов к ним, — а решил разобраться, что с индексами для нового типа. \u003Ccode\u003Ebtree\u003C\u002Fcode\u003E можно создать и использовать для простеньких SELECT. Но depesz хотелось большего — операторов вроде \u003Ccode\u003E@\u003E\u003C\u002Fcode\u003E, а вот с этим пока никак. \u003Ccode\u003Egist\u002Fspgist\u003C\u002Fcode\u003E и \u003Ccode\u003Egin\u003C\u002Fcode\u003E тоже отложили на будущее. В комментариях к статье автор патча, \u003Ci\u003EАлександр Коротков\u003C\u002Fi\u003E, пояснил, что и \u003Ccode\u003Ebtree\u003C\u002Fcode\u003E пока работает так, как будто дыр между диапазонами нет, используя код для обычных \u003Ccode\u003Erange\u003C\u002Fcode\u003E, без \u003Ccode\u003Emulti\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fblog.crunchydata.com\u002Fblog\u002Fpostgres-14-its-the-little-things\"\u003EPostgres 14: It's The Little Things\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТипы \u003Ccode\u003EJSON\u002FJSONB\u003C\u002Fcode\u003E уже в возрасте, а новость в удобном синтаксисе. \u003Ci\u003EКрейг Кирстинс\u003C\u002Fi\u003E (Creig Kirstiens, Crunchy Data) радуется синтаксису с индексной нотацией \u003Cb\u003EJSON\u003C\u002Fb\u003E (JSON subscripting) — она простая, наглядная, интуитивная. Надо было писать так:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"pgsql\"\u003EWHERE details-\u003E'attributes'-\u003E\u003E'color' = 'neon yellow'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nа теперь можно так:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"pgsql\"\u003EWHERE details['attributes']['color'] = '\"neon yellow\"'\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003EЛузанов\u003C\u002Fi\u003E \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostgrespro\u002Fblog\u002F541252#commit_c7aba7c1\"\u003Eпоясняет\u003C\u002Fa\u003E интенции разработчиков более технологично и более исторично: \u003Ci\u003Eс идеи сделать поддержку индексной нотации для json начался длинный путь [с зимы 2017] работы над \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fmessage-id\u002Fflat\u002F20200801143334.d7d3tsb7gaezx6vq%40localhost#61fae982900fdfa283a665c63e93a8c3\"\u003Eэтим патчем\u003C\u002Fa\u003E \u003C\u002Fi\u003EДмитрия Долгова\u003Ci\u003E. И вот спустя несколько лет такая поддержка появилась. Первый патч создает необходимую инфраструктуру индексной нотации для произвольных типов данных. Второй патч добавляет индексную нотацию к типу \u003Cb\u003Ehstore\u003C\u002Fb\u003E, а третий ― к типу JSONB. Теперь вместо специальных функций и операторов можно извлекать необходимые части из JSON-значения. Найдем телефон в контактных данных одного из билетов:\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"pgsql\"\u003ESELECT contact_data, contact_data['phone'] AS phone;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА можно ещё посмотреть статью самого \u003Ci\u003EДмитрия Долгова\u003C\u002Fi\u003E \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Ferthalion.info\u002F2021\u002F03\u002F03\u002Fsubscripting\u002F\"\u003EHow many engineers does it take to make subscripting work?\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EБэкап и репликация\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\"\u003E блоге Fujitsu\u003C\u002Fa\u003E\u003C\u002Fb\u003E обсуждались не все новшества 14-й версии, а те, в разработке которых Fujitsu OSS принимала участие. Они существенные.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\u002Flogical-decoding-of-two-phase-commits\"\u003ELogical decoding of two-phase commits in PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nPostgreSQL поддерживает двухфазные транзакции аж с версии 8.0, а логическую репликацию с 10.0, но двухфазные коммиты до этого не поддерживались логической репликацией. Команды PREPARE TRANSACTION, COMMIT PREPARED и ROLLBACK PREPARED поддерживались на уровне инстанса, но их не могли корректно декодировать при передаче на реплику. Теперь всё работает. Изменились плагин \u003Cb\u003Etest_decoding\u003C\u002Fb\u003E и API.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EДРУГИЕ ФИЧИ В БЛОГЕ FUJITSU (ссылки)\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\u002Fimproved-logging-by-libpq-in-postgresql-14\"\u003EImproved logging by libpq in PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\u002Fenhancement-to-target-session-attrs\"\u003EEnhancements to the target_session_attrs database connection parameter in PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.postgresql.fastware.com\u002Fblog\u002Fspeeding-up-recovery-by-optimizing-dropping-of-relation-buffers\"\u003ESpeeding up recovery by optimizing the dropping of relation buffers – Sneak peek on features committed in PostgreSQL 14\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EДРУГИЕ МИКРООБЗОРЫ МИШЕЛЯ ПАКЬЕ\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002Fpostgresql-2\u002Fpostgres-14-memory-dumps\u002F\"\u003EMemory dumps\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nPostgreSQL работает с памятью в рамках программной архитектуры контекстов. Представление pg_backend_memory_contexts позволяет заглядывать в память, доступную сессии, не используя дебаггер, (это особенно полезно в облачных средах) начиная с TopMemoryContext и спускаясь по деревьям. Это можно сделать не только от суперюзера, но и от ролей, которым это дозволено по GRANT. Кроме того, добавлена одноименная функция pg_backend_memory_contexts(), которая может заглядывать и в чужие сессии (она только под суперюзером). Значения не возвращаются клиенту, а сбрасываются в лог.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002Fpostgresql-2\u002Fpostgres-14-reindex-tbspace\u002F\"\u003EREINDEX TABLESPACE\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто значит, что индекс можно перемещать CONCURRENTLY, так как индекс можно перестраивать, перемещая в другое табличное пространство, а не в два этапа: перестройка, потом перемещение — меньше вероятность, что пространства не хватит. При этом разрешая одновременное чтение и запись во время переиндексации, поскольку операция накладывает блокировку SHARE UPDATE EXCLUSIVE на индекс и родительскую таблицу. Подобная судьба (добавка CONCURRENTLY) ждала CLUSTER и VACUUM FULL, но не дождалась: релиз вышел.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002Fpostgresql-2\u002Fpostgres-14-hashes\u002F\"\u003EFun with Hashes\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗдесь даже есть небольшой исторический экскурс в криптографию Postgres.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpaquier.xyz\u002Fpostgresql-2\u002Fpostgres-14-table-compression\u002F\"\u003ECREATE TABLE COMPRESSION\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТоже с историей вопроса. Сейчас SET COMPRESSION можно задать как lz4. По умолчанию GUC default_toast_compression = «pglz».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИнтересная ситуация с репликацией: при физической репликации можно проигрывать на реплике WALы ведущего сервера, сжатые LZ4, даже если реплика не поддерживает LZ4. Но прочитать данные из таких таблиц не получится: Postgres выдаст ошибку. При логический репликации на каждом сервере всё будет сжато в соответствии с настройками сервера.\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nС Depesz не просто: уж больно он \u003Ci\u003Eprolific\u003C\u002Fi\u003E, так сказать, в своих \u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002Ftag\u002Fpg14\u002F\"\u003EWaiting for PostgreSQL 14\u003C\u002Fa\u003E. 18 заметок обозреть не можем, поэтому\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eпросто ссылки.\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F04\u002F01\u002Fwaiting-for-postgresql-14-add-unistr-function\u002F\"\u003EAdd unistr function\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F04\u002F01\u002Fwaiting-for-postgresql-14-add-pg_database_owner-default-role\u002F\"\u003EAdd «pg_database_owner» default role.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F03\u002F31\u002Fwaiting-for-postgresql-14-add-date_bin-function\u002F\"\u003EAdd date_bin function\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F03\u002F22\u002Fwaiting-for-postgresql-14-allow-configurable-lz4-toast-compression\u002F\"\u003EAllow configurable LZ4 TOAST compression.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F02\u002F04\u002Fwaiting-for-postgresql-14-search-and-cycle-clauses\u002F\"\u003ESEARCH and CYCLE clauses\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F01\u002F18\u002Fwaiting-for-postgresql-14-add-pg_stat_database-counters-for-sessions-and-session-time\u002F\"\u003EAdd pg_stat_database counters for sessions and session time\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2021\u002F01\u002F12\u002Fwaiting-for-postgresql-14-add-idle_session_timeout\u002F\"\u003EAdd idle_session_timeout.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F12\u002F21\u002Fwaiting-for-postgresql-14-pg_stat_statements-track-time-at-which-all-statistics-were-last-reset\u002F\"\u003Epg_stat_statements: Track time at which all statistics were last reset.\u003C\u002Fa\u003E\u003C\u002Fb\u003E \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F12\u002F20\u002Fwaiting-for-postgresql-14-allow-subscripting-of-hstore-values\u002F\"\u003EAllow subscripting of hstore values.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F11\u002F19\u002F3851\u002F\"\u003EProvide the OR REPLACE option for CREATE TRIGGER.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F11\u002F18\u002Fwaiting-for-postgresql-14-support-negative-indexes-in-split_part\u002F\"\u003ESupport negative indexes in split_part().\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F10\u002F05\u002Fwaiting-for-postgresql-14-support-for-out-parameters-in-procedures\u002F\"\u003ESupport for OUT parameters in procedures\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F09\u002F08\u002Fwaiting-for-postgresql-14-add-support-for-partitioned-tables-and-indexes-in-reindex\u002F\"\u003EAdd support for partitioned tables and indexes in REINDEX\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F08\u002F24\u002Fwaiting-for-postgresql-14-pg_stat_statements-track-number-of-rows-processed-by-some-utility-commands\u002F\"\u003Epg_stat_statements: track number of rows processed by some utility commands.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fwww.depesz.com\u002F2020\u002F07\u002F27\u002Fwaiting-for-postgresql-14-rename-wal_keep_segments-to-wal_keep_size\u002F\"\u003ERename wal_keep_segments to wal_keep_size.\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EЗадавайте вопросы\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ смысле здесь, а ещё лучше и на докладе \u003Ci\u003EПавла Лузанова\u003C\u002Fi\u003E \u003Cb\u003E\u003Ca href=\"https:\u002F\u002Fpgconf.ru\u002F202110\u002F309791\"\u003EPostgreSQL 14. Финальный обзор\u003C\u002Fa\u003E\u003C\u002Fb\u003E, который можно будет послушать на \u003Ca href=\"https:\u002F\u002Fpgconf.ru\u002F\"\u003EPGConf.Russia 2021\u003C\u002Fa\u003E, которая состоится назло вирусу (но с QR- и экспресс ПЦР-тестами) 25-26-го октября.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"postgresql"},{"titleHtml":"postgres"},{"titleHtml":"dbms"},{"titleHtml":"rdbms"},{"titleHtml":"data bases"},{"titleHtml":"субд"},{"titleHtml":"рсубд"},{"titleHtml":"базы данных"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F581552\u002Fefc58a2fb1188084dafaa26c19ca55b3\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F581552\u002Fefc58a2fb1188084dafaa26c19ca55b3\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fpostgrespro\\\u002Fblog\\\u002F581552\\\u002F\"},\"headline\":\"Postgresso 35 — спецвыпуск: PostgreSQL 14\",\"datePublished\":\"2021-10-24T00:03:46+03:00\",\"dateModified\":\"2021-10-25T00:22:29+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Igor_Le\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.  Статей о 14-й много...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fpostgrespro\\\u002Fblog\\\u002F581552\\\u002F#post-content-body\",\"about\":[\"c_postgrespro\",\"h_postgresql\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzu\\\u002Fvp\\\u002Fwh\\\u002Fzuvpwh7brmwvj_zblctdxovvl4q.jpeg\"]}","metaDescription":"Пресс-релиз PostgreSQL обширен и основателен. Есть и выжимка (highlights), в которой после бурных обсуждений в рассылках выделили главное.\r\n\r\nСтатей о 14-й много. Мы смотрели и разрозненные статьи...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"postgrespro":{"alias":"postgrespro","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F4e0\u002F339\u002F621\u002F4e0339621abc865fefb88f9e9f44748f.jpg","titleHtml":"Postgres Professional","descriptionHtml":"Разработчик СУБД Postgres Pro","relatedData":null,"statistics":{"postsCount":152,"newsCount":0,"vacanciesCount":0,"employeesCount":22,"careerRating":null,"subscribersCount":41953,"rating":214.71,"invest":null},"foundationDate":{"year":"2015","month":"01","day":"27"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Fwww.postgrespro.ru\u002F","staffNumber":"51–100 человек","registrationDate":"2015-09-30T07:41:09+00:00","representativeUser":{"alias":"x-wao","fullname":"Иван Панченко"},"contacts":[{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002FPostgresProfessional"},{"title":"Twitter","url":"https:\u002F\u002Ftwitter.com\u002FPostgresPro"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fpublic101507899"},{"title":"Google+","url":"https:\u002F\u002Fplus.google.com\u002F+PostgresproRuCompany"},{"title":"LiveJournal","url":"https:\u002F\u002Fpostgrespro.livejournal.com\u002F"}],"settings":{"analyticsSettings":[{"type":"ga","trackingId":"UA-55152600-4"}],"branding":null,"status":"active"},"metadata":{"titleHtml":"Postgres Professional, Москва - Разработчик СУБД Postgres Pro с 27 января 2015 г.","title":"Postgres Professional, Москва - Разработчик СУБД Postgres Pro с 27 января 2015 г.","keywords":["PostgreSQL","SQL","Занимательные задачки","Конференции","Администрирование баз данных"],"descriptionHtml":"152 статьи от авторов компании Postgres Professional","description":"152 статьи от авторов компании Postgres Professional"},"aDeskSettings":null,"careerAlias":"postgrespro","maxCustomTrackerLinks":0}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
