<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Реле Давления v2.0 — revival / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/581288\/"},"headline":"Реле Давления v2.0 — revival","datePublished":"2021-10-12T07:00:02+03:00","dateModified":"2021-10-13T14:12:00+03:00","author":{"@type":"Person","name":"Alex Bogdanovich"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле...","url":"https:\/\/habr.com\/ru\/post\/581288\/#post-content-body","about":["h_controllers","h_home_automation","h_DIY","f_develop","f_popsci"],"image":["https:\/\/habr.com\/share\/publication\/581288\/bab947b6ff0745c326cef3d786f80e09\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/60a\/3fb\/c7f\/60a3fbc7f60147c776415fac87ad1822.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/17a\/1f3\/5a5\/17a1f35a556a8374bccef6ae64023a4e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/b75\/414\/436\/b75414436179659da18b9f0f5f8a233a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/2ae\/5ab\/e0f\/2ae5abe0f06a19f99767ebeb66ab5cc9.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/0ea\/682\/102\/0ea68210283ab09bb79d4d991b44fe57.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4ec\/9d2\/973\/4ec9d2973a363cd77265ef599dfd9a82.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/061\/141\/44f\/06114144ffa59e1d244e1c164feaead4.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/71b\/a24\/ca1\/71ba24ca1ccc64942263e85f751ea768.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/049\/0dd\/305\/0490dd3055d50dba4886dc6a3dfacfc3.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/606\/aed\/704\/606aed704b967a442ccb0f8b10f71f67.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/7ac\/63e\/1b7\/7ac63e1b726d7c8c60061a59a3407e0a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1cc\/d82\/b1a\/1ccd82b1a809c12291e0fa8ca86d2bc1.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ecf\/28e\/05f\/ecf28e05f8662aa9f1238d54e19df3e4.jpg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Реле Давления v2.0 — revival" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Реле Давления v2.0 — revival" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Реле Давления v2.0 — revival" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле давления первого поколения с..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле давления первого поколения с..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле давления первого поколения с..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле давления первого поколения с..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле давления первого поколения с..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/af7/7d0/f28/af77d0f283aba384401e13fd4ce2743a.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/af7/7d0/f28/af77d0f283aba384401e13fd4ce2743a.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/af7/7d0/f28/af77d0f283aba384401e13fd4ce2743a.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/af7/7d0/f28/af77d0f283aba384401e13fd4ce2743a.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/af7/7d0/f28/af77d0f283aba384401e13fd4ce2743a.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="581288" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-12T04:00:02.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/581288/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/581288/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/af7/7d0/f28/af77d0f283aba384401e13fd4ce2743a.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/581288/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Alex_Bogdanovich/" title="Alex_Bogdanovich" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/295/161/c97/295161c97049ed6a00c3c62acfb1ed1f.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/Alex_Bogdanovich/" class="tm-user-info__username">
      Alex_Bogdanovich
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-12T04:00:02.000Z" title="2021-10-12, 07:00">12  октября   в 07:00</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Реле Давления v2.0 — revival</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/controllers/" class="tm-article-snippet__hubs-item-link"><span>Программирование микроконтроллеров</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/home_automation/" class="tm-article-snippet__hubs-item-link"><span>Умный дом</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/DIY/" class="tm-article-snippet__hubs-item-link"><span>DIY или Сделай сам</span> <!----></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="/img/image-loader.svg" height="1125" data-src="https://habrastorage.org/getpro/habr/upload_files/60a/3fb/c7f/60a3fbc7f60147c776415fac87ad1822.png" data-width="1987"/><figcaption></figcaption></figure><details class="spoiler"><summary>Прилетело НЛО и опубликовало эту фразу</summary><div class="spoiler__content"><p>Пусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. </p></div></details><h2>Обзор реле давления первого поколения с дополнениями</h2><figure class="float bordered full-width "><img src="/img/image-loader.svg" alt="Большая коробка с магией внутри :)" title="Большая коробка с магией внутри :)" height="501" data-src="https://habrastorage.org/getpro/habr/upload_files/17a/1f3/5a5/17a1f35a556a8374bccef6ae64023a4e.png" data-width="649"/><figcaption>Большая коробка с магией внутри :)</figcaption></figure><p>Первая версия моего электронного реле [статья: <a href="https://habr.com/en/post/408933/" rel="noopener noreferrer nofollow">https://habr.com/en/post/408933/</a>] была большой, толстой и с кнопками по бокам, торчащими как рога у быка. Вот так всегда, когда нет ограничений по размерам, что уж нам мелочиться то... </p><p>Версия 1.0 вышла на всеобщую критику <strong>4</strong> года назад на базе Arduino (не оригинальной) с большим синим экраном на 4 строчки. Тогда это казалось волшебством, а сейчас обыденностью. Как быстро мы привыкаем к хорошим вещам и забываем радоваться мелочам. Итак: "<em>погнали наших городских!</em>"</p><details class="spoiler"><summary>Флешбэк</summary><div class="spoiler__content"><p>Кстати, помните фотку бани с прошлого поста? Загляните ради интереса <a href="https://habr.com/en/post/408933/" rel="noopener noreferrer nofollow">https://habr.com/en/post/408933/</a>, посмотрите. Спустя годы, сейчас у нас вот так:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="2021 - вид на баню с харчевней (казан + тандыр)" title="2021 - вид на баню с харчевней (казан + тандыр)" height="695" data-src="https://habrastorage.org/getpro/habr/upload_files/b75/414/436/b75414436179659da18b9f0f5f8a233a.png" data-width="1037"/><figcaption>2021 - вид на баню с харчевней (казан + тандыр)</figcaption></figure><p>Как пела в детстве наша дочь:  - И пусть летят <strong>гага</strong>... мы не забудем Вас никогда..."</p></div></details><blockquote><p><strong>Исправления, улучшения, обновления в процессе эксплуатации v1.5</strong></p></blockquote><p>Под шумок прилетело много обновлений со стороны пользователей, которые помогли улучшить код и натолкнули на мысль: «а нафиг столько всего… надо упрощать».</p><p>По факту перешел на mini Arduino, упростил экран, взяв меньший по габаритам и убрал боковые кнопки, которые выставляли верхнее и нижнее давление (нижнее давление говорит когда насос надо включать, верхнее - когда его надо выключать). А <em>накой</em> они, когда давление выставляешь один раз. Настройки начали "залетать" с прошивкой в виде статических переменных. В целом я решил пойти по пути разработки через тестирование прототипа. Внутри каждого из нас живет свой маленький дорогой наш, Маск Илонович:) - который периодически просыпается и подкидывает пищи для размышлений, надо лишь поверить в него и не оборачиваться на лица с "вопросами". </p><figure class="float bordered full-width "><img src="/img/image-loader.svg" alt="Реле на 220 В, 40 А с радиатором охлаждения" title="Реле на 220 В, 40 А с радиатором охлаждения" height="582" data-src="https://habrastorage.org/getpro/habr/upload_files/2ae/5ab/e0f/2ae5abe0f06a19f99767ebeb66ab5cc9.png" data-width="651"/><figcaption>Реле на 220 В, 40 А с радиатором охлаждения</figcaption></figure><p>В процессе понял, что реле на <strong>25А</strong> греется от <strong>1kW</strong> насоса, который колошматит на три дома. Заменил на <strong>40А</strong> и посадил на радиатор. Боковые кнопки почти не использовал, поигрался и вырезал из прототипа. А придуманный мной алгоритм предварительного включения реле даже не запускал в продакшен. Придумал же себе такое дело, если скорость падения давления в баке превышает "некий" порог, не дожидаясь падения до нижнего давления, включать насос на опережение.  </p><p>Arduino прошивка доступна здесь: <a href="https://github.com/abogdanovich/pressure_sensor_arduino" rel="noopener noreferrer nofollow">https://github.com/abogdanovich/pressure_sensor_arduino</a></p><blockquote><p><strong>Фобии, ужастики и отказы за 4 года v1.5</strong></p></blockquote><p>За 4 года эксплуатации произошел только один отказ. Ошибки свои надо признавать и не давать другим их повторять. Данный отказ вылез через 2 года эксплуатации и чуть не стоил мне гидроаккумулятора и мокрых штанов. Глаза округлились, когда я увидел в гараже, как из-под гидроаккумулятора капает водичка...</p><p>Кто видел, как производят гидравлическое тестирование ракет на разрыв, тот поймет всю картину происходящего. Ну так вот… хорошо, что мой насос максимально <strong>8Bar</strong> накачивает, а гидроаккумулятор способен выдерживать до <strong>10Bar</strong>. Это и стало ключевым моментом спасения на максималках. </p><p>Ошибка закралась в коде, где идет проверка показания давления с дополнительной проверкой, для проверки выхода за пределы установленного значения. Так сказать, двойная проверка самого себя. И вот… случилось так, что я прошляпил в коде такой редкий случай, когда показания давления вызвали сбой, установилась ошибка датчика, и при этом, заблокировалась вторая проверка на выключение насоса, когда он выходит за пределы максимально допустимого давления.</p><figure class="float bordered full-width "><img src="/img/image-loader.svg" alt="Гидроаккумулятора накачанный на 8 Bar с максимальным давлением на 10 Bar" title="Гидроаккумулятора накачанный на 8 Bar с максимальным давлением на 10 Bar" height="490" data-src="https://habrastorage.org/getpro/habr/upload_files/0ea/682/102/0ea68210283ab09bb79d4d991b44fe57.png" data-width="652"/><figcaption>Гидроаккумулятора накачанный на 8 Bar с максимальным давлением на 10 Bar</figcaption></figure><p>Недоглядел Михалыч 😊 и словил "гидротест" бака. А сам бак у горловины поднялся на <strong>1см</strong> от давления. Металл горловины, где сужение, выдавило немного наружу. Бак по-прежнему работает и не жалуется, только краска на нем облезла после испытаний  :)</p><p>А теперь самое ценное за 4 года - 2 фотографии сенсора, который под давлением 4-5Bar проработал 4 года в водной среде. Изготовитель Китай. Датчик до сих пор работает! </p><figure class="bordered full-width "><img src="/img/image-loader.svg" alt="Датчик давления 4 года работы в водной среде - 4-5Bar давления." title="Датчик давления 4 года работы в водной среде - 4-5Bar давления." height="736" data-src="https://habrastorage.org/getpro/habr/upload_files/4ec/9d2/973/4ec9d2973a363cd77265ef599dfd9a82.png" data-width="1346"/><figcaption>Датчик давления 4 года работы в водной среде - 4-5Bar давления.</figcaption></figure><p>Вода у нас чистая (60 метров скважина) и я прям не ожидал, что под давлением могут сформироваться такие экскременты :). Твердые кальцинированные образования с черно зеленоватым оттенком. Подозреваю в этом медь и латунь в контакте с другими металлами дают некую "контактную коррозию". Если у Вас есть мысли - напишите их в комментарии. Миф о том, что это чудо проработает месяц - разрушен официально :) - хаха! Mythbusters прям получился. Заменил на новенький, прокачал бак и получил значения такие же, как на механическом манометре. </p><p>Других нареканий не было. Показания по давления совпадают с манометром с небольшим отклонением, которое заложено в самом датчике. Включение и выключение происходят тихо, насос работает исправно, ничего не греется, Ардуина не зависает, не поржавела, не замерзла (<strong>+2..+5</strong> градусов зимой без отопления в гараже). Из функционала включения и выключения, оставил ещё хранение данных на самой Ардуина и загрузкой из памяти <strong>eeprom</strong>. Знаю, знаю... с eeprom баловаться можно до поры до времени, поэтому запись организовал с редким интервалом записи. И тут мне пришла мысля…</p><p>Cейчас народ подкатит с фразами "чем проще устройство тем надежнее..." - ну так они до сих пор и летают на аппаратах производства СССР. </p><p>Надо пробовать двигаться вперед!</p><h2>Переход на новое реле давления v2.0 – MicroPython на базе ESP8266</h2><blockquote><p><strong>И чего мне не спалось то....</strong></p></blockquote><p>Все бы хорошо… Шел бы тандыр коптить, да плов жарить, но нет, душа рвется в бой, да ещё с <strong>ESP8266</strong>, да <strong>MicroPython</strong> "намазывая". И в доме все на них, управляется, да через телефон. Приятно ж то, как 😊. </p><figure class="float bordered full-width "><img src="/img/image-loader.svg" alt="Второе поколение реле давления на базе ESP8266
Полевые испытания " title="Второе поколение реле давления на базе ESP8266
Полевые испытания " height="783" data-src="https://habrastorage.org/getpro/habr/upload_files/061/141/44f/06114144ffa59e1d244e1c164feaead4.png" data-width="1109"/><figcaption>Второе поколение реле давления на базе ESP8266
Полевые испытания </figcaption></figure><p>Как раз на замену надо второе реле давления, на всякий случай. А то пишут <em>вурдалаки</em>, китайское реле давления проживет у тебя месяц, да все прогноз сбыться не может. А я спать не могу теперь. А им тоже не спиться, вот так все и ждут…  </p><p>Решил я податься во все тяжкие, да запилить на базе ESP8266 + MicroPython. Ещё данные хорошо бы в <strong>mongodb</strong> складывать и красивые графики рисовать. А потом много возможностей для анализа данных и генерации статистики. Полезно и лишним не будет. С такими набором данных можно будет и прогнозы подкачки давления в гидроаккумуляторе планировать. … опять спать не буду спокойно. Ай ну и ладно – интересно же!</p><blockquote><p><strong>Плюсы перехода на модуль esp8266</strong> </p></blockquote><p>А что из плюсов и зачем на ESP8266, да ещё с каким-то MicroPython? А тут все просто: попробовал ESP8266 через телефон хоть раз, уже на Ардуино и смотреть не хочется. Не то что делать что-то там... </p><p><em>ИМХО</em>, ESP8266 – это как электрокар против ДВС. Возможности обратной связи c выходом на просторы интернета, оперативность выполнения задач. Я молчу уже про монстра ESP32. Arduino хорош для пробы, этакий старый добрый корвет, с возможностью нарисовать «квадратики» и поморгать светодиодами, для старта автоматизаторов.   </p><h2>Схема нового реле давления на базе MicroPython</h2><p>Перейдем к исполнению нового устройства и рассмотрим поближе, какие компоненты у нас будут, что требуется установить и как мы будем код писать. Я вот сидел и думал, а как обозвать это устройство, а то устал писать "замена механического реле на электронное" - вот <strong>Вы</strong> подскажите вариант названия этого устройства в комментарии, будет интересно почитать Ваши предложения!  </p><figure class="bordered full-width "><img src="/img/image-loader.svg" alt="Схема обновленного устройства реле давления" title="Схема обновленного устройства реле давления" height="684" data-src="https://habrastorage.org/getpro/habr/upload_files/71b/a24/ca1/71ba24ca1ccc64942263e85f751ea768.png" data-width="875"/><figcaption>Схема обновленного устройства реле давления</figcaption></figure><p>Пока я дописывал статью и тестировал датчик, спалил одну ESP8266 (причины не известны... такое бывает). Так же у меня развалился mini oled дисплей, а старый (4*20) дисплей отказался работать. </p><p>И что Вы думаете? Да я плюнул, выкинул обвес дисплея и решил идти дальше, по хардкорному, а точнее - NodeMCU + реле + датчик давления. Все, хватит эти красивые синие экранчики, теперь все будем смотреть через MQTT протокол на экране нашего телефона!</p><p>Итак у нас есть:</p><ul><li><p>датчик давления, который мы купили на aliexpress</p></li><li><p>реле на 40А, </p></li><li><p><s>мини дисплей OLED I2C 128*32</s>, </p></li><li><p>насос (автоматика) </p></li><li><p>ESP8266. Покупайте 12e\f модификацию на базе NodeMCU, сразу распаянный чип со всем обвесом. Раньше я покупал чистый чип и занимался ерундой, пытался припаивать нужные резисторы, но это все от лукавого :) - ну его!  </p></li></ul><figure class="float bordered full-width "><img src="/img/image-loader.svg" height="738" data-src="https://habrastorage.org/getpro/habr/upload_files/049/0dd/305/0490dd3055d50dba4886dc6a3dfacfc3.png" data-width="999"/><figcaption></figcaption></figure><p>ESP8266 состоит из 2 плат. Основа "бутерброда" NodeMCU (например, модификаций много всяких), это которая с ножками и подписанными пинами, micro-USB входом и кнопочками RST (reset) и FLASH (ранее использовалась при прошивке), а так же самим чипом ESP8266, который питается от 3.3V с wifi антенной и металлизированным панцирем, закрывающим собственно сам чип от <s>вредителей</s>  внешнего мира.</p><blockquote><p><strong>Analog-to-digital converter и делитель напряжения</strong></p></blockquote><p>Резко так погружаемся в те места, которые будем использовать при работе, но не те, которые Вы подумали :). Мы рассмотрим лишь то, что касается данной статьи. </p><p>Стоит рассказать несколько нюансов чтения данных ESP8266 через аналоговый пин A0 -    <strong>ADC - </strong>он же <strong>Analog-to-digital converter.</strong></p><figure class="float bordered full-width "><img src="/img/image-loader.svg" height="553" data-src="https://habrastorage.org/getpro/habr/upload_files/606/aed/704/606aed704b967a442ccb0f8b10f71f67.png" data-width="522"/><figcaption></figcaption></figure><p>Что бы замерять напряжение на ESP8266, ADC позволяет измерять интервал от 0 до 1V. Такой глупости нет на Arduino и это автоматически делает Arduino превосходным "безгеморным" бордом для начинающих. А вот кто вкусил ESP8266, тот уже наверняка познакомиться с понижением сигнала (напряжения) от датчика от стандартных 5V до max 1v. Вход A0 на борту NodeMCU, позволяет понижать напряжение с 3.3V до 1V. Там уже встроен делитель напряжения. Но у нас сенсор выдает 0.5 - 5v и нам надо что то с этим делать! Значит надо понизить с 5 до 3.3, а NodeMCU уже подхватит и понизит до 1V. Все просто, нам надо от сенсора припаять резистор 1K и 2K и между ними снимать показания и передавать на A0 pin.  </p><p>Больше информации, уважаемый читатель, сможет найти в интернете с более подробными объяснениями. <em>Интересно, какие Вы делители напряжения <s>напрягали, делили и</s> </em><strong><em>применяли</em></strong><em> и где? Напишите в комментарии, интересно почитать. </em></p><p>C железом все понятно, крутим все провода, паяем, где-то "благим словцом" покрываем. Как соединить реле, сенсор и дисплей, показано на картинке выше. Не ленитесь "гуглить" в случае непонятного подключения. Реле заводим на 14 pin, <s>дисплей на 4 и 5</s>, а сенсор на adc 0. Питаться надо правильно, поэтому мощность блока для ваших устройств рассчитывайте, что бы хватало и для ESP8266 и для датчика давления. Выходное напряжение блока питания 5 вольт с силой тока > 0.5A. Берите с запасом, иначе можно "ловить" глюки и непонятные явления в виде летающих НЛО на вашей базе под названием "ESP8266". </p><blockquote><p><strong>Настройки программного обеспечения</strong></p></blockquote><p>Код писать будем в <strong>PyCharm</strong>, в котором можно установить библиотеку MicroPython и наслаждаться возможностью "заливать" \ "прожигать" код прямо из <strong>PyCharm</strong> <strong>IDE</strong>. Легко, просто и быстро! </p><details class="spoiler"><summary>Тошним с прошивкой MicroPython в Pycharm</summary><div class="spoiler__content"><ol><li><p>Ставим PyCharm Community IDE <a href="https://www.jetbrains.com/pycharm/download/#section=windows" rel="noopener noreferrer nofollow">https://www.jetbrains.com/pycharm/download/#section=windows</a> </p></li><li><p>Устанавливаем plugin MicroPython <a href="https://plugins.jetbrains.com/plugin/9777-micropython" rel="noopener noreferrer nofollow">https://plugins.jetbrains.com/plugin/9777-micropython</a></p></li><li><p>Необходимо скачать и установить <strong>esptool</strong> <a href="https://github.com/espressif/esptool" rel="noopener noreferrer nofollow">https://github.com/espressif/esptool</a> </p></li><li><p>Зайти на сайт MicroPython и скачать последнюю стабильную прошивку для ESP8266 <a href="https://micropython.org/download/esp8266/" rel="noopener noreferrer nofollow">https://micropython.org/download/esp8266/</a></p></li><li><p>Подключить ESP8266 к USB порту и выполнить в терминале 2 команды, предварительно узнав, какой COM порт был назначен ESP8266, когда Вы её воткнули в USB, выполняем команду:</p><ol><li><p>esptool.py --port <strong>COM_PORT</strong> erase_flash (<em>сотрет начисто все, что там затаилось)</em></p></li><li><p>esptool.py --port COM_PORT --baud 115200 write_flash --flash_size=detect -fm dio 0 <strong>esp8266-downloaded-formware-from-web-site.bin </strong>(<em>esp8266-downloaded-formware-from-web-site.bin - имя файла, который Вы скачали с сайта MicroPython)</em></p></li></ol></li></ol></div></details><p>Все готово, <s>что бы спалить наш первый ESP8266</s>, что бы вдохнуть жизнь в Ваш модуль. </p><blockquote><p><strong>Код</strong></p></blockquote><p>Сливаем код <a href="https://github.com/abogdanovich/micropython_esp8266_pressure-sensor" rel="noopener noreferrer nofollow">https://github.com/abogdanovich/micropython_esp8266_pressure-sensor</a> и открываем проект в PyCharm студии.</p><p>Нажимаем магическую комбинацию: <strong>Ctrl + Altr + S</strong>. Идем в Languages &amp; Frameworks -> MicroPython -> и отмечаем чекбоксы: <strong>Enable MicroPython support | Auto-detect device path</strong></p><p>Выделяя каждый файл проекта в окошке файлов проекта (слева), выбирайте Run &lt;filename>, что бы залить каждый файл на ESP8266. </p><p><strong>Незабываем!</strong> Проверить все настройки кода в главном файле <em>main.py</em>: -</p><ul><li><p>выбрать выходные каналы информации: mqtt, display, db (mongodb).  </p></li></ul><ul><li><p>Для <em>mqtt_channels</em> надо вбивать 2 названия, первое будет использоваться для отсылки данных по давлению, второе для экстренного отключения реле (в случае чего).</p></li><li><p>Указать начальные параметры для сенсора, нижнее и верхнее давление </p></li></ul><pre><code>sensor = SmartWaterSync(
            wifi_ssid="",
            wifi_pass="",
            mqtt_username="",
            mqtt_password="",
            mqtt_channels=("smarty/water_pressure", "smarty/water_relay",),     # write topic, read topic (on\off relay)
            output_channels=('mqtt', 'db'),     # possible: mqtt, display, db
            low_pressure=4,                     # bottom ON pressure
            high_pressure=5,                    # up OFF pressure
            max_sensor_pressure=12,             # the max sensor pressure according to specification
            sensor_raw_offset=43,               # define the default value from sensor
            sensor_min_raw_for_error=30         # define this to call ERROR state and disable RELAY \ STOP working
        )</code></pre><p>После заливки всех файлов, Ваше устройство оживет <s>и на дисплее будут показания</s> и esp8266 начнет моргать каждую секунду. Это индикатор работы модуля. Если он моргает и не горит постоянно - значит с кодом более менее все хорошо. Код я рекомендую разобрать самостоятельно. Если Вы желаете внести улучшения либо оптимизировать - милости прошу в гит реквесты. Весь код построен на асинхронном выполнении нескольких задач: </p><ul><li><p>чтение данных с сенсора и принятие решения о включении \ выключен </p></li><li><p>попытка подключиться к Wifi сети</p></li><li><p>попытка подключиться к MQTT серверу</p></li><li><p>отсылка данных в каналы, которые Вы определили при старте: mqtt, db, display.</p></li></ul><p>При старте, все задачи стартуют и пытаются выполнять все что им велено. Я максимально постарался обвернуть все выполнения задач в свой try блок, что бы при возникновении ошибки, не прерывался общий процесс работы модуля и все шло своим путем. Есть идеи? - Пишите!</p><h2>Сбор данных</h2><p>На моем локальном сервере, который успешно <s>пылиться</s> прохлаждается в гараже уже 7-ой год, есть все что мне надо: mqtt сервер, видео сервер (motion), mongoDB и Flask. </p><figure class="float bordered "><img src="/img/image-loader.svg" alt="" title="" height="249" data-src="https://habrastorage.org/getpro/habr/upload_files/7ac/63e/1b7/7ac63e1b726d7c8c60061a59a3407e0a.png" data-width="200"/><figcaption></figcaption></figure><p>Для записи данных я использую mongoDB + Flask связку. Можно отправлять данные напрямую из ESP8266 (честно, ещё сам не пробовал использовать эту библиотеку), а можно через http request "прокидывать" данные во Flask, производить нужные манипуляции и укладывать данные "штабелями" в базу. Это не совсем производительно, но дает возможность в предварительной обработке данных. Да фиг с ним, пусть что-то останется для Вашей оптимизации. Каждому по софтварному пирогу.  </p><figure class="bordered full-width "><img src="/img/image-loader.svg" height="557" data-src="https://habrastorage.org/getpro/habr/upload_files/1cc/d82/b1a/1ccd82b1a809c12291e0fa8ca86d2bc1.png" data-width="1692"/><figcaption></figcaption></figure><p>Описывать обработку и хранение данных на Flask \ mongoDB нет смысла, так как это выходит за рамки данной статьи, да и Вы уже знатно подустали. Отдельно отмечу мобильное приложение для чтения данных через mqtt протокол.</p><blockquote><p><strong>MQTT Dash</strong> - самое достойное приложение с поддержкой MQTT протокола </p></blockquote><figure class="float bordered full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/ecf/28e/05f/ecf28e05f8662aa9f1238d54e19df3e4.jpg" width="720" height="1560" data-src="https://habrastorage.org/getpro/habr/upload_files/ecf/28e/05f/ecf28e05f8662aa9f1238d54e19df3e4.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Сколько себя помню - столько пользуюсь самым крутым приложением поддерживающим напрямую протокол MQTT (только для <strong>Android</strong> пользователей). Автор - если ты читаешь хабру - от души, огромное спасибо тебе и продолжай развивать проект, фиксить баги. Ты - красавчик. Остальные приложения нервно курят в сторонке. Если кто-то готов возразить, милости прошу в комментарии. Спасибо автору, за возможность без рекламы пользоваться полноценным функционалом. Ссылка на приложение <a href="https://play.google.com/store/apps/details?id=net.routix.mqttdash&amp;hl=en&amp;gl=US" rel="noopener noreferrer nofollow">https://play.google.com/store/apps/details?id=net.routix.mqttdash</a></p><p>Если вы используете закрытый MQTT сервер какого либо онлайн сервиса (открытый даже не пытайтесь), или используете свой сервер, как в моем случае. Тогда Вы cможете настроить приложение MQTT Dash и подписаться на свой канал чтения\управления.</p><h2>Заключение</h2><p>Спасибо, что дочитали до конца. Произошло "возрождение" электронного реле, которое радует новым функционалом и возможностями. Накапливаю данные, которые я хочу попробовать обработать, проанализировать в дальнейшем. Если у Вас есть идеи и примеры обработки данных такого типа буду рад послушать Вас!</p><p>/ Alex B. </p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Besp8266%5D" class="tm-tags-list__link">esp8266</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Barduino%5D" class="tm-tags-list__link">arduino</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%80%D0%B5%D0%BB%D0%B5%20%D0%B4%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F%5D" class="tm-tags-list__link">реле давления</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%5D" class="tm-tags-list__link">автоматизация</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmicropython%5D" class="tm-tags-list__link">micropython</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmqtt%5D" class="tm-tags-list__link">mqtt</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/controllers/" class="tm-hubs-list__link">
    Программирование микроконтроллеров
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/home_automation/" class="tm-hubs-list__link">
    Умный дом
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/DIY/" class="tm-hubs-list__link">
    DIY или Сделай сам
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 19: ↑19 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 19: ↑19 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+19</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.7K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    56
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Alex_Bogdanovich/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/295/161/c97/295161c97049ed6a00c3c62acfb1ed1f.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 23 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    15
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">19</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Alex Bogdanovich</span> <a href="/ru/users/Alex_Bogdanovich/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Alex_Bogdanovich
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Software Developer in Automation</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://github.com/abogdanovich/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Github
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/581288/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 19 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/581288/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/581288/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"581288":{"id":"581288","timePublished":"2021-10-12T04:00:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Реле Давления v2.0 — revival","leadData":{"textHtml":"\u003Cp\u003EПривет, дорогой хабровчанин! Хотел выразить тебе огромное спасибо, за то, что смог побудить меня написать эту статью… 😊\u003C\u002Fp\u003E\u003Cp\u003E\u003Cem\u003EЗаваривайте чаёк, кофеёк или что-то покрепче и погнали читать вместе!\u003C\u002Fem\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faf7\u002F7d0\u002Ff28\u002Faf77d0f283aba384401e13fd4ce2743a.png","buttonTextHtml":"Чытаць далей","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faf7\u002F7d0\u002Ff28\u002Faf77d0f283aba384401e13fd4ce2743a.png","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":15,"votesCount":23},"rating":19,"relatedData":null,"contacts":[{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002Fabogdanovich\u002F","value":"abogdanovich"}],"authorContacts":[{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002Fabogdanovich\u002F","value":"abogdanovich"}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"990446","alias":"Alex_Bogdanovich","fullname":"Alex Bogdanovich","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F295\u002F161\u002Fc97\u002F295161c97049ed6a00c3c62acfb1ed1f.png","speciality":"Software Developer in Automation"},"statistics":{"commentsCount":19,"favoritesCount":56,"readingCount":4699,"score":19,"votesCount":19},"hubs":[{"relatedData":null,"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true},{"relatedData":null,"id":"21966","alias":"home_automation","type":"collective","title":"Умный дом","titleHtml":"Умный дом","isProfiled":false},{"relatedData":null,"id":"21976","alias":"DIY","type":"collective","title":"DIY или Сделай сам","titleHtml":"DIY или Сделай сам","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"1125\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F60a\u002F3fb\u002Fc7f\u002F60a3fbc7f60147c776415fac87ad1822.png\" data-width=\"1987\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПрилетело НЛО и опубликовало эту фразу\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. \u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch2\u003EОбзор реле давления первого поколения с дополнениями\u003C\u002Fh2\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Большая коробка с магией внутри :)\" title=\"Большая коробка с магией внутри :)\" height=\"501\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F17a\u002F1f3\u002F5a5\u002F17a1f35a556a8374bccef6ae64023a4e.png\" data-width=\"649\"\u002F\u003E\u003Cfigcaption\u003EБольшая коробка с магией внутри :)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПервая версия моего электронного реле [статья: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F408933\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F408933\u002F\u003C\u002Fa\u003E] была большой, толстой и с кнопками по бокам, торчащими как рога у быка. Вот так всегда, когда нет ограничений по размерам, что уж нам мелочиться то... \u003C\u002Fp\u003E\u003Cp\u003EВерсия 1.0 вышла на всеобщую критику \u003Cstrong\u003E4\u003C\u002Fstrong\u003E года назад на базе Arduino (не оригинальной) с большим синим экраном на 4 строчки. Тогда это казалось волшебством, а сейчас обыденностью. Как быстро мы привыкаем к хорошим вещам и забываем радоваться мелочам. Итак: \"\u003Cem\u003Eпогнали наших городских!\u003C\u002Fem\u003E\"\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EФлешбэк\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EКстати, помните фотку бани с прошлого поста? Загляните ради интереса \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F408933\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fen\u002Fpost\u002F408933\u002F\u003C\u002Fa\u003E, посмотрите. Спустя годы, сейчас у нас вот так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"2021 - вид на баню с харчевней (казан + тандыр)\" title=\"2021 - вид на баню с харчевней (казан + тандыр)\" height=\"695\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb75\u002F414\u002F436\u002Fb75414436179659da18b9f0f5f8a233a.png\" data-width=\"1037\"\u002F\u003E\u003Cfigcaption\u003E2021 - вид на баню с харчевней (казан + тандыр)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EКак пела в детстве наша дочь:  - И пусть летят \u003Cstrong\u003Eгага\u003C\u002Fstrong\u003E... мы не забудем Вас никогда...\"\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EИсправления, улучшения, обновления в процессе эксплуатации v1.5\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EПод шумок прилетело много обновлений со стороны пользователей, которые помогли улучшить код и натолкнули на мысль: «а нафиг столько всего… надо упрощать».\u003C\u002Fp\u003E\u003Cp\u003EПо факту перешел на mini Arduino, упростил экран, взяв меньший по габаритам и убрал боковые кнопки, которые выставляли верхнее и нижнее давление (нижнее давление говорит когда насос надо включать, верхнее - когда его надо выключать). А \u003Cem\u003Eнакой\u003C\u002Fem\u003E они, когда давление выставляешь один раз. Настройки начали \"залетать\" с прошивкой в виде статических переменных. В целом я решил пойти по пути разработки через тестирование прототипа. Внутри каждого из нас живет свой маленький дорогой наш, Маск Илонович:) - который периодически просыпается и подкидывает пищи для размышлений, надо лишь поверить в него и не оборачиваться на лица с \"вопросами\". \u003C\u002Fp\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Реле на 220 В, 40 А с радиатором охлаждения\" title=\"Реле на 220 В, 40 А с радиатором охлаждения\" height=\"582\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2ae\u002F5ab\u002Fe0f\u002F2ae5abe0f06a19f99767ebeb66ab5cc9.png\" data-width=\"651\"\u002F\u003E\u003Cfigcaption\u003EРеле на 220 В, 40 А с радиатором охлаждения\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ процессе понял, что реле на \u003Cstrong\u003E25А\u003C\u002Fstrong\u003E греется от \u003Cstrong\u003E1kW\u003C\u002Fstrong\u003E насоса, который колошматит на три дома. Заменил на \u003Cstrong\u003E40А\u003C\u002Fstrong\u003E и посадил на радиатор. Боковые кнопки почти не использовал, поигрался и вырезал из прототипа. А придуманный мной алгоритм предварительного включения реле даже не запускал в продакшен. Придумал же себе такое дело, если скорость падения давления в баке превышает \"некий\" порог, не дожидаясь падения до нижнего давления, включать насос на опережение.  \u003C\u002Fp\u003E\u003Cp\u003EArduino прошивка доступна здесь: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fabogdanovich\u002Fpressure_sensor_arduino\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fabogdanovich\u002Fpressure_sensor_arduino\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EФобии, ужастики и отказы за 4 года v1.5\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EЗа 4 года эксплуатации произошел только один отказ. Ошибки свои надо признавать и не давать другим их повторять. Данный отказ вылез через 2 года эксплуатации и чуть не стоил мне гидроаккумулятора и мокрых штанов. Глаза округлились, когда я увидел в гараже, как из-под гидроаккумулятора капает водичка...\u003C\u002Fp\u003E\u003Cp\u003EКто видел, как производят гидравлическое тестирование ракет на разрыв, тот поймет всю картину происходящего. Ну так вот… хорошо, что мой насос максимально \u003Cstrong\u003E8Bar\u003C\u002Fstrong\u003E накачивает, а гидроаккумулятор способен выдерживать до \u003Cstrong\u003E10Bar\u003C\u002Fstrong\u003E. Это и стало ключевым моментом спасения на максималках. \u003C\u002Fp\u003E\u003Cp\u003EОшибка закралась в коде, где идет проверка показания давления с дополнительной проверкой, для проверки выхода за пределы установленного значения. Так сказать, двойная проверка самого себя. И вот… случилось так, что я прошляпил в коде такой редкий случай, когда показания давления вызвали сбой, установилась ошибка датчика, и при этом, заблокировалась вторая проверка на выключение насоса, когда он выходит за пределы максимально допустимого давления.\u003C\u002Fp\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Гидроаккумулятора накачанный на 8 Bar с максимальным давлением на 10 Bar\" title=\"Гидроаккумулятора накачанный на 8 Bar с максимальным давлением на 10 Bar\" height=\"490\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ea\u002F682\u002F102\u002F0ea68210283ab09bb79d4d991b44fe57.png\" data-width=\"652\"\u002F\u003E\u003Cfigcaption\u003EГидроаккумулятора накачанный на 8 Bar с максимальным давлением на 10 Bar\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНедоглядел Михалыч 😊 и словил \"гидротест\" бака. А сам бак у горловины поднялся на \u003Cstrong\u003E1см\u003C\u002Fstrong\u003E от давления. Металл горловины, где сужение, выдавило немного наружу. Бак по-прежнему работает и не жалуется, только краска на нем облезла после испытаний  :)\u003C\u002Fp\u003E\u003Cp\u003EА теперь самое ценное за 4 года - 2 фотографии сенсора, который под давлением 4-5Bar проработал 4 года в водной среде. Изготовитель Китай. Датчик до сих пор работает! \u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Датчик давления 4 года работы в водной среде - 4-5Bar давления.\" title=\"Датчик давления 4 года работы в водной среде - 4-5Bar давления.\" height=\"736\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4ec\u002F9d2\u002F973\u002F4ec9d2973a363cd77265ef599dfd9a82.png\" data-width=\"1346\"\u002F\u003E\u003Cfigcaption\u003EДатчик давления 4 года работы в водной среде - 4-5Bar давления.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВода у нас чистая (60 метров скважина) и я прям не ожидал, что под давлением могут сформироваться такие экскременты :). Твердые кальцинированные образования с черно зеленоватым оттенком. Подозреваю в этом медь и латунь в контакте с другими металлами дают некую \"контактную коррозию\". Если у Вас есть мысли - напишите их в комментарии. Миф о том, что это чудо проработает месяц - разрушен официально :) - хаха! Mythbusters прям получился. Заменил на новенький, прокачал бак и получил значения такие же, как на механическом манометре. \u003C\u002Fp\u003E\u003Cp\u003EДругих нареканий не было. Показания по давления совпадают с манометром с небольшим отклонением, которое заложено в самом датчике. Включение и выключение происходят тихо, насос работает исправно, ничего не греется, Ардуина не зависает, не поржавела, не замерзла (\u003Cstrong\u003E+2..+5\u003C\u002Fstrong\u003E градусов зимой без отопления в гараже). Из функционала включения и выключения, оставил ещё хранение данных на самой Ардуина и загрузкой из памяти \u003Cstrong\u003Eeeprom\u003C\u002Fstrong\u003E. Знаю, знаю... с eeprom баловаться можно до поры до времени, поэтому запись организовал с редким интервалом записи. И тут мне пришла мысля…\u003C\u002Fp\u003E\u003Cp\u003ECейчас народ подкатит с фразами \"чем проще устройство тем надежнее...\" - ну так они до сих пор и летают на аппаратах производства СССР. \u003C\u002Fp\u003E\u003Cp\u003EНадо пробовать двигаться вперед!\u003C\u002Fp\u003E\u003Ch2\u003EПереход на новое реле давления v2.0 – MicroPython на базе ESP8266\u003C\u002Fh2\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EИ чего мне не спалось то....\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EВсе бы хорошо… Шел бы тандыр коптить, да плов жарить, но нет, душа рвется в бой, да ещё с \u003Cstrong\u003EESP8266\u003C\u002Fstrong\u003E, да \u003Cstrong\u003EMicroPython\u003C\u002Fstrong\u003E \"намазывая\". И в доме все на них, управляется, да через телефон. Приятно ж то, как 😊. \u003C\u002Fp\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Второе поколение реле давления на базе ESP8266\nПолевые испытания \" title=\"Второе поколение реле давления на базе ESP8266\nПолевые испытания \" height=\"783\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F061\u002F141\u002F44f\u002F06114144ffa59e1d244e1c164feaead4.png\" data-width=\"1109\"\u002F\u003E\u003Cfigcaption\u003EВторое поколение реле давления на базе ESP8266\nПолевые испытания \u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EКак раз на замену надо второе реле давления, на всякий случай. А то пишут \u003Cem\u003Eвурдалаки\u003C\u002Fem\u003E, китайское реле давления проживет у тебя месяц, да все прогноз сбыться не может. А я спать не могу теперь. А им тоже не спиться, вот так все и ждут…  \u003C\u002Fp\u003E\u003Cp\u003EРешил я податься во все тяжкие, да запилить на базе ESP8266 + MicroPython. Ещё данные хорошо бы в \u003Cstrong\u003Emongodb\u003C\u002Fstrong\u003E складывать и красивые графики рисовать. А потом много возможностей для анализа данных и генерации статистики. Полезно и лишним не будет. С такими набором данных можно будет и прогнозы подкачки давления в гидроаккумуляторе планировать. … опять спать не буду спокойно. Ай ну и ладно – интересно же!\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EПлюсы перехода на модуль esp8266\u003C\u002Fstrong\u003E \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EА что из плюсов и зачем на ESP8266, да ещё с каким-то MicroPython? А тут все просто: попробовал ESP8266 через телефон хоть раз, уже на Ардуино и смотреть не хочется. Не то что делать что-то там... \u003C\u002Fp\u003E\u003Cp\u003E\u003Cem\u003EИМХО\u003C\u002Fem\u003E, ESP8266 – это как электрокар против ДВС. Возможности обратной связи c выходом на просторы интернета, оперативность выполнения задач. Я молчу уже про монстра ESP32. Arduino хорош для пробы, этакий старый добрый корвет, с возможностью нарисовать «квадратики» и поморгать светодиодами, для старта автоматизаторов.   \u003C\u002Fp\u003E\u003Ch2\u003EСхема нового реле давления на базе MicroPython\u003C\u002Fh2\u003E\u003Cp\u003EПерейдем к исполнению нового устройства и рассмотрим поближе, какие компоненты у нас будут, что требуется установить и как мы будем код писать. Я вот сидел и думал, а как обозвать это устройство, а то устал писать \"замена механического реле на электронное\" - вот \u003Cstrong\u003EВы\u003C\u002Fstrong\u003E подскажите вариант названия этого устройства в комментарии, будет интересно почитать Ваши предложения!  \u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Схема обновленного устройства реле давления\" title=\"Схема обновленного устройства реле давления\" height=\"684\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F71b\u002Fa24\u002Fca1\u002F71ba24ca1ccc64942263e85f751ea768.png\" data-width=\"875\"\u002F\u003E\u003Cfigcaption\u003EСхема обновленного устройства реле давления\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПока я дописывал статью и тестировал датчик, спалил одну ESP8266 (причины не известны... такое бывает). Так же у меня развалился mini oled дисплей, а старый (4*20) дисплей отказался работать. \u003C\u002Fp\u003E\u003Cp\u003EИ что Вы думаете? Да я плюнул, выкинул обвес дисплея и решил идти дальше, по хардкорному, а точнее - NodeMCU + реле + датчик давления. Все, хватит эти красивые синие экранчики, теперь все будем смотреть через MQTT протокол на экране нашего телефона!\u003C\u002Fp\u003E\u003Cp\u003EИтак у нас есть:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eдатчик давления, который мы купили на aliexpress\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eреле на 40А, \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cs\u003Eмини дисплей OLED I2C 128*32\u003C\u002Fs\u003E, \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eнасос (автоматика) \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EESP8266. Покупайте 12e\\f модификацию на базе NodeMCU, сразу распаянный чип со всем обвесом. Раньше я покупал чистый чип и занимался ерундой, пытался припаивать нужные резисторы, но это все от лукавого :) - ну его!  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"738\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F049\u002F0dd\u002F305\u002F0490dd3055d50dba4886dc6a3dfacfc3.png\" data-width=\"999\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EESP8266 состоит из 2 плат. Основа \"бутерброда\" NodeMCU (например, модификаций много всяких), это которая с ножками и подписанными пинами, micro-USB входом и кнопочками RST (reset) и FLASH (ранее использовалась при прошивке), а так же самим чипом ESP8266, который питается от 3.3V с wifi антенной и металлизированным панцирем, закрывающим собственно сам чип от \u003Cs\u003Eвредителей\u003C\u002Fs\u003E  внешнего мира.\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EAnalog-to-digital converter и делитель напряжения\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EРезко так погружаемся в те места, которые будем использовать при работе, но не те, которые Вы подумали :). Мы рассмотрим лишь то, что касается данной статьи. \u003C\u002Fp\u003E\u003Cp\u003EСтоит рассказать несколько нюансов чтения данных ESP8266 через аналоговый пин A0 -    \u003Cstrong\u003EADC - \u003C\u002Fstrong\u003Eон же \u003Cstrong\u003EAnalog-to-digital converter.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"553\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F606\u002Faed\u002F704\u002F606aed704b967a442ccb0f8b10f71f67.png\" data-width=\"522\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЧто бы замерять напряжение на ESP8266, ADC позволяет измерять интервал от 0 до 1V. Такой глупости нет на Arduino и это автоматически делает Arduino превосходным \"безгеморным\" бордом для начинающих. А вот кто вкусил ESP8266, тот уже наверняка познакомиться с понижением сигнала (напряжения) от датчика от стандартных 5V до max 1v. Вход A0 на борту NodeMCU, позволяет понижать напряжение с 3.3V до 1V. Там уже встроен делитель напряжения. Но у нас сенсор выдает 0.5 - 5v и нам надо что то с этим делать! Значит надо понизить с 5 до 3.3, а NodeMCU уже подхватит и понизит до 1V. Все просто, нам надо от сенсора припаять резистор 1K и 2K и между ними снимать показания и передавать на A0 pin.  \u003C\u002Fp\u003E\u003Cp\u003EБольше информации, уважаемый читатель, сможет найти в интернете с более подробными объяснениями. \u003Cem\u003EИнтересно, какие Вы делители напряжения \u003Cs\u003Eнапрягали, делили и\u003C\u002Fs\u003E \u003C\u002Fem\u003E\u003Cstrong\u003E\u003Cem\u003Eприменяли\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E\u003Cem\u003E и где? Напишите в комментарии, интересно почитать. \u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EC железом все понятно, крутим все провода, паяем, где-то \"благим словцом\" покрываем. Как соединить реле, сенсор и дисплей, показано на картинке выше. Не ленитесь \"гуглить\" в случае непонятного подключения. Реле заводим на 14 pin, \u003Cs\u003Eдисплей на 4 и 5\u003C\u002Fs\u003E, а сенсор на adc 0. Питаться надо правильно, поэтому мощность блока для ваших устройств рассчитывайте, что бы хватало и для ESP8266 и для датчика давления. Выходное напряжение блока питания 5 вольт с силой тока \u003E 0.5A. Берите с запасом, иначе можно \"ловить\" глюки и непонятные явления в виде летающих НЛО на вашей базе под названием \"ESP8266\". \u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EНастройки программного обеспечения\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EКод писать будем в \u003Cstrong\u003EPyCharm\u003C\u002Fstrong\u003E, в котором можно установить библиотеку MicroPython и наслаждаться возможностью \"заливать\" \\ \"прожигать\" код прямо из \u003Cstrong\u003EPyCharm\u003C\u002Fstrong\u003E \u003Cstrong\u003EIDE\u003C\u002Fstrong\u003E. Легко, просто и быстро! \u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EТошним с прошивкой MicroPython в Pycharm\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EСтавим PyCharm Community IDE \u003Ca href=\"https:\u002F\u002Fwww.jetbrains.com\u002Fpycharm\u002Fdownload\u002F#section=windows\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fwww.jetbrains.com\u002Fpycharm\u002Fdownload\u002F#section=windows\u003C\u002Fa\u003E \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EУстанавливаем plugin MicroPython \u003Ca href=\"https:\u002F\u002Fplugins.jetbrains.com\u002Fplugin\u002F9777-micropython\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fplugins.jetbrains.com\u002Fplugin\u002F9777-micropython\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНеобходимо скачать и установить \u003Cstrong\u003Eesptool\u003C\u002Fstrong\u003E \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fespressif\u002Fesptool\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fespressif\u002Fesptool\u003C\u002Fa\u003E \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EЗайти на сайт MicroPython и скачать последнюю стабильную прошивку для ESP8266 \u003Ca href=\"https:\u002F\u002Fmicropython.org\u002Fdownload\u002Fesp8266\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fmicropython.org\u002Fdownload\u002Fesp8266\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПодключить ESP8266 к USB порту и выполнить в терминале 2 команды, предварительно узнав, какой COM порт был назначен ESP8266, когда Вы её воткнули в USB, выполняем команду:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003Eesptool.py --port \u003Cstrong\u003ECOM_PORT\u003C\u002Fstrong\u003E erase_flash (\u003Cem\u003Eсотрет начисто все, что там затаилось)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eesptool.py --port COM_PORT --baud 115200 write_flash --flash_size=detect -fm dio 0 \u003Cstrong\u003Eesp8266-downloaded-formware-from-web-site.bin \u003C\u002Fstrong\u003E(\u003Cem\u003Eesp8266-downloaded-formware-from-web-site.bin - имя файла, который Вы скачали с сайта MicroPython)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EВсе готово, \u003Cs\u003Eчто бы спалить наш первый ESP8266\u003C\u002Fs\u003E, что бы вдохнуть жизнь в Ваш модуль. \u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EКод\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EСливаем код \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fabogdanovich\u002Fmicropython_esp8266_pressure-sensor\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fabogdanovich\u002Fmicropython_esp8266_pressure-sensor\u003C\u002Fa\u003E и открываем проект в PyCharm студии.\u003C\u002Fp\u003E\u003Cp\u003EНажимаем магическую комбинацию: \u003Cstrong\u003ECtrl + Altr + S\u003C\u002Fstrong\u003E. Идем в Languages &amp; Frameworks -\u003E MicroPython -\u003E и отмечаем чекбоксы: \u003Cstrong\u003EEnable MicroPython support | Auto-detect device path\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EВыделяя каждый файл проекта в окошке файлов проекта (слева), выбирайте Run &lt;filename\u003E, что бы залить каждый файл на ESP8266. \u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EНезабываем!\u003C\u002Fstrong\u003E Проверить все настройки кода в главном файле \u003Cem\u003Emain.py\u003C\u002Fem\u003E: -\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eвыбрать выходные каналы информации: mqtt, display, db (mongodb).  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EДля \u003Cem\u003Emqtt_channels\u003C\u002Fem\u003E надо вбивать 2 названия, первое будет использоваться для отсылки данных по давлению, второе для экстренного отключения реле (в случае чего).\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EУказать начальные параметры для сенсора, нижнее и верхнее давление \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode\u003Esensor = SmartWaterSync(\n            wifi_ssid=\"\",\n            wifi_pass=\"\",\n            mqtt_username=\"\",\n            mqtt_password=\"\",\n            mqtt_channels=(\"smarty\u002Fwater_pressure\", \"smarty\u002Fwater_relay\",),     # write topic, read topic (on\\off relay)\n            output_channels=('mqtt', 'db'),     # possible: mqtt, display, db\n            low_pressure=4,                     # bottom ON pressure\n            high_pressure=5,                    # up OFF pressure\n            max_sensor_pressure=12,             # the max sensor pressure according to specification\n            sensor_raw_offset=43,               # define the default value from sensor\n            sensor_min_raw_for_error=30         # define this to call ERROR state and disable RELAY \\ STOP working\n        )\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПосле заливки всех файлов, Ваше устройство оживет \u003Cs\u003Eи на дисплее будут показания\u003C\u002Fs\u003E и esp8266 начнет моргать каждую секунду. Это индикатор работы модуля. Если он моргает и не горит постоянно - значит с кодом более менее все хорошо. Код я рекомендую разобрать самостоятельно. Если Вы желаете внести улучшения либо оптимизировать - милости прошу в гит реквесты. Весь код построен на асинхронном выполнении нескольких задач: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eчтение данных с сенсора и принятие решения о включении \\ выключен \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eпопытка подключиться к Wifi сети\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eпопытка подключиться к MQTT серверу\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eотсылка данных в каналы, которые Вы определили при старте: mqtt, db, display.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПри старте, все задачи стартуют и пытаются выполнять все что им велено. Я максимально постарался обвернуть все выполнения задач в свой try блок, что бы при возникновении ошибки, не прерывался общий процесс работы модуля и все шло своим путем. Есть идеи? - Пишите!\u003C\u002Fp\u003E\u003Ch2\u003EСбор данных\u003C\u002Fh2\u003E\u003Cp\u003EНа моем локальном сервере, который успешно \u003Cs\u003Eпылиться\u003C\u002Fs\u003E прохлаждается в гараже уже 7-ой год, есть все что мне надо: mqtt сервер, видео сервер (motion), mongoDB и Flask. \u003C\u002Fp\u003E\u003Cfigure class=\"float bordered \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"\" title=\"\" height=\"249\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7ac\u002F63e\u002F1b7\u002F7ac63e1b726d7c8c60061a59a3407e0a.png\" data-width=\"200\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДля записи данных я использую mongoDB + Flask связку. Можно отправлять данные напрямую из ESP8266 (честно, ещё сам не пробовал использовать эту библиотеку), а можно через http request \"прокидывать\" данные во Flask, производить нужные манипуляции и укладывать данные \"штабелями\" в базу. Это не совсем производительно, но дает возможность в предварительной обработке данных. Да фиг с ним, пусть что-то останется для Вашей оптимизации. Каждому по софтварному пирогу.  \u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"557\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1cc\u002Fd82\u002Fb1a\u002F1ccd82b1a809c12291e0fa8ca86d2bc1.png\" data-width=\"1692\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EОписывать обработку и хранение данных на Flask \\ mongoDB нет смысла, так как это выходит за рамки данной статьи, да и Вы уже знатно подустали. Отдельно отмечу мобильное приложение для чтения данных через mqtt протокол.\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EMQTT Dash\u003C\u002Fstrong\u003E - самое достойное приложение с поддержкой MQTT протокола \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cfigure class=\"float bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fecf\u002F28e\u002F05f\u002Fecf28e05f8662aa9f1238d54e19df3e4.jpg\" width=\"720\" height=\"1560\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fecf\u002F28e\u002F05f\u002Fecf28e05f8662aa9f1238d54e19df3e4.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСколько себя помню - столько пользуюсь самым крутым приложением поддерживающим напрямую протокол MQTT (только для \u003Cstrong\u003EAndroid\u003C\u002Fstrong\u003E пользователей). Автор - если ты читаешь хабру - от души, огромное спасибо тебе и продолжай развивать проект, фиксить баги. Ты - красавчик. Остальные приложения нервно курят в сторонке. Если кто-то готов возразить, милости прошу в комментарии. Спасибо автору, за возможность без рекламы пользоваться полноценным функционалом. Ссылка на приложение \u003Ca href=\"https:\u002F\u002Fplay.google.com\u002Fstore\u002Fapps\u002Fdetails?id=net.routix.mqttdash&amp;hl=en&amp;gl=US\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fplay.google.com\u002Fstore\u002Fapps\u002Fdetails?id=net.routix.mqttdash\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003EЕсли вы используете закрытый MQTT сервер какого либо онлайн сервиса (открытый даже не пытайтесь), или используете свой сервер, как в моем случае. Тогда Вы cможете настроить приложение MQTT Dash и подписаться на свой канал чтения\\управления.\u003C\u002Fp\u003E\u003Ch2\u003EЗаключение\u003C\u002Fh2\u003E\u003Cp\u003EСпасибо, что дочитали до конца. Произошло \"возрождение\" электронного реле, которое радует новым функционалом и возможностями. Накапливаю данные, которые я хочу попробовать обработать, проанализировать в дальнейшем. Если у Вас есть идеи и примеры обработки данных такого типа буду рад послушать Вас!\u003C\u002Fp\u003E\u003Cp\u003E\u002F Alex B. \u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"esp8266"},{"titleHtml":"arduino"},{"titleHtml":"реле давления"},{"titleHtml":"автоматизация"},{"titleHtml":"micropython"},{"titleHtml":"mqtt"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faf7\u002F7d0\u002Ff28\u002Faf77d0f283aba384401e13fd4ce2743a.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faf7\u002F7d0\u002Ff28\u002Faf77d0f283aba384401e13fd4ce2743a.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F581288\\\u002F\"},\"headline\":\"Реле Давления v2.0 — revival\",\"datePublished\":\"2021-10-12T07:00:02+03:00\",\"dateModified\":\"2021-10-13T14:12:00+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Alex Bogdanovich\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F581288\\\u002F#post-content-body\",\"about\":[\"h_controllers\",\"h_home_automation\",\"h_DIY\",\"f_develop\",\"f_popsci\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F581288\\\u002Fbab947b6ff0745c326cef3d786f80e09\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F60a\\\u002F3fb\\\u002Fc7f\\\u002F60a3fbc7f60147c776415fac87ad1822.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F17a\\\u002F1f3\\\u002F5a5\\\u002F17a1f35a556a8374bccef6ae64023a4e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fb75\\\u002F414\\\u002F436\\\u002Fb75414436179659da18b9f0f5f8a233a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F2ae\\\u002F5ab\\\u002Fe0f\\\u002F2ae5abe0f06a19f99767ebeb66ab5cc9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F0ea\\\u002F682\\\u002F102\\\u002F0ea68210283ab09bb79d4d991b44fe57.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4ec\\\u002F9d2\\\u002F973\\\u002F4ec9d2973a363cd77265ef599dfd9a82.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F061\\\u002F141\\\u002F44f\\\u002F06114144ffa59e1d244e1c164feaead4.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F71b\\\u002Fa24\\\u002Fca1\\\u002F71ba24ca1ccc64942263e85f751ea768.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F049\\\u002F0dd\\\u002F305\\\u002F0490dd3055d50dba4886dc6a3dfacfc3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F606\\\u002Faed\\\u002F704\\\u002F606aed704b967a442ccb0f8b10f71f67.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F7ac\\\u002F63e\\\u002F1b7\\\u002F7ac63e1b726d7c8c60061a59a3407e0a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1cc\\\u002Fd82\\\u002Fb1a\\\u002F1ccd82b1a809c12291e0fa8ca86d2bc1.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fecf\\\u002F28e\\\u002F05f\\\u002Fecf28e05f8662aa9f1238d54e19df3e4.jpg\"]}","metaDescription":"Прилетело НЛО и опубликовало эту фразуПусть эта ламповая статейка даст немного радости в столько серые будни не только белорусов, но и всех остальных. Обзор реле давления первого поколения с...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"controllers,home_automation,DIY"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
