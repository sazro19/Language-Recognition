<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Настройка pfBlockerNG на pfSense (часть 1) / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/580978\/"},"headline":"Настройка pfBlockerNG на pfSense (часть 1)","datePublished":"2021-10-07T11:02:47+03:00","dateModified":"2021-10-07T12:37:50+03:00","author":{"@type":"Person","name":"silinio"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepow...","url":"https:\/\/habr.com\/ru\/post\/580978\/#post-content-body","about":["h_infosecurity","h_sys_admin","h_network_technologies","f_develop","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/580978\/f7dc7562dd4e72e3aa956070b26e0317\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/98c\/864\/0ad\/98c8640ad4700576fbd7c7dffd051fa2.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/852\/4e6\/813\/8524e68137ca1946cc9decb05aaca7f6.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/8b7\/137\/c9a\/8b7137c9ad4ad4f55bcb5c95a8ea898f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f4e\/bf6\/c95\/f4ebf6c95d1e207217655276aec810e5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/d9f\/a2f\/2fe\/d9fa2f2fe8d20459a3b706a8504df1ab.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c6f\/b32\/76f\/c6fb3276fe1db135521f28d286114c86.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/101\/cce\/20d\/101cce20d8d22263699bde4b9c952386.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6e5\/a25\/ab9\/6e5a25ab9a0c6fe4d593f4adf77def5c.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Настройка pfBlockerNG на pfSense (часть 1)" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Настройка pfBlockerNG на pfSense (часть 1)" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Настройка pfBlockerNG на pfSense (часть 1)" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/776/b88/0ed/776b880ede2a7031dcfb7cc0e5e97231.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/776/b88/0ed/776b880ede2a7031dcfb7cc0e5e97231.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/776/b88/0ed/776b880ede2a7031dcfb7cc0e5e97231.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/776/b88/0ed/776b880ede2a7031dcfb7cc0e5e97231.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/776/b88/0ed/776b880ede2a7031dcfb7cc0e5e97231.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="580978" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-07T08:02:47.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/580978/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/580978/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/776/b88/0ed/776b880ede2a7031dcfb7cc0e5e97231.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/580978/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/silinio/" title="silinio" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/dc2/6d8/005/dc26d8005c8bb3d20b5cf04831462d34.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/silinio/" class="tm-user-info__username">
      silinio
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-07T08:02:47.000Z" title="2021-10-07, 11:02">7  октября   в 11:02</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Настройка pfBlockerNG на pfSense (часть 1)</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/infosecurity/" class="tm-article-snippet__hubs-item-link"><span>Информационная безопасность</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/sys_admin/" class="tm-article-snippet__hubs-item-link"><span>Системное администрирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/network_technologies/" class="tm-article-snippet__hubs-item-link"><span>Сетевые технологии</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Recovery mode
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class=""><img src="/img/image-loader.svg" height="375" data-src="https://habrastorage.org/getpro/habr/upload_files/98c/864/0ad/98c8640ad4700576fbd7c7dffd051fa2.png" data-width="375"/><figcaption></figcaption></figure><p><a href="http://pfblockerng.com/" rel="noopener noreferrer nofollow">pfBlockerNG</a>? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free аналогов наиболее близок к FireHOL.</p><p>Основные фичи:</p><ul><li><p>Блокировка IP по географическому признаку используя MaxMind GeoIP</p></li><li><p>Блокировка доменов по категориям использую списки Shallalist и UT1</p></li><li><p>Поддержка IP/DNSBL фидов в разных форматах - TXT, CSV, JSON, ASN, WHOIS, Regexp</p></li><li><p>Блокировка великого и ужасного DNS-over-HTTPS</p></li><li><p>Поддержка SafeSearch - переадресация поисковых запросов Google/Youtube/Yandex/Bing/DuckDuckGo на "безопасную" версию для фильтрации контента не предназначенного для детей</p></li><li><p>Детальное ведение лога, ведение статистики и построение отчётов/диаграмм</p></li></ul><p>Для удобства будем считать что у нас уже установлен последний pfSense (2.5.2 на данный момент) и настроены два сетевых интерфейса - LAN и WAN. Задача - установить и настроить pfBlockerNG для защиты от всего плохого и ужасного.</p><h3>Установка и первоначальная настройка</h3><figure class="full-width "><img src="/img/image-loader.svg" height="593" data-src="https://habrastorage.org/getpro/habr/upload_files/852/4e6/813/8524e68137ca1946cc9decb05aaca7f6.png" data-width="1165"/><figcaption></figcaption></figure><p>Заходим на System > Package Manager > Available Packages и выбираем (внимание!) <strong>pfBlockerNG-devel</strong>. Дело в том что т.н. стабильная версия практически не обновляется уже долгое время и если у вас свежая установка - смело ставим именно -devel. Последняя на момент статьи версия - 3.1.0.</p><p>Переходим на Firewall > pfBlockerNG и попадаем в визард начальной настройки. Делаем два next'а и выбираем WAN в качестве inbound интерфейса и LAN в качестве outbound. Оставляем значение VIP адреса и порты как есть.</p><p>После этого запуститься первоначальная синхронизация pfBlockerNG в процессе которой он скачает некоторые дефолтные фиды и перезапустит DNS Resolver.</p><p>Обратите внимание открывшуюся страницу Update - в дальнейшем для применения изменений или обновления фидов на данной странице нужно запускать Force Reload + All/IP/DNSBL для применения/обновления соответствующих настроек и скачивания свежих фидов. Рекомендуется делать это именно через "Force", т.к. вы не всегда можете знать требуют ли определённые опции перезапуска DNS и перегенерации фидов или нет.</p><p>На основной странице Firewall > pfBlockerNG > General убедимся что стоит галочка Enable и оставим остальные параметры как есть.</p><h3>Основные опции блокировки по IP</h3><figure class="full-width "><img src="/img/image-loader.svg" height="611" data-src="https://habrastorage.org/getpro/habr/upload_files/8b7/137/c9a/8b7137c9ad4ad4f55bcb5c95a8ea898f.png" data-width="1158"/><figcaption></figcaption></figure><p>Страница Firewall > pfBlockerNG > IP. Смело включаем <strong>De-Duplication</strong> и <strong>CIDR Aggregation</strong> - обработка больших IP фидом будет чутка дольше, но итоговые алиасы в правилах файрволла будут короче - соответственно будут потреблять меньше памяти и CPU. Включаем <strong>Suppression</strong> - чтобы скачанные фиды не заблокировали ненароком loopback и ваши внутренние RFC1918 адреса. <strong>Force Global IP Logging</strong> можно также включить (особенно на первое время) для ведения логов всего что будет заблокировано вашими IP фидами. В дальнейшем эту опцию можно выключить и активировать логгирование только для тех фидов что вам интересны. Оставляем <strong>Placeholder IP Address</strong> как есть (это просто аварийный IP, на тот случай если неожиданно скачается пустой фид). Красоты ради можно включить и <strong>ASN Reporting</strong> - в репортах будет отображаться номер ASN.</p><p>В настройках <strong>MaxMind GeoIP</strong> вводим ключ (если его у вас ещё нет, то бесплатно регистрируемся на <a href="https://www.maxmind.com/en/geolite2/signup" rel="noopener noreferrer nofollow">https://www.maxmind.com/en/geolite2/signup</a>). Остальные опции оставляем как есть.</p><p><strong>IPv4 Suppression</strong> - белый список IPv4 адресов (/32 маска) и сетей (только /24 маска!) Добавляем если нужно чтобы что-то случайно не заблочилось фидами.</p><p><strong>IP Interface/Rules Configuration</strong> - настройка параметров Auto-rule для IP блокировок. Честно говоря я предпочитаю создавать с помощью pfBlockerNG просто IP алиас и уже вручную создавать правило файрвола там где мне необходимо - получается всегда можно видеть в каком порядке обрабатываются пакеты и править/перемещать правила при необходимости. Поэтому оставляем эти опции как есть, единственно на что хочу заострить внимание,так это опция <strong>Kill States</strong> - включив её, pfBlockerNG грохнет уже установленные сквозь ваш pfSense соединения, если их IP вдруг обнаружились в обновлённом фиде. Это может замедлить процесс обновления, особенно если у вас много фидов и много одновременных сессий, но и повышает безопасность, когда вдруг оказывается что часть хостов в локалке соединены с C&amp;C серверами.</p><h3>IP фиды</h3><figure class="full-width "><img src="/img/image-loader.svg" height="620" data-src="https://habrastorage.org/getpro/habr/upload_files/f4e/bf6/c95/f4ebf6c95d1e207217655276aec810e5.png" data-width="1150"/><figcaption></figcaption></figure><p>Это одна из основных, наравне с DNSBL фидами фишка для которой и устанавливают pfBlockerNG. Тут всё просто - переходим на Firewall > pfBlockerNG > Feeds и видим огромный список как IPv4/IPv6, так и DNSBL фидов. Но пока вкратце по наиболее важным категориям первого типа:</p><ul><li><p><strong>PRI1</strong>/<strong>PRI2</strong>/<strong>PRI3</strong>/<strong>PRI4</strong> - основные фиды со злодейскими IPшниками - вирусы, malware, C&amp;C сервера и пр. Цифра означает качество фидов, т.е. выборка PRI1 более тщательная чем PRI4, где количество false-positive срабатываний может быть намного чаще. </p></li><li><p><strong>SCANNERS</strong> - IP адреса "легальных" сканеров сети, вроде Shodan. Пригодится для фильтрации inbound трафика в случае когда за pfSense стоят другие сервера.</p></li><li><p><strong>SFS</strong> - Stop Forum Spam. Обычно используется для фильтрации входящего трафика для web-серверов, не имеет особого смысла для трафика исходящего из вашей локалки.</p></li><li><p><strong>TOR</strong> - тут думаю всё понятно</p></li><li><p><strong>MAIL</strong> - антиспам-фиды, на случай если за pfSense стоит ваш почтовик</p></li><li><p><strong>DNS</strong> - IP адреса всех известных DNS серверов. Можно использовать для доп. блокировки исходящих DNS запросов на внешние сервера. Но осторожно, могут быть и false-positive срабатывания</p></li><li><p><strong>Proxy</strong>, <strong>Torrent</strong>, <strong>VPN</strong> - IPшки известных прокси серверов, торрент-трекеров и VPN. Последний использовать аккуратно, могут быть заблокированы и вполне легитимные VPNы (например DrWeb Security Space)</p></li></ul><p>Нажимаем на плюсик в правой колонке и попадаем на страницу добавления IP фида. Выставляем <strong>State</strong> в положение ON, чтобы активировать скачивание фида и смотрим Settings. В Action выбираем собственно действие - Inbound/Oubound Deny/Permit понятно, match просто логирует трафик, c <strong>Alias</strong> интереснее - я обычно использую Alias Deny для блокировки и Alias Permit для разрешающих фидов (бывает и такое, см. дальше). <strong>Enable Logging</strong> и <strong>States Removal</strong> аналогичны Force Global IP Logging и Kill States что рассматривались выше. Оставляем остальные опции как есть (периодичность обновления известных фидов прописывается автоматически), разве что стоит обратить внимание на <strong>IPv4 Custom_List</strong> - там можно прописать дополнительные IP или домены/ASN которые преобразуются в IP и будут добавлены к фиду.</p><p>Нажимаем Save и переходим на вкладку Update чтобы запустить процесс обновления. Но лучше добавить ещё фидов, и вообще добить всю конфигурацию и тогда уже сделать  это.</p><p>Иногда нужный фид отсутствует в списке и вы можете просто добавить его вручную - Firewall > pfBlockerNG > IP > IPv4 > кнопка Add. Основные опции мы разобрали, стоит остановиться на форматах:</p><ul><li><p><strong>Auto</strong> - это может быть txt, csv или json файл по указанному URL</p></li><li><p><strong>GeoIP</strong> - при настроенном GeoIP можно просто указать двухбуквенный код страны</p></li><li><p><strong>Whois</strong> - преобразует указанное доменное имя в IP адрес(а)</p></li><li><p><strong>ASN </strong>- можно указать номер или имя ASN (при наборе отобразятся варианты / автодополнение)</p></li></ul><p>В поле <strong>State</strong> также может быть полезен вариант <strong>HOLD</strong> - в этом случает фид скачивается только один раз.</p><p>Кстати, а в когда это может понадобится IP фид для разрешающего правила? Например чтобы используя <a href="https://reestr.rublacklist.net/article/api/" rel="noopener noreferrer nofollow">фиды роскомсвободы</a> логировать нужный трафик. Корпоративный пример - это bypass правило для <a href="https://endpoints.office.com/endpoints/worldwide?clientrequestid=b10c5ed1-bad1-445f-b386-b919946339a7" rel="noopener noreferrer nofollow">адресов Office365</a>.</p><p>Важное про IP фиды - если те стали слишком уж большие, вы можете увидеть в логах pfSense "Cannot allocate memory" ошибку, вроде: </p><pre><code>There were error(s) loading the rules: /tmp/rules.debug:37: cannot define table pfB_Europe_v6: 
Cannot allocate memory - The line in question reads [37]: table &lt;pfB_Europe_v6> persist file "/var/db/aliastables/pfB_Europe_v6.txt" @ 2016-09-24 18:01:48</code></pre><p>Значит под таблицы файрвола (т.е. алиасы) выделено недостаточно памяти. Лечится увеличением <strong>Firewall Maximum Table Entries</strong> (лучше сразу раза в 2-3) на странице System > Advanced > Firewall &amp; NAT.</p><h3>Основные опции DNS блокировки</h3><figure class="full-width "><img src="/img/image-loader.svg" height="609" data-src="https://habrastorage.org/getpro/habr/upload_files/d9f/a2f/2fe/d9fa2f2fe8d20459a3b706a8504df1ab.png" data-width="1163"/><figcaption></figcaption></figure><p>pfBlockerNG использует DNS Resolver (unbound) для фильтрации DNS имён, TLD, IDN и.. обо всё по порядку. </p><p>Заходим на Firewall > pfBlockerNG > DNSBL, включаем и выбираем <strong>DNSBL Mode</strong> - <strong>Unbound python mode</strong>. Данный режим появился не так давно, но достаточно стабилен и обладает куда большим количеством опций (те что с молнией) и работает пошустрее. <strong>Wildcard Blocking (TLD)</strong> - позволяет блокировать целые TLD домены. Следует аккуратно включать эту опцию. <strong>Python Control</strong> - с помощью DNS TXT отправляемых с локалхоста pfBlockerNG может выполнять некоторые простые действия. Вроде мини-API. Можно сделать скрипт который будет подключаться к pfSense по SSH и добавлять/удалять IP в DNSBL bypass список. <strong>DNSBL Blocking</strong> - включаем. <strong>HSTS mode</strong> - исключает отображение ошибок сертификата для многих популярных доменов если те заблокированы через DNSBL. Просто и безопасно. Включаем. <strong>TLD Allow</strong> - блокирует все TLD домены что не выбраны в списке. Если пользователи сети должны работать только с определённым набором TLD доменов (например только клиенты определённых стран + основные домены), то может пригодится. <strong>IDN blocking</strong> - блокирует любые IDN домены. Следует подумать прежде чем активировать, иначе <a href="https://xn--80aesfpebagmfblc0a.xn--p1ai/" rel="noopener noreferrer nofollow">стопкоронавирус.рф</a> не откроется. <strong>Regex Blocking</strong> - блокировка доменов по регулярным выражениям в поле Python Regex List. Если будете их писать - включаем. <strong>CNAME Validation</strong> - проверка через DNSBL всех CNAME, лучше включить. <strong>no AAAA</strong> - если нужно запретить для выбранных доменов IPv6 (AAAA) запросы. <strong>Python Group Policy</strong> - позволяет указать список IP адресов локальных хостов на которые не распространяется DNSBL. Boss/God mode.</p><p><strong>DNSBL Webserver Configuration</strong> - если в локальной сети используется IPv6 то активируем <strong>IPv6 DNSBL</strong>. <strong>Web Server Interface</strong> - убеждаемся что выбран Localhost, иначе могут быть проблемы с другими сервисами, в частности с OSPF на том же интерфейсе.</p><p><strong>DNSBL Configuration</strong> - Включаем <strong>Permit Firewall Rules</strong> и выбираем нужные локальные интерфейсы если хотим фильтровать для нескольких локальных подсеток (напр. LAN, IoT, Guest). Можно сбацать собственную страницу блокировки и выбрать в Blocked Webpage. <strong>Global Logging/Blocking Mode</strong> - для лучшего логирования выбираем Enabled, если хотите меньше сообщений о ошибках сертификата в браузерах пользователей - то Disabled. <strong>Resolver cache</strong> - включаем, скорость ресолвинга имён будет только лучше.</p><p><strong>DNSBL Whitelist</strong> - тут думаю всё понятно. Стоит отметить что как здесь, так и в остальных полях где нужно вводить домены, можно вводить кириллические домены (в смысле IDN).</p><p><strong>TOP1M Whitelist</strong> - позволяет отфильтровать популярные домены из фидов, дабы не заблокировать те ненароком. Лучше включить и потюнить <strong>Domain count</strong> по ходу дела если будет нужно. Не забудьте выбрать те TLD домены что нужно фильтровать.</p><p><strong>TLD Exclusion List / Blacklist / Whitelist</strong> - используются опцией Wildcard Blocking (TLD).</p><p><strong>DNSBL IPs</strong> - предпочитаю выставлять <strong>List Action</strong> в Alias Deny, так, если в DNSBL фидах обнаруживаются чистые IP адреса, то все они будут находиться в алиасе <em>pfB_DNSBLIP_v4</em>, который уже можно ставить куда угодно.</p><h2>DNSBL фиды</h2><figure class="full-width "><img src="/img/image-loader.svg" height="576" data-src="https://habrastorage.org/getpro/habr/upload_files/c6f/b32/76f/c6fb3276fe1db135521f28d286114c86.png" data-width="1146"/><figcaption></figcaption></figure><p>Основной принцип работы с DNSBL фидами тот же что и с IPшными, с небольшими отличиями. Но сначала посмотрим основные виды DNSBL фидов:</p><ul><li><p>EasyList, ADs, ADs_Basic - рекламные домены. Must have.</p></li><li><p>Email - почтовые сервера, может заблочить (без предварительной фильтрации) полезные домены</p></li><li><p>Malicious, Phishing - тут всё понятно</p></li><li><p>Cryptojackers - домены для скрытого майнинга. лучше добавить</p></li><li><p>Compilation - по сути агрегаторы более мелких фидов, могут быть довольно большие и неаккуратные (просто активируйте Top 1M на них)</p></li><li><p>STUN - список STUN доменов используемых (в основном) IP телефонами за NAT'ом</p></li><li><p>Firebog - самые разные фиды с <a href="https://firebog.net/" rel="noopener noreferrer nofollow">firebog.net</a>. Много полезного.</p></li></ul><p>Нажимаем на плюсик в правой колонке и видим страницу очень похожую на ту что мы видели при добавлении IP фида. Но есть некоторые отличия:</p><ul><li><p>В качестве <strong>Action</strong> выбираем Unbound</p></li><li><p><strong>Group Order</strong> - если выставить Primary, то данный фид будет обрабатываться первым в группе. Другими словами если вам нужно чтобы домены из данного фида обрабатывались немного по-другому (напр. иной Logging / Blocking mode) и эти же самые домены могут находиться другом фиде группы.</p></li><li><p><strong>DNSBL Custom_List</strong> - можно вручную добавить ещё доменов. Как было сказано ранее можно напрямую вводить IDN домены.</p></li></ul><p>Думаю по DNSBL фидам всё понятно. Но остались ещё две вкладки - DNSBL Category и DNSBL SafeSearch</p><h2>DNSBL Category</h2><figure class="full-width "><img src="/img/image-loader.svg" height="619" data-src="https://habrastorage.org/getpro/habr/upload_files/101/cce/20d/101cce20d8d22263699bde4b9c952386.png" data-width="1165"/><figcaption></figcaption></figure><p>В двух словах это блокировка по категориям сайтов наподобие Firepower Security Intelligence. Включаем <strong>Blacklist Category</strong>, выбираем понравившийся нам блэклист (или оба!), частоту обновлений, логирование и вперёд! </p><h2>DNSBL SafeSearch</h2><figure class="full-width "><img src="/img/image-loader.svg" height="609" data-src="https://habrastorage.org/getpro/habr/upload_files/6e5/a25/ab9/6e5a25ab9a0c6fe4d593f4adf77def5c.png" data-width="1158"/><figcaption></figcaption></figure><p>На этой странице можно настроить две вещи - собственно SafeSearch, или как его ещё называют "Семейный поиск" и блокировку DoH серверов.</p><p>Просто выбираем <strong>SafeSearch Redirection</strong> - Enable и теперь наши поисковые запросы перенаправляются на "безопасные" поисковые домены, например поиск через www.duckduckgo.com будет перенаправлен на safe.duckduckgo.com. Но это касается только поиска через Google, Yandex, DuckDuckGo, Bing и поисковик по картинкам Pixabay. Причём только Google поддерживает такой безопасный поиск для IPv6. <strong>YouTube Restrictions</strong> работает аналогично (в т.ч. через IPv6), но только для поиска через youtube. Можно даже выбрать "силу" семейного поиска - Moderate (фильтровать мрачную жесть) и Strict (фильтровать любую жесть).</p><p><strong>DNS over HTTPS/TLS Blocking</strong> говорит само за себя и позволяет заблокировать известные DoH сервера. Делаем Enable + выбираем все сервера через Ctrl+A. Готово.</p><p>А что если наши хитрые пользователи просто пропишут любимый DNS сервер в настройках компа? На такой этот случай нужно не забыть заблокировать DNS-over-TLS порт (853) наружу, а также настроить форвардинг портов, так, чтобы любые DNS запросы наружу заворачивались на DNS Resolver pfSense. Не буду копировать сюда текст а просто дам ссылку на то как сделать это: <a href="https://docs.netgate.com/pfsense/en/latest/recipes/dns-redirect.html" rel="noopener noreferrer nofollow">https://docs.netgate.com/pfsense/en/latest/recipes/dns-redirect.html</a>. Не забудьте сделать тоже самое для IPv6 если этот протокол используется в вашей сети.</p><p>Пожалуй всё - и если тут было рассказано про возможности и настройку pfBlockerNG в целом, то в последующем будут step-by-step туториалы под конкретные случаи.</p><p>Полезные статьи по pfSense:</p><ul><li><p><a href="https://habr.com/ru/post/580646/" rel="noopener noreferrer nofollow">pfSense сегодня — VPN</a></p></li><li><p><a href="https://habr.com/ru/post/492684/" rel="noopener noreferrer nofollow">Бесплатный прокси-сервер для предприятия с доменной аутентификацией</a></p></li><li><p><a href="https://habr.com/ru/company/postuf/blog/475068/" rel="noopener noreferrer nofollow">Заворачиваем весь трафик локальной сети в vpn без ограничения скорости</a></p></li></ul><p>p.s. в статью нет описания настройки GeoIP и Reputation - будет во второй части. + разбор интересующих вас вопросов и что-нибудь ещё</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpfsense%5D" class="tm-tags-list__link">pfsense</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpfblockerng%5D" class="tm-tags-list__link">pfblockerng</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdoh%5D" class="tm-tags-list__link">doh</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bfirehol%5D" class="tm-tags-list__link">firehol</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/infosecurity/" class="tm-hubs-list__link">
    Информационная безопасность
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/sys_admin/" class="tm-hubs-list__link">
    Системное администрирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/network_technologies/" class="tm-hubs-list__link">
    Сетевые технологии
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 4: ↑4 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 4: ↑4 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+4</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.5K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    46
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/silinio/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/dc2/6d8/005/dc26d8005c8bb3d20b5cf04831462d34.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 44 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes">
    0
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">22</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">silinio</span> <a href="/ru/users/silinio/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @silinio
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <button type="submit" class="tm-user-card__button btn btn_transparent btn_small">
      Задонатить
    </button> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/580978/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 2 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/580978/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/580978/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"580978":{"id":"580978","timePublished":"2021-10-07T08:02:47+00:00","isCorporative":false,"lang":"ru","titleHtml":"Настройка pfBlockerNG на pfSense (часть 1)","leadData":{"textHtml":"\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Fpfblockerng.com\u002F\" rel=\"noopener noreferrer nofollow\"\u003EpfBlockerNG\u003C\u002Fa\u003E? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence и OpenDNS, ну а из free аналогов наиболее близок к FireHOL.\u003C\u002Fp\u003E\u003Cp\u003EОсновные фичи - Блокировка IP по географическому признаку используя MaxMind GeoIP; Блокировка доменов по категориям использую списки Shallalist и UT1; Поддержка IP\u002FDNSBL фидов в разных форматах - TXT, CSV, JSON, ASN, WHOIS, Regexp; Блокировка великого и ужасного DNS-over-HTTPS; Поддержка SafeSearch - переадресация поисковых запросов Google\u002FYoutube\u002FYandex\u002FBing\u002FDuckDuckGo на \"безопасную\" версию для фильтрации контента не предназначенного для детей; Детальное ведение лога, статистики и построение отчётов\u002Fдиаграмм.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F776\u002Fb88\u002F0ed\u002F776b880ede2a7031dcfb7cc0e5e97231.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F776\u002Fb88\u002F0ed\u002F776b880ede2a7031dcfb7cc0e5e97231.png","fit":"cover","positionY":46.590909090909,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"recovery","data":null}],"author":{"scoreStats":{"score":0,"votesCount":44},"rating":22,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":"41001174488864","paymentPayPalMe":null,"paymentWebmoney":"520039128566"},"id":"33919","alias":"silinio","fullname":"silinio","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdc2\u002F6d8\u002F005\u002Fdc26d8005c8bb3d20b5cf04831462d34.png","speciality":null},"statistics":{"commentsCount":2,"favoritesCount":46,"readingCount":3461,"score":4,"votesCount":4},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"17123","alias":"network_technologies","type":"collective","title":"Сетевые технологии","titleHtml":"Сетевые технологии","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"375\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F98c\u002F864\u002F0ad\u002F98c8640ad4700576fbd7c7dffd051fa2.png\" data-width=\"375\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Fpfblockerng.com\u002F\" rel=\"noopener noreferrer nofollow\"\u003EpfBlockerNG\u003C\u002Fa\u003E? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free аналогов наиболее близок к FireHOL.\u003C\u002Fp\u003E\u003Cp\u003EОсновные фичи:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EБлокировка IP по географическому признаку используя MaxMind GeoIP\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EБлокировка доменов по категориям использую списки Shallalist и UT1\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПоддержка IP\u002FDNSBL фидов в разных форматах - TXT, CSV, JSON, ASN, WHOIS, Regexp\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EБлокировка великого и ужасного DNS-over-HTTPS\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПоддержка SafeSearch - переадресация поисковых запросов Google\u002FYoutube\u002FYandex\u002FBing\u002FDuckDuckGo на \"безопасную\" версию для фильтрации контента не предназначенного для детей\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДетальное ведение лога, ведение статистики и построение отчётов\u002Fдиаграмм\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EДля удобства будем считать что у нас уже установлен последний pfSense (2.5.2 на данный момент) и настроены два сетевых интерфейса - LAN и WAN. Задача - установить и настроить pfBlockerNG для защиты от всего плохого и ужасного.\u003C\u002Fp\u003E\u003Ch3\u003EУстановка и первоначальная настройка\u003C\u002Fh3\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"593\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F852\u002F4e6\u002F813\u002F8524e68137ca1946cc9decb05aaca7f6.png\" data-width=\"1165\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗаходим на System \u003E Package Manager \u003E Available Packages и выбираем (внимание!) \u003Cstrong\u003EpfBlockerNG-devel\u003C\u002Fstrong\u003E. Дело в том что т.н. стабильная версия практически не обновляется уже долгое время и если у вас свежая установка - смело ставим именно -devel. Последняя на момент статьи версия - 3.1.0.\u003C\u002Fp\u003E\u003Cp\u003EПереходим на Firewall \u003E pfBlockerNG и попадаем в визард начальной настройки. Делаем два next'а и выбираем WAN в качестве inbound интерфейса и LAN в качестве outbound. Оставляем значение VIP адреса и порты как есть.\u003C\u002Fp\u003E\u003Cp\u003EПосле этого запуститься первоначальная синхронизация pfBlockerNG в процессе которой он скачает некоторые дефолтные фиды и перезапустит DNS Resolver.\u003C\u002Fp\u003E\u003Cp\u003EОбратите внимание открывшуюся страницу Update - в дальнейшем для применения изменений или обновления фидов на данной странице нужно запускать Force Reload + All\u002FIP\u002FDNSBL для применения\u002Fобновления соответствующих настроек и скачивания свежих фидов. Рекомендуется делать это именно через \"Force\", т.к. вы не всегда можете знать требуют ли определённые опции перезапуска DNS и перегенерации фидов или нет.\u003C\u002Fp\u003E\u003Cp\u003EНа основной странице Firewall \u003E pfBlockerNG \u003E General убедимся что стоит галочка Enable и оставим остальные параметры как есть.\u003C\u002Fp\u003E\u003Ch3\u003EОсновные опции блокировки по IP\u003C\u002Fh3\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"611\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8b7\u002F137\u002Fc9a\u002F8b7137c9ad4ad4f55bcb5c95a8ea898f.png\" data-width=\"1158\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСтраница Firewall \u003E pfBlockerNG \u003E IP. Смело включаем \u003Cstrong\u003EDe-Duplication\u003C\u002Fstrong\u003E и \u003Cstrong\u003ECIDR Aggregation\u003C\u002Fstrong\u003E - обработка больших IP фидом будет чутка дольше, но итоговые алиасы в правилах файрволла будут короче - соответственно будут потреблять меньше памяти и CPU. Включаем \u003Cstrong\u003ESuppression\u003C\u002Fstrong\u003E - чтобы скачанные фиды не заблокировали ненароком loopback и ваши внутренние RFC1918 адреса. \u003Cstrong\u003EForce Global IP Logging\u003C\u002Fstrong\u003E можно также включить (особенно на первое время) для ведения логов всего что будет заблокировано вашими IP фидами. В дальнейшем эту опцию можно выключить и активировать логгирование только для тех фидов что вам интересны. Оставляем \u003Cstrong\u003EPlaceholder IP Address\u003C\u002Fstrong\u003E как есть (это просто аварийный IP, на тот случай если неожиданно скачается пустой фид). Красоты ради можно включить и \u003Cstrong\u003EASN Reporting\u003C\u002Fstrong\u003E - в репортах будет отображаться номер ASN.\u003C\u002Fp\u003E\u003Cp\u003EВ настройках \u003Cstrong\u003EMaxMind GeoIP\u003C\u002Fstrong\u003E вводим ключ (если его у вас ещё нет, то бесплатно регистрируемся на \u003Ca href=\"https:\u002F\u002Fwww.maxmind.com\u002Fen\u002Fgeolite2\u002Fsignup\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fwww.maxmind.com\u002Fen\u002Fgeolite2\u002Fsignup\u003C\u002Fa\u003E). Остальные опции оставляем как есть.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EIPv4 Suppression\u003C\u002Fstrong\u003E - белый список IPv4 адресов (\u002F32 маска) и сетей (только \u002F24 маска!) Добавляем если нужно чтобы что-то случайно не заблочилось фидами.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EIP Interface\u002FRules Configuration\u003C\u002Fstrong\u003E - настройка параметров Auto-rule для IP блокировок. Честно говоря я предпочитаю создавать с помощью pfBlockerNG просто IP алиас и уже вручную создавать правило файрвола там где мне необходимо - получается всегда можно видеть в каком порядке обрабатываются пакеты и править\u002Fперемещать правила при необходимости. Поэтому оставляем эти опции как есть, единственно на что хочу заострить внимание,так это опция \u003Cstrong\u003EKill States\u003C\u002Fstrong\u003E - включив её, pfBlockerNG грохнет уже установленные сквозь ваш pfSense соединения, если их IP вдруг обнаружились в обновлённом фиде. Это может замедлить процесс обновления, особенно если у вас много фидов и много одновременных сессий, но и повышает безопасность, когда вдруг оказывается что часть хостов в локалке соединены с C&amp;C серверами.\u003C\u002Fp\u003E\u003Ch3\u003EIP фиды\u003C\u002Fh3\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"620\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff4e\u002Fbf6\u002Fc95\u002Ff4ebf6c95d1e207217655276aec810e5.png\" data-width=\"1150\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЭто одна из основных, наравне с DNSBL фидами фишка для которой и устанавливают pfBlockerNG. Тут всё просто - переходим на Firewall \u003E pfBlockerNG \u003E Feeds и видим огромный список как IPv4\u002FIPv6, так и DNSBL фидов. Но пока вкратце по наиболее важным категориям первого типа:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EPRI1\u003C\u002Fstrong\u003E\u002F\u003Cstrong\u003EPRI2\u003C\u002Fstrong\u003E\u002F\u003Cstrong\u003EPRI3\u003C\u002Fstrong\u003E\u002F\u003Cstrong\u003EPRI4\u003C\u002Fstrong\u003E - основные фиды со злодейскими IPшниками - вирусы, malware, C&amp;C сервера и пр. Цифра означает качество фидов, т.е. выборка PRI1 более тщательная чем PRI4, где количество false-positive срабатываний может быть намного чаще. \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003ESCANNERS\u003C\u002Fstrong\u003E - IP адреса \"легальных\" сканеров сети, вроде Shodan. Пригодится для фильтрации inbound трафика в случае когда за pfSense стоят другие сервера.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003ESFS\u003C\u002Fstrong\u003E - Stop Forum Spam. Обычно используется для фильтрации входящего трафика для web-серверов, не имеет особого смысла для трафика исходящего из вашей локалки.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003ETOR\u003C\u002Fstrong\u003E - тут думаю всё понятно\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EMAIL\u003C\u002Fstrong\u003E - антиспам-фиды, на случай если за pfSense стоит ваш почтовик\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EDNS\u003C\u002Fstrong\u003E - IP адреса всех известных DNS серверов. Можно использовать для доп. блокировки исходящих DNS запросов на внешние сервера. Но осторожно, могут быть и false-positive срабатывания\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EProxy\u003C\u002Fstrong\u003E, \u003Cstrong\u003ETorrent\u003C\u002Fstrong\u003E, \u003Cstrong\u003EVPN\u003C\u002Fstrong\u003E - IPшки известных прокси серверов, торрент-трекеров и VPN. Последний использовать аккуратно, могут быть заблокированы и вполне легитимные VPNы (например DrWeb Security Space)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EНажимаем на плюсик в правой колонке и попадаем на страницу добавления IP фида. Выставляем \u003Cstrong\u003EState\u003C\u002Fstrong\u003E в положение ON, чтобы активировать скачивание фида и смотрим Settings. В Action выбираем собственно действие - Inbound\u002FOubound Deny\u002FPermit понятно, match просто логирует трафик, c \u003Cstrong\u003EAlias\u003C\u002Fstrong\u003E интереснее - я обычно использую Alias Deny для блокировки и Alias Permit для разрешающих фидов (бывает и такое, см. дальше). \u003Cstrong\u003EEnable Logging\u003C\u002Fstrong\u003E и \u003Cstrong\u003EStates Removal\u003C\u002Fstrong\u003E аналогичны Force Global IP Logging и Kill States что рассматривались выше. Оставляем остальные опции как есть (периодичность обновления известных фидов прописывается автоматически), разве что стоит обратить внимание на \u003Cstrong\u003EIPv4 Custom_List\u003C\u002Fstrong\u003E - там можно прописать дополнительные IP или домены\u002FASN которые преобразуются в IP и будут добавлены к фиду.\u003C\u002Fp\u003E\u003Cp\u003EНажимаем Save и переходим на вкладку Update чтобы запустить процесс обновления. Но лучше добавить ещё фидов, и вообще добить всю конфигурацию и тогда уже сделать  это.\u003C\u002Fp\u003E\u003Cp\u003EИногда нужный фид отсутствует в списке и вы можете просто добавить его вручную - Firewall \u003E pfBlockerNG \u003E IP \u003E IPv4 \u003E кнопка Add. Основные опции мы разобрали, стоит остановиться на форматах:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EAuto\u003C\u002Fstrong\u003E - это может быть txt, csv или json файл по указанному URL\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EGeoIP\u003C\u002Fstrong\u003E - при настроенном GeoIP можно просто указать двухбуквенный код страны\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EWhois\u003C\u002Fstrong\u003E - преобразует указанное доменное имя в IP адрес(а)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EASN \u003C\u002Fstrong\u003E- можно указать номер или имя ASN (при наборе отобразятся варианты \u002F автодополнение)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВ поле \u003Cstrong\u003EState\u003C\u002Fstrong\u003E также может быть полезен вариант \u003Cstrong\u003EHOLD\u003C\u002Fstrong\u003E - в этом случает фид скачивается только один раз.\u003C\u002Fp\u003E\u003Cp\u003EКстати, а в когда это может понадобится IP фид для разрешающего правила? Например чтобы используя \u003Ca href=\"https:\u002F\u002Freestr.rublacklist.net\u002Farticle\u002Fapi\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eфиды роскомсвободы\u003C\u002Fa\u003E логировать нужный трафик. Корпоративный пример - это bypass правило для \u003Ca href=\"https:\u002F\u002Fendpoints.office.com\u002Fendpoints\u002Fworldwide?clientrequestid=b10c5ed1-bad1-445f-b386-b919946339a7\" rel=\"noopener noreferrer nofollow\"\u003Eадресов Office365\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EВажное про IP фиды - если те стали слишком уж большие, вы можете увидеть в логах pfSense \"Cannot allocate memory\" ошибку, вроде: \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EThere were error(s) loading the rules: \u002Ftmp\u002Frules.debug:37: cannot define table pfB_Europe_v6: \nCannot allocate memory - The line in question reads [37]: table &lt;pfB_Europe_v6\u003E persist file \"\u002Fvar\u002Fdb\u002Faliastables\u002FpfB_Europe_v6.txt\" @ 2016-09-24 18:01:48\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗначит под таблицы файрвола (т.е. алиасы) выделено недостаточно памяти. Лечится увеличением \u003Cstrong\u003EFirewall Maximum Table Entries\u003C\u002Fstrong\u003E (лучше сразу раза в 2-3) на странице System \u003E Advanced \u003E Firewall &amp; NAT.\u003C\u002Fp\u003E\u003Ch3\u003EОсновные опции DNS блокировки\u003C\u002Fh3\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"609\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd9f\u002Fa2f\u002F2fe\u002Fd9fa2f2fe8d20459a3b706a8504df1ab.png\" data-width=\"1163\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EpfBlockerNG использует DNS Resolver (unbound) для фильтрации DNS имён, TLD, IDN и.. обо всё по порядку. \u003C\u002Fp\u003E\u003Cp\u003EЗаходим на Firewall \u003E pfBlockerNG \u003E DNSBL, включаем и выбираем \u003Cstrong\u003EDNSBL Mode\u003C\u002Fstrong\u003E - \u003Cstrong\u003EUnbound python mode\u003C\u002Fstrong\u003E. Данный режим появился не так давно, но достаточно стабилен и обладает куда большим количеством опций (те что с молнией) и работает пошустрее. \u003Cstrong\u003EWildcard Blocking (TLD)\u003C\u002Fstrong\u003E - позволяет блокировать целые TLD домены. Следует аккуратно включать эту опцию. \u003Cstrong\u003EPython Control\u003C\u002Fstrong\u003E - с помощью DNS TXT отправляемых с локалхоста pfBlockerNG может выполнять некоторые простые действия. Вроде мини-API. Можно сделать скрипт который будет подключаться к pfSense по SSH и добавлять\u002Fудалять IP в DNSBL bypass список. \u003Cstrong\u003EDNSBL Blocking\u003C\u002Fstrong\u003E - включаем. \u003Cstrong\u003EHSTS mode\u003C\u002Fstrong\u003E - исключает отображение ошибок сертификата для многих популярных доменов если те заблокированы через DNSBL. Просто и безопасно. Включаем. \u003Cstrong\u003ETLD Allow\u003C\u002Fstrong\u003E - блокирует все TLD домены что не выбраны в списке. Если пользователи сети должны работать только с определённым набором TLD доменов (например только клиенты определённых стран + основные домены), то может пригодится. \u003Cstrong\u003EIDN blocking\u003C\u002Fstrong\u003E - блокирует любые IDN домены. Следует подумать прежде чем активировать, иначе \u003Ca href=\"https:\u002F\u002Fxn--80aesfpebagmfblc0a.xn--p1ai\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eстопкоронавирус.рф\u003C\u002Fa\u003E не откроется. \u003Cstrong\u003ERegex Blocking\u003C\u002Fstrong\u003E - блокировка доменов по регулярным выражениям в поле Python Regex List. Если будете их писать - включаем. \u003Cstrong\u003ECNAME Validation\u003C\u002Fstrong\u003E - проверка через DNSBL всех CNAME, лучше включить. \u003Cstrong\u003Eno AAAA\u003C\u002Fstrong\u003E - если нужно запретить для выбранных доменов IPv6 (AAAA) запросы. \u003Cstrong\u003EPython Group Policy\u003C\u002Fstrong\u003E - позволяет указать список IP адресов локальных хостов на которые не распространяется DNSBL. Boss\u002FGod mode.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EDNSBL Webserver Configuration\u003C\u002Fstrong\u003E - если в локальной сети используется IPv6 то активируем \u003Cstrong\u003EIPv6 DNSBL\u003C\u002Fstrong\u003E. \u003Cstrong\u003EWeb Server Interface\u003C\u002Fstrong\u003E - убеждаемся что выбран Localhost, иначе могут быть проблемы с другими сервисами, в частности с OSPF на том же интерфейсе.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EDNSBL Configuration\u003C\u002Fstrong\u003E - Включаем \u003Cstrong\u003EPermit Firewall Rules\u003C\u002Fstrong\u003E и выбираем нужные локальные интерфейсы если хотим фильтровать для нескольких локальных подсеток (напр. LAN, IoT, Guest). Можно сбацать собственную страницу блокировки и выбрать в Blocked Webpage. \u003Cstrong\u003EGlobal Logging\u002FBlocking Mode\u003C\u002Fstrong\u003E - для лучшего логирования выбираем Enabled, если хотите меньше сообщений о ошибках сертификата в браузерах пользователей - то Disabled. \u003Cstrong\u003EResolver cache\u003C\u002Fstrong\u003E - включаем, скорость ресолвинга имён будет только лучше.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EDNSBL Whitelist\u003C\u002Fstrong\u003E - тут думаю всё понятно. Стоит отметить что как здесь, так и в остальных полях где нужно вводить домены, можно вводить кириллические домены (в смысле IDN).\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003ETOP1M Whitelist\u003C\u002Fstrong\u003E - позволяет отфильтровать популярные домены из фидов, дабы не заблокировать те ненароком. Лучше включить и потюнить \u003Cstrong\u003EDomain count\u003C\u002Fstrong\u003E по ходу дела если будет нужно. Не забудьте выбрать те TLD домены что нужно фильтровать.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003ETLD Exclusion List \u002F Blacklist \u002F Whitelist\u003C\u002Fstrong\u003E - используются опцией Wildcard Blocking (TLD).\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EDNSBL IPs\u003C\u002Fstrong\u003E - предпочитаю выставлять \u003Cstrong\u003EList Action\u003C\u002Fstrong\u003E в Alias Deny, так, если в DNSBL фидах обнаруживаются чистые IP адреса, то все они будут находиться в алиасе \u003Cem\u003EpfB_DNSBLIP_v4\u003C\u002Fem\u003E, который уже можно ставить куда угодно.\u003C\u002Fp\u003E\u003Ch2\u003EDNSBL фиды\u003C\u002Fh2\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"576\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc6f\u002Fb32\u002F76f\u002Fc6fb3276fe1db135521f28d286114c86.png\" data-width=\"1146\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EОсновной принцип работы с DNSBL фидами тот же что и с IPшными, с небольшими отличиями. Но сначала посмотрим основные виды DNSBL фидов:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EEasyList, ADs, ADs_Basic - рекламные домены. Must have.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EEmail - почтовые сервера, может заблочить (без предварительной фильтрации) полезные домены\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EMalicious, Phishing - тут всё понятно\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ECryptojackers - домены для скрытого майнинга. лучше добавить\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ECompilation - по сути агрегаторы более мелких фидов, могут быть довольно большие и неаккуратные (просто активируйте Top 1M на них)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ESTUN - список STUN доменов используемых (в основном) IP телефонами за NAT'ом\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EFirebog - самые разные фиды с \u003Ca href=\"https:\u002F\u002Ffirebog.net\u002F\" rel=\"noopener noreferrer nofollow\"\u003Efirebog.net\u003C\u002Fa\u003E. Много полезного.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EНажимаем на плюсик в правой колонке и видим страницу очень похожую на ту что мы видели при добавлении IP фида. Но есть некоторые отличия:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВ качестве \u003Cstrong\u003EAction\u003C\u002Fstrong\u003E выбираем Unbound\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EGroup Order\u003C\u002Fstrong\u003E - если выставить Primary, то данный фид будет обрабатываться первым в группе. Другими словами если вам нужно чтобы домены из данного фида обрабатывались немного по-другому (напр. иной Logging \u002F Blocking mode) и эти же самые домены могут находиться другом фиде группы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EDNSBL Custom_List\u003C\u002Fstrong\u003E - можно вручную добавить ещё доменов. Как было сказано ранее можно напрямую вводить IDN домены.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EДумаю по DNSBL фидам всё понятно. Но остались ещё две вкладки - DNSBL Category и DNSBL SafeSearch\u003C\u002Fp\u003E\u003Ch2\u003EDNSBL Category\u003C\u002Fh2\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"619\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F101\u002Fcce\u002F20d\u002F101cce20d8d22263699bde4b9c952386.png\" data-width=\"1165\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ двух словах это блокировка по категориям сайтов наподобие Firepower Security Intelligence. Включаем \u003Cstrong\u003EBlacklist Category\u003C\u002Fstrong\u003E, выбираем понравившийся нам блэклист (или оба!), частоту обновлений, логирование и вперёд! \u003C\u002Fp\u003E\u003Ch2\u003EDNSBL SafeSearch\u003C\u002Fh2\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"609\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002Fa25\u002Fab9\u002F6e5a25ab9a0c6fe4d593f4adf77def5c.png\" data-width=\"1158\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНа этой странице можно настроить две вещи - собственно SafeSearch, или как его ещё называют \"Семейный поиск\" и блокировку DoH серверов.\u003C\u002Fp\u003E\u003Cp\u003EПросто выбираем \u003Cstrong\u003ESafeSearch Redirection\u003C\u002Fstrong\u003E - Enable и теперь наши поисковые запросы перенаправляются на \"безопасные\" поисковые домены, например поиск через www.duckduckgo.com будет перенаправлен на safe.duckduckgo.com. Но это касается только поиска через Google, Yandex, DuckDuckGo, Bing и поисковик по картинкам Pixabay. Причём только Google поддерживает такой безопасный поиск для IPv6. \u003Cstrong\u003EYouTube Restrictions\u003C\u002Fstrong\u003E работает аналогично (в т.ч. через IPv6), но только для поиска через youtube. Можно даже выбрать \"силу\" семейного поиска - Moderate (фильтровать мрачную жесть) и Strict (фильтровать любую жесть).\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EDNS over HTTPS\u002FTLS Blocking\u003C\u002Fstrong\u003E говорит само за себя и позволяет заблокировать известные DoH сервера. Делаем Enable + выбираем все сервера через Ctrl+A. Готово.\u003C\u002Fp\u003E\u003Cp\u003EА что если наши хитрые пользователи просто пропишут любимый DNS сервер в настройках компа? На такой этот случай нужно не забыть заблокировать DNS-over-TLS порт (853) наружу, а также настроить форвардинг портов, так, чтобы любые DNS запросы наружу заворачивались на DNS Resolver pfSense. Не буду копировать сюда текст а просто дам ссылку на то как сделать это: \u003Ca href=\"https:\u002F\u002Fdocs.netgate.com\u002Fpfsense\u002Fen\u002Flatest\u002Frecipes\u002Fdns-redirect.html\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fdocs.netgate.com\u002Fpfsense\u002Fen\u002Flatest\u002Frecipes\u002Fdns-redirect.html\u003C\u002Fa\u003E. Не забудьте сделать тоже самое для IPv6 если этот протокол используется в вашей сети.\u003C\u002Fp\u003E\u003Cp\u003EПожалуй всё - и если тут было рассказано про возможности и настройку pfBlockerNG в целом, то в последующем будут step-by-step туториалы под конкретные случаи.\u003C\u002Fp\u003E\u003Cp\u003EПолезные статьи по pfSense:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F580646\u002F\" rel=\"noopener noreferrer nofollow\"\u003EpfSense сегодня — VPN\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F492684\u002F\" rel=\"noopener noreferrer nofollow\"\u003EБесплатный прокси-сервер для предприятия с доменной аутентификацией\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fpostuf\u002Fblog\u002F475068\u002F\" rel=\"noopener noreferrer nofollow\"\u003EЗаворачиваем весь трафик локальной сети в vpn без ограничения скорости\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003Ep.s. в статью нет описания настройки GeoIP и Reputation - будет во второй части. + разбор интересующих вас вопросов и что-нибудь ещё\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"pfsense"},{"titleHtml":"pfblockerng"},{"titleHtml":"doh"},{"titleHtml":"firehol"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F776\u002Fb88\u002F0ed\u002F776b880ede2a7031dcfb7cc0e5e97231.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F776\u002Fb88\u002F0ed\u002F776b880ede2a7031dcfb7cc0e5e97231.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F580978\\\u002F\"},\"headline\":\"Настройка pfBlockerNG на pfSense (часть 1)\",\"datePublished\":\"2021-10-07T11:02:47+03:00\",\"dateModified\":\"2021-10-07T12:37:50+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"silinio\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepow...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F580978\\\u002F#post-content-body\",\"about\":[\"h_infosecurity\",\"h_sys_admin\",\"h_network_technologies\",\"f_develop\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F580978\\\u002Ff7dc7562dd4e72e3aa956070b26e0317\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F98c\\\u002F864\\\u002F0ad\\\u002F98c8640ad4700576fbd7c7dffd051fa2.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F852\\\u002F4e6\\\u002F813\\\u002F8524e68137ca1946cc9decb05aaca7f6.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F8b7\\\u002F137\\\u002Fc9a\\\u002F8b7137c9ad4ad4f55bcb5c95a8ea898f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff4e\\\u002Fbf6\\\u002Fc95\\\u002Ff4ebf6c95d1e207217655276aec810e5.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd9f\\\u002Fa2f\\\u002F2fe\\\u002Fd9fa2f2fe8d20459a3b706a8504df1ab.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc6f\\\u002Fb32\\\u002F76f\\\u002Fc6fb3276fe1db135521f28d286114c86.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F101\\\u002Fcce\\\u002F20d\\\u002F101cce20d8d22263699bde4b9c952386.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6e5\\\u002Fa25\\\u002Fab9\\\u002F6e5a25ab9a0c6fe4d593f4adf77def5c.png\"]}","metaDescription":"pfBlockerNG? Что это? Далеко немногие используют функционал pfSense на полную - а ведь данный пакет является по сути  opensource решением близким к Cisco Firepower Security Intelligence, ну а из free...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"infosecurity,sys_admin,network_technologies"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
