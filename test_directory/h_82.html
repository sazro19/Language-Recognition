<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Flare-On 8 2021 CTF writeup&#x27;ы / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/584672\/"},"headline":"Flare-On 8 2021 CTF writeup'ы","datePublished":"2021-10-24T07:02:37+03:00","dateModified":"2021-10-25T09:20:08+03:00","author":{"@type":"Person","name":"Trotil"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлаг...","url":"https:\/\/habr.com\/ru\/post\/584672\/#post-content-body","about":["h_infosecurity","h_reverse-engineering","h_ctf","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/584672\/78e035041442557d9c65ba1e8836a605\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/3b4\/2b8\/a81\/3b42b8a81b4d15c5efc1f3c5a86c0d9f.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/467\/72c\/142\/46772c142a6988fb170a1c0418aee705.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/095\/5b8\/180\/0955b8180f189bfbf50ceb7905a39c5a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/77b\/f0d\/fb4\/77bf0dfb4c5b09eeb071bf9725ea2d20.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/b2f\/09b\/af5\/b2f09baf5d996a865595044f7cdecb3b.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/54c\/ae5\/013\/54cae5013f64048bc87ceb19404cdd94.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4fa\/8c9\/dbc\/4fa8c9dbc1ea5868634ecf28384e50e9.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c88\/ec4\/db5\/c88ec4db5ba3b34c020e1f320fd9be20.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/14a\/a80\/145\/14aa801453047ef448688dc8ee9f907a.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/892\/f43\/9c4\/892f439c46d746f852304d5a7e6be94f.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6e8\/8a6\/74a\/6e88a674ae1d3a82d8a08be24cbf8685.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/921\/1a6\/3f4\/9211a63f47c4001b431bb11ee3f9b424.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/32c\/d91\/1db\/32cd911db6f131d2df3411cd29d9bd40.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6e0\/a92\/9fd\/6e0a929fd2abfdb4979b1f0644c98a2a.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f47\/506\/0f0\/f475060f0915a2fb3e9319400bce8386.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c2b\/cc1\/9b2\/c2bcc19b2f7faea36cbf33821efb5f19.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f2e\/7a0\/9b4\/f2e7a09b469ad4a372fab1e3f74f384a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/571\/985\/377\/5719853779dfbc91d22cd3ee0a777a07.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/be4\/891\/daf\/be4891dafd8404b6dc28cbb4356e431c.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/558\/7c7\/2d6\/5587c72d6a44f859b962d74d70af04bf.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/882\/d13\/be7\/882d13be746b1a6c73d36694de1de94e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/aff\/062\/79f\/aff06279fa5abbdccc2913c5edf5c425.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/762\/421\/bd5\/762421bd570fd7fbd43964ff6e6d2058.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4a0\/1b7\/480\/4a01b748043c74a5eadeacbf07c968e9.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/124\/f60\/f96\/124f60f96848c4f36a67075e9b824ef5.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1ce\/e80\/92c\/1cee8092c028cc5c3f0e72fe2a421836.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/88f\/c3c\/578\/88fc3c5785e130266dce22e17b076b37.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e21\/d2b\/9b9\/e21d2b9b9e9331f2bfed56b0b3b1b739.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/10e\/ad7\/94e\/10ead794e83580baa69f41b69d4a657e.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4ca\/401\/1e6\/4ca4011e61b07bfcf1b405ca4f645bc4.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/235\/21f\/c14\/23521fc149b7a878af70e5e389709e6d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5b1\/b9b\/094\/5b1b9b0941deb5cff335da0621f01bab.PNG","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/448\/fdd\/779\/448fdd779ec8a6fd3cb33efc014fb470.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Flare-On 8 2021 CTF writeup&#x27;ы" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Flare-On 8 2021 CTF writeup&#x27;ы" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Flare-On 8 2021 CTF writeup&#x27;ы" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/f3f/199/4c7/f3f1994c7d61ff3d161f0a433a1c0b04.PNG" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/f3f/199/4c7/f3f1994c7d61ff3d161f0a433a1c0b04.PNG" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/f3f/199/4c7/f3f1994c7d61ff3d161f0a433a1c0b04.PNG" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/f3f/199/4c7/f3f1994c7d61ff3d161f0a433a1c0b04.PNG" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/f3f/199/4c7/f3f1994c7d61ff3d161f0a433a1c0b04.PNG" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="584672" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-24T04:02:37.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/584672/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/584672/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/f3f/199/4c7/f3f1994c7d61ff3d161f0a433a1c0b04.PNG" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/584672/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Trotil/" title="Trotil" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_lilac"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/Trotil/" class="tm-user-info__username">
      Trotil
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-24T04:02:37.000Z" title="2021-10-24, 07:02">вчера в 07:02</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Flare-On 8 2021 CTF writeup'ы</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/infosecurity/" class="tm-article-snippet__hubs-item-link"><span>Информационная безопасность</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/reverse-engineering/" class="tm-article-snippet__hubs-item-link"><span>Реверс-инжиниринг</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/ctf/" class="tm-article-snippet__hubs-item-link"><span>CTF</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/3b4/2b8/a81/3b42b8a81b4d15c5efc1f3c5a86c0d9f.PNG" width="407" height="198"/><figcaption></figcaption></figure><p>Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий нарастающей сложности. Участие в подобных конкурсах позволяет поддерживать свои инженерные навыки в тонусе и каждый раз стимулирует учиться новым интересным вещам. Субъективно задания этого года были проще, чем задания прошлых лет и это  косвенно подтверждается большим числом победителей в этом году.  Сложности при прохождении в основном возникали из-за неочевидности  использования (применения) известных данных, нежели какие-то  технологические или алгоритмические трудности - нужно только было  правильно сопоставить "А" и "Б". Практически все предложенные задания  решались в ручном режиме в отладчике без необходимости применения  узкоспециализированных приёмов и инструментов.  </p><p>Я узнал об этих соревнованиях только в 2019 году, сразу же решил зарегистрироваться и получил от решения всех головоломок огромное удовольствие. На счету у меня теперь третий памятный приз от команды FireEye и в этот раз занял 39 место в общемировом рейтинге (4-ое среди россиян):</p><figure class="full-width "><img src="/img/image-loader.svg" alt="число завершивших CTF к i-тому дню. Длительность конкурса - 6 недель" title="число завершивших CTF к i-тому дню. Длительность конкурса - 6 недель" height="360" data-src="https://habrastorage.org/getpro/habr/upload_files/467/72c/142/46772c142a6988fb170a1c0418aee705.png" data-width="720"/><figcaption>число завершивших CTF к i-тому дню. Длительность конкурса - 6 недель</figcaption></figure><p>Все флаги Flare-On Challenge традиционно оканчиваются на @flare-on.com. Давайте приступим к разбору заданий.</p><figure class="full-width "><img src="/img/image-loader.svg" height="376" data-src="https://habrastorage.org/getpro/habr/upload_files/095/5b8/180/0955b8180f189bfbf50ceb7905a39c5a.png" data-width="723"/><figcaption></figcaption></figure><p>Первое задание Flare-on обычно не вызывает никаких затруднений. В этом году это простая авторизационная html-форма с полями ввода имени пользователя и пароля. Посмотрим, как проверяется валидность данных:</p><details class="spoiler"><summary>исходный код функции checkCreds()</summary><div class="spoiler__content"><pre><code class="javascript">&lt;script>
var form = document.getElementById("credform");
var username = document.getElementById("usrname");
var password = document.getElementById("psw");
var info = document.getElementById("infolabel");
var checkbtn = document.getElementById("checkbtn");
var encoded_key = "P1xNFigYIh0BGAofD1o5RSlXeRU2JiQQSSgCRAJdOw=="

function checkCreds() {

	if (username.value == "Admin" &amp;&amp; atob(password.value) == "goldenticket") 
	{
		var key = atob(encoded_key);
		var flag = "";
		for (let i = 0; i &lt; key.length; i++)
		{
			flag += String.fromCharCode(key.charCodeAt(i) ^ password.value.charCodeAt(i % password.value.length))
		}
		document.getElementById("banner").style.display = "none";
		document.getElementById("formdiv").style.display = "none";
		document.getElementById("message").style.display = "none";
		document.getElementById("final_flag").innerText = flag;
		document.getElementById("winner").style.display = "block";
	}
	else
	{
		document.getElementById("message").style.display = "block";
	}
}

&lt;/script></code></pre></div></details><p>Ну, ок. Прописываем перед if ( ... ) </p><pre><code>username.value = "Admin";
password.value = btoa("goldenticket");
</code></pre><p>вводим в форму произвольные данные для вызова проверочного скрипта и получаем первый ключ:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/77b/f0d/fb4/77bf0dfb4c5b09eeb071bf9725ea2d20.PNG" alt="
" title="
" width="518" height="302"/><figcaption>
</figcaption></figure><figure class="full-width "><img src="/img/image-loader.svg" height="299" data-src="https://habrastorage.org/getpro/habr/upload_files/b2f/09b/af5/b2f09baf5d996a865595044f7cdecb3b.png" data-width="723"/><figcaption></figcaption></figure><p>В наличии программа-распаковщик UnlockYourFiles.exe и 6 зашифрованных файлов:<br/><br/>capa.png.encrypted<br/>cicero.txt.encrypted<br/>commandovm.gif.encrypted<br/>critical_data.txt.encrypted<br/>flarevm.jpg.encrypted<br/>latin_alphabet.txt.encrypted<br/><br/>При запуске программа просит ввести ключ расшифровки. Легко обнаружить, что программа читает и пишет блоками по 8 байт. Также легко проверить, что изменение одного байта ключа влияет только на один байт блока данных. Программа небольшая - всего 9 функций и единственная функция, похожая на дешифровщик данных, выглядит вот так:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/54c/ae5/013/54cae5013f64048bc87ceb19404cdd94.PNG" width="1632" height="473"/><figcaption></figcaption></figure><p><br/>Тот случай, когда ассемблер понятнее вывода дизассемблера. <br/>Проще всего декодировать файл с алфавитом. Перепишем алгоритм на Python:</p><pre><code class="python">alphabet = "ABCDEFGH"
b = [0x0f,0xce,0x60,0xbc,0xe6,0x2f,0x46,0xea]
for i in range(8):
    for c in range(256):
        if (rol(c^b[i],i,8) -i )== ord(alphabet[i]):
            print(chr(c),end='')</code></pre><p>Ключ расшифровки - No1Trust, а флаг - You_Have_Awakened_Me_Too_Soon_EXE@flare-on.com</p><figure class="full-width "><img src="/img/image-loader.svg" height="299" data-src="https://habrastorage.org/getpro/habr/upload_files/4fa/8c9/dbc/4fa8c9dbc1ea5868634ecf28384e50e9.png" data-width="723"/><figcaption></figcaption></figure><p>Здесь мы добрались до чего-то интересного. Дан докер-контейнер. Я решил не возиться с установкой и настройкой системы развёртывания, а для начала изучить его структуру. Технически он представляет собой каталоги с json-описателем и с содержимым в виде tar-архива. Один контейнер содержит файл./AntiochOS, остальные контейнеры - некоторое подмножество файлов a.dat..z.dat. Файлы *.dat нигде не повторяются. У каждого контейнера свой уникальный автор, по другим полям (кроме ID) описания контейнеров не различаются.</p><p>Отлично. Запустим ./AntiochOS:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/c88/ec4/db5/c88ec4db5ba3b34c020e1f320fd9be20.PNG" width="658" height="226"/><figcaption></figcaption></figure><p>В гидре напрямую можно увидеть, что ./AntiochOS поддерживает четыре команды: "help", "quit", "approach" и "consult".</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/14a/a80/145/14aa801453047ef448688dc8ee9f907a.PNG" width="337" height="163"/><figcaption></figcaption></figure><p>Вводный текст команды approach - отслылка к популярной британской фэнтезийной кинокомедии Монти Пайтон и Священный Грааль, и <a href="http://montypython.50webs.com/scripts/Holy_Grail/Scene22.htm" rel="noopener noreferrer nofollow">в сцене 22</a> можно найти ответы на вопросы: имя - Sir Lancelot, квест - Holy Grail, любимый цвет - Blue. Три <s>правильно угаданные буквы дают право открыть две шкатулки</s> угаданных слова выдают пользователю некоторое число. В ./AntiochOS есть массив структур {hash_name, hash_color, res_value}, Программа вычисляет хэши от введённых вами строковых данных, и если проверки пройдены - возвращает вам соответствующим им res_value - уникальный номер в диапазоне [1..30]. Иначе... AAARGH! Имя квеста нигде не используется. </p><p>Замечаем, что Sir Lancelot является создателем одного из контейнеров докера с [a.dat ... z.dat], следовательно, хэши от других имён тоже можно найти в этом массиве структур, а значит, для каждого имени можно подсмотреть свой res_value, даже не зная ответов на 2 и 3 вопросы, в gdb это несложно сделать:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/892/f43/9c4/892f439c46d746f852304d5a7e6be94f.PNG" width="461" height="592"/><figcaption></figcaption></figure><details class="spoiler"><summary>как это сделано</summary><div class="spoiler__content"><p>после вычисления хеша мы проходим по циклу по <em>i</em> до совпадения с <em>data[i].hash_name</em>, после выхода из цикла регистр rdx уже будет указывать на следующий элемент структуры, а значит, что [rdx-0x4] - на data[i-1].res.value</p></div></details><p>и т.д. Смотрите - мы не угадали с цветом, но номер всё равно получили. Далее из каждого контейнера нужно скопировать [a.dat...z.dat] в общее хранилище согласно этим порядковым номерам (порядок важен, из-за пропусков не все *.dat результирующего набора будут из последнего добавленного хранилища). Если всё сделать верно, в псевдографике по команде "consult" можно прочитать флаг Five_Is_Right_0ut@flare-on.com.</p><p>Сидел над заданием больше суток - много неочевидных вещей, дольше всего думал над последним шагом - номера получил, все нужные файлы a.dat..z.dat на руках, бинарник изучен вдоль и поперёк, а что делать с этим богатством дальше - совершенно непонятно.</p><figure class="full-width "><img src="/img/image-loader.svg" height="318" data-src="https://habrastorage.org/getpro/habr/upload_files/6e8/8a6/74a/6e88a674ae1d3a82d8a08be24cbf8685.png" data-width="723"/><figcaption></figcaption></figure><p>Нам предлагают поиграть в мультимедийную игру-угадайку и получить в качестве приза флаг. Суть игры - кликнуть несколько раз на любые из 16 изображений в главном  окне и запросить проверку вашего персонального выбора. Стандартная практика для нулевых - standalone-приложение, движок + проект в одном флаконе. Например, AutoPlay Media Studio, генераторы электронных учебников, игровые движки - были сотни таких программ. CFF Explorer намекает нам, что приложение упаковано:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/921/1a6/3f4/9211a63f47c4001b431bb11ee3f9b424.PNG" width="488" height="34"/><figcaption></figcaption></figure><p>а комментарий приложения гласит, что это приложение сделано с помощью Multimedia Builder:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/32c/d91/1db/32cd911db6f131d2df3411cd29d9bd40.PNG" width="422" height="64"/><figcaption></figcaption></figure><p>Приложение можно <a href="https://github.com/qprotex/MMUnbuilder" rel="noopener noreferrer nofollow">декомпилировать</a> и сохранить проект Multimedia Builder отдельно от приложения. Я решил скачать триальную версию ММВ и открыть этот проект там. К сожалению, распакованный проект в нём открывается как-то совсем криво:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/6e0/a92/9fd/6e0a929fd2abfdb4979b1f0644c98a2a.PNG" width="1472" height="766"/><figcaption></figcaption></figure><p>У меня не получилось получить доступ к ресурсам проекта через ММВ, а также понять в нём, к чему привязан каждый из скриптов, но зато получил подказку, что нужно обратить внимание на папку TEMP (см. скриншот). Аккуратно выпишем все скрипты, может пригодиться:</p><pre><code class="cpp">Script01: part1$='derelict:MZZWP'; PluginSet("PlugIn","part1$")
Script02: part2$='lagan:BAJkR'; PluginSet("PlugIn","part2$")
Script03: part2$='flotsam:DFWEyEW'; PluginSet("PlugIn","part2$")
Script04: part1$='flotsam:PXopvM'; PluginSet("PlugIn","part1$")
Script05: part2$='derelict:LDNCVYU'; PluginSet("PlugIn","part2$")
Script06: part3$='derelict:yXQsGB'; PluginSet("PlugIn","part3$")
Script07: part2$='jetsam:newaui'; PluginSet("PlugIn","part2$")
Script08: part3$='lagan:QICMX'; PluginSet("PlugIn","part3$")
Script09: part1$='lagan:rOPFG'; PluginSet("PlugIn","part1$")
Script10: part3$='jetsam:HwdwAZ'; PluginSet("PlugIn","part3$")
Script11: part1$='jetsam:SLdkv'; PluginSet("PlugIn","part1$")
Script12: part2$='derelict:LSZvYSFHW'; PluginSet("PlugIn","part2$")
Script13: part3$='flotsam:BGgsuhn'; PluginSet("PlugIn","part3$")
Script14: part4$='lagan:GTYAKlwER'; PluginSet("PlugIn","part2$")
Script15: part4$='derelict:RTYXAc'; PluginSet("PlugIn","part4$")
Script16: part2$='lagan:GTXI'; PluginSet("PlugIn","part2$")</code></pre><details class="spoiler"><summary>Script17:</summary><div class="spoiler__content"><pre><code class="cpp">PluginRun("PlugIn","PluginFunc19")
PluginGet("PlugIn","var1$")
NextPage()
LoadVariable("visitors","count")
count = count + 1
SaveVariable("visitors","count")
vc$='Visitor Counter: ' + CHAR(count)
CreateText("mytext","visitlabel$,1050,580,yippy")
LoadText("visitlabel$","vc$")
colr$='TEXTCOLOR=255,0,0'
SetObjectParam("outlabel$","colr$")
SetObjectParam("outlabel$","FONTNAME=Comic Sans MS")
SetObjectParam("outlabel$","FONTSIZE=24")
colors$[1] = '255,0,0'
colors$[2] = '0,255,0'
colors$[3] = '0,0,255'
colors$[4] = '255,0,0'
colors$[5] = '0,255,0'
colors$[6] = '0,0,255'
colors$[7] = '255,0,0'
colors$[8] = '0,255,0'
colors$[9] = '0,0,255'
colors$[10] = '255,0,0'
colors$[11] = '0,255,0'
colors$[12] = '0,0,255'
colors$[13] = '255,0,0'
colors$[14] = '0,255,0'
colors$[15] = '0,0,255'
For Loop= 1 To 1000
  For Counter= 1 To 15
    CreateText("mytext","outlabel$,20,100 + 50 * Counter,yippy")
    LoadText("outlabel$","var1$")
    colr$='TEXTCOLOR='+colors$[Counter]
    SetObjectParam("outlabel$","colr$")
    SetObjectParam("outlabel$","FONTNAME=Comic Sans MS")
    SetObjectParam("outlabel$","FONTSIZE=48")
    Pause("1000")
    DeleteObject("outlabel$")
  Next Counter
Next Loop</code></pre></div></details><p>Так. Значит, при вызове скриптов в памяти приложения формируются четыре строки (derelict, lagan, flotsam, jetsam), а на последнем шаге вызывается результирующий скрипт Script17. Согласно подсказке в папке TEMP обнаруживаем fathom.dll, а в нём - экспортируемую функцию PluginFunc19 (aдрес 0x10002e40). x64dbg позволяет установить брейкпойнт в момент загрузки конкретной DLL, а будучи загруженной, можно определить относительный адрес нужной функции. Каких-то хитрых трюков в решении данного таска как таковых нет, просто нужно раз -нцать пройтись отладчиком по данной функции (она небольшая) и получить ответы на следующие вопросы:</p><ul><li><p>за какой скрипт отвечает каждая картинка игрового приложения</p></li><li><p>все ли данные для нас актуальны (ответ - не все)</p></li><li><p>что за преобразования происходят с данными (если вдруг запутались - очень помогает выписать на бумаге пошагово 1-2 прохода тела цикла  - такого типа комментарии смотри в ch10)</p></li><li><p>на вход какой хеш-функции подаётся блок (ответ - 0x8003 - md5).</p></li></ul><details class="spoiler"><summary>так выглядит пошаговый анализ этого задания в отладчике</summary><div class="spoiler__content"><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/f47/506/0f0/f475060f0915a2fb3e9319400bce8386.PNG" width="1918" height="1156"/><figcaption></figcaption></figure></div></details><p>Я переписал алгоритм PluginFunc19 на Python:</p><pre><code class="python">d = ('MZZWP','LDNCVYU', 'yXQsGB', 'LSZvYSFHW', 'RTYXAc')
l = ('BAJkR','QICMX', 'rOPFG', 'GTYAKlwER','GTXI')
f = ('DFWEyEW', 'PXopvM', 'BGgsuhn')
j  = ('newaui', 'HwdwAZ', 'SLdkv')

import binascii
import random
import hashlib

x = '00A8A3FCD1A79DD2BA8F8F87A4E4CBF9169E81F938E5AF9F909A96A3A9A42596'
x = binascii.unhexlify(x)
x =x[::-1]

for w in range(10):
    for loop in range(10*w):
        f_str = ''
        j_str = ''
        for i in range(3):
            j_str = j_str + j[random.randint(0,2)]
        for i in range(w+1):
            f_str = f_str + f[random.randint(0,2)]
            for i in range(31):
                r[i]= x[i] ^ ord(f_str[i % len(f_str)])
                r[i] = ( r[i] - ord(j_str[i % len(j_str)])) % 256
                if hashlib.md5(r).hexdigest() == '6c5215b12a10e936f8de1e42083ba184':
                    print ('yes')
                    print(j_str)
                    print(f_str)
                    print(hashlib.md5(r).hexdigest())
                    exit
</code></pre><p>запустил на исполнение, получил верную последовательность, которая даёт эталонный хэш. После нажатия правильной игровой комбинации получил верный ключ: s1gn_my_gu357_b00k@flare-on.com</p><figure class="full-width "><img src="/img/image-loader.svg" height="729" data-src="https://habrastorage.org/getpro/habr/upload_files/c2b/cc1/9b2/c2bcc19b2f7faea36cbf33821efb5f19.png" data-width="723"/><figcaption></figcaption></figure><p>Да, это виртуальная машина с неизвестным содержимым внутри. Минимальный набор уважаемого исследователя чужих виртуальных машин выглядит так:</p><pre><code class="bash">cat ~/.bash*
find / -type f -mtime -60 -mtime +1 -exec ls -la {} \: 2>/dev/null | less
ls -la ~
ls -la Documents
crontab -a</code></pre><p>Это даст нам полезные, явно не системные файлы, со свежей датой создания 26 августа 2021 года:</p><ul><li><p>/usr/bin/zyppe   // утилита, устанавливающая слой шифрования</p></li><li><p>/usr/bin/dot        // утилита, требующая ввести какой-то пароль</p></li><li><p>некие константы NUMBER и aлиас FLARE</p></li><li><p>кучу зашифрованных файлов в папке Documents </p></li></ul><p>Начинаем разбираться.</p><p>Необходимо снять слой шифрования. Все текстовые документы раздела Documents имеют размер 1024 байта.  Утилита /usr/bin/zyppe использует симметричный алгоритм, так что всё, что нам нужно, это повторно применить её к содержимому папки Documents.</p><p>Теперь почитаем сами документы:</p><pre><code class="bash">[user@localhost Documents]$ cat udon_noddles.txt.broken 
"ugali", "unagi" and "udon noodles" are delicious. What a coincidence that all of them start by "u"!

[user@localhost Documents]$ cat ugali.txt.broken 
Ugali with Sausages or Spaghetti is tasty. It doesn’t matter if you rotate it left or right, it is still tasty! You should try to come up with a great recipe using CyberChef

[user@localhost Documents]$ cat unagi.txt.broken 
The 1st byte of the password is 0x45</code></pre><p>Документы на букву "s" зашифрованы с помощью команд ror или rol. Исходный вариант:</p><pre><code class="bash">[user@localhost Documents]$ xxd sausages.txt.broken 
00000000: 2a34 b210 19b9 3a10 31bc 3ab2 10b7 3310  *4....:.1.:...3.
00000010: 3a34 b210 38b0 b9b9 bbb7 3932 10b4 b910  :4..8.....92....
00000020: 183c 991a 0500 0000 0000 0000 0000 0000  .&lt;..............</code></pre><p>Преобразованный вариант:</p><pre><code>sausages.txt:         The 2st byte of the password is 0x34
strawberries.txt:     In the FLARE team we like to speak in code. 
spaghetti.txt:        In the FLARE language "spaghetti" is "c3BhZ2hldHRp". 
strawberries.txt:     You should learn our language, otherwise you want be able to speak with us when you escape 
                      (if you manage to escape!). For example, instead of "strawberries" we say "c3RyYXdiZXJyaWVz".</code></pre><p>Подсказок, к каким документам применять указанные алгоритмы больше не будет и необходимо следовать своей интуиции. Документы на букву "r" написаны кодировкой Base64:</p><pre><code class="bash">[user@localhost Documents]$ cat rasberries.txt.broken 
VGhlIDNyZCBieXRlIG9mIHRoZSBwYXNzd29yZCBpczogMHg1MQo=</code></pre><p>Сконвертируем их в человеко-понятный вид:</p><pre><code>rasberries.txt      The 3rd byte of the password is: 0x51
reeses.txt          We LOVE "Reese\'s", they are great for everything! They are amazing 
                    in ice-cream and they even work as a key for XOR encoding </code></pre><p>Документы на букву "b" накрыты операцией ХОR, где первый операнд - исходный текст, второй - i-тый байт "Reese's". Преобразовываем и продолжаем копаться в чужом белье:</p><pre><code class="bash">blue_cheese.txt:         The 4th byte of the password is: 0x35
backberries.txt:         If you are not good in maths, the only thing that can save you is to be a bash expert. 
                         Otherwise you will be locked here forever HA HA HA!
banana_chips.txt:        Are you good at maths? We love maths at FLARE!
                         We use this formula a lot to decode bytes: "ENCODED_BYTE + 27 + NUMBER1 * NUMBER2 - NUMBER3"</code></pre><p>Отлично, пока не очень сложно. Следующие документы - это просто  chr(ord(symbol) + 0x4 )):</p><pre><code>iced_coffee.txt          The only problem with RC4 is that you need a key. The FLARE team normally uses this number: "SREFBE" (as an UTF-8 string). 
                         If you have no idea what that means, you should give up and bake some muffins.
instant_noodles.txt      The 5th byte of the password is: 0xMS
ice_cream.txt            это рецепт вкусного десерта, попробуем его позже, на данный момент
                         оттуда нам важно выяснить, что C -> 0,  B -> 1,  L -> 2...</code></pre><p>Зная ключ для RC4 вскроем документы на букву "n":</p><pre><code>nachos.txt             In the FLARE team we really like Felix Delastelle algorithms,
                       specially the one which combines the Polybius square with transposition, 
                       and uses fractionation to achieve diffusion.
natillas.txt           Do you know natillas? 
                       In Spain, this term refers to a custard dish made with milk and KEYWORD, 
                       similar to other European creams as crème anglaise.
                       In Colombia, the delicacy does not include KEYWORD, and is called natilla
nutella.txt            The 6th byte of the password is: 0x36</code></pre><p>По-видимому, этот шифр малоизвестен в русскоязычной среде. До Flare-2021 pанее в литературе мне нигде не попадались упоминания о нём.  Расшифровать такой шифртекст удобно на ресурсе cryptii.com ( <a href="https://cryptii.com/pipes/bifid-cipher" rel="noopener noreferrer nofollow">https://cryptii.com/pipes/bifid-cipher</a> ). Ура, мы можем прочесть тексты на букву d, например, такой:</p><pre><code>Abn lef emadkxp frceqdnhe? Tah gdcktm temyku xxo qo ktyhzn! Zd'k raooua, por uda ztykqh.
are you missing something? you should search for it better! it's hidden, but not really.</code></pre><p>(читателю для сравнения дан текст до расшифровки и после). Узнаём, что есть скрытый файл с фразой "the 7th byte of the password is: 0x66" и что "giovan battista bellaso loved microwaves". А вы знали, что шифр Виженера придуман не им? Теперь и вы это знаете. </p><p>Применяем шифр Виженера с ключевым словом microwaves к текстам на букву "o", получаем 8-ой байт пароля "0x60", и информацию о том, что Flare Team публикует в твиттере массу интересных публикаций и это поможет вскрыть тексты на оставшуюся букву "t". Увы, я не справился с последним шагом, но известных символов мне хватило, чтобы брутфорсом подобрать нужный пароль для приложения /usr/bin/dot.</p><details class="spoiler"><summary>как это сделано</summary><div class="spoiler__content"><p>Приложение dot вычисляет sha256 от введённой строки и сравнивает её с эталонной. Можно воспользоваться мощной утилитой hashcat для подбора хеша, а можно написать свой брутфорс.</p></div></details><p>Пароль: <code>E4Q45d6f`lD5I</code>, флаг: H4Ck3r_e5c4P3D@flare-on.com</p><p>Весёлый этап, чтобы добраться до ключа, пришлось пройти эдакий лабиринт и распутать серию несложных школьных загадок.</p><figure class="full-width "><img src="/img/image-loader.svg" height="459" data-src="https://habrastorage.org/getpro/habr/upload_files/f2e/7a0/9b4/f2e7a09b469ad4a372fab1e3f74f384a.png" data-width="723"/><figcaption></figcaption></figure><p>Дан pcap-файл с двумя tcp-сессиями между хостом и  A xn--zn8hscq4eeafedhjjkl.flare-on.com. Первая сессия - передача png-котика и некоторого двоичного файла. Вторая сессия - общение мелкими пакетами друг с другом. Заметна определённая структура - двочные файлы начинаются с "MEOW", Dword value, Dword value, "PA30". Увы, Wireshark умеет сохранять сессию в бинарном виде только как единое целое, то есть можно сохранить и после нарезать bin по совпадению с MEOW, но я принял более универсальное решение - сохранить дамп как массивы "C" и быстро набросал python-скрипт по конвертации массивов в множество bin-файлов, благо анализ сетевого траффика - частая встречающаяся задача и удобный инструмент конвертации наверняка пригодится ещё.</p><p>Так, что, собственно, с этим добром делать? Извлечённая картинка было совершнно типовой. <a href="https://www.aldeid.com/wiki/Zsteg" rel="noopener noreferrer nofollow">Стеганографический анализ</a> утилитой zsteg ничего не выявил, PNG-файл содержал правильные заголовки и никаких лишний секций не имел. Второй двоичный файл первой сессии имел размер 10Кб и на полноценную программу (даже упакованную) никак не тянул.</p><p>Довольно быстро нашлось, что 50 41 33 30 (PA30) - это сигнатура Package Delta Format, но <a href="https://reverseengineering.stackexchange.com/questions/19734/dll-starting-with-dcd" rel="noopener noreferrer nofollow">этот в сети пример</a> повёл меня по ложному пути - видно, что у такого файла средняя энтропия и бывают повторяющеся символы (конкурсные пакеты данных такими особенностями не обладали), а своих файлов PA30 на компе не нашлось. Какое-то время потратил на подбор алгоритма сжатия, пока не понял, что это совершенно бесполезное занятие.</p><p>Выручила вот <a href="https://wumb0.in/extracting-and-diffing-ms-patches-in-2020.html" rel="noopener noreferrer nofollow">эта найденная ссылка</a> и опубликованный проект delta_patch.py на гитхабе. И, да, это действительно Package Delta Format! Сложно передать, но это было огромное потрясение. Так умело подобрать данные, нормальное изображение 660 кб патчем в 10 кб превратить в полноценное dll-приложение весом в 1.4 мб. Фокус, похлеще фокусов Гуддини и Копперфильда.</p><p>Прошу простить меня за это большое лирическое отступление, но я никак не ожидал, что оно сработает. Остальное оказалось элементарным делом. Порт и хост можно подсмотреть в tcp-трафике, настроить сеть, написать серверное приложение и сымитировать внешнюю атаку по перехваченным запросам со второй сессии. Выяснилось, dll при установлении соодинения создаёт cmd-подпроцесс, получает shell-команды и отправляет результат их исполнения. Злоумышленник с помощью специальных запросов мог переходить по каталогам файловой системы, читать файлы, запрашивать перечень файлов. В одном прочитанном таким образом файле и содержался ключ 1m_H3rE_Liv3_1m_n0t_a_C4t@flare-on.com.</p><p>Расшифровка и создание патчей осуществлялось библиотечными функциями CreateDeltaB и ApplyDeltaB. Второй вариант решения задачи - написать свой расшифровщик, но я предпочёл просто читать выделенную память в отладчике после вызова ApplyDeltaB, посылая на вход не только сами запросы, но и перехваченные ответы.</p><details class="spoiler"><summary>прикладываю пример расшифрованной команды и ответа:</summary><div class="spoiler__content"><pre><code class="powershell">@echo off &amp; for /f %a in ('dir /s /b') do echo %~fa %~za

C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Cat_Memes 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Great_Ideas 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\No_Flags_Here 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\NO_SERIOUSLY_EVEN_MORE_BESTEST_IDEAS 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Okay_Ideas 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Swag 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\The_BEST_Ideas 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Cat_Memes\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Great_Ideas\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\FlagPit 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\Gotcha.txt 1806
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\The_Real_Challenge 0
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\FlagPit\me0000000w.txt 812
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\The_Real_Challenge\Mugatuware.exe 1532928
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Never\Gonna\Give\You\Up\The_Real_Challenge\mydude.exe 650105
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\No_Flags_Here\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\No_Flags_Here\what_did_you_expect.txt 1658
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\NO_SERIOUSLY_EVEN_MORE_BESTEST_IDEAS\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Okay_Ideas\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\Swag\meow.txt 64
C:\Users\user\Desktop\SuperSecret\2021_FlareOn\The_BEST_Ideas\meow.txt 64</code></pre></div></details><p>Бонус - адрес сайта после декодирования url: 🐈😸😻😹😺🐱😼🙀😿😾😽😻.flare-on.com</p><figure class="full-width "><img src="/img/image-loader.svg" height="299" data-src="https://habrastorage.org/getpro/habr/upload_files/571/985/377/5719853779dfbc91d22cd3ee0a777a07.png" data-width="723"/><figcaption></figcaption></figure><p>Дано классическов MFC-приложение с задизабленными кнопками:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/be4/891/daf/be4891dafd8404b6dc28cbb4356e431c.PNG" width="408" height="329"/><figcaption></figcaption></figure><p>Сразу смутил слишком большой объём файла (4.2Мб) для такого небольшого приложения и поиск по  сигнатуре выявил внутри exe скрытую dll, Системные библиотечные вызовы заменены хэшами. Здравая интуиция говорит, что здесь пытались спрятать важные вещи.</p><p>У доброго охотника на людей есть подборка утилит, разработанных по большей части 15 лет назад, но не потерявших актуальности до сих пор, позволяющие просматривать или менять стили окон, передавать или отслеживать сообщения и уведомления. Мы можем воспользоваться одной из них и привести приложение в работоспособное состояние. Изучение функциональных возможностей проги не даст вам информации о ключе, увы. Нам необходимо искать другие пути.</p><p>Через некоторое время вы обязательно заметите, что при закрытии программы за крест процесс остаётся висеть в системе. Их могут накопиться в системе несколько штук. Они не завершаются, а засыпают посредством вызова SleepEx на 360000мс. Такие паузы можно и нужно убирать. На этом этапе уже начал выполняться код из скрытой dll.</p><p>Программа открывает сетевое соедение с inactive.flare.com:888, посылает команду '@' и ожидает в ответ run|exe|flare-on. Чтобы выполнилась полезная для нас ветка условия, необходимо и достаточно послать приложению команду flare-on и пройти проверку на соответствие имени программы со строкой "Spell.EXE". Первые две команды нам не нужны - это встроенный бэкдор для удалённого управления - для запуска команд и произвольных приложений целевого компьютера.</p><p>В случае команды "flare-on" приложение обращается к встроенному ресурсу с именем PNG (картинка png), расшифровывает её ключом из хедера приложения exe - результат  строка "l3rlcps_7r_vb33eehskc3". Но это ещё не всё, ибо данный текст - бессмыслица. Функция 0x180002730 подсказывает правильный порядок символов флага, шифрует некоторые данные и пишет полученные байт в куст реестра Software\Microsoft\Spel. В реестр можно и не смотреть, ведь флаг мы уже получили шагом ранее. Всё, можно переходить к следующей задаче. Ответ: b3s7_sp3llcheck3r_ev3r@flare-on.com</p><figure class="full-width "><img src="/img/image-loader.svg" height="338" data-src="https://habrastorage.org/getpro/habr/upload_files/558/7c7/2d6/5587c72d6a44f859b962d74d70af04bf.png" data-width="723"/><figcaption></figcaption></figure><p>Не менее прекрасное очередное задание - свыше трёх мегабайт js-скрипта. После беглого осмотра понимаешь, что большая часть этого кода никогда не используется и самое оптимальное решение - вырезать такие фрагменты из файла. </p><pre><code class="perl">my @matches = $content =~ /\{(?:[^}{]+|(?R))*+\}/mg;</code></pre><p>В одной строке ужас и красота регулярных выражений. Мы ищем последовательность, которая начинается открывающейся фигурной скобкой "{" и оканчивается закрывающейся фигурной скобкой "}", содержащей внутри одну из двух альтернатив: либо последовательность из 1 и более символа без фигурных скобок или рекурсивно весь шаблон снова. Таким образом, если у нас не "{{" движок сьедает ненулевое количество нескобочных символов, упирается в открытую скобку и выполняет сопоставление с исходным РВ. Такой регескп работает для правильных скобочных структур.</p><p>Этот классический пример я доработал, а именно - перед удалением добавил проверку, что перед правильной скобочной структурой стоит ключевое слово "function" и далее идут необязательные входные параметры. После perl-скрипта и небольшой ручной работы очищенный код выглядит так:</p><pre><code class="javascript">ciphertext =" ..." // данные, что необходимо расшифровать
some_arr =  "..." // ключ, которым накрыт шифртекст, 221 байт
passwd='gflsdgfdjgflkdsfjg4980utjkfdskfglsldfgjJLmSDA49sdfgjlfdsjjqdgjfj'.split(''); //пароль, который преобразует байты ключа для шифртекста

pass4form=xDyuf5ziRN1SvRgcaYDiFlXE3AwG.ZJqLM97qEThEw2Tgkd8VM5OWlcFN6hx4y2.value.split(';')
if(pass4form[0].length==64)                   
             passwd=pass4form[0].split('');           // применяется пароль из формы ввода html, если он есть и длины 64

ciphertext2 = atob(ciphertext).split('');
ciphertext_len = ciphertext2.length;
 
 arr_221 = atob(some_arr).split('');

 
for (i=0; i &lt; arr_221.length; i++) { arr_221[i] = (arr_221[i].charCodeAt(0) + passwd[i % 64].charCodeAt(0)) &amp; 0xFF;	}
   
   
ciphertext3 = ciphertext2;
for (i=0; i &lt; ciphertext_len; i++) { ciphertext3[i] = (ciphertext3[i].charCodeAt(0) - arr_221[i % arr_221.length]) &amp; 0xFF;	}

res="";
for (i=0; i &lt; ciphertext2.length; i++) { res+=String.fromCharCode(ciphertext3[i]);}
   
if('rFzmLyTiZ6AHlL1Q4xV7G8pW32'>=res)eval(res)

(имена переменных вида PyKEvIqAmUkUVL0Anfn9FElFUN2dic3z переименованы)</code></pre><p>Очевидно, что после расшифровки шифртекста должен получиться валидный js-код (т.е. текстовый файл), поэтому можно написать скрипт, проитерироваться по всем байтам пароля, для каждой позиции подбирая верный, выполняя проверку, что </p><pre><code class="python">if chr(res[i]).isprintable():
   some code ...</code></pre><p>Такая проверка потерпит неудачу.</p><details class="spoiler"><summary>почему?</summary><div class="spoiler__content"><p>потому что текстовый файл помимо печатных символов содержит непечатные "\n\r" (0xa,0xd)</p></div></details><p>Учтём этот небольшой нюанс, и тогда всё получится, правда, для некоторых позиции пароля будут возможны несколько вариантов значений. Это приведёт к тому, что результирующий текст будет местами искажен, если мы точно не угадаем с первоначальным символом на i-том месте пароля. Авторы задания любезно поместили в начало js-кода литературный англоязычный комментарий, который помогает выявить и исправить такие ошибки.</p><p>Итак, мы подобрали пароль и получили валидный js-код. Посмотрим на него:</p><pre><code class="javascript">[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+</code></pre><p>и так далее. Метод обфрускации <a href="https://en.wikipedia.org/wiki/JSFuck" rel="noopener noreferrer nofollow">JSFuck</a>, придуман 10 лет назад, примерно тогда описан и метод деобфрускации. Конвертируем и получаем js-код, скрытый той же методикой, что и изначальный js. Повторяем шаги 1 и 2 несколько раз, пока не доберёмся до флага.</p><p>Ответ: I_h4d_v1rtU411y_n0_r3h34rs4l_f0r_th4t@flare-on.com</p><p>Задача решена.</p><figure class="full-width "><img src="/img/image-loader.svg" height="370" data-src="https://habrastorage.org/getpro/habr/upload_files/882/d13/be7/882d13be746b1a6c73d36694de1de94e.png" data-width="723"/><figcaption></figcaption></figure><p>Самое сложное задание контеста. Вот примерный список трудностей, которые пришлось преодолеть:</p><ul><li><p>разобраться с протоколом UDP и догадаться, что ПО функционирует только с админскими правами </p></li></ul><p>написал тестовый пример и запустил:</p><pre><code class="cpp">WSAStartup(MAKEWORD(2, 2), &amp;data);
SOCKET s = socket(AF_INET, SOCK_RAW, IPPROTO_UDP);</code></pre><p>(c обычными правами это не работало)</p><ul><li><p>обойти в отладчике все антиотладочные проверки</p></li></ul><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/aff/062/79f/aff06279fa5abbdccc2913c5edf5c425.PNG" alt="в x64dbg сделал принудительную установку регистров и флагов в ожидаемое значение," title="в x64dbg сделал принудительную установку регистров и флагов в ожидаемое значение," width="1094" height="140"/><figcaption>в x64dbg сделал принудительную установку регистров и флагов в ожидаемое значение,</figcaption></figure><p>(крайне неочевидный факт - последней операцией необходимо указывать $breakpointcondition=0, иначе отладчик будет делать принудительный останов)</p><ul><li><p>убрать паразитные потоки, которые ничего не делают (вылечилось выявлением мест запуска функции 0x402710 - они создавали случайный тред)</p></li><li><p>расшифровать вызовы функций. Дело в том, что прямых вызовов функций в программе нет, вместо этого есть создание исключительных ситуаций и обработка эксепшенов. В обработчик передаётся хеш имени библиотеки и хеш функции. </p></li><li><p>занопить фейковые инструкции, которые никогда не выполнялись, но запутывали работу дизассемблера. Этот и предыдущий пункты можно автоматизировать.</p></li><li><p>найти поток и участок кода, где происходит обработка входящего сообщения по сети</p></li><li><p>выяснить, что существуют 4 вида входящих сообщений (0x00000001, 0x00000002, 0x00000003, 0x00000004)</p></li></ul><p>0x00000001 - печатает fake-флаг и рикролл, сбрасывает 128-битный ключ в нулевое состояние</p><p>0x00000002 - если сообщение совпадает с одной из четырёх констант s3cret,L0ve,5Ex,g0d, поток исполнения попадает в одну из ветвей второй части функции и заполняет свои 32бита из 128бит ключа, который используется командой 0x3</p><p>0x00000003 - если сообщение совпадает с 'MZ' - вызывает процедуру, что пытается расшифровать некоторые зашифрованные данные ключом 128 бит алгоритмом RC4.</p><p>0x00000004 (и далее) - эхо-ответ</p><p>Если вы справились с вышеперечисленными шагами - кажется, что победа вот-вот близко, но вместо заветного флага в консоль по-прежнему печатается белиберда. Что же не учтёно? Опытным путём было исследовано, что алгоритм в точности таков, каков он здесь описан, и не содержит скрытых условий и ветвей. Есть только одно место, где расшифровывается флаг, по динамическому ключу, части которого зависят от 4 входящих строк. Попробовал оставлять часть хеша незаполненным (нулевой ключ - тоже ключ!), эти 2^4 = 16 комбинаций не помогли. Наконец, заметил, что если посылать сообщения длиннее, чем контрольные константы, мы по-прежнему попадаем в ветви, где вычисляется хеши (результат, конечно же, получается другим), значит, правильный ключ генерируется из входящих сообщений большего размера и это оказались сообщения [b's3cret\0',b'L0ve\0',b'5Ex\0',b'g0d\0'].</p><p>Ответ: n0_mOr3_eXcEpti0n$_p1ea$e@flare-on.com</p><details class="spoiler"><summary>Дополнение: гайд по автоматизации</summary><div class="spoiler__content"><p>Из-за антиотладочных мер листинг evil.exe выглядит нечитабельно:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/762/421/bd5/762421bd570fd7fbd43964ff6e6d2058.PNG" width="930" height="654"/><figcaption></figcaption></figure><p>На скриншоте обфусцирован вызов CreateMutexA():</p><pre><code>MOV       EDX,dword ptr [EBP + local_24]
MOV       ECX,dword ptr [EBP + local_28] // 0x1c5d2c5e = hash("CreateMutexA")
XOR       EAX,EAX
MOV       EAX,dword ptr [EAX]      // разыменование нулевого указателя
</code></pre><p>Обработчик исключения выполняет поиск функции по заданному хэшу и передаёт ей управление. Первые три байта после последнего MOV являются мусорными, т.к. возврат происходит по адресу 0x406512. Это сделано для запутывания дизассемблера и реверс-инженера. Давайте это исправим:</p><details class="spoiler"><summary>Скрипт для ghidra</summary><div class="spoiler__content"><pre><code class="python">from ghidra.program.model.listing import CodeUnit

listing = currentProgram.getListing()
addr = toAddr('00401000')

def check_exc1(addr):
    c = listing.getCodeUnitAt(addr)
    if c.getMnemonicString() != u'MOV':
        return 0
    addr = addr.add(c.length)
    c = listing.getCodeUnitAt(addr)
    if c.getMnemonicString() != u'MOV':
        return 0
    addr = addr.add(c.length)
    c = listing.getCodeUnitAt(addr)
    if c.toString() != u'XOR EAX,EAX':
        return 0
    addr = addr.add(c.length)
    c = listing.getCodeUnitAt(addr)
    if c.toString() != 'MOV EAX,dword ptr [EAX]':
        return 0
    return 1


#while addr &lt; toAddr('00406600'):
while addr &lt; toAddr('00444CED'):
    if check_exc1(addr):
        print(addr)
        addr2 = addr.add(10)
        clearListing(addr2)
        setByte(addr2,0x90)
        disassemble(addr2)

        addr2 = addr2.add(1)
        clearListing(addr2)
        setByte(addr2,0x90)
        disassemble(addr2)

        addr2 = addr2.add(1)
        clearListing(addr2)
        setByte(addr2,0x90)
        disassemble(addr2)

        addr3 = addr2.add(1)
        i = 0
        while i &lt; 20:
            addr2 = addr2.add(1)
            clearListing(addr2)
            i = i + 1
        disassemble(addr3)
    c = listing.getCodeUnitAt(addr)
    addr = addr.add(c.length)</code></pre></div></details><p>Топорный, но вполне работающий вариант. Здесь происходит следующее:</p><ul><li><p>выполняется поиск четвёрки инструкций MOV +MOV + XOR EAX,EAX + MOV (в коде присутствуют и другие исключения, например - деление на ноль)</p></li><li><p>при успехе - очищается листинг на несколько инструкций вперед, и три последующих байта заменяются инструкциями NOP(0x90)</p></li><li><p>ассемблирование участка кода выполняется заново</p></li></ul><p>Можно усовершенствовать этот скрипт, добавив распознавание функций и команду c.SetComment(CodeUnit.EOL_COMMENT,text). Словарь хеш -> "имя функции" можно собрать в x64dbg по адресу 0x4055d6 функции с условным названием API_RESOLVER:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/4a0/1b7/480/4a01b748043c74a5eadeacbf07c968e9.PNG" width="1919" height="794"/><figcaption></figcaption></figure><p>ESI - указатель на строковое имя функции, ECX - её хеш, команда "log" отладчика поможет создать полезную для наших нужд базу данных хешей. Конечный результат может выглядеть следующим образом:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/124/f60/f96/124f60f96848c4f36a67075e9b824ef5.PNG" width="923" height="666"/><figcaption></figcaption></figure><p>Имея в наличии эту базу данных, можно установить комментарии напротив соответствующих инструкций и в Иде, и в x64dbg,</p></div></details><figure class="full-width "><img src="/img/image-loader.svg" height="338" data-src="https://habrastorage.org/getpro/habr/upload_files/1ce/e80/92c/1cee8092c028cc5c3f0e72fe2a421836.png" data-width="723"/><figcaption></figcaption></figure><p>Дан pcap-файл с исполняемым файлом, который общается по протоколу IRC и сама переписка между двумя клиентскими приложениями. Переписка состоит из двух похожих диалогов и каждая из них оканчивается отправкой потока данных с целевого компьютера. Собственная реализация IRC-сервера показалась бесперспективной идеей, а вот <a href="https://www.unrealircd.org/" rel="noopener noreferrer nofollow">готовое решение</a> идеально подошло под задачу. Бот желает общаться с сервером wizardcult.flare-on.com  и пользователем dung3onm4st3r13, требуемое легко настроить. Попытка повторить диалог как в pcap оказалась успешной, за исключением финальной стадии ( после фразы "I quaff my potion and attack!" в оригинальном диалоге возвращался шифркод). Strace прояснил ситуацию:</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/88f/c3c/578/88fc3c5785e130266dce22e17b076b37.PNG" alt="скриншот программы pidgin" title="скриншот программы pidgin" width="716" height="262"/><figcaption>скриншот программы pidgin</figcaption></figure><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/e21/d2b/9b9/e21d2b9b9e9331f2bfed56b0b3b1b739.PNG" alt="stat(&quot;/mages_tower&quot;,...) = -1 ENOENT" title="stat(&quot;/mages_tower&quot;,...) = -1 ENOENT" width="883" height="160"/><figcaption>stat("/mages_tower",...) = -1 ENOENT</figcaption></figure><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/10e/ad7/94e/10ead794e83580baa69f41b69d4a657e.PNG" alt="open(&quot;/mages_tower/cool_wizard_meme.png&quot;,...) = -1 ENOENT" title="open(&quot;/mages_tower/cool_wizard_meme.png&quot;,...) = -1 ENOENT" width="1270" height="209"/><figcaption>open("/mages_tower/cool_wizard_meme.png",...) = -1 ENOENT</figcaption></figure><p>Я создал недостающий каталог и файл и немного поэксперементировал с входными данными: можно проверить, что длина выходных данных совпадает с длиной входных данных, т.е. вход шифруется побайтно, в первом диалоге по входу вида "aaaaaaaaaaaa" возвращается одинаковый вывод, то есть кодирование открытых данных не зависит от них позиции, а во втором случае одинаковым алгоритмом K кодируется каждый k+24 * i символ.<br/>А вот, собственно, и всё - генерируем 256 открытых текстов с одинаковыми символами (или один длинный, содержащий все символы подряд), активируем бота и получаем в ответ множества значений всех 24-ёх функций f_0, f_1, ..., f_23 на всей области определения. Зная, как закодирован произвольный i-тый символ сообщения, по шифртексту можно восстановить исходное сообщение. Это оказалась png-картинка с флагом на ней. Самая сложная задача решена за несколько часов... До сих пор нахожусь в лёгком недоумении, это прокол организаторов или любезно оставленная открытая калитка на заднем дворе. Заметим, что для её решения практически не потребовалось анализировать исходный код.</p><p>После сдачи всех заданий мне захотелось получить дополнительный опыт реверсинга go-приложений и виртуальных машин, так что представим теперь, что такой способ решения задачи или нам неизвестен или невозможен. Первым делом следует ознакомиться с концепциями языка. Мне помогли разобраться следующие источники:</p><ul><li><p>Максим Жашкевич, Язык Go Для Начинающих</p></li><li><p><a href="https://rednaga.io/2016/09/21/reversing_go_binaries_like_a_pro/" rel="noopener noreferrer nofollow">Reversing GO binaries like a pro</a></p></li><li><p><a href="https://dr-knz.net/go-calling-convention-x86-64.html#strings-and-slices-use-two-and-three-words" rel="noopener noreferrer nofollow">The Go low-level calling convention on x86-64</a></p></li></ul><p>Требуется в точности узнать алгоритм шифрования входной последовательности. Этот алгоритм выполняется, очевидно, в некоторой виртуальной машине:</p><figure class=""><img src="https://habrastorage.org/getpro/habr/upload_files/4ca/401/1e6/4ca4011e61b07bfcf1b405ca4f645bc4.PNG" width="281" height="308"/><figcaption></figcaption></figure><p>а сами данные для виртуальной машины загружаются злоумышленником извне как рецепт зелья, каждый ингридиент которого интерпретируется как некоторый байт, что позже поступает на вход декодеру - десериализатору данных в объект. Существует прекрасный инструмент для восстановления символов go-приложений, таких как методы и структуры - <a href="https://go-re.tk/redress/" rel="noopener noreferrer nofollow">redress</a>. Кажется, у нас всё есть для того, чтобы посмотреть на эти данные в человекопонятном виде.</p><p>Смотрите и запускайте <a href="https://play.golang.org/p/9tZW2pnHsSv" rel="noopener noreferrer nofollow">этот код в онлайн-интерпретаторе</a>. Можно переключиться с программы 1 на программу 2. Немного пояснений. Типы данных скопированы как есть из выдачи утилиты redress, сериализованные данные программ ВМ можно сдампить в gdb как входной параметр функции Decoder(), использован <a href="https://golangify.com/gob" rel="noopener noreferrer nofollow">базовый пример работы</a> с encoding/gob и добавлена печать адресов полей структур для определения смещения, это нам пригодится для анализа приложения.</p><p>Вот наглядная интерпретация данных первого диалога из pcap:</p><figure class="full-width "><img src="/img/image-loader.svg" height="386" data-src="https://habrastorage.org/getpro/habr/upload_files/235/21f/c14/23521fc149b7a878af70e5e389709e6d.png" data-width="573"/><figcaption></figcaption></figure><p>то есть виртуальная машина - это многопроцессорная ЭВМ с памятями, входом и выходом и закешированными инструкциями. Я установил брейкпоинты на все ассемблерные команды (и на функции чтения/записи регистров) и обнаружил, что на такой программе срабатывают только три из них: MOV (чаще других), TEQ, XOR, Несложно сопоставить одно с другим и предположить, что программа выполняет out[i] = in[i] ^ 0xa2. и понять, что опкоды mov - 0x01, teq - 0x05, xor - 0x12. Условные операторы устанавливают флаг Cond процессора и инструкции могут пропускаться интерпретатором (если cond_cpu !=cond_instr). Инструкции с Сond=0 исполняются всегда.</p><p>Вот моя самая первая попытка расставить точки останова в ключевых местах и полученный при этом вывод (две итерации цикла по программе со скриншота выше):</p><figure class="full-width "><img src="https://habrastorage.org/getpro/habr/upload_files/5b1/b9b/094/5b1b9b0941deb5cff335da0621f01bab.PNG" alt="к сожалению, хабраредактор не позволяет так разметить текст" title="к сожалению, хабраредактор не позволяет так разметить текст" width="625" height="496"/><figcaption>к сожалению, хабраредактор не позволяет так разметить текст</figcaption></figure><p>Жирным выделены брейкпоинты от второго CPU. Видны переключения контекста от одного CPU к другому. Сначала потоки идут параллельно (от запуска к запуску последовательность инструкций может незначительно меняться), Ключевой момент для осознания реализации работы мультипроцессорности - в строке 02 предпринимается попытка получить значение регистра <strong>r0 cpu1</strong>, поток засыпает ровно до того момента, когда в регистр <strong>r2 cpu0</strong> не будет записано значение (0x63), и, как можно заметить, возвращаемое значение <strong>r0 cpu1</strong> = 0x63. Это указывает на жёсткую связь между <strong>r2 cpu0</strong> и <strong>r0 cpu1</strong>. Далее в строках 06..10 происходит ровно тоже самое. Пытаемся прочитать <strong>r2 cpu0</strong> и засыпаем ровно до того момента, как в <strong>r0 cpu1</strong> не будет записано значение (0xc1).</p><p>Эти связи задаются в разделе Links:</p><pre><code>LHDevice0 - Input Device
LHDevice1 - Output Device
LHDevice2 - CPU0
LHDevice3 - CPU1
....
LHDevice_(N+2) - CPU_N
LHDevice_(N+3) - ROM0
и так далее.</code></pre><p>Здесь: r0 CPU0 - вход, r1 CPU0 - выход, r2 CPU0 ==  r1 CPU1 и программу можно переписать так:</p><pre><code>CPU0: 
mov input, acc
teq acc,-1
если да: mov -1, output
			   mov input, acc
mov acc, r2      /// активируем cpu1 и посылаем входное значение
mov r2, acc      /// получаем данные из cpu1
mov acc, output

CPU1:
mov r0,acc
xor 0xa2,acc
mov acc,r0 (возвращаемся в cpu0)</code></pre><p>После того, как первая программа помогла вам осознать заложенный принцип ВМ, можно разбираться с программой N2, которая несколько запутаннее. Здесь уже не 2 CPU, а 7, кроме того, памяти непусты и содержат некие двоичные данные. Перечень опкодов можно взять в ExecuteInstruction, где анализируется первый параметр и вызывается соответствующая функция ВМ. Для визуализации работы ВМ я написал отладочный модуль, используя gdb.python, главная функция которого для примера представлена ниже:</p><pre><code class="python">
    def print_instr(self):
        pointer_addr_cpu = self.execute_and_get_value('x/g ($rax+0x20)')
        cpu_N_value      = self.execute_and_get_value('x/g ($rax+0x10)')

        pointer_addr_cpu = int(pointer_addr_cpu,0)
        cpu_N_value      = int(cpu_N_value,0)

        ind = self.cpu_addr.index(pointer_addr_cpu)

        cpu_r0      = self.get_reg('x/gx ($rax+0x38)')
        cpu_r1      = self.get_reg('x/gx ($rax+0x40)')
        cpu_r2      = self.get_reg('x/gx ($rax+0x48)')
        cpu_r3      = self.get_reg('x/gx ($rax+0x50)')
        cpu_acc     = self.get_reg('x/gx ($rax+0x0)')
        cpu_dat     = self.get_reg('x/gx ($rax+0x8)')
        cpu_cond    = self.get_param('x/gx ($rax+0x18)')

        instr_opcode = self.execute_and_get_value('x/g (0x%x+0x30*%d)'% (pointer_addr_cpu, cpu_N_value))
        instr_opcode      = (int(instr_opcode,0))
        instr_par1 = self.get_param('x/g (0x%x+0x30*%d+0x08)'% (pointer_addr_cpu, cpu_N_value))
        instr_par2 = self.get_param('x/g (0x%x+0x30*%d+0x10)'% (pointer_addr_cpu, cpu_N_value))
        instr_par3 = self.get_param('x/g (0x%x+0x30*%d+0x18)'% (pointer_addr_cpu, cpu_N_value))
        instr_par4 = self.get_param('x/g (0x%x+0x30*%d+0x20)'% (pointer_addr_cpu, cpu_N_value))
        instr_par5 = self.get_param('x/g (0x%x+0x30*%d+0x28)'% (pointer_addr_cpu, cpu_N_value))

        reg1 = 'r' if int(instr_par4) &amp; 0x1 else ''
        reg2 = 'r' if int(instr_par4) &amp; 0x2 else ''

        #                0     1     2      3      4      5      6      7     8     9   
        instr_names = ['___','mov', 'movc','___', '___', 'teq', 'tgt', 'tlt','tcp', 'add',
                       'sub','mul', 'div', 'not', '___', '___', 'and',' or', 'xor', 'shl', 'shr']

        shift = ' ' * (4 * ind)
        
        if instr_par5 == '0' or int(instr_par5) == int(cpu_cond):
             print ('%s cpu%d_%02d | %s %s%s %s%s %s %s | %s %s %s %s %s %s DEBUG' % (
                shift, ind, cpu_N_value,
                instr_names[instr_opcode], reg1, instr_par1, reg2, instr_par2, instr_par3, instr_par4, 
                cpu_r0,cpu_r1,cpu_r2,cpu_r3,cpu_acc,cpu_dat  ))</code></pre><p>в результате получаем такой красивый вывод в отладчике:</p><details class="spoiler"><summary>лог</summary><div class="spoiler__content"><pre><code>cpu0_00 | mov r0 r4 0 3 | CH0 CH1 CH2 0x0 0x21 0x0                         0x21 -> acc cp0             
cpu0_01 | teq r4 -1 0 1 | CH0 CH1 CH2 0x0 0x21 0x0                         0x21 != -1 ?
cpu0_04 | mov r4 r2 0 3 | CH0 CH1 CH2 0x0 0x21 0x0                         0x21 send r0 cp1
    cpu1_00 | mov r0 r4 0 3 | CH2 CH6 CH3 0x0 0x21 0x1b                    0x21 -> acc cp1
    cpu1_01 | mov r4 r1 0 3 | CH2 CH6 CH3 0x0 0x21 0x1b                    0x21 send r0 cp2
        cpu2_00 | mov r0 r4 0 3 | CH6 CH7 CH8 CH9 0x21 0x0                 0x21 -> acc cp2
        cpu2_01 | tgt r4 63 0 1 | CH6 CH7 CH8 CH9 0x21 0x0                 0x63 > 0x21 ?
        cpu2_04 | mov r4 r1 0 3 | CH6 CH7 CH8 CH9 0x21 0x0                 request data1[0x21]
        cpu2_05 | mov r2 r0 0 3 | CH6 CH7 CH8 CH9 0x21 0x0                 send data1[0x21]=0xf -> r1 cp1
    cpu1_02 | mov r1 r4 0 3 | CH2 CH6 CH3 0x0 0xf 0x1b                     0xf -> acc
    cpu1_03 | mov r4 r2 0 3 | CH2 CH6 CH3 0x0 0xf 0x1b                     0xf send r0 cp5
                    cpu5_03 | mov r0 r5 0 3 | CH3 CH4 CH5 0x0 0x1 0xf      0xf -> dat
                    cpu5_04 | mov r2 r4 0 3 | CH3 CH4 CH5 0x0 0x31 0xf     data4[i] -> acc
                    cpu5_05 | not 539 0 0 0 | CH3 CH4 CH5 0x0 0xce 0xf     acc ^ 0xff           
                    cpu5_06 | and ff 0 0 0 | CH3 CH4 CH5 0x0 0xce 0xf      = 0xce
                    cpu5_07 | xor r5 0 0 1 | CH3 CH4 CH5 0x0 0xc1 0xf      0xf ^ 0xce = 0xc1
                    cpu5_08 | mov r4 r0 0 3 | CH3 CH4 CH5 0x0 0xc1 0xf     0xc1 send r2 cp1
    cpu1_04 | mov r2 r4 0 3 | CH2 CH6 CH3 0x0 0xc1 0x1b                    0xc1 -> acc
                    cpu5_00 | mov r1 r4 0 3 | CH3 CH4 CH5 0x0 0x2 0xf      0x2 -> acc
    cpu1_05 | mov r4 r1 0 3 | CH2 CH6 CH3 0x0 0xc1 0x1b                    0xc1 -> send r0 cp2 
        cpu2_00 | mov r0 r4 0 3 | CH6 CH7 CH8 CH9 0xc1 0x0                 0xc1 -> acc
                    cpu5_01 | and 1 0 0 0 | CH3 CH4 CH5 0x0 0x0 0xf        0x2 &amp; 0x1 = 0x0
        cpu2_01 | tgt r4 63 0 1 | CH6 CH7 CH8 CH9 0xc1 0x0                 0xc1 > 0x63?
                    cpu5_02 | teq r4 1 0 1 | CH3 CH4 CH5 0x0 0x0 0xf       (0x2 &amp; 0x1) == 0x1 ?
        cpu2_02 | mov r4 r3 0 3 | CH6 CH7 CH8 CH9 0xc1 0x0                 0xc1 send r0 cp3
            cpu3_00 | mov r0 r4 0 3 | CH9 CH10 CH11 CH12 0xc1 0x0          0xc1 -> acc
            cpu3_01 | tgt r4 c7 0 1 | CH9 CH10 CH11 CH12 0xc1 0x0          0xc1 > 0xc7 ?
            cpu3_04 | sub 64 0 0 0 | CH9 CH10 CH11 CH12 0x5d 0x0           0xc1 - 0x64 = 0x5d
            cpu3_05 | mov r4 r1 0 3 | CH9 CH10 CH11 CH12 0x5d 0x0          request data2[0x5d] (=0xd6)
            cpu3_06 | mov r2 r0 0 3 | CH9 CH10 CH11 CH12 0x5d 0x0          send 0xd6 r3 cpu2
    cpu1_06 | mov r1 r5 0 3 | CH2 CH6 CH3 0x0 0xc1 0xd6                    0xd6 -> dat
        cpu2_03 | mov r3 r0 0 3 | CH6 CH7 CH8 CH9 0xc1 0x0                 send 0xd6 r1 cpu1
    cpu1_07 | mov 80 r4 0 2 | CH2 CH6 CH3 0x0 0x80 0xd6                    const 0x80 -> acc
    cpu1_08 | and r5 0 0 1 | CH2 CH6 CH3 0x0 0x80 0xd6                     0xd6 ^ 0x80
    cpu1_09 | teq r4 80 0 1 | CH2 CH6 CH3 0x0 0x80 0xd6                    (0xd6 ^ 0x80) == 0x80 ?
    cpu1_10 | mov r5 r4 0 3 | CH2 CH6 CH3 0x0 0xd6 0xd6                    0xd6 -> acc
    cpu1_11 | xor 42 0 0 0 | CH2 CH6 CH3 0x0 0x94 0xd6                     0xd6 ^ 0x42 = 0x94
    cpu1_13 | not 539 0 0 0 | CH2 CH6 CH3 0x0 0xffffff6b 0xd6              0xd6 ^ 0xff = 0x6b
    cpu1_14 | and ff 0 0 0 | CH2 CH6 CH3 0x0 0x6b 0xd6                     
    cpu1_15 | mov r4 r0 0 3 | CH2 CH6 CH3 0x0 0x6b 0xd6                    0x6b -> r2 cp0
cpu0_05 | mov r2 r4 0 3 | CH0 CH1 CH2 0x0 0x6b 0x0                         0x6b -> acc
cpu0_06 | mov r4 r1 0 3 | CH0 CH1 CH2 0x0 0x6b 0x0                         0x6b -> Output
cpu0_00 | mov r0 r4 0 3 | CH0 CH1 CH2 0x0 0x2f 0x0                         Input -> 0x2f</code></pre><p>(CH{i} - это каналы, описанные в разделе Links)</p></div></details><p>Хотелось бы упомнянуть ещё один момент: существует заметная разница в том, когда снимать состояние ЭВМ - до входа в ExecuteInctruction или после. Это обусловлено особенностью работы горутин и go-каналов, а именно, тем фактом, что горутины выполняются асинхронно и могут приостанавливаться в ожидании данных из других горутин. Более понятным порядком следования инструкций будет, если останавливаться позже. Обратите внимание, здесь регистры процессора зафиксированы на момент, когда текущая инструкция уже отработала.</p><p>Оставляю читателю статьи возможность изучить Программу2 в онлайн-интерпретаторе и самостоятельно проследить за ходом исполнения программы по листингу и комментариям, а я приведу лишь итоговый алгоритм, записанный на языке Python:</p><details class="spoiler"><summary>алгоритм шифрования и дешифрования</summary><div class="spoiler__content"><pre><code class="python">def inv(perm):
    inverse = [0] * len(perm)
    for i, p in enumerate(perm):
        inverse[p] = i
    return inverse

import binascii

dat = '5a840645aecbe8f357fea63d5e4108d03322218120dd00a023af71048bf5181de10f6509ce42783ec337ca8f6432e0acde917c2ac007f4959f4053e567b67a524e3f834bc982722e761cf11eccb7d7c78a10791a4d1935167d432bcd86ab4492d40e9814b99ba7241b3ce23ad3f0fd4f77d1a30c48806adabdd8475bfa960beccf49d9117fb127e7c5b263e62836b35dfbdca87025f6b09ca55fb839e485a9fc13025130f269ff74bf59b54617c2586199eba49e89ee6cefa290738c54bc6ddb2cd6e3a18d50f734d5f9017b8ebe686b559d2ded2f93151fc488aaf80d5cea5603c19a38056f624a12df609429757eade90a31b4bbba873b26d26e66c84c97c6'

dat = binascii.unhexlify(dat)
datreverse = inv(dat)

dat4 = b'a11_mY_hom1es_h4t3_b4rds'

inputdata = '23212f75' # example
inputdata = binascii.unhexlify(inputd)

for i in range (len(inputd)):
    
    c = dat4[i%24] ^ dat[inputdata[i]]
    if i%2:
        c = c ^ 0xff
    c = dat[c]
 
    if c &amp; 0x80:
        c = c ^ 0x42
    c = c ^ 0xff

    # -------------------- #
    
    c = c ^ 0xff
    if c &amp; 0x80:
        c = c ^ 0x42
    c = datreverse[c]
    if i%2:
        c = c ^ 0xff
    
    c = datreverse [c ^ dat4[i%24]]</code></pre></div></details><details class="spoiler"><summary>результат наших трудов - картинка с флагом</summary><div class="spoiler__content"><figure class=""><img src="/img/image-loader.svg" height="680" data-src="https://habrastorage.org/getpro/habr/upload_files/448/fdd/779/448fdd779ec8a6fd3cb33efc014fb470.png" data-width="512"/><figcaption></figcaption></figure></div></details><p>На этом я завершаю свою публикацию. Все задания успешно решены. При подготовке этой статьи упущены несущественные моменты из-за необходимости баланса между её размером и содержательностью повествования. Ходы рассуждений сознательно законспектированы в точности так, как это происходило в дни моего участия. Ссылки на решения других участников я добавлю сюда позже по мере их готовности.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bflare-on%5D" class="tm-tags-list__link">flare-on</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%80%D0%B5%D0%B2%D0%B5%D1%80%D1%81-%D0%B8%D0%BD%D0%B6%D0%B8%D0%BD%D0%B8%D1%80%D0%B8%D0%BD%D0%B3%5D" class="tm-tags-list__link">реверс-инжиниринг</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bctf%5D" class="tm-tags-list__link">ctf</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/infosecurity/" class="tm-hubs-list__link">
    Информационная безопасность
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/reverse-engineering/" class="tm-hubs-list__link">
    Реверс-инжиниринг
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/ctf/" class="tm-hubs-list__link">
    CTF
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 5: ↑5 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 5: ↑5 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+5</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">554</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    5
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Trotil/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_lilac"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 4 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    4
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">5</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Trotil</span> <a href="/ru/users/Trotil/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Trotil
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/584672/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/584672/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/584672/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"584672":{"id":"584672","timePublished":"2021-10-24T04:02:37+00:00","isCorporative":false,"lang":"ru","titleHtml":"Flare-On 8 2021 CTF writeup'ы","leadData":{"textHtml":"\u003Cp\u003EЗакончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий нарастающей сложности. Участие в подобных конкурсах позволяет поддерживать свои инженерные навыки в тонусе и каждый раз стимулирует учиться новым интересным вещам. Субъективно задания этого года были проще, чем задания прошлых лет и это  косвенно подтверждается большим числом победителей в этом году.  Сложности при прохождении в основном возникали из-за неочевидности  использования (применения) известных данных, нежели какие-то технологические или алгоритмические трудности - нужно только было правильно сопоставить \"А\" и \"Б\". Практически все предложенные задания  решались в ручном режиме в отладчике без необходимости применения узкоспециализированных приёмов и инструментов.  \u003C\u002Fp\u003E\u003Cp\u003EЯ узнал об этих соревнованиях только в 2019 году, сразу же решил зарегистрироваться и получил от решения всех головоломок огромное удовольствие. На счету у меня теперь третий памятный приз от команды FireEye и в этот раз занял 39 место в общемировом рейтинге (4-ое среди россиян).\u003C\u002Fp\u003E\u003Cp\u003EВсе флаги Flare-On Challenge традиционно оканчиваются на @flare-on.com. Давайте приступим к разбору заданий.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3f\u002F199\u002F4c7\u002Ff3f1994c7d61ff3d161f0a433a1c0b04.PNG","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3f\u002F199\u002F4c7\u002Ff3f1994c7d61ff3d161f0a433a1c0b04.PNG","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":4,"votesCount":4},"rating":5,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"13019","alias":"Trotil","fullname":"Trotil","avatarUrl":null,"speciality":null},"statistics":{"commentsCount":0,"favoritesCount":5,"readingCount":554,"score":5,"votesCount":5},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"19011","alias":"reverse-engineering","type":"collective","title":"Реверс-инжиниринг","titleHtml":"Реверс-инжиниринг","isProfiled":true},{"relatedData":null,"id":"20810","alias":"ctf","type":"collective","title":"CTF","titleHtml":"CTF","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3b4\u002F2b8\u002Fa81\u002F3b42b8a81b4d15c5efc1f3c5a86c0d9f.PNG\" width=\"407\" height=\"198\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗакончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий нарастающей сложности. Участие в подобных конкурсах позволяет поддерживать свои инженерные навыки в тонусе и каждый раз стимулирует учиться новым интересным вещам. Субъективно задания этого года были проще, чем задания прошлых лет и это  косвенно подтверждается большим числом победителей в этом году.  Сложности при прохождении в основном возникали из-за неочевидности  использования (применения) известных данных, нежели какие-то  технологические или алгоритмические трудности - нужно только было  правильно сопоставить \"А\" и \"Б\". Практически все предложенные задания  решались в ручном режиме в отладчике без необходимости применения  узкоспециализированных приёмов и инструментов.  \u003C\u002Fp\u003E\u003Cp\u003EЯ узнал об этих соревнованиях только в 2019 году, сразу же решил зарегистрироваться и получил от решения всех головоломок огромное удовольствие. На счету у меня теперь третий памятный приз от команды FireEye и в этот раз занял 39 место в общемировом рейтинге (4-ое среди россиян):\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"число завершивших CTF к i-тому дню. Длительность конкурса - 6 недель\" title=\"число завершивших CTF к i-тому дню. Длительность конкурса - 6 недель\" height=\"360\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F467\u002F72c\u002F142\u002F46772c142a6988fb170a1c0418aee705.png\" data-width=\"720\"\u002F\u003E\u003Cfigcaption\u003Eчисло завершивших CTF к i-тому дню. Длительность конкурса - 6 недель\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВсе флаги Flare-On Challenge традиционно оканчиваются на @flare-on.com. Давайте приступим к разбору заданий.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"376\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F095\u002F5b8\u002F180\u002F0955b8180f189bfbf50ceb7905a39c5a.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПервое задание Flare-on обычно не вызывает никаких затруднений. В этом году это простая авторизационная html-форма с полями ввода имени пользователя и пароля. Посмотрим, как проверяется валидность данных:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eисходный код функции checkCreds()\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E&lt;script\u003E\nvar form = document.getElementById(\"credform\");\nvar username = document.getElementById(\"usrname\");\nvar password = document.getElementById(\"psw\");\nvar info = document.getElementById(\"infolabel\");\nvar checkbtn = document.getElementById(\"checkbtn\");\nvar encoded_key = \"P1xNFigYIh0BGAofD1o5RSlXeRU2JiQQSSgCRAJdOw==\"\n\nfunction checkCreds() {\n\n\tif (username.value == \"Admin\" &amp;&amp; atob(password.value) == \"goldenticket\") \n\t{\n\t\tvar key = atob(encoded_key);\n\t\tvar flag = \"\";\n\t\tfor (let i = 0; i &lt; key.length; i++)\n\t\t{\n\t\t\tflag += String.fromCharCode(key.charCodeAt(i) ^ password.value.charCodeAt(i % password.value.length))\n\t\t}\n\t\tdocument.getElementById(\"banner\").style.display = \"none\";\n\t\tdocument.getElementById(\"formdiv\").style.display = \"none\";\n\t\tdocument.getElementById(\"message\").style.display = \"none\";\n\t\tdocument.getElementById(\"final_flag\").innerText = flag;\n\t\tdocument.getElementById(\"winner\").style.display = \"block\";\n\t}\n\telse\n\t{\n\t\tdocument.getElementById(\"message\").style.display = \"block\";\n\t}\n}\n\n&lt;\u002Fscript\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНу, ок. Прописываем перед if ( ... ) \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eusername.value = \"Admin\";\npassword.value = btoa(\"goldenticket\");\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eвводим в форму произвольные данные для вызова проверочного скрипта и получаем первый ключ:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F77b\u002Ff0d\u002Ffb4\u002F77bf0dfb4c5b09eeb071bf9725ea2d20.PNG\" alt=\"\n\" title=\"\n\" width=\"518\" height=\"302\"\u002F\u003E\u003Cfigcaption\u003E\n\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"299\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb2f\u002F09b\u002Faf5\u002Fb2f09baf5d996a865595044f7cdecb3b.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ наличии программа-распаковщик UnlockYourFiles.exe и 6 зашифрованных файлов:\u003Cbr\u002F\u003E\u003Cbr\u002F\u003Ecapa.png.encrypted\u003Cbr\u002F\u003Ecicero.txt.encrypted\u003Cbr\u002F\u003Ecommandovm.gif.encrypted\u003Cbr\u002F\u003Ecritical_data.txt.encrypted\u003Cbr\u002F\u003Eflarevm.jpg.encrypted\u003Cbr\u002F\u003Elatin_alphabet.txt.encrypted\u003Cbr\u002F\u003E\u003Cbr\u002F\u003EПри запуске программа просит ввести ключ расшифровки. Легко обнаружить, что программа читает и пишет блоками по 8 байт. Также легко проверить, что изменение одного байта ключа влияет только на один байт блока данных. Программа небольшая - всего 9 функций и единственная функция, похожая на дешифровщик данных, выглядит вот так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F54c\u002Fae5\u002F013\u002F54cae5013f64048bc87ceb19404cdd94.PNG\" width=\"1632\" height=\"473\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cbr\u002F\u003EТот случай, когда ассемблер понятнее вывода дизассемблера. \u003Cbr\u002F\u003EПроще всего декодировать файл с алфавитом. Перепишем алгоритм на Python:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Ealphabet = \"ABCDEFGH\"\nb = [0x0f,0xce,0x60,0xbc,0xe6,0x2f,0x46,0xea]\nfor i in range(8):\n    for c in range(256):\n        if (rol(c^b[i],i,8) -i )== ord(alphabet[i]):\n            print(chr(c),end='')\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКлюч расшифровки - No1Trust, а флаг - You_Have_Awakened_Me_Too_Soon_EXE@flare-on.com\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"299\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4fa\u002F8c9\u002Fdbc\u002F4fa8c9dbc1ea5868634ecf28384e50e9.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗдесь мы добрались до чего-то интересного. Дан докер-контейнер. Я решил не возиться с установкой и настройкой системы развёртывания, а для начала изучить его структуру. Технически он представляет собой каталоги с json-описателем и с содержимым в виде tar-архива. Один контейнер содержит файл.\u002FAntiochOS, остальные контейнеры - некоторое подмножество файлов a.dat..z.dat. Файлы *.dat нигде не повторяются. У каждого контейнера свой уникальный автор, по другим полям (кроме ID) описания контейнеров не различаются.\u003C\u002Fp\u003E\u003Cp\u003EОтлично. Запустим .\u002FAntiochOS:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc88\u002Fec4\u002Fdb5\u002Fc88ec4db5ba3b34c020e1f320fd9be20.PNG\" width=\"658\" height=\"226\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ гидре напрямую можно увидеть, что .\u002FAntiochOS поддерживает четыре команды: \"help\", \"quit\", \"approach\" и \"consult\".\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F14a\u002Fa80\u002F145\u002F14aa801453047ef448688dc8ee9f907a.PNG\" width=\"337\" height=\"163\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВводный текст команды approach - отслылка к популярной британской фэнтезийной кинокомедии Монти Пайтон и Священный Грааль, и \u003Ca href=\"http:\u002F\u002Fmontypython.50webs.com\u002Fscripts\u002FHoly_Grail\u002FScene22.htm\" rel=\"noopener noreferrer nofollow\"\u003Eв сцене 22\u003C\u002Fa\u003E можно найти ответы на вопросы: имя - Sir Lancelot, квест - Holy Grail, любимый цвет - Blue. Три \u003Cs\u003Eправильно угаданные буквы дают право открыть две шкатулки\u003C\u002Fs\u003E угаданных слова выдают пользователю некоторое число. В .\u002FAntiochOS есть массив структур {hash_name, hash_color, res_value}, Программа вычисляет хэши от введённых вами строковых данных, и если проверки пройдены - возвращает вам соответствующим им res_value - уникальный номер в диапазоне [1..30]. Иначе... AAARGH! Имя квеста нигде не используется. \u003C\u002Fp\u003E\u003Cp\u003EЗамечаем, что Sir Lancelot является создателем одного из контейнеров докера с [a.dat ... z.dat], следовательно, хэши от других имён тоже можно найти в этом массиве структур, а значит, для каждого имени можно подсмотреть свой res_value, даже не зная ответов на 2 и 3 вопросы, в gdb это несложно сделать:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F892\u002Ff43\u002F9c4\u002F892f439c46d746f852304d5a7e6be94f.PNG\" width=\"461\" height=\"592\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eкак это сделано\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003Eпосле вычисления хеша мы проходим по циклу по \u003Cem\u003Ei\u003C\u002Fem\u003E до совпадения с \u003Cem\u003Edata[i].hash_name\u003C\u002Fem\u003E, после выхода из цикла регистр rdx уже будет указывать на следующий элемент структуры, а значит, что [rdx-0x4] - на data[i-1].res.value\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003Eи т.д. Смотрите - мы не угадали с цветом, но номер всё равно получили. Далее из каждого контейнера нужно скопировать [a.dat...z.dat] в общее хранилище согласно этим порядковым номерам (порядок важен, из-за пропусков не все *.dat результирующего набора будут из последнего добавленного хранилища). Если всё сделать верно, в псевдографике по команде \"consult\" можно прочитать флаг Five_Is_Right_0ut@flare-on.com.\u003C\u002Fp\u003E\u003Cp\u003EСидел над заданием больше суток - много неочевидных вещей, дольше всего думал над последним шагом - номера получил, все нужные файлы a.dat..z.dat на руках, бинарник изучен вдоль и поперёк, а что делать с этим богатством дальше - совершенно непонятно.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"318\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e8\u002F8a6\u002F74a\u002F6e88a674ae1d3a82d8a08be24cbf8685.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНам предлагают поиграть в мультимедийную игру-угадайку и получить в качестве приза флаг. Суть игры - кликнуть несколько раз на любые из 16 изображений в главном  окне и запросить проверку вашего персонального выбора. Стандартная практика для нулевых - standalone-приложение, движок + проект в одном флаконе. Например, AutoPlay Media Studio, генераторы электронных учебников, игровые движки - были сотни таких программ. CFF Explorer намекает нам, что приложение упаковано:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F921\u002F1a6\u002F3f4\u002F9211a63f47c4001b431bb11ee3f9b424.PNG\" width=\"488\" height=\"34\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003Eа комментарий приложения гласит, что это приложение сделано с помощью Multimedia Builder:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F32c\u002Fd91\u002F1db\u002F32cd911db6f131d2df3411cd29d9bd40.PNG\" width=\"422\" height=\"64\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПриложение можно \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fqprotex\u002FMMUnbuilder\" rel=\"noopener noreferrer nofollow\"\u003Eдекомпилировать\u003C\u002Fa\u003E и сохранить проект Multimedia Builder отдельно от приложения. Я решил скачать триальную версию ММВ и открыть этот проект там. К сожалению, распакованный проект в нём открывается как-то совсем криво:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e0\u002Fa92\u002F9fd\u002F6e0a929fd2abfdb4979b1f0644c98a2a.PNG\" width=\"1472\" height=\"766\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EУ меня не получилось получить доступ к ресурсам проекта через ММВ, а также понять в нём, к чему привязан каждый из скриптов, но зато получил подказку, что нужно обратить внимание на папку TEMP (см. скриншот). Аккуратно выпишем все скрипты, может пригодиться:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EScript01: part1$='derelict:MZZWP'; PluginSet(\"PlugIn\",\"part1$\")\nScript02: part2$='lagan:BAJkR'; PluginSet(\"PlugIn\",\"part2$\")\nScript03: part2$='flotsam:DFWEyEW'; PluginSet(\"PlugIn\",\"part2$\")\nScript04: part1$='flotsam:PXopvM'; PluginSet(\"PlugIn\",\"part1$\")\nScript05: part2$='derelict:LDNCVYU'; PluginSet(\"PlugIn\",\"part2$\")\nScript06: part3$='derelict:yXQsGB'; PluginSet(\"PlugIn\",\"part3$\")\nScript07: part2$='jetsam:newaui'; PluginSet(\"PlugIn\",\"part2$\")\nScript08: part3$='lagan:QICMX'; PluginSet(\"PlugIn\",\"part3$\")\nScript09: part1$='lagan:rOPFG'; PluginSet(\"PlugIn\",\"part1$\")\nScript10: part3$='jetsam:HwdwAZ'; PluginSet(\"PlugIn\",\"part3$\")\nScript11: part1$='jetsam:SLdkv'; PluginSet(\"PlugIn\",\"part1$\")\nScript12: part2$='derelict:LSZvYSFHW'; PluginSet(\"PlugIn\",\"part2$\")\nScript13: part3$='flotsam:BGgsuhn'; PluginSet(\"PlugIn\",\"part3$\")\nScript14: part4$='lagan:GTYAKlwER'; PluginSet(\"PlugIn\",\"part2$\")\nScript15: part4$='derelict:RTYXAc'; PluginSet(\"PlugIn\",\"part4$\")\nScript16: part2$='lagan:GTXI'; PluginSet(\"PlugIn\",\"part2$\")\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EScript17:\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EPluginRun(\"PlugIn\",\"PluginFunc19\")\nPluginGet(\"PlugIn\",\"var1$\")\nNextPage()\nLoadVariable(\"visitors\",\"count\")\ncount = count + 1\nSaveVariable(\"visitors\",\"count\")\nvc$='Visitor Counter: ' + CHAR(count)\nCreateText(\"mytext\",\"visitlabel$,1050,580,yippy\")\nLoadText(\"visitlabel$\",\"vc$\")\ncolr$='TEXTCOLOR=255,0,0'\nSetObjectParam(\"outlabel$\",\"colr$\")\nSetObjectParam(\"outlabel$\",\"FONTNAME=Comic Sans MS\")\nSetObjectParam(\"outlabel$\",\"FONTSIZE=24\")\ncolors$[1] = '255,0,0'\ncolors$[2] = '0,255,0'\ncolors$[3] = '0,0,255'\ncolors$[4] = '255,0,0'\ncolors$[5] = '0,255,0'\ncolors$[6] = '0,0,255'\ncolors$[7] = '255,0,0'\ncolors$[8] = '0,255,0'\ncolors$[9] = '0,0,255'\ncolors$[10] = '255,0,0'\ncolors$[11] = '0,255,0'\ncolors$[12] = '0,0,255'\ncolors$[13] = '255,0,0'\ncolors$[14] = '0,255,0'\ncolors$[15] = '0,0,255'\nFor Loop= 1 To 1000\n  For Counter= 1 To 15\n    CreateText(\"mytext\",\"outlabel$,20,100 + 50 * Counter,yippy\")\n    LoadText(\"outlabel$\",\"var1$\")\n    colr$='TEXTCOLOR='+colors$[Counter]\n    SetObjectParam(\"outlabel$\",\"colr$\")\n    SetObjectParam(\"outlabel$\",\"FONTNAME=Comic Sans MS\")\n    SetObjectParam(\"outlabel$\",\"FONTSIZE=48\")\n    Pause(\"1000\")\n    DeleteObject(\"outlabel$\")\n  Next Counter\nNext Loop\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EТак. Значит, при вызове скриптов в памяти приложения формируются четыре строки (derelict, lagan, flotsam, jetsam), а на последнем шаге вызывается результирующий скрипт Script17. Согласно подсказке в папке TEMP обнаруживаем fathom.dll, а в нём - экспортируемую функцию PluginFunc19 (aдрес 0x10002e40). x64dbg позволяет установить брейкпойнт в момент загрузки конкретной DLL, а будучи загруженной, можно определить относительный адрес нужной функции. Каких-то хитрых трюков в решении данного таска как таковых нет, просто нужно раз -нцать пройтись отладчиком по данной функции (она небольшая) и получить ответы на следующие вопросы:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eза какой скрипт отвечает каждая картинка игрового приложения\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eвсе ли данные для нас актуальны (ответ - не все)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eчто за преобразования происходят с данными (если вдруг запутались - очень помогает выписать на бумаге пошагово 1-2 прохода тела цикла  - такого типа комментарии смотри в ch10)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eна вход какой хеш-функции подаётся блок (ответ - 0x8003 - md5).\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eтак выглядит пошаговый анализ этого задания в отладчике\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff47\u002F506\u002F0f0\u002Ff475060f0915a2fb3e9319400bce8386.PNG\" width=\"1918\" height=\"1156\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EЯ переписал алгоритм PluginFunc19 на Python:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Ed = ('MZZWP','LDNCVYU', 'yXQsGB', 'LSZvYSFHW', 'RTYXAc')\nl = ('BAJkR','QICMX', 'rOPFG', 'GTYAKlwER','GTXI')\nf = ('DFWEyEW', 'PXopvM', 'BGgsuhn')\nj  = ('newaui', 'HwdwAZ', 'SLdkv')\n\nimport binascii\nimport random\nimport hashlib\n\nx = '00A8A3FCD1A79DD2BA8F8F87A4E4CBF9169E81F938E5AF9F909A96A3A9A42596'\nx = binascii.unhexlify(x)\nx =x[::-1]\n\nfor w in range(10):\n    for loop in range(10*w):\n        f_str = ''\n        j_str = ''\n        for i in range(3):\n            j_str = j_str + j[random.randint(0,2)]\n        for i in range(w+1):\n            f_str = f_str + f[random.randint(0,2)]\n            for i in range(31):\n                r[i]= x[i] ^ ord(f_str[i % len(f_str)])\n                r[i] = ( r[i] - ord(j_str[i % len(j_str)])) % 256\n                if hashlib.md5(r).hexdigest() == '6c5215b12a10e936f8de1e42083ba184':\n                    print ('yes')\n                    print(j_str)\n                    print(f_str)\n                    print(hashlib.md5(r).hexdigest())\n                    exit\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eзапустил на исполнение, получил верную последовательность, которая даёт эталонный хэш. После нажатия правильной игровой комбинации получил верный ключ: s1gn_my_gu357_b00k@flare-on.com\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"729\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc2b\u002Fcc1\u002F9b2\u002Fc2bcc19b2f7faea36cbf33821efb5f19.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДа, это виртуальная машина с неизвестным содержимым внутри. Минимальный набор уважаемого исследователя чужих виртуальных машин выглядит так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Ecat ~\u002F.bash*\nfind \u002F -type f -mtime -60 -mtime +1 -exec ls -la {} \\: 2\u003E\u002Fdev\u002Fnull | less\nls -la ~\nls -la Documents\ncrontab -a\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЭто даст нам полезные, явно не системные файлы, со свежей датой создания 26 августа 2021 года:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u002Fusr\u002Fbin\u002Fzyppe   \u002F\u002F утилита, устанавливающая слой шифрования\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u002Fusr\u002Fbin\u002Fdot        \u002F\u002F утилита, требующая ввести какой-то пароль\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eнекие константы NUMBER и aлиас FLARE\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eкучу зашифрованных файлов в папке Documents \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EНачинаем разбираться.\u003C\u002Fp\u003E\u003Cp\u003EНеобходимо снять слой шифрования. Все текстовые документы раздела Documents имеют размер 1024 байта.  Утилита \u002Fusr\u002Fbin\u002Fzyppe использует симметричный алгоритм, так что всё, что нам нужно, это повторно применить её к содержимому папки Documents.\u003C\u002Fp\u003E\u003Cp\u003EТеперь почитаем сами документы:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E[user@localhost Documents]$ cat udon_noddles.txt.broken \n\"ugali\", \"unagi\" and \"udon noodles\" are delicious. What a coincidence that all of them start by \"u\"!\n\n[user@localhost Documents]$ cat ugali.txt.broken \nUgali with Sausages or Spaghetti is tasty. It doesn’t matter if you rotate it left or right, it is still tasty! You should try to come up with a great recipe using CyberChef\n\n[user@localhost Documents]$ cat unagi.txt.broken \nThe 1st byte of the password is 0x45\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДокументы на букву \"s\" зашифрованы с помощью команд ror или rol. Исходный вариант:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E[user@localhost Documents]$ xxd sausages.txt.broken \n00000000: 2a34 b210 19b9 3a10 31bc 3ab2 10b7 3310  *4....:.1.:...3.\n00000010: 3a34 b210 38b0 b9b9 bbb7 3932 10b4 b910  :4..8.....92....\n00000020: 183c 991a 0500 0000 0000 0000 0000 0000  .&lt;..............\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПреобразованный вариант:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Esausages.txt:         The 2st byte of the password is 0x34\nstrawberries.txt:     In the FLARE team we like to speak in code. \nspaghetti.txt:        In the FLARE language \"spaghetti\" is \"c3BhZ2hldHRp\". \nstrawberries.txt:     You should learn our language, otherwise you want be able to speak with us when you escape \n                      (if you manage to escape!). For example, instead of \"strawberries\" we say \"c3RyYXdiZXJyaWVz\".\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПодсказок, к каким документам применять указанные алгоритмы больше не будет и необходимо следовать своей интуиции. Документы на букву \"r\" написаны кодировкой Base64:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E[user@localhost Documents]$ cat rasberries.txt.broken \nVGhlIDNyZCBieXRlIG9mIHRoZSBwYXNzd29yZCBpczogMHg1MQo=\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EСконвертируем их в человеко-понятный вид:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Erasberries.txt      The 3rd byte of the password is: 0x51\nreeses.txt          We LOVE \"Reese\\'s\", they are great for everything! They are amazing \n                    in ice-cream and they even work as a key for XOR encoding \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДокументы на букву \"b\" накрыты операцией ХОR, где первый операнд - исходный текст, второй - i-тый байт \"Reese's\". Преобразовываем и продолжаем копаться в чужом белье:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eblue_cheese.txt:         The 4th byte of the password is: 0x35\nbackberries.txt:         If you are not good in maths, the only thing that can save you is to be a bash expert. \n                         Otherwise you will be locked here forever HA HA HA!\nbanana_chips.txt:        Are you good at maths? We love maths at FLARE!\n                         We use this formula a lot to decode bytes: \"ENCODED_BYTE + 27 + NUMBER1 * NUMBER2 - NUMBER3\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОтлично, пока не очень сложно. Следующие документы - это просто  chr(ord(symbol) + 0x4 )):\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eiced_coffee.txt          The only problem with RC4 is that you need a key. The FLARE team normally uses this number: \"SREFBE\" (as an UTF-8 string). \n                         If you have no idea what that means, you should give up and bake some muffins.\ninstant_noodles.txt      The 5th byte of the password is: 0xMS\nice_cream.txt            это рецепт вкусного десерта, попробуем его позже, на данный момент\n                         оттуда нам важно выяснить, что C -\u003E 0,  B -\u003E 1,  L -\u003E 2...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗная ключ для RC4 вскроем документы на букву \"n\":\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Enachos.txt             In the FLARE team we really like Felix Delastelle algorithms,\n                       specially the one which combines the Polybius square with transposition, \n                       and uses fractionation to achieve diffusion.\nnatillas.txt           Do you know natillas? \n                       In Spain, this term refers to a custard dish made with milk and KEYWORD, \n                       similar to other European creams as crème anglaise.\n                       In Colombia, the delicacy does not include KEYWORD, and is called natilla\nnutella.txt            The 6th byte of the password is: 0x36\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПо-видимому, этот шифр малоизвестен в русскоязычной среде. До Flare-2021 pанее в литературе мне нигде не попадались упоминания о нём.  Расшифровать такой шифртекст удобно на ресурсе cryptii.com ( \u003Ca href=\"https:\u002F\u002Fcryptii.com\u002Fpipes\u002Fbifid-cipher\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fcryptii.com\u002Fpipes\u002Fbifid-cipher\u003C\u002Fa\u003E ). Ура, мы можем прочесть тексты на букву d, например, такой:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EAbn lef emadkxp frceqdnhe? Tah gdcktm temyku xxo qo ktyhzn! Zd'k raooua, por uda ztykqh.\nare you missing something? you should search for it better! it's hidden, but not really.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E(читателю для сравнения дан текст до расшифровки и после). Узнаём, что есть скрытый файл с фразой \"the 7th byte of the password is: 0x66\" и что \"giovan battista bellaso loved microwaves\". А вы знали, что шифр Виженера придуман не им? Теперь и вы это знаете. \u003C\u002Fp\u003E\u003Cp\u003EПрименяем шифр Виженера с ключевым словом microwaves к текстам на букву \"o\", получаем 8-ой байт пароля \"0x60\", и информацию о том, что Flare Team публикует в твиттере массу интересных публикаций и это поможет вскрыть тексты на оставшуюся букву \"t\". Увы, я не справился с последним шагом, но известных символов мне хватило, чтобы брутфорсом подобрать нужный пароль для приложения \u002Fusr\u002Fbin\u002Fdot.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eкак это сделано\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EПриложение dot вычисляет sha256 от введённой строки и сравнивает её с эталонной. Можно воспользоваться мощной утилитой hashcat для подбора хеша, а можно написать свой брутфорс.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EПароль: \u003Ccode\u003EE4Q45d6f`lD5I\u003C\u002Fcode\u003E, флаг: H4Ck3r_e5c4P3D@flare-on.com\u003C\u002Fp\u003E\u003Cp\u003EВесёлый этап, чтобы добраться до ключа, пришлось пройти эдакий лабиринт и распутать серию несложных школьных загадок.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"459\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff2e\u002F7a0\u002F9b4\u002Ff2e7a09b469ad4a372fab1e3f74f384a.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДан pcap-файл с двумя tcp-сессиями между хостом и  A xn--zn8hscq4eeafedhjjkl.flare-on.com. Первая сессия - передача png-котика и некоторого двоичного файла. Вторая сессия - общение мелкими пакетами друг с другом. Заметна определённая структура - двочные файлы начинаются с \"MEOW\", Dword value, Dword value, \"PA30\". Увы, Wireshark умеет сохранять сессию в бинарном виде только как единое целое, то есть можно сохранить и после нарезать bin по совпадению с MEOW, но я принял более универсальное решение - сохранить дамп как массивы \"C\" и быстро набросал python-скрипт по конвертации массивов в множество bin-файлов, благо анализ сетевого траффика - частая встречающаяся задача и удобный инструмент конвертации наверняка пригодится ещё.\u003C\u002Fp\u003E\u003Cp\u003EТак, что, собственно, с этим добром делать? Извлечённая картинка было совершнно типовой. \u003Ca href=\"https:\u002F\u002Fwww.aldeid.com\u002Fwiki\u002FZsteg\" rel=\"noopener noreferrer nofollow\"\u003EСтеганографический анализ\u003C\u002Fa\u003E утилитой zsteg ничего не выявил, PNG-файл содержал правильные заголовки и никаких лишний секций не имел. Второй двоичный файл первой сессии имел размер 10Кб и на полноценную программу (даже упакованную) никак не тянул.\u003C\u002Fp\u003E\u003Cp\u003EДовольно быстро нашлось, что 50 41 33 30 (PA30) - это сигнатура Package Delta Format, но \u003Ca href=\"https:\u002F\u002Freverseengineering.stackexchange.com\u002Fquestions\u002F19734\u002Fdll-starting-with-dcd\" rel=\"noopener noreferrer nofollow\"\u003Eэтот в сети пример\u003C\u002Fa\u003E повёл меня по ложному пути - видно, что у такого файла средняя энтропия и бывают повторяющеся символы (конкурсные пакеты данных такими особенностями не обладали), а своих файлов PA30 на компе не нашлось. Какое-то время потратил на подбор алгоритма сжатия, пока не понял, что это совершенно бесполезное занятие.\u003C\u002Fp\u003E\u003Cp\u003EВыручила вот \u003Ca href=\"https:\u002F\u002Fwumb0.in\u002Fextracting-and-diffing-ms-patches-in-2020.html\" rel=\"noopener noreferrer nofollow\"\u003Eэта найденная ссылка\u003C\u002Fa\u003E и опубликованный проект delta_patch.py на гитхабе. И, да, это действительно Package Delta Format! Сложно передать, но это было огромное потрясение. Так умело подобрать данные, нормальное изображение 660 кб патчем в 10 кб превратить в полноценное dll-приложение весом в 1.4 мб. Фокус, похлеще фокусов Гуддини и Копперфильда.\u003C\u002Fp\u003E\u003Cp\u003EПрошу простить меня за это большое лирическое отступление, но я никак не ожидал, что оно сработает. Остальное оказалось элементарным делом. Порт и хост можно подсмотреть в tcp-трафике, настроить сеть, написать серверное приложение и сымитировать внешнюю атаку по перехваченным запросам со второй сессии. Выяснилось, dll при установлении соодинения создаёт cmd-подпроцесс, получает shell-команды и отправляет результат их исполнения. Злоумышленник с помощью специальных запросов мог переходить по каталогам файловой системы, читать файлы, запрашивать перечень файлов. В одном прочитанном таким образом файле и содержался ключ 1m_H3rE_Liv3_1m_n0t_a_C4t@flare-on.com.\u003C\u002Fp\u003E\u003Cp\u003EРасшифровка и создание патчей осуществлялось библиотечными функциями CreateDeltaB и ApplyDeltaB. Второй вариант решения задачи - написать свой расшифровщик, но я предпочёл просто читать выделенную память в отладчике после вызова ApplyDeltaB, посылая на вход не только сами запросы, но и перехваченные ответы.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eприкладываю пример расшифрованной команды и ответа:\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"powershell\"\u003E@echo off &amp; for \u002Ff %a in ('dir \u002Fs \u002Fb') do echo %~fa %~za\n\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Cat_Memes 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Great_Ideas 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\No_Flags_Here 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\NO_SERIOUSLY_EVEN_MORE_BESTEST_IDEAS 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Okay_Ideas 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Swag 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\The_BEST_Ideas 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Cat_Memes\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Great_Ideas\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\FlagPit 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\Gotcha.txt 1806\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\The_Real_Challenge 0\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\FlagPit\\me0000000w.txt 812\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\The_Real_Challenge\\Mugatuware.exe 1532928\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Never\\Gonna\\Give\\You\\Up\\The_Real_Challenge\\mydude.exe 650105\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\No_Flags_Here\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\No_Flags_Here\\what_did_you_expect.txt 1658\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\NO_SERIOUSLY_EVEN_MORE_BESTEST_IDEAS\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Okay_Ideas\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\Swag\\meow.txt 64\nC:\\Users\\user\\Desktop\\SuperSecret\\2021_FlareOn\\The_BEST_Ideas\\meow.txt 64\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EБонус - адрес сайта после декодирования url: 🐈😸😻😹😺🐱😼🙀😿😾😽😻.flare-on.com\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"299\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F571\u002F985\u002F377\u002F5719853779dfbc91d22cd3ee0a777a07.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДано классическов MFC-приложение с задизабленными кнопками:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbe4\u002F891\u002Fdaf\u002Fbe4891dafd8404b6dc28cbb4356e431c.PNG\" width=\"408\" height=\"329\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСразу смутил слишком большой объём файла (4.2Мб) для такого небольшого приложения и поиск по  сигнатуре выявил внутри exe скрытую dll, Системные библиотечные вызовы заменены хэшами. Здравая интуиция говорит, что здесь пытались спрятать важные вещи.\u003C\u002Fp\u003E\u003Cp\u003EУ доброго охотника на людей есть подборка утилит, разработанных по большей части 15 лет назад, но не потерявших актуальности до сих пор, позволяющие просматривать или менять стили окон, передавать или отслеживать сообщения и уведомления. Мы можем воспользоваться одной из них и привести приложение в работоспособное состояние. Изучение функциональных возможностей проги не даст вам информации о ключе, увы. Нам необходимо искать другие пути.\u003C\u002Fp\u003E\u003Cp\u003EЧерез некоторое время вы обязательно заметите, что при закрытии программы за крест процесс остаётся висеть в системе. Их могут накопиться в системе несколько штук. Они не завершаются, а засыпают посредством вызова SleepEx на 360000мс. Такие паузы можно и нужно убирать. На этом этапе уже начал выполняться код из скрытой dll.\u003C\u002Fp\u003E\u003Cp\u003EПрограмма открывает сетевое соедение с inactive.flare.com:888, посылает команду '@' и ожидает в ответ run|exe|flare-on. Чтобы выполнилась полезная для нас ветка условия, необходимо и достаточно послать приложению команду flare-on и пройти проверку на соответствие имени программы со строкой \"Spell.EXE\". Первые две команды нам не нужны - это встроенный бэкдор для удалённого управления - для запуска команд и произвольных приложений целевого компьютера.\u003C\u002Fp\u003E\u003Cp\u003EВ случае команды \"flare-on\" приложение обращается к встроенному ресурсу с именем PNG (картинка png), расшифровывает её ключом из хедера приложения exe - результат  строка \"l3rlcps_7r_vb33eehskc3\". Но это ещё не всё, ибо данный текст - бессмыслица. Функция 0x180002730 подсказывает правильный порядок символов флага, шифрует некоторые данные и пишет полученные байт в куст реестра Software\\Microsoft\\Spel. В реестр можно и не смотреть, ведь флаг мы уже получили шагом ранее. Всё, можно переходить к следующей задаче. Ответ: b3s7_sp3llcheck3r_ev3r@flare-on.com\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"338\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F558\u002F7c7\u002F2d6\u002F5587c72d6a44f859b962d74d70af04bf.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНе менее прекрасное очередное задание - свыше трёх мегабайт js-скрипта. После беглого осмотра понимаешь, что большая часть этого кода никогда не используется и самое оптимальное решение - вырезать такие фрагменты из файла. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"perl\"\u003Emy @matches = $content =~ \u002F\\{(?:[^}{]+|(?R))*+\\}\u002Fmg;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ одной строке ужас и красота регулярных выражений. Мы ищем последовательность, которая начинается открывающейся фигурной скобкой \"{\" и оканчивается закрывающейся фигурной скобкой \"}\", содержащей внутри одну из двух альтернатив: либо последовательность из 1 и более символа без фигурных скобок или рекурсивно весь шаблон снова. Таким образом, если у нас не \"{{\" движок сьедает ненулевое количество нескобочных символов, упирается в открытую скобку и выполняет сопоставление с исходным РВ. Такой регескп работает для правильных скобочных структур.\u003C\u002Fp\u003E\u003Cp\u003EЭтот классический пример я доработал, а именно - перед удалением добавил проверку, что перед правильной скобочной структурой стоит ключевое слово \"function\" и далее идут необязательные входные параметры. После perl-скрипта и небольшой ручной работы очищенный код выглядит так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eciphertext =\" ...\" \u002F\u002F данные, что необходимо расшифровать\nsome_arr =  \"...\" \u002F\u002F ключ, которым накрыт шифртекст, 221 байт\npasswd='gflsdgfdjgflkdsfjg4980utjkfdskfglsldfgjJLmSDA49sdfgjlfdsjjqdgjfj'.split(''); \u002F\u002Fпароль, который преобразует байты ключа для шифртекста\n\npass4form=xDyuf5ziRN1SvRgcaYDiFlXE3AwG.ZJqLM97qEThEw2Tgkd8VM5OWlcFN6hx4y2.value.split(';')\nif(pass4form[0].length==64)                   \n             passwd=pass4form[0].split('');           \u002F\u002F применяется пароль из формы ввода html, если он есть и длины 64\n\nciphertext2 = atob(ciphertext).split('');\nciphertext_len = ciphertext2.length;\n \n arr_221 = atob(some_arr).split('');\n\n \nfor (i=0; i &lt; arr_221.length; i++) { arr_221[i] = (arr_221[i].charCodeAt(0) + passwd[i % 64].charCodeAt(0)) &amp; 0xFF;\t}\n   \n   \nciphertext3 = ciphertext2;\nfor (i=0; i &lt; ciphertext_len; i++) { ciphertext3[i] = (ciphertext3[i].charCodeAt(0) - arr_221[i % arr_221.length]) &amp; 0xFF;\t}\n\nres=\"\";\nfor (i=0; i &lt; ciphertext2.length; i++) { res+=String.fromCharCode(ciphertext3[i]);}\n   \nif('rFzmLyTiZ6AHlL1Q4xV7G8pW32'\u003E=res)eval(res)\n\n(имена переменных вида PyKEvIqAmUkUVL0Anfn9FElFUN2dic3z переименованы)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОчевидно, что после расшифровки шифртекста должен получиться валидный js-код (т.е. текстовый файл), поэтому можно написать скрипт, проитерироваться по всем байтам пароля, для каждой позиции подбирая верный, выполняя проверку, что \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eif chr(res[i]).isprintable():\n   some code ...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТакая проверка потерпит неудачу.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eпочему?\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003Eпотому что текстовый файл помимо печатных символов содержит непечатные \"\\n\\r\" (0xa,0xd)\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EУчтём этот небольшой нюанс, и тогда всё получится, правда, для некоторых позиции пароля будут возможны несколько вариантов значений. Это приведёт к тому, что результирующий текст будет местами искажен, если мы точно не угадаем с первоначальным символом на i-том месте пароля. Авторы задания любезно поместили в начало js-кода литературный англоязычный комментарий, который помогает выявить и исправить такие ошибки.\u003C\u002Fp\u003E\u003Cp\u003EИтак, мы подобрали пароль и получили валидный js-код. Посмотрим на него:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eи так далее. Метод обфрускации \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FJSFuck\" rel=\"noopener noreferrer nofollow\"\u003EJSFuck\u003C\u002Fa\u003E, придуман 10 лет назад, примерно тогда описан и метод деобфрускации. Конвертируем и получаем js-код, скрытый той же методикой, что и изначальный js. Повторяем шаги 1 и 2 несколько раз, пока не доберёмся до флага.\u003C\u002Fp\u003E\u003Cp\u003EОтвет: I_h4d_v1rtU411y_n0_r3h34rs4l_f0r_th4t@flare-on.com\u003C\u002Fp\u003E\u003Cp\u003EЗадача решена.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"370\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F882\u002Fd13\u002Fbe7\u002F882d13be746b1a6c73d36694de1de94e.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСамое сложное задание контеста. Вот примерный список трудностей, которые пришлось преодолеть:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eразобраться с протоколом UDP и догадаться, что ПО функционирует только с админскими правами \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003Eнаписал тестовый пример и запустил:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EWSAStartup(MAKEWORD(2, 2), &amp;data);\nSOCKET s = socket(AF_INET, SOCK_RAW, IPPROTO_UDP);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E(c обычными правами это не работало)\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eобойти в отладчике все антиотладочные проверки\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faff\u002F062\u002F79f\u002Faff06279fa5abbdccc2913c5edf5c425.PNG\" alt=\"в x64dbg сделал принудительную установку регистров и флагов в ожидаемое значение,\" title=\"в x64dbg сделал принудительную установку регистров и флагов в ожидаемое значение,\" width=\"1094\" height=\"140\"\u002F\u003E\u003Cfigcaption\u003Eв x64dbg сделал принудительную установку регистров и флагов в ожидаемое значение,\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E(крайне неочевидный факт - последней операцией необходимо указывать $breakpointcondition=0, иначе отладчик будет делать принудительный останов)\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eубрать паразитные потоки, которые ничего не делают (вылечилось выявлением мест запуска функции 0x402710 - они создавали случайный тред)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eрасшифровать вызовы функций. Дело в том, что прямых вызовов функций в программе нет, вместо этого есть создание исключительных ситуаций и обработка эксепшенов. В обработчик передаётся хеш имени библиотеки и хеш функции. \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eзанопить фейковые инструкции, которые никогда не выполнялись, но запутывали работу дизассемблера. Этот и предыдущий пункты можно автоматизировать.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eнайти поток и участок кода, где происходит обработка входящего сообщения по сети\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eвыяснить, что существуют 4 вида входящих сообщений (0x00000001, 0x00000002, 0x00000003, 0x00000004)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E0x00000001 - печатает fake-флаг и рикролл, сбрасывает 128-битный ключ в нулевое состояние\u003C\u002Fp\u003E\u003Cp\u003E0x00000002 - если сообщение совпадает с одной из четырёх констант s3cret,L0ve,5Ex,g0d, поток исполнения попадает в одну из ветвей второй части функции и заполняет свои 32бита из 128бит ключа, который используется командой 0x3\u003C\u002Fp\u003E\u003Cp\u003E0x00000003 - если сообщение совпадает с 'MZ' - вызывает процедуру, что пытается расшифровать некоторые зашифрованные данные ключом 128 бит алгоритмом RC4.\u003C\u002Fp\u003E\u003Cp\u003E0x00000004 (и далее) - эхо-ответ\u003C\u002Fp\u003E\u003Cp\u003EЕсли вы справились с вышеперечисленными шагами - кажется, что победа вот-вот близко, но вместо заветного флага в консоль по-прежнему печатается белиберда. Что же не учтёно? Опытным путём было исследовано, что алгоритм в точности таков, каков он здесь описан, и не содержит скрытых условий и ветвей. Есть только одно место, где расшифровывается флаг, по динамическому ключу, части которого зависят от 4 входящих строк. Попробовал оставлять часть хеша незаполненным (нулевой ключ - тоже ключ!), эти 2^4 = 16 комбинаций не помогли. Наконец, заметил, что если посылать сообщения длиннее, чем контрольные константы, мы по-прежнему попадаем в ветви, где вычисляется хеши (результат, конечно же, получается другим), значит, правильный ключ генерируется из входящих сообщений большего размера и это оказались сообщения [b's3cret\\0',b'L0ve\\0',b'5Ex\\0',b'g0d\\0'].\u003C\u002Fp\u003E\u003Cp\u003EОтвет: n0_mOr3_eXcEpti0n$_p1ea$e@flare-on.com\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EДополнение: гайд по автоматизации\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EИз-за антиотладочных мер листинг evil.exe выглядит нечитабельно:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F762\u002F421\u002Fbd5\u002F762421bd570fd7fbd43964ff6e6d2058.PNG\" width=\"930\" height=\"654\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНа скриншоте обфусцирован вызов CreateMutexA():\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EMOV       EDX,dword ptr [EBP + local_24]\nMOV       ECX,dword ptr [EBP + local_28] \u002F\u002F 0x1c5d2c5e = hash(\"CreateMutexA\")\nXOR       EAX,EAX\nMOV       EAX,dword ptr [EAX]      \u002F\u002F разыменование нулевого указателя\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОбработчик исключения выполняет поиск функции по заданному хэшу и передаёт ей управление. Первые три байта после последнего MOV являются мусорными, т.к. возврат происходит по адресу 0x406512. Это сделано для запутывания дизассемблера и реверс-инженера. Давайте это исправим:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EСкрипт для ghidra\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Efrom ghidra.program.model.listing import CodeUnit\n\nlisting = currentProgram.getListing()\naddr = toAddr('00401000')\n\ndef check_exc1(addr):\n    c = listing.getCodeUnitAt(addr)\n    if c.getMnemonicString() != u'MOV':\n        return 0\n    addr = addr.add(c.length)\n    c = listing.getCodeUnitAt(addr)\n    if c.getMnemonicString() != u'MOV':\n        return 0\n    addr = addr.add(c.length)\n    c = listing.getCodeUnitAt(addr)\n    if c.toString() != u'XOR EAX,EAX':\n        return 0\n    addr = addr.add(c.length)\n    c = listing.getCodeUnitAt(addr)\n    if c.toString() != 'MOV EAX,dword ptr [EAX]':\n        return 0\n    return 1\n\n\n#while addr &lt; toAddr('00406600'):\nwhile addr &lt; toAddr('00444CED'):\n    if check_exc1(addr):\n        print(addr)\n        addr2 = addr.add(10)\n        clearListing(addr2)\n        setByte(addr2,0x90)\n        disassemble(addr2)\n\n        addr2 = addr2.add(1)\n        clearListing(addr2)\n        setByte(addr2,0x90)\n        disassemble(addr2)\n\n        addr2 = addr2.add(1)\n        clearListing(addr2)\n        setByte(addr2,0x90)\n        disassemble(addr2)\n\n        addr3 = addr2.add(1)\n        i = 0\n        while i &lt; 20:\n            addr2 = addr2.add(1)\n            clearListing(addr2)\n            i = i + 1\n        disassemble(addr3)\n    c = listing.getCodeUnitAt(addr)\n    addr = addr.add(c.length)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EТопорный, но вполне работающий вариант. Здесь происходит следующее:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eвыполняется поиск четвёрки инструкций MOV +MOV + XOR EAX,EAX + MOV (в коде присутствуют и другие исключения, например - деление на ноль)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eпри успехе - очищается листинг на несколько инструкций вперед, и три последующих байта заменяются инструкциями NOP(0x90)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eассемблирование участка кода выполняется заново\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EМожно усовершенствовать этот скрипт, добавив распознавание функций и команду c.SetComment(CodeUnit.EOL_COMMENT,text). Словарь хеш -\u003E \"имя функции\" можно собрать в x64dbg по адресу 0x4055d6 функции с условным названием API_RESOLVER:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a0\u002F1b7\u002F480\u002F4a01b748043c74a5eadeacbf07c968e9.PNG\" width=\"1919\" height=\"794\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EESI - указатель на строковое имя функции, ECX - её хеш, команда \"log\" отладчика поможет создать полезную для наших нужд базу данных хешей. Конечный результат может выглядеть следующим образом:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F124\u002Ff60\u002Ff96\u002F124f60f96848c4f36a67075e9b824ef5.PNG\" width=\"923\" height=\"666\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИмея в наличии эту базу данных, можно установить комментарии напротив соответствующих инструкций и в Иде, и в x64dbg,\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"338\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1ce\u002Fe80\u002F92c\u002F1cee8092c028cc5c3f0e72fe2a421836.png\" data-width=\"723\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДан pcap-файл с исполняемым файлом, который общается по протоколу IRC и сама переписка между двумя клиентскими приложениями. Переписка состоит из двух похожих диалогов и каждая из них оканчивается отправкой потока данных с целевого компьютера. Собственная реализация IRC-сервера показалась бесперспективной идеей, а вот \u003Ca href=\"https:\u002F\u002Fwww.unrealircd.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eготовое решение\u003C\u002Fa\u003E идеально подошло под задачу. Бот желает общаться с сервером wizardcult.flare-on.com  и пользователем dung3onm4st3r13, требуемое легко настроить. Попытка повторить диалог как в pcap оказалась успешной, за исключением финальной стадии ( после фразы \"I quaff my potion and attack!\" в оригинальном диалоге возвращался шифркод). Strace прояснил ситуацию:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F88f\u002Fc3c\u002F578\u002F88fc3c5785e130266dce22e17b076b37.PNG\" alt=\"скриншот программы pidgin\" title=\"скриншот программы pidgin\" width=\"716\" height=\"262\"\u002F\u003E\u003Cfigcaption\u003Eскриншот программы pidgin\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe21\u002Fd2b\u002F9b9\u002Fe21d2b9b9e9331f2bfed56b0b3b1b739.PNG\" alt=\"stat(&quot;\u002Fmages_tower&quot;,...) = -1 ENOENT\" title=\"stat(&quot;\u002Fmages_tower&quot;,...) = -1 ENOENT\" width=\"883\" height=\"160\"\u002F\u003E\u003Cfigcaption\u003Estat(\"\u002Fmages_tower\",...) = -1 ENOENT\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F10e\u002Fad7\u002F94e\u002F10ead794e83580baa69f41b69d4a657e.PNG\" alt=\"open(&quot;\u002Fmages_tower\u002Fcool_wizard_meme.png&quot;,...) = -1 ENOENT\" title=\"open(&quot;\u002Fmages_tower\u002Fcool_wizard_meme.png&quot;,...) = -1 ENOENT\" width=\"1270\" height=\"209\"\u002F\u003E\u003Cfigcaption\u003Eopen(\"\u002Fmages_tower\u002Fcool_wizard_meme.png\",...) = -1 ENOENT\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЯ создал недостающий каталог и файл и немного поэксперементировал с входными данными: можно проверить, что длина выходных данных совпадает с длиной входных данных, т.е. вход шифруется побайтно, в первом диалоге по входу вида \"aaaaaaaaaaaa\" возвращается одинаковый вывод, то есть кодирование открытых данных не зависит от них позиции, а во втором случае одинаковым алгоритмом K кодируется каждый k+24 * i символ.\u003Cbr\u002F\u003EА вот, собственно, и всё - генерируем 256 открытых текстов с одинаковыми символами (или один длинный, содержащий все символы подряд), активируем бота и получаем в ответ множества значений всех 24-ёх функций f_0, f_1, ..., f_23 на всей области определения. Зная, как закодирован произвольный i-тый символ сообщения, по шифртексту можно восстановить исходное сообщение. Это оказалась png-картинка с флагом на ней. Самая сложная задача решена за несколько часов... До сих пор нахожусь в лёгком недоумении, это прокол организаторов или любезно оставленная открытая калитка на заднем дворе. Заметим, что для её решения практически не потребовалось анализировать исходный код.\u003C\u002Fp\u003E\u003Cp\u003EПосле сдачи всех заданий мне захотелось получить дополнительный опыт реверсинга go-приложений и виртуальных машин, так что представим теперь, что такой способ решения задачи или нам неизвестен или невозможен. Первым делом следует ознакомиться с концепциями языка. Мне помогли разобраться следующие источники:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EМаксим Жашкевич, Язык Go Для Начинающих\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Frednaga.io\u002F2016\u002F09\u002F21\u002Freversing_go_binaries_like_a_pro\u002F\" rel=\"noopener noreferrer nofollow\"\u003EReversing GO binaries like a pro\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdr-knz.net\u002Fgo-calling-convention-x86-64.html#strings-and-slices-use-two-and-three-words\" rel=\"noopener noreferrer nofollow\"\u003EThe Go low-level calling convention on x86-64\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТребуется в точности узнать алгоритм шифрования входной последовательности. Этот алгоритм выполняется, очевидно, в некоторой виртуальной машине:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4ca\u002F401\u002F1e6\u002F4ca4011e61b07bfcf1b405ca4f645bc4.PNG\" width=\"281\" height=\"308\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003Eа сами данные для виртуальной машины загружаются злоумышленником извне как рецепт зелья, каждый ингридиент которого интерпретируется как некоторый байт, что позже поступает на вход декодеру - десериализатору данных в объект. Существует прекрасный инструмент для восстановления символов go-приложений, таких как методы и структуры - \u003Ca href=\"https:\u002F\u002Fgo-re.tk\u002Fredress\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eredress\u003C\u002Fa\u003E. Кажется, у нас всё есть для того, чтобы посмотреть на эти данные в человекопонятном виде.\u003C\u002Fp\u003E\u003Cp\u003EСмотрите и запускайте \u003Ca href=\"https:\u002F\u002Fplay.golang.org\u002Fp\u002F9tZW2pnHsSv\" rel=\"noopener noreferrer nofollow\"\u003Eэтот код в онлайн-интерпретаторе\u003C\u002Fa\u003E. Можно переключиться с программы 1 на программу 2. Немного пояснений. Типы данных скопированы как есть из выдачи утилиты redress, сериализованные данные программ ВМ можно сдампить в gdb как входной параметр функции Decoder(), использован \u003Ca href=\"https:\u002F\u002Fgolangify.com\u002Fgob\" rel=\"noopener noreferrer nofollow\"\u003Eбазовый пример работы\u003C\u002Fa\u003E с encoding\u002Fgob и добавлена печать адресов полей структур для определения смещения, это нам пригодится для анализа приложения.\u003C\u002Fp\u003E\u003Cp\u003EВот наглядная интерпретация данных первого диалога из pcap:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"386\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F235\u002F21f\u002Fc14\u002F23521fc149b7a878af70e5e389709e6d.png\" data-width=\"573\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003Eто есть виртуальная машина - это многопроцессорная ЭВМ с памятями, входом и выходом и закешированными инструкциями. Я установил брейкпоинты на все ассемблерные команды (и на функции чтения\u002Fзаписи регистров) и обнаружил, что на такой программе срабатывают только три из них: MOV (чаще других), TEQ, XOR, Несложно сопоставить одно с другим и предположить, что программа выполняет out[i] = in[i] ^ 0xa2. и понять, что опкоды mov - 0x01, teq - 0x05, xor - 0x12. Условные операторы устанавливают флаг Cond процессора и инструкции могут пропускаться интерпретатором (если cond_cpu !=cond_instr). Инструкции с Сond=0 исполняются всегда.\u003C\u002Fp\u003E\u003Cp\u003EВот моя самая первая попытка расставить точки останова в ключевых местах и полученный при этом вывод (две итерации цикла по программе со скриншота выше):\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5b1\u002Fb9b\u002F094\u002F5b1b9b0941deb5cff335da0621f01bab.PNG\" alt=\"к сожалению, хабраредактор не позволяет так разметить текст\" title=\"к сожалению, хабраредактор не позволяет так разметить текст\" width=\"625\" height=\"496\"\u002F\u003E\u003Cfigcaption\u003Eк сожалению, хабраредактор не позволяет так разметить текст\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЖирным выделены брейкпоинты от второго CPU. Видны переключения контекста от одного CPU к другому. Сначала потоки идут параллельно (от запуска к запуску последовательность инструкций может незначительно меняться), Ключевой момент для осознания реализации работы мультипроцессорности - в строке 02 предпринимается попытка получить значение регистра \u003Cstrong\u003Er0 cpu1\u003C\u002Fstrong\u003E, поток засыпает ровно до того момента, когда в регистр \u003Cstrong\u003Er2 cpu0\u003C\u002Fstrong\u003E не будет записано значение (0x63), и, как можно заметить, возвращаемое значение \u003Cstrong\u003Er0 cpu1\u003C\u002Fstrong\u003E = 0x63. Это указывает на жёсткую связь между \u003Cstrong\u003Er2 cpu0\u003C\u002Fstrong\u003E и \u003Cstrong\u003Er0 cpu1\u003C\u002Fstrong\u003E. Далее в строках 06..10 происходит ровно тоже самое. Пытаемся прочитать \u003Cstrong\u003Er2 cpu0\u003C\u002Fstrong\u003E и засыпаем ровно до того момента, как в \u003Cstrong\u003Er0 cpu1\u003C\u002Fstrong\u003E не будет записано значение (0xc1).\u003C\u002Fp\u003E\u003Cp\u003EЭти связи задаются в разделе Links:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003ELHDevice0 - Input Device\nLHDevice1 - Output Device\nLHDevice2 - CPU0\nLHDevice3 - CPU1\n....\nLHDevice_(N+2) - CPU_N\nLHDevice_(N+3) - ROM0\nи так далее.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗдесь: r0 CPU0 - вход, r1 CPU0 - выход, r2 CPU0 ==  r1 CPU1 и программу можно переписать так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003ECPU0: \nmov input, acc\nteq acc,-1\nесли да: mov -1, output\n\t\t\t   mov input, acc\nmov acc, r2      \u002F\u002F\u002F активируем cpu1 и посылаем входное значение\nmov r2, acc      \u002F\u002F\u002F получаем данные из cpu1\nmov acc, output\n\nCPU1:\nmov r0,acc\nxor 0xa2,acc\nmov acc,r0 (возвращаемся в cpu0)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПосле того, как первая программа помогла вам осознать заложенный принцип ВМ, можно разбираться с программой N2, которая несколько запутаннее. Здесь уже не 2 CPU, а 7, кроме того, памяти непусты и содержат некие двоичные данные. Перечень опкодов можно взять в ExecuteInstruction, где анализируется первый параметр и вызывается соответствующая функция ВМ. Для визуализации работы ВМ я написал отладочный модуль, используя gdb.python, главная функция которого для примера представлена ниже:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\n    def print_instr(self):\n        pointer_addr_cpu = self.execute_and_get_value('x\u002Fg ($rax+0x20)')\n        cpu_N_value      = self.execute_and_get_value('x\u002Fg ($rax+0x10)')\n\n        pointer_addr_cpu = int(pointer_addr_cpu,0)\n        cpu_N_value      = int(cpu_N_value,0)\n\n        ind = self.cpu_addr.index(pointer_addr_cpu)\n\n        cpu_r0      = self.get_reg('x\u002Fgx ($rax+0x38)')\n        cpu_r1      = self.get_reg('x\u002Fgx ($rax+0x40)')\n        cpu_r2      = self.get_reg('x\u002Fgx ($rax+0x48)')\n        cpu_r3      = self.get_reg('x\u002Fgx ($rax+0x50)')\n        cpu_acc     = self.get_reg('x\u002Fgx ($rax+0x0)')\n        cpu_dat     = self.get_reg('x\u002Fgx ($rax+0x8)')\n        cpu_cond    = self.get_param('x\u002Fgx ($rax+0x18)')\n\n        instr_opcode = self.execute_and_get_value('x\u002Fg (0x%x+0x30*%d)'% (pointer_addr_cpu, cpu_N_value))\n        instr_opcode      = (int(instr_opcode,0))\n        instr_par1 = self.get_param('x\u002Fg (0x%x+0x30*%d+0x08)'% (pointer_addr_cpu, cpu_N_value))\n        instr_par2 = self.get_param('x\u002Fg (0x%x+0x30*%d+0x10)'% (pointer_addr_cpu, cpu_N_value))\n        instr_par3 = self.get_param('x\u002Fg (0x%x+0x30*%d+0x18)'% (pointer_addr_cpu, cpu_N_value))\n        instr_par4 = self.get_param('x\u002Fg (0x%x+0x30*%d+0x20)'% (pointer_addr_cpu, cpu_N_value))\n        instr_par5 = self.get_param('x\u002Fg (0x%x+0x30*%d+0x28)'% (pointer_addr_cpu, cpu_N_value))\n\n        reg1 = 'r' if int(instr_par4) &amp; 0x1 else ''\n        reg2 = 'r' if int(instr_par4) &amp; 0x2 else ''\n\n        #                0     1     2      3      4      5      6      7     8     9   \n        instr_names = ['___','mov', 'movc','___', '___', 'teq', 'tgt', 'tlt','tcp', 'add',\n                       'sub','mul', 'div', 'not', '___', '___', 'and',' or', 'xor', 'shl', 'shr']\n\n        shift = ' ' * (4 * ind)\n        \n        if instr_par5 == '0' or int(instr_par5) == int(cpu_cond):\n             print ('%s cpu%d_%02d | %s %s%s %s%s %s %s | %s %s %s %s %s %s DEBUG' % (\n                shift, ind, cpu_N_value,\n                instr_names[instr_opcode], reg1, instr_par1, reg2, instr_par2, instr_par3, instr_par4, \n                cpu_r0,cpu_r1,cpu_r2,cpu_r3,cpu_acc,cpu_dat  ))\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eв результате получаем такой красивый вывод в отладчике:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eлог\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode\u003Ecpu0_00 | mov r0 r4 0 3 | CH0 CH1 CH2 0x0 0x21 0x0                         0x21 -\u003E acc cp0             \ncpu0_01 | teq r4 -1 0 1 | CH0 CH1 CH2 0x0 0x21 0x0                         0x21 != -1 ?\ncpu0_04 | mov r4 r2 0 3 | CH0 CH1 CH2 0x0 0x21 0x0                         0x21 send r0 cp1\n    cpu1_00 | mov r0 r4 0 3 | CH2 CH6 CH3 0x0 0x21 0x1b                    0x21 -\u003E acc cp1\n    cpu1_01 | mov r4 r1 0 3 | CH2 CH6 CH3 0x0 0x21 0x1b                    0x21 send r0 cp2\n        cpu2_00 | mov r0 r4 0 3 | CH6 CH7 CH8 CH9 0x21 0x0                 0x21 -\u003E acc cp2\n        cpu2_01 | tgt r4 63 0 1 | CH6 CH7 CH8 CH9 0x21 0x0                 0x63 \u003E 0x21 ?\n        cpu2_04 | mov r4 r1 0 3 | CH6 CH7 CH8 CH9 0x21 0x0                 request data1[0x21]\n        cpu2_05 | mov r2 r0 0 3 | CH6 CH7 CH8 CH9 0x21 0x0                 send data1[0x21]=0xf -\u003E r1 cp1\n    cpu1_02 | mov r1 r4 0 3 | CH2 CH6 CH3 0x0 0xf 0x1b                     0xf -\u003E acc\n    cpu1_03 | mov r4 r2 0 3 | CH2 CH6 CH3 0x0 0xf 0x1b                     0xf send r0 cp5\n                    cpu5_03 | mov r0 r5 0 3 | CH3 CH4 CH5 0x0 0x1 0xf      0xf -\u003E dat\n                    cpu5_04 | mov r2 r4 0 3 | CH3 CH4 CH5 0x0 0x31 0xf     data4[i] -\u003E acc\n                    cpu5_05 | not 539 0 0 0 | CH3 CH4 CH5 0x0 0xce 0xf     acc ^ 0xff           \n                    cpu5_06 | and ff 0 0 0 | CH3 CH4 CH5 0x0 0xce 0xf      = 0xce\n                    cpu5_07 | xor r5 0 0 1 | CH3 CH4 CH5 0x0 0xc1 0xf      0xf ^ 0xce = 0xc1\n                    cpu5_08 | mov r4 r0 0 3 | CH3 CH4 CH5 0x0 0xc1 0xf     0xc1 send r2 cp1\n    cpu1_04 | mov r2 r4 0 3 | CH2 CH6 CH3 0x0 0xc1 0x1b                    0xc1 -\u003E acc\n                    cpu5_00 | mov r1 r4 0 3 | CH3 CH4 CH5 0x0 0x2 0xf      0x2 -\u003E acc\n    cpu1_05 | mov r4 r1 0 3 | CH2 CH6 CH3 0x0 0xc1 0x1b                    0xc1 -\u003E send r0 cp2 \n        cpu2_00 | mov r0 r4 0 3 | CH6 CH7 CH8 CH9 0xc1 0x0                 0xc1 -\u003E acc\n                    cpu5_01 | and 1 0 0 0 | CH3 CH4 CH5 0x0 0x0 0xf        0x2 &amp; 0x1 = 0x0\n        cpu2_01 | tgt r4 63 0 1 | CH6 CH7 CH8 CH9 0xc1 0x0                 0xc1 \u003E 0x63?\n                    cpu5_02 | teq r4 1 0 1 | CH3 CH4 CH5 0x0 0x0 0xf       (0x2 &amp; 0x1) == 0x1 ?\n        cpu2_02 | mov r4 r3 0 3 | CH6 CH7 CH8 CH9 0xc1 0x0                 0xc1 send r0 cp3\n            cpu3_00 | mov r0 r4 0 3 | CH9 CH10 CH11 CH12 0xc1 0x0          0xc1 -\u003E acc\n            cpu3_01 | tgt r4 c7 0 1 | CH9 CH10 CH11 CH12 0xc1 0x0          0xc1 \u003E 0xc7 ?\n            cpu3_04 | sub 64 0 0 0 | CH9 CH10 CH11 CH12 0x5d 0x0           0xc1 - 0x64 = 0x5d\n            cpu3_05 | mov r4 r1 0 3 | CH9 CH10 CH11 CH12 0x5d 0x0          request data2[0x5d] (=0xd6)\n            cpu3_06 | mov r2 r0 0 3 | CH9 CH10 CH11 CH12 0x5d 0x0          send 0xd6 r3 cpu2\n    cpu1_06 | mov r1 r5 0 3 | CH2 CH6 CH3 0x0 0xc1 0xd6                    0xd6 -\u003E dat\n        cpu2_03 | mov r3 r0 0 3 | CH6 CH7 CH8 CH9 0xc1 0x0                 send 0xd6 r1 cpu1\n    cpu1_07 | mov 80 r4 0 2 | CH2 CH6 CH3 0x0 0x80 0xd6                    const 0x80 -\u003E acc\n    cpu1_08 | and r5 0 0 1 | CH2 CH6 CH3 0x0 0x80 0xd6                     0xd6 ^ 0x80\n    cpu1_09 | teq r4 80 0 1 | CH2 CH6 CH3 0x0 0x80 0xd6                    (0xd6 ^ 0x80) == 0x80 ?\n    cpu1_10 | mov r5 r4 0 3 | CH2 CH6 CH3 0x0 0xd6 0xd6                    0xd6 -\u003E acc\n    cpu1_11 | xor 42 0 0 0 | CH2 CH6 CH3 0x0 0x94 0xd6                     0xd6 ^ 0x42 = 0x94\n    cpu1_13 | not 539 0 0 0 | CH2 CH6 CH3 0x0 0xffffff6b 0xd6              0xd6 ^ 0xff = 0x6b\n    cpu1_14 | and ff 0 0 0 | CH2 CH6 CH3 0x0 0x6b 0xd6                     \n    cpu1_15 | mov r4 r0 0 3 | CH2 CH6 CH3 0x0 0x6b 0xd6                    0x6b -\u003E r2 cp0\ncpu0_05 | mov r2 r4 0 3 | CH0 CH1 CH2 0x0 0x6b 0x0                         0x6b -\u003E acc\ncpu0_06 | mov r4 r1 0 3 | CH0 CH1 CH2 0x0 0x6b 0x0                         0x6b -\u003E Output\ncpu0_00 | mov r0 r4 0 3 | CH0 CH1 CH2 0x0 0x2f 0x0                         Input -\u003E 0x2f\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E(CH{i} - это каналы, описанные в разделе Links)\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EХотелось бы упомнянуть ещё один момент: существует заметная разница в том, когда снимать состояние ЭВМ - до входа в ExecuteInctruction или после. Это обусловлено особенностью работы горутин и go-каналов, а именно, тем фактом, что горутины выполняются асинхронно и могут приостанавливаться в ожидании данных из других горутин. Более понятным порядком следования инструкций будет, если останавливаться позже. Обратите внимание, здесь регистры процессора зафиксированы на момент, когда текущая инструкция уже отработала.\u003C\u002Fp\u003E\u003Cp\u003EОставляю читателю статьи возможность изучить Программу2 в онлайн-интерпретаторе и самостоятельно проследить за ходом исполнения программы по листингу и комментариям, а я приведу лишь итоговый алгоритм, записанный на языке Python:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eалгоритм шифрования и дешифрования\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef inv(perm):\n    inverse = [0] * len(perm)\n    for i, p in enumerate(perm):\n        inverse[p] = i\n    return inverse\n\nimport binascii\n\ndat = '5a840645aecbe8f357fea63d5e4108d03322218120dd00a023af71048bf5181de10f6509ce42783ec337ca8f6432e0acde917c2ac007f4959f4053e567b67a524e3f834bc982722e761cf11eccb7d7c78a10791a4d1935167d432bcd86ab4492d40e9814b99ba7241b3ce23ad3f0fd4f77d1a30c48806adabdd8475bfa960beccf49d9117fb127e7c5b263e62836b35dfbdca87025f6b09ca55fb839e485a9fc13025130f269ff74bf59b54617c2586199eba49e89ee6cefa290738c54bc6ddb2cd6e3a18d50f734d5f9017b8ebe686b559d2ded2f93151fc488aaf80d5cea5603c19a38056f624a12df609429757eade90a31b4bbba873b26d26e66c84c97c6'\n\ndat = binascii.unhexlify(dat)\ndatreverse = inv(dat)\n\ndat4 = b'a11_mY_hom1es_h4t3_b4rds'\n\ninputdata = '23212f75' # example\ninputdata = binascii.unhexlify(inputd)\n\nfor i in range (len(inputd)):\n    \n    c = dat4[i%24] ^ dat[inputdata[i]]\n    if i%2:\n        c = c ^ 0xff\n    c = dat[c]\n \n    if c &amp; 0x80:\n        c = c ^ 0x42\n    c = c ^ 0xff\n\n    # -------------------- #\n    \n    c = c ^ 0xff\n    if c &amp; 0x80:\n        c = c ^ 0x42\n    c = datreverse[c]\n    if i%2:\n        c = c ^ 0xff\n    \n    c = datreverse [c ^ dat4[i%24]]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003Eрезультат наших трудов - картинка с флагом\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"680\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F448\u002Ffdd\u002F779\u002F448fdd779ec8a6fd3cb33efc014fb470.png\" data-width=\"512\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНа этом я завершаю свою публикацию. Все задания успешно решены. При подготовке этой статьи упущены несущественные моменты из-за необходимости баланса между её размером и содержательностью повествования. Ходы рассуждений сознательно законспектированы в точности так, как это происходило в дни моего участия. Ссылки на решения других участников я добавлю сюда позже по мере их готовности.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"flare-on"},{"titleHtml":"реверс-инжиниринг"},{"titleHtml":"ctf"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3f\u002F199\u002F4c7\u002Ff3f1994c7d61ff3d161f0a433a1c0b04.PNG","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3f\u002F199\u002F4c7\u002Ff3f1994c7d61ff3d161f0a433a1c0b04.PNG","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584672\\\u002F\"},\"headline\":\"Flare-On 8 2021 CTF writeup'ы\",\"datePublished\":\"2021-10-24T07:02:37+03:00\",\"dateModified\":\"2021-10-25T09:20:08+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Trotil\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлаг...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584672\\\u002F#post-content-body\",\"about\":[\"h_infosecurity\",\"h_reverse-engineering\",\"h_ctf\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F584672\\\u002F78e035041442557d9c65ba1e8836a605\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F3b4\\\u002F2b8\\\u002Fa81\\\u002F3b42b8a81b4d15c5efc1f3c5a86c0d9f.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F467\\\u002F72c\\\u002F142\\\u002F46772c142a6988fb170a1c0418aee705.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F095\\\u002F5b8\\\u002F180\\\u002F0955b8180f189bfbf50ceb7905a39c5a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F77b\\\u002Ff0d\\\u002Ffb4\\\u002F77bf0dfb4c5b09eeb071bf9725ea2d20.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fb2f\\\u002F09b\\\u002Faf5\\\u002Fb2f09baf5d996a865595044f7cdecb3b.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F54c\\\u002Fae5\\\u002F013\\\u002F54cae5013f64048bc87ceb19404cdd94.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4fa\\\u002F8c9\\\u002Fdbc\\\u002F4fa8c9dbc1ea5868634ecf28384e50e9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc88\\\u002Fec4\\\u002Fdb5\\\u002Fc88ec4db5ba3b34c020e1f320fd9be20.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F14a\\\u002Fa80\\\u002F145\\\u002F14aa801453047ef448688dc8ee9f907a.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F892\\\u002Ff43\\\u002F9c4\\\u002F892f439c46d746f852304d5a7e6be94f.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6e8\\\u002F8a6\\\u002F74a\\\u002F6e88a674ae1d3a82d8a08be24cbf8685.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F921\\\u002F1a6\\\u002F3f4\\\u002F9211a63f47c4001b431bb11ee3f9b424.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F32c\\\u002Fd91\\\u002F1db\\\u002F32cd911db6f131d2df3411cd29d9bd40.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6e0\\\u002Fa92\\\u002F9fd\\\u002F6e0a929fd2abfdb4979b1f0644c98a2a.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff47\\\u002F506\\\u002F0f0\\\u002Ff475060f0915a2fb3e9319400bce8386.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc2b\\\u002Fcc1\\\u002F9b2\\\u002Fc2bcc19b2f7faea36cbf33821efb5f19.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff2e\\\u002F7a0\\\u002F9b4\\\u002Ff2e7a09b469ad4a372fab1e3f74f384a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F571\\\u002F985\\\u002F377\\\u002F5719853779dfbc91d22cd3ee0a777a07.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fbe4\\\u002F891\\\u002Fdaf\\\u002Fbe4891dafd8404b6dc28cbb4356e431c.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F558\\\u002F7c7\\\u002F2d6\\\u002F5587c72d6a44f859b962d74d70af04bf.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F882\\\u002Fd13\\\u002Fbe7\\\u002F882d13be746b1a6c73d36694de1de94e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Faff\\\u002F062\\\u002F79f\\\u002Faff06279fa5abbdccc2913c5edf5c425.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F762\\\u002F421\\\u002Fbd5\\\u002F762421bd570fd7fbd43964ff6e6d2058.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4a0\\\u002F1b7\\\u002F480\\\u002F4a01b748043c74a5eadeacbf07c968e9.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F124\\\u002Ff60\\\u002Ff96\\\u002F124f60f96848c4f36a67075e9b824ef5.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1ce\\\u002Fe80\\\u002F92c\\\u002F1cee8092c028cc5c3f0e72fe2a421836.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F88f\\\u002Fc3c\\\u002F578\\\u002F88fc3c5785e130266dce22e17b076b37.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe21\\\u002Fd2b\\\u002F9b9\\\u002Fe21d2b9b9e9331f2bfed56b0b3b1b739.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F10e\\\u002Fad7\\\u002F94e\\\u002F10ead794e83580baa69f41b69d4a657e.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4ca\\\u002F401\\\u002F1e6\\\u002F4ca4011e61b07bfcf1b405ca4f645bc4.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F235\\\u002F21f\\\u002Fc14\\\u002F23521fc149b7a878af70e5e389709e6d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5b1\\\u002Fb9b\\\u002F094\\\u002F5b1b9b0941deb5cff335da0621f01bab.PNG\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F448\\\u002Ffdd\\\u002F779\\\u002F448fdd779ec8a6fd3cb33efc014fb470.png\"]}","metaDescription":"Закончился очередной конкурс Flare-On от компании FireEye. Он привлекает  любителей и профессионалов обратной разработки со всего мира. Ежегодно  FireEye предлагает всем желающим 10-12 заданий...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"infosecurity,reverse-engineering,ctf"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
