<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Удаленный мониторинг состояния квартиры и управление домашними устройствами / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/first\/blog\/582258\/"},"headline":"Удаленный мониторинг состояния квартиры и управление домашними устройствами","datePublished":"2021-10-18T10:00:01+03:00","dateModified":"2021-10-18T10:37:34+03:00","author":{"@type":"Person","name":"kot_review"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек н...","url":"https:\/\/habr.com\/ru\/company\/first\/blog\/582258\/#post-content-body","about":["c_first","h_arduino","h_electronics","h_easyelectronics","f_develop","f_popsci"],"image":["https:\/\/habr.com\/share\/publication\/582258\/67da3358adbc62e5313864d97a108be7\/","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/6f7\/7fd\/57c\/6f77fd57c17fbc0f4ae3b57eac673c90.png","https:\/\/habrastorage.org\/webt\/51\/hp\/jw\/51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg","https:\/\/habrastorage.org\/webt\/gw\/ig\/l1\/gwigl1ir0aixv-nt7yi_3calul0.jpeg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Удаленный мониторинг состояния квартиры и управление домашними устройствами" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Удаленный мониторинг состояния квартиры и управление домашними устройствами" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Удаленный мониторинг состояния квартиры и управление домашними устройствами" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://hsto.org/webt/3p/hz/sp/3phzsp19etcevyj3b06yfa9_yam.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://hsto.org/webt/3p/hz/sp/3phzsp19etcevyj3b06yfa9_yam.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://hsto.org/webt/3p/hz/sp/3phzsp19etcevyj3b06yfa9_yam.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://hsto.org/webt/3p/hz/sp/3phzsp19etcevyj3b06yfa9_yam.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://hsto.org/webt/3p/hz/sp/3phzsp19etcevyj3b06yfa9_yam.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="582258" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-18T07:00:01.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/582258/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/company/first/blog/582258/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://hsto.org/webt/3p/hz/sp/3phzsp19etcevyj3b06yfa9_yam.png" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="first" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><!----></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-card tm-company-article__company-card"><div class="tm-company-card__info"><div class="tm-company-card__header"><a href="/ru/company/first/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="//habrastorage.org/getpro/habr/company/81e/a2b/70e/81ea2b70ebe0942cdf523ca6af7a3e2b.png" width="48" class="tm-entity-image__pic"></div></a> <!----> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">356.96</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div> <div class="tm-company-card__info"><a href="/ru/company/first/profile/" class="tm-company-card__name">
        FirstVDS
      </a> <div class="tm-company-card__description">Виртуальные и выделенные серверы в ДЦ в Москве</div></div></div> <div class="tm-company-card__buttons"><!----> <!----></div></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/kot_review/" title="kot_review" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/598/273/23e/59827323e7b2f5f4bc577d4ab8cf934a.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/kot_review/" class="tm-user-info__username">
      kot_review
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-18T07:00:01.000Z" title="2021-10-18, 10:00">18  октября   в 10:00</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Удаленный мониторинг состояния квартиры и управление домашними устройствами</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/company/first/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании FirstVDS</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/arduino/" class="tm-article-snippet__hubs-item-link"><span>Разработка под Arduino</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/electronics/" class="tm-article-snippet__hubs-item-link"><span>Производство и разработка электроники</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/easyelectronics/" class="tm-article-snippet__hubs-item-link"><span>Электроника для начинающих</span> <!----></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/6f7/7fd/57c/6f77fd57c17fbc0f4ae3b57eac673c90.png"/><br/>
<br/>
Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также необходимость автоматического исполнения некоторых задач, среди которых особо можно выделить полив домашних цветов.<br/>
<br/>
В рамках этой статьи мы попробуем рассмотреть, как можно было бы создать систему домашнего мониторинга и удалённого управления, используя минимальные средства. Несмотря на некоторую ограниченность системы, она является в достаточной степени функциональной и даёт широкие возможности её создателю.<br/>
<br/>
<a name="habracut"></a>Попробуем кратко охарактеризовать комплекс задач, стоящих перед разработчиком системы:<br/>
<br/>
<ul>
<li>Большое количество различных бытовых несчастий происходит ввиду того, что случаются разнообразные техногенные катастрофы бытового масштаба. Среди них можно выделить: протечки в системе отопления, забытые включёнными краны холодной и горячей воды, случайное возгорание объектов. Последний пункт является особо любопытным, так как зачастую такие случаи возникают даже из-за невинной капли воды, оставшейся на подоконнике, которая, по сути, является собирающей линзой. В яркий солнечный день эта водяная линза легко концентрирует солнечные лучи в поджигающую точку (точно так же, как многие баловались в детстве, выжигая всякие надписи на деревянных предметах). Поэтому наблюдение за температурой и влажностью в квартире является крайне важным, так как эксцессы на базе этих двух пунктов могут произойти даже совершенно случайно, без особой вины владельца. Поэтому создаваемая нами система должна будет иметь возможность мониторить уровень влажности и температуры в квартире.</li>
<li>Многие люди, уезжая даже на непродолжительный отпуск, сталкиваются с необходимостью полива домашних цветов. Поэтому создание такой системы будет вполне актуальным и нужным для большинства людей. Наличие подобного устройства дома развязывает руки владельцу и позволяет ему отсутствовать продолжительное время.</li>
<li>Каждый собственник в момент своего отсутствия достаточно сильно переживает о том, не было ли совершено проникновение в его жилище. Установка профессиональных систем сигнализации является, конечно, предпочтительным вариантом, однако такое действие несколько затратно. Поэтому мы постараемся создать свою систему, которая, несмотря на свою доступность, сможет быть вполне функциональный и позволит в режиме реального времени мониторить жилище на отсутствие/наличие взлома и проникновения в него.</li>
</ul><br/>
Для реализации всего вышесказанного видится наиболее целесообразным создать систему, состоящую из двух функциональных блоков:<br/>
<br/>
<ul>
<li>Блок мониторинга за состоянием жилища.</li>
<li>Блок оповещения владельца о возникновении внештатных ситуаций.</li>
</ul><br/>
В качестве блока мониторинга мы будем использовать mqtt-брокер, в соответствующие топики которого система будет публиковать отчёты о состоянии отслеживаемых параметров. Для наблюдения за этими параметрами со стороны владельца вполне рационально использовать то или иное приложение под смартфон, которое позволит производить мониторинг параметров в реальном времени.<br/>
<br/>
Для физической реализации мониторинга мы будем использовать датчик влажности и температуры DHT22, в то время как для мониторинга за проникновением в жилище мы будем использовать пару из цифрового датчика Холла KY-003 и неодимового магнита.<br/>
<br/>
Для оповещения владельца мы создадим систему отправки предупреждающих e-mail сообщений, так как этот способ является одним из наиболее доступных. Как альтернативу ему можно было рассмотреть написание некого приложения под смартфон, которое будет мониторить топики, в которые система будет публиковать сообщения о внештатных ситуациях, при возникновении которых смартфон будет подавать звуковой или иной сигнал. Однако рассмотрение этого не входит в рамки этой статьи, поэтому создание такой системы оповещения можно отложить на перспективу.<br/>
<br/>
В качестве ещё одного интересного варианта оповещения владельца можно было бы рассмотреть вариант отправки сервисных SMS сообщений. Здесь возможны тоже несколько вариантов. Среди которых можно перечислить такие, как: <br/>
<br/>
<ul>
<li>Отправка смс-сообщения непосредственно с аппаратного устройства.</li>
<li>Использование соответствующих интернет-сервисов, когда отправка данных позволяет преобразовать их в SMS сообщение для адресата. Такой способ является тоже весьма интересным и может быть проработан в рамках создания будущих устройств.</li>
</ul><br/>
Общая схема системы и её работы показана на рисунке ниже (кликабельно, большая):<br/>
<br/>
<a href="https://habrastorage.org/webt/51/hp/jw/51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg"><div style="text-align:center;"><img src="https://habrastorage.org/r/w780q1/webt/51/hp/jw/51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg" data-src="https://habrastorage.org/webt/51/hp/jw/51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg" data-blurred="true"/></div></a><br/>
<br/>
«Мозг» системы будет построен на основе известного микроконтроллера Espressif ESP32.<br/>
Программирование системы будет осуществлено в рамках среды разработки Arduino IDE, с использованием языка Arduino C.<br/>
<br/>
Для удобства работы с кодом и чёткого его структурирования мы его раздели на пять блоков, которые будут разнесены на пять необходимых вкладок Arduino IDE в виде соответствующих функций. Рассмотрим вкратце содержимое каждой из них:<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w780q1/webt/gw/ig/l1/gwigl1ir0aixv-nt7yi_3calul0.jpeg" data-src="https://habrastorage.org/webt/gw/ig/l1/gwigl1ir0aixv-nt7yi_3calul0.jpeg" data-blurred="true"/></div><br/>
Для начала нам необходимо сконфигурировать свою домашнюю сеть роутера, к которому будет подключаться по wi-fi в наш микроконтроллер:<br/>
<br/>
<pre><code class="java">const char* ssid = ""; //сюда название вашей домашней wifi-сети роутера
const char* password = "";//сюда пароль от wifi-сети роутера</code></pre><br/>
Далее нам необходимо сконфигурировать параметры доступа к mqtt-брокеру. Для лучшего понимания кода мы снабдили его положенными пояснениями:<br/>
<br/>
<pre><code class="java">const char* mqtt_server = "vashbroker.com";//сюда адрес вашего брокера
#define mqtt_port 1883 //порт вашего брокера
#define MQTT_USER ""   //сюда имя пользователя MQTT,
                       //если система должна иметь пользователя и пароль
#define MQTT_PASSWORD "" //сюда пароль пользователя MQTT,
                       //если система должна иметь пользователя и пароль
</code></pre><br/>
Далее мы создаём топики для публикации в них как сообщений от микроконтроллера:<br/>
<br/>
<pre><code class="java">#define MQTT_PUBLISHING_CHANNEL "/Kvartira/Reports"
#define MQTT_PUBLISHING_CHANNEL_2 "/Kvartira/Humidity"
#define MQTT_PUBLISHING_CHANNEL_3 "/Kvartira/Temperature"</code></pre><br/>
Так и для публикации «приказов» на выполнение от смартфона:<br/>
<br/>
<pre><code class="java">#define MQTT_RECEIVER_CHANNEL_1 "Kvartira/Orders"</code></pre><br/>
К слову сказать, насчёт топиков, их количество может быть произвольным, и вы можете создать свои собственные как для отправки сообщений на исполнение, так и для получения данных о происходящем от микроконтроллера.<br/>
<br/>
Далее мы устанавливаем переменные процесса отправки e-mail сообщений. Для пример взята почта gmail:<br/>
<br/>
<pre><code class="java">#define SMTP_HOST "smtp.gmail.com"
#define SMTP_PORT 465

#define AUTHOR_EMAIL "nekayapochta@gmail.com" //адрес электронной почты,
                                              //ОТКУДА будет отправляться сообщение
#define AUTHOR_PASSWORD "parol" //пароль электронной почты,
                                //ОТКУДА будет отправляться сообщение
#define RECIPIENT_EMAIL "vashapochta@mail.ru" //адрес электронной почты,
                                              //КУДА будет отправляться сообщение 

SMTPSession smtp; // объект SMTP-сессии, используемый для отправки e-mail сообщения
void smtpCallback(SMTP_Status status); // Функция обратного вызова, чтобы получать статус
                                      //состояния отправки e-mail сообщения

String EmailMessageType = ""; //В эту строку будет писаться, какое сообщение отправить
       const uint32_t SendingPeriod = 30000; //интервал, между отправкой почты
                                             //(чтобы сильно часто не спамить)
       uint32_t lastSendingTime = 0; //время, когда было отправлено последнее сообщение</code></pre><br/>
Также определяем переменные датчиков:<br/>
<br/>
<pre><code class="java">#define DHTPIN 4      // Пин, к которому подключён датчик
#define DHTTYPE DHT22 // Используемый датчик DHT 22
  DHT dht1 (DHTPIN, DHTTYPE); // Инициализируем датчик
      float humiditySensor1 = 0;  //влажность, считанная с датчика 1

 //критическая влажность, при которой идёт отправка сообщения на e-mail:
      float ALARM_for_HumiditySensors = 100;

      float temperatureSensor1 = 0;  //температура, считанная с датчика 1

//критическая температура, в градусах Цельсия, при которой
//идёт отправка сообщения на e-mail:
      float ALARM_for_temperatureSensors = 50;

//интервал между считываниями данных с датчика 1:      
      const uint32_t DelayPeriod = 2000; 

//когда в последний раз были прочитаны данные с датчика 1:     
      uint32_t Sensor1LastReadingTime = 0;

// Пин, к которому подключён датчик Холла, на входной двери:
#define HALLPIN 13 
int value ; // переменная для хранения значения с датчика  </code></pre><br/>
И установим переменные управляющих контактов. Здесь под управляющими контактами подразумеваются те, что будут управлять транзисторными ключами и могут быть подключены к абсолютно разным устройствам: полива цветов, проветривания комнаты или теплицы и т.д. Для примера указан только один вариант, вы же можете установить нужное вам количество, создав их в необходимой для вас конфигурации:<br/>
<br/>
<pre><code class="java">// Пин, к которому подключён транзисторный ключ полива цветов:
const int mosfetPin = 19;

//начало времени работы двигателя полива цветов:
uint32_t pauseStartTime = 0;

//количество миллисекунд работы двигателя полива:
const uint32_t WORKperiod = 8000;</code></pre><br/>
Из интересных моментов стоит отметить ещё и функцию прерывания, которая содержится в методе setup(). Дело здесь в следующем: так как (предположительно) событие проникновения в квартиру является довольно краткосрочным, то есть гипотетический вор быстро откроет дверь и так же быстро её закроет, поэтому мы устанавливаем функцию прерывания, которая прерывает исполнение кода и отправляет сообщение о взломе в любой момент работы программы. Это позволит не пропустить соответствующее изменение состояния датчика. Другими словами, при открытии двери сигнал от цифрового датчика Холла изменится на HIGH и будет вызвана функция Email_ handler:<br/>
<br/>
<pre><code class="java">  attachInterrupt(digitalPinToInterrupt (HALLPIN), Email_handler, HIGH);</code></pre><br/>
Благодаря чёткому разделению программы на функциональные блоки, мы можем видеть, что метод loop() весьма разгружен и является очень лаконичным и легко понимаемым:<br/>
<br/>
<pre><code class="java">void loop(){

 //проверка и реконнект при потере связи:
   ConnectionsChecker ();

 //чтение показателей датчиков:   
   SensorsReader ();   

//проверка - нет ли новых сообщений на исполнение с MQTT-брокера:   
   client.loop();

// отправка сообщения на Email при возникновении критических ситуаций:   
   Email_handler(); 
}</code></pre><br/>
<h3><font color="#163C51">Рассмотрим составные его элементы подробнее</font></h3>Как можно видеть, функция ConnectionsChecker — отвечает за две операции: восстановление связи с роутером при её потере и за восстановление связи с mqtt-брокером при пропадании таковой:<br/>
<br/>
<pre><code class="java">void ConnectionsChecker () 
{
    //если разрыв соединения с точкой доступа — восстанавливаем связь:
  if (WiFi.status() != WL_CONNECTED)
     {
           setup_wifi(); 
     }
   
  //если разрыв соединения с MQTT-брокером — восстанавливаем связь: 
  if (!client.connected()) 
     {
      reconnect();
     }
}</code></pre><br/>
Функция Email_ handler отвечает за отправку соответствующих e-mail сообщений при возникновении определённых условий:<br/>
<br/>
<pre><code class="java">      String textMsg = "";

      if (humiditySensor1>=ALARM_for_HumiditySensors)
      {
        textMsg = "ОПАСНОСТЬ! Превышение уровня влажности в квартире!";
      }
      else if (temperatureSensor1>=ALARM_for_temperatureSensors)
      {
        textMsg = "ОПАСНОСТЬ! Опасная температура в квартире!";        
      }
      else
      {
        textMsg = "ОПАСНОСТЬ-ВЗЛОМ! Проникновение через дверь!";        
      }
</code></pre><br/>
Функция MQTT_handler служит для обработки сообщений, которые были получены микроконтроллером и должны быть исполнены. Здесь также для примера приведён только один вариант сообщения — получение цифры 0, при таком варианте включается электродвигатель насоса и происходит полив цветов. Вы же можете раскомментировать необходимые строки, либо даже добавить количество условий для вашего конкретного случая:<br/>
<br/>
<pre><code class="java">              if(ch[0]=='0')
              { 
                Serial.println("Полить цветы");
                pauseStartTime = millis();

                //включаем двигатель полива цветов:               
                digitalWrite(mosfetPin, HIGH);

                //ничего не делаем, просто ждём:
                while ( (millis() - pauseStartTime)&lt;WORKperiod ){}; 
//
                digitalWrite(mosfetPin, LOW);//выключаем двигатель             
        
                client.publish(MQTT_PUBLISHING_CHANNEL, "Цветы политы!");
                                
//раскомментируйте 2 условия ниже и при необходимости добавьте свои
//при потребности (если нужно кроме полива проветрить теплицу и т.д.)
//              } else if (ch[0]=='1')
//              {
//             
//              }
//              else if (ch[0]=='2')
//              {
//                
//              }</code></pre><br/>
И последняя функция SensorsReader занимается обработкой показателей от датчика влажности и температуры. В данную функцию также возможно добавить большее количество датчиков, например, для отслеживания температуры и влажности в различных комнатах. Здесь же для примера приведён только один датчик.<br/>
<br/>
Интересным моментом этой функции является то, что она после считывания параметров публикует их в подходящие топики mqtt-брокера, после чего эти показатели могут быть считаны приложением на смартфоне в любой момент. Таким образом, владелец всегда может быть осведомлён о состоянии «погоды» в квартире:<br/>
<br/>
<pre><code class="java">    client.publish(MQTT_PUBLISHING_CHANNEL_2, dtostrf(humiditySensor1, 5, 2, humidity) );
    client.publish(MQTT_PUBLISHING_CHANNEL_3, dtostrf(temperatureSensor1, 5, 2, temperature) );</code></pre><br/>
В качестве приложения для смартфона можно использовать, например, MQTT Dash или любое другое по вкусу.<br/>
<br/>
Файл проекта Arduino IDE в архиве, можно <a href="https://drive.google.com/file/d/1JyA6RcYkAOpBj84kCHSDP-D_wMbJeWIQ/view?usp=sharing">скачать здесь</a>.<br/>
<br/>
<hr/>НЛО прилетело и оставило здесь промокоды для читателей нашего блога:<br/>
<br/>
<b><font color="#163C51">HABRFIRSTVDS </font></b>— скидка 15% на все тарифы VDS, кроме VDS Прогрев, на сайте <a href="https://firstvds.ru/">firstvds.ru</a>.<br/>
<br/>
<b><font color="#163C51">HABRFIRSTDEDIC </font></b>— скидка 20% на гибкие конфигурации выделенных серверов на базе процессоров AMD Ryzen и Intel Core на сайте <a href="https://1dedic.ru/?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=product&amp;utm_content=amdryzen5">1dedic.ru</a>.<br/>
<br/>
Скидка применяется на весь оплаченный период (1, 3, 6 или 12 месяцев) и распространяется только на ресурсы сервера. Воспользоваться промокодом можно до 31.12.21 при заказе любого количества новых серверов.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Besp32%5D" class="tm-tags-list__link">esp32</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B4%D0%B0%D1%82%D1%87%D0%B8%D0%BA%D0%B8%5D" class="tm-tags-list__link">датчики</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BFirstVDS%5D" class="tm-tags-list__link">FirstVDS</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BFirstDEDIC%5D" class="tm-tags-list__link">FirstDEDIC</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/company/first/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании FirstVDS
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/arduino/" class="tm-hubs-list__link">
    Разработка под Arduino
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/electronics/" class="tm-hubs-list__link">
    Производство и разработка электроники
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/easyelectronics/" class="tm-hubs-list__link">
    Электроника для начинающих
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 21: ↑20 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 21: ↑20 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+19</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    63
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/company/first/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/81e/a2b/70e/81ea2b70ebe0942cdf523ca6af7a3e2b.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/company/first/profile/" class="tm-company-snippet__title">FirstVDS</a> <div class="tm-company-snippet__description">Виртуальные и выделенные серверы в ДЦ в Москве</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://firstvds.ru" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a><a href="https://1dedic.ru" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a><a href="https://facebook.com/FirstVDS" rel="noopener" target="_blank" class="tm-article-author__contact">
      Facebook
    </a><a href="https://vk.com/firstvds" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/kot_review/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/598/273/23e/59827323e7b2f5f4bc577d4ab8cf934a.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 10 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    10
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">33</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/kot_review/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @kot_review
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Программист</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/company/first/blog/582258/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 8 
    </span></a> <!----></div></div></div>  <!---->  <!----> <!----></div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2002-12-05T21:00:00.000Z" title="2002-12-06, 00:00">6  декабря  2002</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="http://firstvds.ru/?aid=20152" target="_blank" class="tm-company-basic-info__link">
      firstvds.ru
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    51–100 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2012-09-13T06:50:30.000Z" title="2012-09-13, 10:50">13  сентября  2012</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="/ru/users/FirstJohn/" class="tm-company-basic-info__link">
      FirstJohn
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/company/first/blog/582258/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/company/first/blog/582258/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"582258":{"id":"582258","timePublished":"2021-10-18T07:00:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Удаленный мониторинг состояния квартиры и управление домашними устройствами","leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F6f7\u002F7fd\u002F57c\u002F6f77fd57c17fbc0f4ae3b57eac673c90.png\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНаиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также необходимость автоматического исполнения некоторых задач, среди которых особо можно выделить полив домашних цветов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ рамках этой статьи мы попробуем рассмотреть, как можно было бы создать систему домашнего мониторинга и удалённого управления, используя минимальные средства. Несмотря на некоторую ограниченность системы, она является в достаточной степени функциональной и даёт широкие возможности её создателю.\u003Cbr\u003E\r\n\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":10,"votesCount":10},"rating":33,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2801053","alias":"kot_review","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F598\u002F273\u002F23e\u002F59827323e7b2f5f4bc577d4ab8cf934a.png","speciality":"Программист"},"statistics":{"commentsCount":8,"favoritesCount":63,"readingCount":5060,"score":19,"votesCount":21},"hubs":[{"relatedData":null,"id":"17832","alias":"first","type":"corporative","title":"Блог компании FirstVDS","titleHtml":"Блог компании FirstVDS","isProfiled":false},{"relatedData":null,"id":"21474","alias":"arduino","type":"collective","title":"Разработка под Arduino","titleHtml":"Разработка под Arduino","isProfiled":true},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"22016","alias":"easyelectronics","type":"collective","title":"Электроника для начинающих","titleHtml":"Электроника для начинающих","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F6f7\u002F7fd\u002F57c\u002F6f77fd57c17fbc0f4ae3b57eac673c90.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНаиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также необходимость автоматического исполнения некоторых задач, среди которых особо можно выделить полив домашних цветов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ рамках этой статьи мы попробуем рассмотреть, как можно было бы создать систему домашнего мониторинга и удалённого управления, используя минимальные средства. Несмотря на некоторую ограниченность системы, она является в достаточной степени функциональной и даёт широкие возможности её создателю.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003EПопробуем кратко охарактеризовать комплекс задач, стоящих перед разработчиком системы:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EБольшое количество различных бытовых несчастий происходит ввиду того, что случаются разнообразные техногенные катастрофы бытового масштаба. Среди них можно выделить: протечки в системе отопления, забытые включёнными краны холодной и горячей воды, случайное возгорание объектов. Последний пункт является особо любопытным, так как зачастую такие случаи возникают даже из-за невинной капли воды, оставшейся на подоконнике, которая, по сути, является собирающей линзой. В яркий солнечный день эта водяная линза легко концентрирует солнечные лучи в поджигающую точку (точно так же, как многие баловались в детстве, выжигая всякие надписи на деревянных предметах). Поэтому наблюдение за температурой и влажностью в квартире является крайне важным, так как эксцессы на базе этих двух пунктов могут произойти даже совершенно случайно, без особой вины владельца. Поэтому создаваемая нами система должна будет иметь возможность мониторить уровень влажности и температуры в квартире.\u003C\u002Fli\u003E\r\n\u003Cli\u003EМногие люди, уезжая даже на непродолжительный отпуск, сталкиваются с необходимостью полива домашних цветов. Поэтому создание такой системы будет вполне актуальным и нужным для большинства людей. Наличие подобного устройства дома развязывает руки владельцу и позволяет ему отсутствовать продолжительное время.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКаждый собственник в момент своего отсутствия достаточно сильно переживает о том, не было ли совершено проникновение в его жилище. Установка профессиональных систем сигнализации является, конечно, предпочтительным вариантом, однако такое действие несколько затратно. Поэтому мы постараемся создать свою систему, которая, несмотря на свою доступность, сможет быть вполне функциональный и позволит в режиме реального времени мониторить жилище на отсутствие\u002Fналичие взлома и проникновения в него.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nДля реализации всего вышесказанного видится наиболее целесообразным создать систему, состоящую из двух функциональных блоков:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EБлок мониторинга за состоянием жилища.\u003C\u002Fli\u003E\r\n\u003Cli\u003EБлок оповещения владельца о возникновении внештатных ситуаций.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nВ качестве блока мониторинга мы будем использовать mqtt-брокер, в соответствующие топики которого система будет публиковать отчёты о состоянии отслеживаемых параметров. Для наблюдения за этими параметрами со стороны владельца вполне рационально использовать то или иное приложение под смартфон, которое позволит производить мониторинг параметров в реальном времени.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля физической реализации мониторинга мы будем использовать датчик влажности и температуры DHT22, в то время как для мониторинга за проникновением в жилище мы будем использовать пару из цифрового датчика Холла KY-003 и неодимового магнита.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля оповещения владельца мы создадим систему отправки предупреждающих e-mail сообщений, так как этот способ является одним из наиболее доступных. Как альтернативу ему можно было рассмотреть написание некого приложения под смартфон, которое будет мониторить топики, в которые система будет публиковать сообщения о внештатных ситуациях, при возникновении которых смартфон будет подавать звуковой или иной сигнал. Однако рассмотрение этого не входит в рамки этой статьи, поэтому создание такой системы оповещения можно отложить на перспективу.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ качестве ещё одного интересного варианта оповещения владельца можно было бы рассмотреть вариант отправки сервисных SMS сообщений. Здесь возможны тоже несколько вариантов. Среди которых можно перечислить такие, как: \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EОтправка смс-сообщения непосредственно с аппаратного устройства.\u003C\u002Fli\u003E\r\n\u003Cli\u003EИспользование соответствующих интернет-сервисов, когда отправка данных позволяет преобразовать их в SMS сообщение для адресата. Такой способ является тоже весьма интересным и может быть проработан в рамках создания будущих устройств.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nОбщая схема системы и её работы показана на рисунке ниже (кликабельно, большая):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F51\u002Fhp\u002Fjw\u002F51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F51\u002Fhp\u002Fjw\u002F51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F51\u002Fhp\u002Fjw\u002F51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n«Мозг» системы будет построен на основе известного микроконтроллера Espressif ESP32.\u003Cbr\u002F\u003E\r\nПрограммирование системы будет осуществлено в рамках среды разработки Arduino IDE, с использованием языка Arduino C.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля удобства работы с кодом и чёткого его структурирования мы его раздели на пять блоков, которые будут разнесены на пять необходимых вкладок Arduino IDE в виде соответствующих функций. Рассмотрим вкратце содержимое каждой из них:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fgw\u002Fig\u002Fl1\u002Fgwigl1ir0aixv-nt7yi_3calul0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgw\u002Fig\u002Fl1\u002Fgwigl1ir0aixv-nt7yi_3calul0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nДля начала нам необходимо сконфигурировать свою домашнюю сеть роутера, к которому будет подключаться по wi-fi в наш микроконтроллер:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003Econst char* ssid = \"\"; \u002F\u002Fсюда название вашей домашней wifi-сети роутера\nconst char* password = \"\";\u002F\u002Fсюда пароль от wifi-сети роутера\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДалее нам необходимо сконфигурировать параметры доступа к mqtt-брокеру. Для лучшего понимания кода мы снабдили его положенными пояснениями:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003Econst char* mqtt_server = \"vashbroker.com\";\u002F\u002Fсюда адрес вашего брокера\n#define mqtt_port 1883 \u002F\u002Fпорт вашего брокера\n#define MQTT_USER \"\"   \u002F\u002Fсюда имя пользователя MQTT,\n                       \u002F\u002Fесли система должна иметь пользователя и пароль\n#define MQTT_PASSWORD \"\" \u002F\u002Fсюда пароль пользователя MQTT,\n                       \u002F\u002Fесли система должна иметь пользователя и пароль\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДалее мы создаём топики для публикации в них как сообщений от микроконтроллера:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E#define MQTT_PUBLISHING_CHANNEL \"\u002FKvartira\u002FReports\"\n#define MQTT_PUBLISHING_CHANNEL_2 \"\u002FKvartira\u002FHumidity\"\n#define MQTT_PUBLISHING_CHANNEL_3 \"\u002FKvartira\u002FTemperature\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТак и для публикации «приказов» на выполнение от смартфона:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E#define MQTT_RECEIVER_CHANNEL_1 \"Kvartira\u002FOrders\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nК слову сказать, насчёт топиков, их количество может быть произвольным, и вы можете создать свои собственные как для отправки сообщений на исполнение, так и для получения данных о происходящем от микроконтроллера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДалее мы устанавливаем переменные процесса отправки e-mail сообщений. Для пример взята почта gmail:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E#define SMTP_HOST \"smtp.gmail.com\"\n#define SMTP_PORT 465\n\n#define AUTHOR_EMAIL \"nekayapochta@gmail.com\" \u002F\u002Fадрес электронной почты,\n                                              \u002F\u002FОТКУДА будет отправляться сообщение\n#define AUTHOR_PASSWORD \"parol\" \u002F\u002Fпароль электронной почты,\n                                \u002F\u002FОТКУДА будет отправляться сообщение\n#define RECIPIENT_EMAIL \"vashapochta@mail.ru\" \u002F\u002Fадрес электронной почты,\n                                              \u002F\u002FКУДА будет отправляться сообщение \n\nSMTPSession smtp; \u002F\u002F объект SMTP-сессии, используемый для отправки e-mail сообщения\nvoid smtpCallback(SMTP_Status status); \u002F\u002F Функция обратного вызова, чтобы получать статус\n                                      \u002F\u002Fсостояния отправки e-mail сообщения\n\nString EmailMessageType = \"\"; \u002F\u002FВ эту строку будет писаться, какое сообщение отправить\n       const uint32_t SendingPeriod = 30000; \u002F\u002Fинтервал, между отправкой почты\n                                             \u002F\u002F(чтобы сильно часто не спамить)\n       uint32_t lastSendingTime = 0; \u002F\u002Fвремя, когда было отправлено последнее сообщение\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТакже определяем переменные датчиков:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E#define DHTPIN 4      \u002F\u002F Пин, к которому подключён датчик\n#define DHTTYPE DHT22 \u002F\u002F Используемый датчик DHT 22\n  DHT dht1 (DHTPIN, DHTTYPE); \u002F\u002F Инициализируем датчик\n      float humiditySensor1 = 0;  \u002F\u002Fвлажность, считанная с датчика 1\n\n \u002F\u002Fкритическая влажность, при которой идёт отправка сообщения на e-mail:\n      float ALARM_for_HumiditySensors = 100;\n\n      float temperatureSensor1 = 0;  \u002F\u002Fтемпература, считанная с датчика 1\n\n\u002F\u002Fкритическая температура, в градусах Цельсия, при которой\n\u002F\u002Fидёт отправка сообщения на e-mail:\n      float ALARM_for_temperatureSensors = 50;\n\n\u002F\u002Fинтервал между считываниями данных с датчика 1:      \n      const uint32_t DelayPeriod = 2000; \n\n\u002F\u002Fкогда в последний раз были прочитаны данные с датчика 1:     \n      uint32_t Sensor1LastReadingTime = 0;\n\n\u002F\u002F Пин, к которому подключён датчик Холла, на входной двери:\n#define HALLPIN 13 \nint value ; \u002F\u002F переменная для хранения значения с датчика  \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nИ установим переменные управляющих контактов. Здесь под управляющими контактами подразумеваются те, что будут управлять транзисторными ключами и могут быть подключены к абсолютно разным устройствам: полива цветов, проветривания комнаты или теплицы и т.д. Для примера указан только один вариант, вы же можете установить нужное вам количество, создав их в необходимой для вас конфигурации:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E\u002F\u002F Пин, к которому подключён транзисторный ключ полива цветов:\nconst int mosfetPin = 19;\n\n\u002F\u002Fначало времени работы двигателя полива цветов:\nuint32_t pauseStartTime = 0;\n\n\u002F\u002Fколичество миллисекунд работы двигателя полива:\nconst uint32_t WORKperiod = 8000;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nИз интересных моментов стоит отметить ещё и функцию прерывания, которая содержится в методе setup(). Дело здесь в следующем: так как (предположительно) событие проникновения в квартиру является довольно краткосрочным, то есть гипотетический вор быстро откроет дверь и так же быстро её закроет, поэтому мы устанавливаем функцию прерывания, которая прерывает исполнение кода и отправляет сообщение о взломе в любой момент работы программы. Это позволит не пропустить соответствующее изменение состояния датчика. Другими словами, при открытии двери сигнал от цифрового датчика Холла изменится на HIGH и будет вызвана функция Email_ handler:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E  attachInterrupt(digitalPinToInterrupt (HALLPIN), Email_handler, HIGH);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nБлагодаря чёткому разделению программы на функциональные блоки, мы можем видеть, что метод loop() весьма разгружен и является очень лаконичным и легко понимаемым:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003Evoid loop(){\n\n \u002F\u002Fпроверка и реконнект при потере связи:\n   ConnectionsChecker ();\n\n \u002F\u002Fчтение показателей датчиков:   \n   SensorsReader ();   \n\n\u002F\u002Fпроверка - нет ли новых сообщений на исполнение с MQTT-брокера:   \n   client.loop();\n\n\u002F\u002F отправка сообщения на Email при возникновении критических ситуаций:   \n   Email_handler(); \n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E\u003Cfont color=\"#163C51\"\u003EРассмотрим составные его элементы подробнее\u003C\u002Ffont\u003E\u003C\u002Fh3\u003EКак можно видеть, функция ConnectionsChecker — отвечает за две операции: восстановление связи с роутером при её потере и за восстановление связи с mqtt-брокером при пропадании таковой:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003Evoid ConnectionsChecker () \n{\n    \u002F\u002Fесли разрыв соединения с точкой доступа — восстанавливаем связь:\n  if (WiFi.status() != WL_CONNECTED)\n     {\n           setup_wifi(); \n     }\n   \n  \u002F\u002Fесли разрыв соединения с MQTT-брокером — восстанавливаем связь: \n  if (!client.connected()) \n     {\n      reconnect();\n     }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nФункция Email_ handler отвечает за отправку соответствующих e-mail сообщений при возникновении определённых условий:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E      String textMsg = \"\";\n\n      if (humiditySensor1\u003E=ALARM_for_HumiditySensors)\n      {\n        textMsg = \"ОПАСНОСТЬ! Превышение уровня влажности в квартире!\";\n      }\n      else if (temperatureSensor1\u003E=ALARM_for_temperatureSensors)\n      {\n        textMsg = \"ОПАСНОСТЬ! Опасная температура в квартире!\";        \n      }\n      else\n      {\n        textMsg = \"ОПАСНОСТЬ-ВЗЛОМ! Проникновение через дверь!\";        \n      }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nФункция MQTT_handler служит для обработки сообщений, которые были получены микроконтроллером и должны быть исполнены. Здесь также для примера приведён только один вариант сообщения — получение цифры 0, при таком варианте включается электродвигатель насоса и происходит полив цветов. Вы же можете раскомментировать необходимые строки, либо даже добавить количество условий для вашего конкретного случая:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E              if(ch[0]=='0')\n              { \n                Serial.println(\"Полить цветы\");\n                pauseStartTime = millis();\n\n                \u002F\u002Fвключаем двигатель полива цветов:               \n                digitalWrite(mosfetPin, HIGH);\n\n                \u002F\u002Fничего не делаем, просто ждём:\n                while ( (millis() - pauseStartTime)&lt;WORKperiod ){}; \n\u002F\u002F\n                digitalWrite(mosfetPin, LOW);\u002F\u002Fвыключаем двигатель             \n        \n                client.publish(MQTT_PUBLISHING_CHANNEL, \"Цветы политы!\");\n                                \n\u002F\u002Fраскомментируйте 2 условия ниже и при необходимости добавьте свои\n\u002F\u002Fпри потребности (если нужно кроме полива проветрить теплицу и т.д.)\n\u002F\u002F              } else if (ch[0]=='1')\n\u002F\u002F              {\n\u002F\u002F             \n\u002F\u002F              }\n\u002F\u002F              else if (ch[0]=='2')\n\u002F\u002F              {\n\u002F\u002F                \n\u002F\u002F              }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nИ последняя функция SensorsReader занимается обработкой показателей от датчика влажности и температуры. В данную функцию также возможно добавить большее количество датчиков, например, для отслеживания температуры и влажности в различных комнатах. Здесь же для примера приведён только один датчик.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИнтересным моментом этой функции является то, что она после считывания параметров публикует их в подходящие топики mqtt-брокера, после чего эти показатели могут быть считаны приложением на смартфоне в любой момент. Таким образом, владелец всегда может быть осведомлён о состоянии «погоды» в квартире:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"java\"\u003E    client.publish(MQTT_PUBLISHING_CHANNEL_2, dtostrf(humiditySensor1, 5, 2, humidity) );\n    client.publish(MQTT_PUBLISHING_CHANNEL_3, dtostrf(temperatureSensor1, 5, 2, temperature) );\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВ качестве приложения для смартфона можно использовать, например, MQTT Dash или любое другое по вкусу.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nФайл проекта Arduino IDE в архиве, можно \u003Ca href=\"https:\u002F\u002Fdrive.google.com\u002Ffile\u002Fd\u002F1JyA6RcYkAOpBj84kCHSDP-D_wMbJeWIQ\u002Fview?usp=sharing\"\u003Eскачать здесь\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Chr\u002F\u003EНЛО прилетело и оставило здесь промокоды для читателей нашего блога:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Cfont color=\"#163C51\"\u003EHABRFIRSTVDS \u003C\u002Ffont\u003E\u003C\u002Fb\u003E— скидка 15% на все тарифы VDS, кроме VDS Прогрев, на сайте \u003Ca href=\"https:\u002F\u002Ffirstvds.ru\u002F\"\u003Efirstvds.ru\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003E\u003Cfont color=\"#163C51\"\u003EHABRFIRSTDEDIC \u003C\u002Ffont\u003E\u003C\u002Fb\u003E— скидка 20% на гибкие конфигурации выделенных серверов на базе процессоров AMD Ryzen и Intel Core на сайте \u003Ca href=\"https:\u002F\u002F1dedic.ru\u002F?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=product&amp;utm_content=amdryzen5\"\u003E1dedic.ru\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкидка применяется на весь оплаченный период (1, 3, 6 или 12 месяцев) и распространяется только на ресурсы сервера. Воспользоваться промокодом можно до 31.12.21 при заказе любого количества новых серверов.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"esp32"},{"titleHtml":"датчики"},{"titleHtml":"FirstVDS"},{"titleHtml":"FirstDEDIC"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002F3p\u002Fhz\u002Fsp\u002F3phzsp19etcevyj3b06yfa9_yam.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002F3p\u002Fhz\u002Fsp\u002F3phzsp19etcevyj3b06yfa9_yam.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Ffirst\\\u002Fblog\\\u002F582258\\\u002F\"},\"headline\":\"Удаленный мониторинг состояния квартиры и управление домашними устройствами\",\"datePublished\":\"2021-10-18T10:00:01+03:00\",\"dateModified\":\"2021-10-18T10:37:34+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"kot_review\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек н...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Ffirst\\\u002Fblog\\\u002F582258\\\u002F#post-content-body\",\"about\":[\"c_first\",\"h_arduino\",\"h_electronics\",\"h_easyelectronics\",\"f_develop\",\"f_popsci\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F582258\\\u002F67da3358adbc62e5313864d97a108be7\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F6f7\\\u002F7fd\\\u002F57c\\\u002F6f77fd57c17fbc0f4ae3b57eac673c90.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F51\\\u002Fhp\\\u002Fjw\\\u002F51hpjwbmtbyqdw2d7hrtg_kx3r0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fgw\\\u002Fig\\\u002Fl1\\\u002Fgwigl1ir0aixv-nt7yi_3calul0.jpeg\"]}","metaDescription":"Наиболее частыми задачами, стоящими перед любыми домовладельцами, являются наблюдение за его жилищем в момент физического отсутствия, например, когда человек находится на работе, а также...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"first":{"alias":"first","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F81e\u002Fa2b\u002F70e\u002F81ea2b70ebe0942cdf523ca6af7a3e2b.png","titleHtml":"FirstVDS","descriptionHtml":"Виртуальные и выделенные серверы в ДЦ в Москве","relatedData":null,"statistics":{"postsCount":72,"newsCount":0,"vacanciesCount":0,"employeesCount":14,"careerRating":null,"subscribersCount":24212,"rating":356.96,"invest":null},"foundationDate":{"year":"2002","month":"12","day":"06"},"location":{"city":null,"region":null,"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Ffirstvds.ru\u002F?aid=20152","staffNumber":"51–100 человек","registrationDate":"2012-09-13T06:50:30+00:00","representativeUser":{"alias":"FirstJohn","fullname":null},"contacts":[{"title":"Сайт","url":"https:\u002F\u002Ffirstvds.ru"},{"title":"Сайт","url":"https:\u002F\u002F1dedic.ru"},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002FFirstVDS"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Ffirstvds"}],"settings":{"analyticsSettings":[{"type":"ga","trackingId":"UA-10974470-14"}],"branding":null,"status":"active"},"metadata":{"titleHtml":"FirstVDS, Россия - Виртуальные и выделенные серверы в ДЦ в Москве с 6 декабря 2002 г.","title":"FirstVDS, Россия - Виртуальные и выделенные серверы в ДЦ в Москве с 6 декабря 2002 г.","keywords":["Программирование","Системное администрирование","Хостинг","Разработка под Arduino","Компиляторы"],"descriptionHtml":"72 статьи от авторов компании FirstVDS","description":"72 статьи от авторов компании FirstVDS"},"aDeskSettings":null,"careerAlias":"firstvds","maxCustomTrackerLinks":0}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
