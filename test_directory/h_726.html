<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/582708\/"},"headline":"Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов","datePublished":"2021-10-11T12:00:21+03:00","dateModified":"2021-10-11T16:55:13+03:00","author":{"@type":"Person","name":"Дмитрий Поздняков"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых п...","url":"https:\/\/habr.com\/ru\/post\/582708\/#post-content-body","about":["h_search_technologies","h_algorithms","h_maths","h_machine_learning","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/582708\/c26f7729404c29b7a90d266fe778a097\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/65f\/682\/67d\/65f68267d3d20a5cd6b141768b9e4370.svg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/bfb\/9fc\/16f\/bfb9fc16fa351e244030af9d0a42497f.svg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/dad\/a48\/306\/dada483069f3465192f81b4b1d79ed70.svg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c60\/263\/096\/c60263096c7cc4f96f6a86363139061c.svg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c2e\/b62\/77a\/c2eb6277a8e960b6fc902a81914f643c.svg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/00d\/4b5\/f46\/00d4b5f46f5758b7f87efd4d7a992219.gif"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="582708" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-11T09:00:21.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/582708/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/582708/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Dmitry_Po/" title="Dmitry_Po" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/233/d39/e46/233d39e464b9067fc2b98f7d8bc597c0.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/Dmitry_Po/" class="tm-user-info__username">
      Dmitry_Po
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-11T09:00:21.000Z" title="2021-10-11, 12:00">11  октября   в 12:00</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/search_technologies/" class="tm-article-snippet__hubs-item-link"><span>Поисковые технологии</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/algorithms/" class="tm-article-snippet__hubs-item-link"><span>Алгоритмы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/maths/" class="tm-article-snippet__hubs-item-link"><span>Математика</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/machine_learning/" class="tm-article-snippet__hubs-item-link"><span>Машинное обучение</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="http://www.sciencepublishinggroup.com/journal/paperinfo?journalid=303&amp;doi=10.11648/j.ajcst.20210402.12" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Dmitry Pozdnyakov
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух наиболее близких по косинусному расстоянию лицевых дескрипторов. Разработанный алгоритм обладает той же точностью, что и метод простого перебора и, в то же время, он приблизительно в сто раз быстрее. С более подробным описанием алгоритма можно познакомиться в англоязычном оригинале настоящей статьи.</p><h3>Введение</h3><p>В последние годы автоматизированные методы сличения изображений лиц при установлении наличия в базе запрашиваемой персоны стали особенно популярными. И когда в базе лиц очень большое количество изображений, то затрачиваемое время на поиск наиболее похожего изображения лица на фото сличаемой персоны становиться крайне критичным. Проблема быстрой обработки данных базы лиц даже трансформировалась в отдельную область научных исследований. В настоящее время наиболее популярным методом кодирования отличительных черт лица является нейросетевая экстракция соответствующего ему дескриптора — вектора из многомерного пространства характерных лицевых признаков. Такой подход позволяет свести сличение изображений лиц к формальному сравнению дескрипторов с использованием той или иной метрики. В частности, в качестве первого приближения может применяться и обычное Эвклидово расстояние или наоборот, могут использоваться какие-либо экзотические метрики, хотя наиболее употребимой мерой похожести является косинусное расстояние. В любом случае, независимо от способа задания метрики, задача нахождения наиболее похожего изображения лица из заданного множества лиц на изображение лица сличаемой персоны сводится к поиску ближайшей соседней точки в соответствующем метрическом смысле к заданной точке многомерного пространства лицевых признаков. И такая задача может быть абсолютно точно решена методом полного перебора дескрипторов (поиск дескриптора, отвечающего, например, максимальному значению косинусной похожести). При количестве изображений лиц в базе равном <em>M</em> вычислительная сложность алгоритма поиска, очевидно, пропорциональна <em>M</em>. И если <em>M</em> весьма велико, то на полный перебор может уходить слишком много времени, что, порой, неприемлемо. Более того, из-за аппаратных ограничений начиная с некоторых значений <em>M</em> распараллеливание алгоритма поиска и перенос его на GPU перестает быть эффективным методом ускорения этого алгоритма. Естественным способом решения данной проблемы является специальная организация данных в базе (<a href="https://ru.wikipedia.org/wiki/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0_%D0%92%D0%BE%D1%80%D0%BE%D0%BD%D0%BE%D0%B3%D0%BE" rel="noopener noreferrer nofollow">диаграмма Вороного</a>, <a href="https://ru.wikipedia.org/wiki/K-d-%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE" rel="noopener noreferrer nofollow">K-d-дерево</a> и др.) плюс <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%B8%D1%81%D0%BA%D0%BE%D0%B2%D1%8B%D0%B9_%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81" rel="noopener noreferrer nofollow">индексирование</a>, <a href="https://en.wikipedia.org/wiki/Geometric_hashing" rel="noopener noreferrer nofollow">хеширование</a> и пр., позволяющие кардинально ускорить поиск. Конкретных реализаций указанных подходов существует огромное множество. Однако, все они позволяют находить <a href="https://en.wikipedia.org/wiki/Nearest_neighbor_search" rel="noopener noreferrer nofollow">ближайшего соседа</a> либо приблизительно, либо с выделением больших объемов памяти на индексную информацию и большими вычислительными затратами на переиндексацию базы данных.</p><p>С учетом вышесказанного возникает естественный вопрос: а вообще возможно ли путем не слишком сложных вычислений без необходимости выделения больших объемов памяти проиндексировать элементы базы так, чтобы впоследствии с помощью некоего специального алгоритма поиска можно было бы абсолютно точно находить ближайшего соседа со среднестатистическим временем поиска, по крайней мере, в разы меньшим, чем время, необходимое на полный перебор элементов в базе. Именно на этот вопрос и отвечает настоящая публикация на примере решения задачи быстрого дескрипторного поиска наиболее похожего изображения лица из базы на изображение лица сличаемой персоны.</p><h3>Теория</h3><p>В качестве методологической основы для индексации состоящей из дескрипторов базы изображений лиц используем ряд модификаций такого известного классического алгоритма, как метод геометрического хеширования. Итак, пусть дескриптора <strong>d</strong><em><sub>ij</sub></em> — это элементы векторного пространства лицевых признаков единичной длины с размерностью <em>N</em> = 512 (но может быть больше или меньше), извлекаемые из изображений лиц какой-либо нейронной сетью, например, типа <a href="https://arxiv.org/pdf/1801.07698.pdf" rel="noopener noreferrer nofollow">ArcFace</a> с бэкбоном типа <a href="https://en.wikipedia.org/wiki/Residual_neural_network" rel="noopener noreferrer nofollow">ResNet</a>, которая была обучена, например, с использованием <a href="http://shuoyang1213.me/WIDERFACE/" rel="noopener noreferrer nofollow">WiderFace</a>.</p><p>Геометрическое хеширование не позволяет с абсолютной точностью определять ближайшего соседа для пробных векторов, попадающих в окрестности границ, разделяющих заданную область пространства на соответствующие кластера многомерных векторов. Поэтому для классического алгоритма геометрического хеширования необходимо осуществить ряд модификаций. При этом далее для конкретизации всех примеров будет рассматриваться такая хорошо известная база изображений лиц, как <a href="http://vis-www.cs.umass.edu/lfw/" rel="noopener noreferrer nofollow">LFW</a>. Далее будут изложены этапы, необходимые как для подготовки базы лиц, так и для самого хеширования и ускоренного поиска по базе дескрипторов.</p><p>1-й этап – фильтрация. Для каждой <em>i</em>-ой персоны в базе по всем дескрипторам, отвечающим различным <em>j</em> изображениям её лица, осуществляется <a href="https://arxiv.org/ftp/arxiv/papers/2007/2007.03021.pdf" rel="noopener noreferrer nofollow">поиск наиболее репрезентативного дескриптора</a> <strong>D</strong><em><sub>i</sub></em>. Именно найденный наиболее репрезентативный дескриптор для каждой персоны сопоставляется ей в качестве единственного векторного идентификатора. В итоге, количество дескрипторов в дескрипторной базе будет соответствовать количеству персон в базе изображений лиц, которая может содержать в разы больше изображений по отношению к количеству персон (на одну персону, естественно, может приходится более одного изображения её лица).</p><p>2-й этап – статистические оценки. Вычисляется ряд вспомогательных величин:</p><img class="formula" source="\begin{equation} \boldsymbol{\mathrm{MD}}=\left({\mathop{mdn}\limits_{i}} \{ D_{1,i} \} ,{\mathop{mdn}\limits_{i}} \{ D_{2,i} \} ,...,{\mathop{mdn}\limits_{i}} \{ D_{n,i} \} ,...,{\mathop{mdn}\limits_{i}} \{ D_{N,i} \} \right)^{T}, (1) \end{equation}" alt="\begin{equation} \boldsymbol{\mathrm{MD}}=\left({\mathop{mdn}\limits_{i}} \{ D_{1,i} \} ,{\mathop{mdn}\limits_{i}} \{ D_{2,i} \} ,...,{\mathop{mdn}\limits_{i}} \{ D_{n,i} \} ,...,{\mathop{mdn}\limits_{i}} \{ D_{N,i} \} \right)^{T}, (1) \end{equation}" src="https://habrastorage.org/getpro/habr/upload_files/65f/682/67d/65f68267d3d20a5cd6b141768b9e4370.svg" width="602" height="53"/><img class="formula" source="\begin{equation}  \overline{\boldsymbol{\mathrm{\Delta D}}}=\left(\overline{\Delta D_{1} },\overline{\Delta D_{2} },...,\overline{\Delta D_{n} },...,\overline{\Delta D_{N} }\right)^{T}, (2)  \end{equation}" alt="\begin{equation}  \overline{\boldsymbol{\mathrm{\Delta D}}}=\left(\overline{\Delta D_{1} },\overline{\Delta D_{2} },...,\overline{\Delta D_{n} },...,\overline{\Delta D_{N} }\right)^{T}, (2)  \end{equation}" src="https://habrastorage.org/getpro/habr/upload_files/bfb/9fc/16f/bfb9fc16fa351e244030af9d0a42497f.svg" width="398" height="42"/><img class="formula" source="\begin{equation}  \overline{\Delta D_{n} }=\frac{1}{I} \sum _{i=1}^{I}\left|D_{n,i} -MD_{n} \right|. (3) \end{equation}" alt="\begin{equation}  \overline{\Delta D_{n} }=\frac{1}{I} \sum _{i=1}^{I}\left|D_{n,i} -MD_{n} \right|. (3) \end{equation}" src="https://habrastorage.org/getpro/habr/upload_files/dad/a48/306/dada483069f3465192f81b4b1d79ed70.svg" width="271" height="60"/><p>В выражении (1) для определения моды гауссианы используется медианная оценка вместо средней для уменьшения влияния на неё статистических выбросов.</p><p>3-й этап – промежуточное хеширование. С учетом гауссовского распределения признаков по каждой из компонент множества векторов лицевых признаков для каждой компоненты каждого дескриптора осуществляется квантизация значений этих компонент с помощью функции erf таким образом, чтобы каждому целочисленному значению отвечало статистически одинаковое количество изображений лиц рассматриваемой базы. В частности, каждому дескриптору (хеш-ключу) <strong>D</strong><em><sub>i</sub></em> сопоставляется соответствующий вектор (промежуточный хеш-код) <strong>P</strong><em><sub>i</sub></em> (см. ниже равенства (4) и (5)).</p><p>Для определения оптимальной разрядности компонент промежуточного хеш-кода (количества разбиений/ячеек/бинов) <em>Q</em> (<em>q</em> = 0, …, <em>Q</em>) исходим из следующих соображений. Пусть у нас имеется пробный вектор и далее мы хотим, по крайней мере, локально для текущей компоненты абсолютно точно находить ближайшего соседа в рамках <a href="https://arxiv.org/ftp/arxiv/papers/2007/2007.03021.pdf" rel="noopener noreferrer nofollow">проективного приближения</a>. Для этого кроме перебора всех дескрипторов с такой же компонентой хеш-кода <em>q</em><sub>0</sub> необходимо сравнить и все дескриптора из соседних ячеек (<em>q</em><sub>0</sub> ± 1), чтобы исключить проблему приграничных областей. К примеру, при разбиении на 3 ячейки в 1 из 3 случаев придется перебрать все имеющиеся в наличии дескриптора и выигрыш при индексном поиске по хеш-кодам будет незначительный в сравнении с полным перебором. Чтобы получить заметный выигрыш в индексном поиске необходимо разбить область на множество ячеек. И чем на большее количество ячеек разбита область, тем меньшая доля дескрипторов попадает в ячейки <em>q</em><sub>0</sub> - 1, <em>q</em><sub>0</sub> и <em>q</em><sub>0</sub> + 1 по отношению ко всем дескрипторам в других ячейках. Что увеличивает среднестатистическую скорость индексного поиска по сравнению с полным перебором в (<em>Q</em> + 1)<sup>2</sup><em>/</em>(3<em>Q</em> + 1) раз на одну компоненту. При рассмотрении <em>R</em> репрезентативных компонент дескрипторов алгоритм поиска по хеш-кодам быстрее полного перебора в (<em>Q</em> + 1)<sup>2</sup><em><sup>R</sup>/</em>(3<em>Q</em> + 1)<em><sup>R</sup></em> раз. Однако, из-за использования проективного приближения уменьшение размера ячеек будет приводить к снижению глобальной точности поиска тем сильнее, чем большее количество компонент дескрипторов задействовано в хешировании (с ростом <em>R</em> резко возрастает вероятность нахождения дескриптора с максимальной косинусной похожестью на сличаемый дескриптор вне выборки для поиска). Таким образом, оптимальными разбиениями являются такие, для которых <em>Q</em> принимает значения от 4 до 7. Далее будет рассмотрено именно сбалансированное разбиение при <em>Q</em> =4 (исключая собственную ячейку число проверяемых ячеек в большинстве случаев равно числу непроверяемых), обеспечивающее максимальную глобальную точность алгоритма.</p><p>Итак, <em>P<sub>n</sub></em><sub>,</sub><em><sub>i</sub></em> для <em>D<sub>n</sub></em><sub>,</sub><em><sub>i</sub></em> задается через</p><img class="formula" source="\begin{equation}  \Theta _{n,i} =\frac{D_{n,i} -MD_{n} }{\overline{\Delta D_{n} }}, (4)  \end{equation}" alt="\begin{equation}  \Theta _{n,i} =\frac{D_{n,i} -MD_{n} }{\overline{\Delta D_{n} }}, (4)  \end{equation}" src="https://habrastorage.org/getpro/habr/upload_files/c60/263/096/c60263096c7cc4f96f6a86363139061c.svg" width="204" height="53"/><p>следующим образом:</p><img class="formula" source="\begin{equation}  \left\{\begin{array}{l} {P_{n,i} =0,\Theta _{n,i} \le -1.055;} \\ {P_{n,i} =1,\Theta _{n,i} \in (-1.055,\; -0.318);} \\ {P_{n,i} =2,\Theta _{n,i} \in [-\, 0.318,\; 0.318];} \\ {P_{n,i} =3,\Theta _{n,i} \in (0.318,\; 1.055);} \\ {P_{n,i} =4,\Theta _{n,i} \ge 1.055.} \end{array}\right. (5)   \end{equation}" alt="\begin{equation}  \left\{\begin{array}{l} {P_{n,i} =0,\Theta _{n,i} \le -1.055;} \\ {P_{n,i} =1,\Theta _{n,i} \in (-1.055,\; -0.318);} \\ {P_{n,i} =2,\Theta _{n,i} \in [-\, 0.318,\; 0.318];} \\ {P_{n,i} =3,\Theta _{n,i} \in (0.318,\; 1.055);} \\ {P_{n,i} =4,\Theta _{n,i} \ge 1.055.} \end{array}\right. (5)   \end{equation}" src="https://habrastorage.org/getpro/habr/upload_files/c2e/b62/77a/c2eb6277a8e960b6fc902a81914f643c.svg" width="335" height="138"/><p>Как упоминалось ранее, числовые значения отрезка и интервалов получаются инверсией функции erf так, чтобы в них попадало в среднем одинаковое количество дескрипторов по значениям их компонент. Для увеличения устойчивости к статистическим выбросам разбиение на интервалы делается не по среднеквадратическому отклонению значения компоненты дескриптора от моды нормального распределения текущей компоненты по всем дескрипторам, а по среднему отклонению компоненты дескриптора от этой моды (см. равенство (4)).</p><p>4-й этап – определение ключевых компонент дескрипторов и их иерархии. Далее для определения дескрипторных хеш-кодов, представляющих собой упорядоченную выборку компонент промежуточных хеш-кодов по ключевым дескрипторным компонентам, осуществляется попарное сравнение всего имеющегося множества изображений лиц по косинусной похожести <em>C<sub>s</sub></em> отвечающих им дескрипторов (соответствует скалярному произведению для дескрипторов, нормированных на единицу). Делается это следующим образом. Вначале выбирается некий уровень отсечения для косинусной похожести <em>C<sub>th</sub></em>, к примеру, равный 0.5. Затем по всей базе изображений лиц подсчитывается количество пар дескрипторов <strong>D</strong><em><sub>i</sub></em> и <strong>D</strong><em><sub>i'</sub></em>, для которых косинусное сходство равно или больше рассматриваемого уровня (<strong>D</strong><em><sub>i</sub></em><strong>D</strong><em><sub>i'</sub></em> ≥ <em>C<sub>th</sub></em>). Одновременно для каждой дескрипторной компоненты вычисляется доля <em>e<sub>n</sub></em> от выбранных пар дескрипторов, для которых ещё и значения промежуточных хеш-кодов отличаются не более чем на единицу (|<em>P<sub>n,i</sub></em> – <em>P<sub>n,i' </sub></em>| ≤ 1), то есть, принадлежат одной локальной хеш-окрестности. Далее по всем дескрипторным компонентам проверяется условие равенства единице (существует ли такое <em>n</em>, что <em>e<sub>n</sub></em> = 1?). Если условие не выполнилось ни для одной дескрипторной компоненты, то делается инкремент величины <em>C<sub>th</sub></em>, например на 0.05, и снова осуществляется проверка. И так до тех пор, пока не найдется одна дескрипторная компонента, для которой <em>e<sub>n</sub></em> = 1. Если же при следующем инкременте условие равенства единице выполняется сразу для нескольких <em>e<sub>n</sub></em>, то относительно предыдущего шага инкремент уменьшается, например вдвое, и по аналогии с <a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%B1%D0%B8%D1%81%D0%B5%D0%BA%D1%86%D0%B8%D0%B8" rel="noopener noreferrer nofollow">методом бисекции</a> находится такой уровень <em>C<sub>th</sub></em><sup>(1)</sup>, для которого единственная дескрипторная компонента равна единице, но не обязательно точно по условию скачка <em>e<sub>n</sub></em> в единицу. Если же за разумное количество итераций не удается разбить текущий интервал так, чтобы на интервале от <em>C<sub>th</sub></em><sup>(1)</sup> до <em>C<sub>th</sub></em><sup>(2)</sup> для единственной компоненты выполнялось условие <em>e<sub>n</sub></em> = 1, например, из-за недостаточности разнообразия изображений лиц в базе, приводящей к существенной дискретности ряда рассчитываемых параметров, скачек в единицу происходит в одной и той же точке <em>C<sub>th</sub></em> для двух компонент <em>e<sub>n</sub></em>, то полагается <em>C<sub>th</sub></em><sup>(2)</sup> = <em>C<sub>th</sub></em><sup>(3)</sup> =… с произвольной иерархией по соответствующим <em>n</em>. Далее с учетом всех предыдущих шагов по <em>C<sub>th</sub></em>, которые уже могли привести к выполнению условия равенства единице для нескольких <em>e<sub>n</sub></em>, находим все интересующие нас уровни <em>C<sub>th</sub></em><sup>(</sup><em><sup>r</sup></em><sup>)</sup> (<em>r</em> = 1, 2, …, <em>R</em>), отвечающие следующему утверждению: в базе изображений лиц все лица с косинусной похожестью их дескрипторов больше или равно <em>C<sub>th</sub></em><sup>(</sup><em><sup>r</sup></em><sup>)</sup> имеют <em>r</em> дескрипторных компонент, для которых соответствующие компоненты их хеш-кодов принадлежат одним и тем же локальным хеш-окрестностям, и – наоборот. Тогда соответствующее упорядоченное по <em>C<sub>th</sub></em><sup>(</sup><em><sup>r</sup></em><sup>)</sup> подмножество ключевых компонент промежуточных дескрипторных хеш-кодов и формирует для каждого дескриптора его хеш-код.</p><p>На примере базы лиц LFW было получено следующее упорядоченное множество по дескрипторным компонентам:</p><div><div class="table"><table><tbody><tr><td><p align="center"><em>r</em></p></td><td><p align="center"><em>n</em></p></td><td><p align="center"><em>C<sub>th</sub></em><sup>(</sup><em><sup>r</sup></em><sup>)</sup></p></td></tr><tr><td><p align="center">1</p></td><td><p align="center">423</p></td><td><p align="center">0.57</p></td></tr><tr><td><p align="center">2</p></td><td><p align="center">388</p></td><td><p align="center">0.58</p></td></tr><tr><td><p align="center">3</p></td><td><p align="center">213</p></td><td><p align="center">0.59</p></td></tr><tr><td><p align="center">4</p></td><td><p align="center">39</p></td><td><p align="center">0.60</p></td></tr><tr><td><p align="center">5</p></td><td><p align="center">256</p></td><td><p align="center">0.60</p></td></tr><tr><td><p align="center">6</p></td><td><p align="center">69</p></td><td><p align="center">0.61</p></td></tr><tr><td><p align="center">7</p></td><td><p align="center">374</p></td><td><p align="center">0.61</p></td></tr></tbody></table></div></div><p>5-й этап – получение дескрипторных хеш-кодов. Правила вычисления для всякого дескриптора <strong>D</strong> значений ряда параметров по формулам (4) и (5) наряду с использованием полученного в виде таблицы фильтра компонент и представляет собой не что иное, как определение хеш-функции, с помощью которой из дескриптора–хеш-ключа можно получать соответствующий ему семиразрядный пятиричный хеш-код <strong>H</strong> (в общем случае как числовая разрядность хеш-кода, так и его система счисления может быть иной).</p><p>6-й этап – каталогизация базы изображений лиц с соответствующими им дескрипторами по дескрипторным хеш-кодам. Для ускорения доступа в базе к объектам поиска по хеш-коду целесообразно эти объекты должным образом каталогизировать. В частности, для рассматриваемого примера базы (корневого каталога) дерево вложенных каталогов имеет вид, как показано на рисунке ниже.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Семиярусное дерево каталогов, содержащее на глубочайшем седьмом уровне файлы с изображениями лиц и соответствующие им файлы дескрипторов" title="Семиярусное дерево каталогов, содержащее на глубочайшем седьмом уровне файлы с изображениями лиц и соответствующие им файлы дескрипторов" height="810" data-src="https://habrastorage.org/getpro/habr/upload_files/00d/4b5/f46/00d4b5f46f5758b7f87efd4d7a992219.gif" data-width="1364"/><figcaption>Семиярусное дерево каталогов, содержащее на глубочайшем седьмом уровне файлы с изображениями лиц и соответствующие им файлы дескрипторов</figcaption></figure><p>В таком случае корневой каталог содержит 5<sup>7</sup> = 78125 вложенных каталогов седьмого глубочайшего уровня. Для репрезентативности каталогизированной базы изображений лиц необходимо, чтобы каждый такой вложенный каталог содержал достаточное количество файлов для разных персон. Статистически это условие более-менее обеспечивается, когда в базе содержатся изображения хотя бы для 10<sup>6</sup> человек. Однако, чтобы с высокой достоверностью исключить наличие пустых каталогов на самом глубоком уровне, объем базы должен содержать информацию о 10<sup>7</sup> или более различных персон. К величине аналогичного порядка можно прийти и с другой точки зрения. Современная вычислительная техника дает возможность решать рассматриваемую задачу простым полным перебором за приемлемое время даже на уровне персональных компьютеров при количестве 1–2-хкилобайтных дескрипторов в базе порядка 10<sup>5</sup>. Дополнительные возможности открываются с использованием многопроцессорных рабочих станций с установленными в них несколькими графическими ускорителями. С их помощью можно в рамках аналогичных временных интервалов обрабатывать полным перебором базы уже с объемами порядка 10<sup>6</sup> персон. Переход к базам с объемами порядка 10<sup>7</sup> персон потребует достаточно дорогостоящих решений на основе рабочих станций, объединенных в вычислительный кластер. В то же время, можно использовать предложенный метод хеширования для ускорения поиска в среднем в (25/13)<sup>7</sup> » 100 раз (<em>Q</em> = 4) и обрабатывать с приемлемыми временными затратами на поиск по хеш-коду базы объемами около 10<sup>7</sup> персон даже на персональных компьютерах. При этом базы такого объема обеспечивают отсутствие необходимости их переиндексации вследствие добавления в них новых элементов, имеющих в рамках предложенного подхода ничтожный статистический вес. Переиндексацию таких баз целесообразно проводить по счетчику новых элементов, когда их общее количество станет соизмеримым с количеством первичных элементов в базах.</p><h3>Результаты</h3><p>Рассмотрим теперь непосредственно сам алгоритм поиска наиболее схожего изображения лица из базы лиц на изображение лица сличаемой персоны по косинусной похожести отвечающих этим изображениям дескрипторов. Итак, пусть имеется подготовленная согласно описанному выше алгоритму база изображений лиц и соответствующих им дескрипторов, обладающая достаточной статистической репрезентативностью (>> 10<sup>5</sup> персон). Предположим, что сформирован запрос на поиск для некого изображения лица по отвечающему ему дескриптору. И пусть, для определенности, это будет дескриптор, для которого с помощью вышеописанной процедуры (хеш-функции) для него получается следующий хеш-код: 0442103. Далее для всех дескрипторных <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D1%8F_%D1%85%D0%B5%D1%88-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8" rel="noopener noreferrer nofollow">коллизий хеш-кода</a> по локальным окрестностям его компонент, в частности, при</p><div><div class="table"><table><tbody><tr><td><p align="center"><em>r</em></p></td><td><p align="center">1</p></td><td><p align="center">2</p></td><td><p align="center">3</p></td><td><p align="center">4</p></td><td><p align="center">5</p></td><td><p align="center">6</p></td><td><p align="center">7</p></td></tr><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">0..2</p></td><td><p align="center">0..1</p></td><td><p align="center">2..4</p></td></tr></tbody></table></div></div><p>осуществляется полный перебор отфильтрованных дескрипторов из базы (приблизительно 0.006 от их общего количества) по максимуму косинусной похожести дескрипторов. Если результатом поиска является дескриптор с косинусной похожестью не менее <em>C<sub>th</sub></em><sup>(7)</sup> (в общем случае может быть запрос на поиск нескольких наиболее похожих дескрипторов), то поиск считается удачным и заканчивается. Иначе поиск продолжается с расширением локальных хеш-окрестностей слева и справа вплоть до полного перебора на текущем уровне <em>r</em> с последующим переходом к следующему уровню <em>r</em> (от больших значений <em>r</em> к меньшим) пока либо найденное текущее максимальное значение косинусной похожести не сравняется или превысит <em>C<sub>th</sub></em><sup>(</sup><em><sup>r</sup></em><sup>)</sup>, либо не будет осуществлен полный перебор всех дескрипторов в базе. Например, пусть для рассмотренных коллизий максимальная косинусная похожесть <em>C<sub>max</sub></em> составляет 0.52. Тогда поиск необходимо дополнительно проводить и по коллизиям</p><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">0..2</p></td><td><p align="center">0..1</p></td><td><p align="center">1</p></td></tr></tbody></table></div></div><p>и, пусть, с тем же результатом <em>C<sub>max</sub></em> = 0.52. И так несколько раз подряд, то есть, по соответствующим нижеперечисленным коллизиям.</p><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">0..2</p></td><td><p align="center">0..1</p></td><td><p align="center">0</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">0..2</p></td><td><p align="center">2</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">0..2</p></td><td><p align="center">3</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">0..2</p></td><td><p align="center">4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">3</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">1..3</p></td><td><p align="center">4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td data-colwidth="83" width="83"><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">3..4</p></td><td><p align="center">0, 4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><p>А по коллизиям</p><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">2</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td><td data-colwidth="84" width="84"><p align="center">0..4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td><p align="center">1</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><div><div class="table"><table><tbody><tr><td><p align="center"><em>H<sub>r</sub></em></p></td><td><p align="center">0..1</p></td><td><p align="center">3..4</p></td><td data-colwidth="84" width="84"><p align="center">0</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td><td><p align="center">0..4</p></td></tr></tbody></table></div></div><p>пусть был найден дескриптор, для которого <em>C<sub>max</sub></em> = 0.586 > <em>C<sub>th</sub></em><sup>(2)</sup>. Полученный результат фиксируется, а поиск останавливается.</p><p>Теперь возникает резонный вопрос, а насколько часто реализуются случаи, когда при первичном поиске <em>C<sub>max</sub></em> &lt; <em>C<sub>th</sub></em><sup>(7)</sup>. Ведь в таком случае скорость поиска может снижаться в разы вплоть до полного перебора. И если такие случаи будут частыми, то существенного выигрыша от индексного поиска по хеш-коду не будет. Однако, из практики использования нейросетевых технологий вроде ArcFace наблюдения следующие. Для конкретной полученной нами реализации нейросети в достаточно редких случаях дескриптора, соответствующие весьма качественным изображениям неких персон, могут иметь косинусную похожесть на наиболее репрезентативные дескриптора этих персон менее 0.57. В то же время, в каких-то крайне редких случаях дескриптора, отвечающие изображениям лиц каких-то персон, имеют косинусную похожесть на наиболее репрезентативные дескриптора каких-то других персон более 0.61. Все эти наблюдения позволяют, в том числе, сформулировать следующую гипотезу:</p><p>– если в результате первичного поиска <em>C<sub>max</sub></em> &lt; <em>C<sub>th</sub></em><sup>(7)</sup>, то с высокой вероятностью в базе отсутствуют изображения лица сличаемой персоны.</p><p>Сам же эффект перекрытия дескрипторных кластеров для разных персон не обладает такой статистической значимостью, чтобы привести к практически полной редукции ускорения поиска по хеш-коду.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B1%D1%8B%D1%81%D1%82%D1%80%D1%8B%D0%B9%20%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%5D" class="tm-tags-list__link">быстрый поиск</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%85%D0%B5%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%5D" class="tm-tags-list__link">хеширование</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BD%D0%B5%D0%B9%D1%80%D0%BE%D1%81%D0%B5%D1%82%D0%B8%5D" class="tm-tags-list__link">нейросети</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B3%D0%BB%D1%83%D0%B1%D0%BE%D0%BA%D0%BE%D0%B5%20%D0%BE%D0%B1%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%5D" class="tm-tags-list__link">глубокое обучение</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/search_technologies/" class="tm-hubs-list__link">
    Поисковые технологии
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/algorithms/" class="tm-hubs-list__link">
    Алгоритмы
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/maths/" class="tm-hubs-list__link">
    Математика
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/machine_learning/" class="tm-hubs-list__link">
    Машинное обучение
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 5: ↑5 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 5: ↑5 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+5</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    27
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Dmitry_Po/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/233/d39/e46/233d39e464b9067fc2b98f7d8bc597c0.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 10 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    10
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">2</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Дмитрий Поздняков</span> <a href="/ru/users/Dmitry_Po/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Dmitry_Po
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">машинное зрение, глубокое обучение</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/582708/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 4 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/582708/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/582708/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"582708":{"id":"582708","timePublished":"2021-10-11T09:00:21+00:00","isCorporative":false,"lang":"ru","titleHtml":"Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов","leadData":{"textHtml":"\u003Cp\u003EПри решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух наиболее близких по косинусному расстоянию лицевых дескрипторов. Разработанный алгоритм обладает той же точностью, что и метод простого перебора и, в то же время, он приблизительно в сто раз быстрее. С более подробным описанием алгоритма можно познакомиться в англоязычном оригинале настоящей статьи.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F00d\u002F4b5\u002Ff46\u002F00d4b5f46f5758b7f87efd4d7a992219.gif","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F00d\u002F4b5\u002Ff46\u002F00d4b5f46f5758b7f87efd4d7a992219.gif","fit":"cover","positionY":15.681818181818,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Dmitry Pozdnyakov","originalUrl":"http:\u002F\u002Fwww.sciencepublishinggroup.com\u002Fjournal\u002Fpaperinfo?journalid=303&doi=10.11648\u002Fj.ajcst.20210402.12"}},{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":10,"votesCount":10},"rating":2,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2755129","alias":"Dmitry_Po","fullname":"Дмитрий Поздняков","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F233\u002Fd39\u002Fe46\u002F233d39e464b9067fc2b98f7d8bc597c0.jpg","speciality":"машинное зрение, глубокое обучение"},"statistics":{"commentsCount":4,"favoritesCount":27,"readingCount":1646,"score":5,"votesCount":5},"hubs":[{"relatedData":null,"id":"126","alias":"search_technologies","type":"collective","title":"Поисковые технологии","titleHtml":"Поисковые технологии","isProfiled":true},{"relatedData":null,"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"relatedData":null,"id":"17812","alias":"maths","type":"collective","title":"Математика","titleHtml":"Математика","isProfiled":true},{"relatedData":null,"id":"19439","alias":"machine_learning","type":"collective","title":"Машинное обучение","titleHtml":"Машинное обучение","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПри решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух наиболее близких по косинусному расстоянию лицевых дескрипторов. Разработанный алгоритм обладает той же точностью, что и метод простого перебора и, в то же время, он приблизительно в сто раз быстрее. С более подробным описанием алгоритма можно познакомиться в англоязычном оригинале настоящей статьи.\u003C\u002Fp\u003E\u003Ch3\u003EВведение\u003C\u002Fh3\u003E\u003Cp\u003EВ последние годы автоматизированные методы сличения изображений лиц при установлении наличия в базе запрашиваемой персоны стали особенно популярными. И когда в базе лиц очень большое количество изображений, то затрачиваемое время на поиск наиболее похожего изображения лица на фото сличаемой персоны становиться крайне критичным. Проблема быстрой обработки данных базы лиц даже трансформировалась в отдельную область научных исследований. В настоящее время наиболее популярным методом кодирования отличительных черт лица является нейросетевая экстракция соответствующего ему дескриптора — вектора из многомерного пространства характерных лицевых признаков. Такой подход позволяет свести сличение изображений лиц к формальному сравнению дескрипторов с использованием той или иной метрики. В частности, в качестве первого приближения может применяться и обычное Эвклидово расстояние или наоборот, могут использоваться какие-либо экзотические метрики, хотя наиболее употребимой мерой похожести является косинусное расстояние. В любом случае, независимо от способа задания метрики, задача нахождения наиболее похожего изображения лица из заданного множества лиц на изображение лица сличаемой персоны сводится к поиску ближайшей соседней точки в соответствующем метрическом смысле к заданной точке многомерного пространства лицевых признаков. И такая задача может быть абсолютно точно решена методом полного перебора дескрипторов (поиск дескриптора, отвечающего, например, максимальному значению косинусной похожести). При количестве изображений лиц в базе равном \u003Cem\u003EM\u003C\u002Fem\u003E вычислительная сложность алгоритма поиска, очевидно, пропорциональна \u003Cem\u003EM\u003C\u002Fem\u003E. И если \u003Cem\u003EM\u003C\u002Fem\u003E весьма велико, то на полный перебор может уходить слишком много времени, что, порой, неприемлемо. Более того, из-за аппаратных ограничений начиная с некоторых значений \u003Cem\u003EM\u003C\u002Fem\u003E распараллеливание алгоритма поиска и перенос его на GPU перестает быть эффективным методом ускорения этого алгоритма. Естественным способом решения данной проблемы является специальная организация данных в базе (\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0_%D0%92%D0%BE%D1%80%D0%BE%D0%BD%D0%BE%D0%B3%D0%BE\" rel=\"noopener noreferrer nofollow\"\u003Eдиаграмма Вороного\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FK-d-%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE\" rel=\"noopener noreferrer nofollow\"\u003EK-d-дерево\u003C\u002Fa\u003E и др.) плюс \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9F%D0%BE%D0%B8%D1%81%D0%BA%D0%BE%D0%B2%D1%8B%D0%B9_%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81\" rel=\"noopener noreferrer nofollow\"\u003Eиндексирование\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FGeometric_hashing\" rel=\"noopener noreferrer nofollow\"\u003Eхеширование\u003C\u002Fa\u003E и пр., позволяющие кардинально ускорить поиск. Конкретных реализаций указанных подходов существует огромное множество. Однако, все они позволяют находить \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FNearest_neighbor_search\" rel=\"noopener noreferrer nofollow\"\u003Eближайшего соседа\u003C\u002Fa\u003E либо приблизительно, либо с выделением больших объемов памяти на индексную информацию и большими вычислительными затратами на переиндексацию базы данных.\u003C\u002Fp\u003E\u003Cp\u003EС учетом вышесказанного возникает естественный вопрос: а вообще возможно ли путем не слишком сложных вычислений без необходимости выделения больших объемов памяти проиндексировать элементы базы так, чтобы впоследствии с помощью некоего специального алгоритма поиска можно было бы абсолютно точно находить ближайшего соседа со среднестатистическим временем поиска, по крайней мере, в разы меньшим, чем время, необходимое на полный перебор элементов в базе. Именно на этот вопрос и отвечает настоящая публикация на примере решения задачи быстрого дескрипторного поиска наиболее похожего изображения лица из базы на изображение лица сличаемой персоны.\u003C\u002Fp\u003E\u003Ch3\u003EТеория\u003C\u002Fh3\u003E\u003Cp\u003EВ качестве методологической основы для индексации состоящей из дескрипторов базы изображений лиц используем ряд модификаций такого известного классического алгоритма, как метод геометрического хеширования. Итак, пусть дескриптора \u003Cstrong\u003Ed\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Eij\u003C\u002Fsub\u003E\u003C\u002Fem\u003E — это элементы векторного пространства лицевых признаков единичной длины с размерностью \u003Cem\u003EN\u003C\u002Fem\u003E = 512 (но может быть больше или меньше), извлекаемые из изображений лиц какой-либо нейронной сетью, например, типа \u003Ca href=\"https:\u002F\u002Farxiv.org\u002Fpdf\u002F1801.07698.pdf\" rel=\"noopener noreferrer nofollow\"\u003EArcFace\u003C\u002Fa\u003E с бэкбоном типа \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FResidual_neural_network\" rel=\"noopener noreferrer nofollow\"\u003EResNet\u003C\u002Fa\u003E, которая была обучена, например, с использованием \u003Ca href=\"http:\u002F\u002Fshuoyang1213.me\u002FWIDERFACE\u002F\" rel=\"noopener noreferrer nofollow\"\u003EWiderFace\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EГеометрическое хеширование не позволяет с абсолютной точностью определять ближайшего соседа для пробных векторов, попадающих в окрестности границ, разделяющих заданную область пространства на соответствующие кластера многомерных векторов. Поэтому для классического алгоритма геометрического хеширования необходимо осуществить ряд модификаций. При этом далее для конкретизации всех примеров будет рассматриваться такая хорошо известная база изображений лиц, как \u003Ca href=\"http:\u002F\u002Fvis-www.cs.umass.edu\u002Flfw\u002F\" rel=\"noopener noreferrer nofollow\"\u003ELFW\u003C\u002Fa\u003E. Далее будут изложены этапы, необходимые как для подготовки базы лиц, так и для самого хеширования и ускоренного поиска по базе дескрипторов.\u003C\u002Fp\u003E\u003Cp\u003E1-й этап – фильтрация. Для каждой \u003Cem\u003Ei\u003C\u002Fem\u003E-ой персоны в базе по всем дескрипторам, отвечающим различным \u003Cem\u003Ej\u003C\u002Fem\u003E изображениям её лица, осуществляется \u003Ca href=\"https:\u002F\u002Farxiv.org\u002Fftp\u002Farxiv\u002Fpapers\u002F2007\u002F2007.03021.pdf\" rel=\"noopener noreferrer nofollow\"\u003Eпоиск наиболее репрезентативного дескриптора\u003C\u002Fa\u003E \u003Cstrong\u003ED\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E. Именно найденный наиболее репрезентативный дескриптор для каждой персоны сопоставляется ей в качестве единственного векторного идентификатора. В итоге, количество дескрипторов в дескрипторной базе будет соответствовать количеству персон в базе изображений лиц, которая может содержать в разы больше изображений по отношению к количеству персон (на одну персону, естественно, может приходится более одного изображения её лица).\u003C\u002Fp\u003E\u003Cp\u003E2-й этап – статистические оценки. Вычисляется ряд вспомогательных величин:\u003C\u002Fp\u003E\u003Cimg class=\"formula\" source=\"\\begin{equation} \\boldsymbol{\\mathrm{MD}}=\\left({\\mathop{mdn}\\limits_{i}} \\{ D_{1,i} \\} ,{\\mathop{mdn}\\limits_{i}} \\{ D_{2,i} \\} ,...,{\\mathop{mdn}\\limits_{i}} \\{ D_{n,i} \\} ,...,{\\mathop{mdn}\\limits_{i}} \\{ D_{N,i} \\} \\right)^{T}, (1) \\end{equation}\" alt=\"\\begin{equation} \\boldsymbol{\\mathrm{MD}}=\\left({\\mathop{mdn}\\limits_{i}} \\{ D_{1,i} \\} ,{\\mathop{mdn}\\limits_{i}} \\{ D_{2,i} \\} ,...,{\\mathop{mdn}\\limits_{i}} \\{ D_{n,i} \\} ,...,{\\mathop{mdn}\\limits_{i}} \\{ D_{N,i} \\} \\right)^{T}, (1) \\end{equation}\" src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F65f\u002F682\u002F67d\u002F65f68267d3d20a5cd6b141768b9e4370.svg\" width=\"602\" height=\"53\"\u002F\u003E\u003Cimg class=\"formula\" source=\"\\begin{equation}  \\overline{\\boldsymbol{\\mathrm{\\Delta D}}}=\\left(\\overline{\\Delta D_{1} },\\overline{\\Delta D_{2} },...,\\overline{\\Delta D_{n} },...,\\overline{\\Delta D_{N} }\\right)^{T}, (2)  \\end{equation}\" alt=\"\\begin{equation}  \\overline{\\boldsymbol{\\mathrm{\\Delta D}}}=\\left(\\overline{\\Delta D_{1} },\\overline{\\Delta D_{2} },...,\\overline{\\Delta D_{n} },...,\\overline{\\Delta D_{N} }\\right)^{T}, (2)  \\end{equation}\" src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbfb\u002F9fc\u002F16f\u002Fbfb9fc16fa351e244030af9d0a42497f.svg\" width=\"398\" height=\"42\"\u002F\u003E\u003Cimg class=\"formula\" source=\"\\begin{equation}  \\overline{\\Delta D_{n} }=\\frac{1}{I} \\sum _{i=1}^{I}\\left|D_{n,i} -MD_{n} \\right|. (3) \\end{equation}\" alt=\"\\begin{equation}  \\overline{\\Delta D_{n} }=\\frac{1}{I} \\sum _{i=1}^{I}\\left|D_{n,i} -MD_{n} \\right|. (3) \\end{equation}\" src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdad\u002Fa48\u002F306\u002Fdada483069f3465192f81b4b1d79ed70.svg\" width=\"271\" height=\"60\"\u002F\u003E\u003Cp\u003EВ выражении (1) для определения моды гауссианы используется медианная оценка вместо средней для уменьшения влияния на неё статистических выбросов.\u003C\u002Fp\u003E\u003Cp\u003E3-й этап – промежуточное хеширование. С учетом гауссовского распределения признаков по каждой из компонент множества векторов лицевых признаков для каждой компоненты каждого дескриптора осуществляется квантизация значений этих компонент с помощью функции erf таким образом, чтобы каждому целочисленному значению отвечало статистически одинаковое количество изображений лиц рассматриваемой базы. В частности, каждому дескриптору (хеш-ключу) \u003Cstrong\u003ED\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E сопоставляется соответствующий вектор (промежуточный хеш-код) \u003Cstrong\u003EP\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E (см. ниже равенства (4) и (5)).\u003C\u002Fp\u003E\u003Cp\u003EДля определения оптимальной разрядности компонент промежуточного хеш-кода (количества разбиений\u002Fячеек\u002Fбинов) \u003Cem\u003EQ\u003C\u002Fem\u003E (\u003Cem\u003Eq\u003C\u002Fem\u003E = 0, …, \u003Cem\u003EQ\u003C\u002Fem\u003E) исходим из следующих соображений. Пусть у нас имеется пробный вектор и далее мы хотим, по крайней мере, локально для текущей компоненты абсолютно точно находить ближайшего соседа в рамках \u003Ca href=\"https:\u002F\u002Farxiv.org\u002Fftp\u002Farxiv\u002Fpapers\u002F2007\u002F2007.03021.pdf\" rel=\"noopener noreferrer nofollow\"\u003Eпроективного приближения\u003C\u002Fa\u003E. Для этого кроме перебора всех дескрипторов с такой же компонентой хеш-кода \u003Cem\u003Eq\u003C\u002Fem\u003E\u003Csub\u003E0\u003C\u002Fsub\u003E необходимо сравнить и все дескриптора из соседних ячеек (\u003Cem\u003Eq\u003C\u002Fem\u003E\u003Csub\u003E0\u003C\u002Fsub\u003E ± 1), чтобы исключить проблему приграничных областей. К примеру, при разбиении на 3 ячейки в 1 из 3 случаев придется перебрать все имеющиеся в наличии дескриптора и выигрыш при индексном поиске по хеш-кодам будет незначительный в сравнении с полным перебором. Чтобы получить заметный выигрыш в индексном поиске необходимо разбить область на множество ячеек. И чем на большее количество ячеек разбита область, тем меньшая доля дескрипторов попадает в ячейки \u003Cem\u003Eq\u003C\u002Fem\u003E\u003Csub\u003E0\u003C\u002Fsub\u003E - 1, \u003Cem\u003Eq\u003C\u002Fem\u003E\u003Csub\u003E0\u003C\u002Fsub\u003E и \u003Cem\u003Eq\u003C\u002Fem\u003E\u003Csub\u003E0\u003C\u002Fsub\u003E + 1 по отношению ко всем дескрипторам в других ячейках. Что увеличивает среднестатистическую скорость индексного поиска по сравнению с полным перебором в (\u003Cem\u003EQ\u003C\u002Fem\u003E + 1)\u003Csup\u003E2\u003C\u002Fsup\u003E\u003Cem\u003E\u002F\u003C\u002Fem\u003E(3\u003Cem\u003EQ\u003C\u002Fem\u003E + 1) раз на одну компоненту. При рассмотрении \u003Cem\u003ER\u003C\u002Fem\u003E репрезентативных компонент дескрипторов алгоритм поиска по хеш-кодам быстрее полного перебора в (\u003Cem\u003EQ\u003C\u002Fem\u003E + 1)\u003Csup\u003E2\u003C\u002Fsup\u003E\u003Cem\u003E\u003Csup\u003ER\u003C\u002Fsup\u003E\u002F\u003C\u002Fem\u003E(3\u003Cem\u003EQ\u003C\u002Fem\u003E + 1)\u003Cem\u003E\u003Csup\u003ER\u003C\u002Fsup\u003E\u003C\u002Fem\u003E раз. Однако, из-за использования проективного приближения уменьшение размера ячеек будет приводить к снижению глобальной точности поиска тем сильнее, чем большее количество компонент дескрипторов задействовано в хешировании (с ростом \u003Cem\u003ER\u003C\u002Fem\u003E резко возрастает вероятность нахождения дескриптора с максимальной косинусной похожестью на сличаемый дескриптор вне выборки для поиска). Таким образом, оптимальными разбиениями являются такие, для которых \u003Cem\u003EQ\u003C\u002Fem\u003E принимает значения от 4 до 7. Далее будет рассмотрено именно сбалансированное разбиение при \u003Cem\u003EQ\u003C\u002Fem\u003E =4 (исключая собственную ячейку число проверяемых ячеек в большинстве случаев равно числу непроверяемых), обеспечивающее максимальную глобальную точность алгоритма.\u003C\u002Fp\u003E\u003Cp\u003EИтак, \u003Cem\u003EP\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csub\u003E,\u003C\u002Fsub\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E для \u003Cem\u003ED\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csub\u003E,\u003C\u002Fsub\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E задается через\u003C\u002Fp\u003E\u003Cimg class=\"formula\" source=\"\\begin{equation}  \\Theta _{n,i} =\\frac{D_{n,i} -MD_{n} }{\\overline{\\Delta D_{n} }}, (4)  \\end{equation}\" alt=\"\\begin{equation}  \\Theta _{n,i} =\\frac{D_{n,i} -MD_{n} }{\\overline{\\Delta D_{n} }}, (4)  \\end{equation}\" src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc60\u002F263\u002F096\u002Fc60263096c7cc4f96f6a86363139061c.svg\" width=\"204\" height=\"53\"\u002F\u003E\u003Cp\u003Eследующим образом:\u003C\u002Fp\u003E\u003Cimg class=\"formula\" source=\"\\begin{equation}  \\left\\{\\begin{array}{l} {P_{n,i} =0,\\Theta _{n,i} \\le -1.055;} \\\\ {P_{n,i} =1,\\Theta _{n,i} \\in (-1.055,\\; -0.318);} \\\\ {P_{n,i} =2,\\Theta _{n,i} \\in [-\\, 0.318,\\; 0.318];} \\\\ {P_{n,i} =3,\\Theta _{n,i} \\in (0.318,\\; 1.055);} \\\\ {P_{n,i} =4,\\Theta _{n,i} \\ge 1.055.} \\end{array}\\right. (5)   \\end{equation}\" alt=\"\\begin{equation}  \\left\\{\\begin{array}{l} {P_{n,i} =0,\\Theta _{n,i} \\le -1.055;} \\\\ {P_{n,i} =1,\\Theta _{n,i} \\in (-1.055,\\; -0.318);} \\\\ {P_{n,i} =2,\\Theta _{n,i} \\in [-\\, 0.318,\\; 0.318];} \\\\ {P_{n,i} =3,\\Theta _{n,i} \\in (0.318,\\; 1.055);} \\\\ {P_{n,i} =4,\\Theta _{n,i} \\ge 1.055.} \\end{array}\\right. (5)   \\end{equation}\" src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc2e\u002Fb62\u002F77a\u002Fc2eb6277a8e960b6fc902a81914f643c.svg\" width=\"335\" height=\"138\"\u002F\u003E\u003Cp\u003EКак упоминалось ранее, числовые значения отрезка и интервалов получаются инверсией функции erf так, чтобы в них попадало в среднем одинаковое количество дескрипторов по значениям их компонент. Для увеличения устойчивости к статистическим выбросам разбиение на интервалы делается не по среднеквадратическому отклонению значения компоненты дескриптора от моды нормального распределения текущей компоненты по всем дескрипторам, а по среднему отклонению компоненты дескриптора от этой моды (см. равенство (4)).\u003C\u002Fp\u003E\u003Cp\u003E4-й этап – определение ключевых компонент дескрипторов и их иерархии. Далее для определения дескрипторных хеш-кодов, представляющих собой упорядоченную выборку компонент промежуточных хеш-кодов по ключевым дескрипторным компонентам, осуществляется попарное сравнение всего имеющегося множества изображений лиц по косинусной похожести \u003Cem\u003EC\u003Csub\u003Es\u003C\u002Fsub\u003E\u003C\u002Fem\u003E отвечающих им дескрипторов (соответствует скалярному произведению для дескрипторов, нормированных на единицу). Делается это следующим образом. Вначале выбирается некий уровень отсечения для косинусной похожести \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, к примеру, равный 0.5. Затем по всей базе изображений лиц подсчитывается количество пар дескрипторов \u003Cstrong\u003ED\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E и \u003Cstrong\u003ED\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei'\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, для которых косинусное сходство равно или больше рассматриваемого уровня (\u003Cstrong\u003ED\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Cstrong\u003ED\u003C\u002Fstrong\u003E\u003Cem\u003E\u003Csub\u003Ei'\u003C\u002Fsub\u003E\u003C\u002Fem\u003E ≥ \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E). Одновременно для каждой дескрипторной компоненты вычисляется доля \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E от выбранных пар дескрипторов, для которых ещё и значения промежуточных хеш-кодов отличаются не более чем на единицу (|\u003Cem\u003EP\u003Csub\u003En,i\u003C\u002Fsub\u003E\u003C\u002Fem\u003E – \u003Cem\u003EP\u003Csub\u003En,i' \u003C\u002Fsub\u003E\u003C\u002Fem\u003E| ≤ 1), то есть, принадлежат одной локальной хеш-окрестности. Далее по всем дескрипторным компонентам проверяется условие равенства единице (существует ли такое \u003Cem\u003En\u003C\u002Fem\u003E, что \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E = 1?). Если условие не выполнилось ни для одной дескрипторной компоненты, то делается инкремент величины \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, например на 0.05, и снова осуществляется проверка. И так до тех пор, пока не найдется одна дескрипторная компонента, для которой \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E = 1. Если же при следующем инкременте условие равенства единице выполняется сразу для нескольких \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, то относительно предыдущего шага инкремент уменьшается, например вдвое, и по аналогии с \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%B1%D0%B8%D1%81%D0%B5%D0%BA%D1%86%D0%B8%D0%B8\" rel=\"noopener noreferrer nofollow\"\u003Eметодом бисекции\u003C\u002Fa\u003E находится такой уровень \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(1)\u003C\u002Fsup\u003E, для которого единственная дескрипторная компонента равна единице, но не обязательно точно по условию скачка \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E в единицу. Если же за разумное количество итераций не удается разбить текущий интервал так, чтобы на интервале от \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(1)\u003C\u002Fsup\u003E до \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(2)\u003C\u002Fsup\u003E для единственной компоненты выполнялось условие \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E = 1, например, из-за недостаточности разнообразия изображений лиц в базе, приводящей к существенной дискретности ряда рассчитываемых параметров, скачек в единицу происходит в одной и той же точке \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E для двух компонент \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, то полагается \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(2)\u003C\u002Fsup\u003E = \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(3)\u003C\u002Fsup\u003E =… с произвольной иерархией по соответствующим \u003Cem\u003En\u003C\u002Fem\u003E. Далее с учетом всех предыдущих шагов по \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, которые уже могли привести к выполнению условия равенства единице для нескольких \u003Cem\u003Ee\u003Csub\u003En\u003C\u002Fsub\u003E\u003C\u002Fem\u003E, находим все интересующие нас уровни \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(\u003C\u002Fsup\u003E\u003Cem\u003E\u003Csup\u003Er\u003C\u002Fsup\u003E\u003C\u002Fem\u003E\u003Csup\u003E)\u003C\u002Fsup\u003E (\u003Cem\u003Er\u003C\u002Fem\u003E = 1, 2, …, \u003Cem\u003ER\u003C\u002Fem\u003E), отвечающие следующему утверждению: в базе изображений лиц все лица с косинусной похожестью их дескрипторов больше или равно \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(\u003C\u002Fsup\u003E\u003Cem\u003E\u003Csup\u003Er\u003C\u002Fsup\u003E\u003C\u002Fem\u003E\u003Csup\u003E)\u003C\u002Fsup\u003E имеют \u003Cem\u003Er\u003C\u002Fem\u003E дескрипторных компонент, для которых соответствующие компоненты их хеш-кодов принадлежат одним и тем же локальным хеш-окрестностям, и – наоборот. Тогда соответствующее упорядоченное по \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(\u003C\u002Fsup\u003E\u003Cem\u003E\u003Csup\u003Er\u003C\u002Fsup\u003E\u003C\u002Fem\u003E\u003Csup\u003E)\u003C\u002Fsup\u003E подмножество ключевых компонент промежуточных дескрипторных хеш-кодов и формирует для каждого дескриптора его хеш-код.\u003C\u002Fp\u003E\u003Cp\u003EНа примере базы лиц LFW было получено следующее упорядоченное множество по дескрипторным компонентам:\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003Er\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003En\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(\u003C\u002Fsup\u003E\u003Cem\u003E\u003Csup\u003Er\u003C\u002Fsup\u003E\u003C\u002Fem\u003E\u003Csup\u003E)\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E423\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.57\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E388\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.58\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E213\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.59\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E39\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.60\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E5\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E256\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.60\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E6\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E69\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.61\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E7\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E374\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0.61\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E5-й этап – получение дескрипторных хеш-кодов. Правила вычисления для всякого дескриптора \u003Cstrong\u003ED\u003C\u002Fstrong\u003E значений ряда параметров по формулам (4) и (5) наряду с использованием полученного в виде таблицы фильтра компонент и представляет собой не что иное, как определение хеш-функции, с помощью которой из дескриптора–хеш-ключа можно получать соответствующий ему семиразрядный пятиричный хеш-код \u003Cstrong\u003EH\u003C\u002Fstrong\u003E (в общем случае как числовая разрядность хеш-кода, так и его система счисления может быть иной).\u003C\u002Fp\u003E\u003Cp\u003E6-й этап – каталогизация базы изображений лиц с соответствующими им дескрипторами по дескрипторным хеш-кодам. Для ускорения доступа в базе к объектам поиска по хеш-коду целесообразно эти объекты должным образом каталогизировать. В частности, для рассматриваемого примера базы (корневого каталога) дерево вложенных каталогов имеет вид, как показано на рисунке ниже.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Семиярусное дерево каталогов, содержащее на глубочайшем седьмом уровне файлы с изображениями лиц и соответствующие им файлы дескрипторов\" title=\"Семиярусное дерево каталогов, содержащее на глубочайшем седьмом уровне файлы с изображениями лиц и соответствующие им файлы дескрипторов\" height=\"810\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F00d\u002F4b5\u002Ff46\u002F00d4b5f46f5758b7f87efd4d7a992219.gif\" data-width=\"1364\"\u002F\u003E\u003Cfigcaption\u003EСемиярусное дерево каталогов, содержащее на глубочайшем седьмом уровне файлы с изображениями лиц и соответствующие им файлы дескрипторов\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ таком случае корневой каталог содержит 5\u003Csup\u003E7\u003C\u002Fsup\u003E = 78125 вложенных каталогов седьмого глубочайшего уровня. Для репрезентативности каталогизированной базы изображений лиц необходимо, чтобы каждый такой вложенный каталог содержал достаточное количество файлов для разных персон. Статистически это условие более-менее обеспечивается, когда в базе содержатся изображения хотя бы для 10\u003Csup\u003E6\u003C\u002Fsup\u003E человек. Однако, чтобы с высокой достоверностью исключить наличие пустых каталогов на самом глубоком уровне, объем базы должен содержать информацию о 10\u003Csup\u003E7\u003C\u002Fsup\u003E или более различных персон. К величине аналогичного порядка можно прийти и с другой точки зрения. Современная вычислительная техника дает возможность решать рассматриваемую задачу простым полным перебором за приемлемое время даже на уровне персональных компьютеров при количестве 1–2-хкилобайтных дескрипторов в базе порядка 10\u003Csup\u003E5\u003C\u002Fsup\u003E. Дополнительные возможности открываются с использованием многопроцессорных рабочих станций с установленными в них несколькими графическими ускорителями. С их помощью можно в рамках аналогичных временных интервалов обрабатывать полным перебором базы уже с объемами порядка 10\u003Csup\u003E6\u003C\u002Fsup\u003E персон. Переход к базам с объемами порядка 10\u003Csup\u003E7\u003C\u002Fsup\u003E персон потребует достаточно дорогостоящих решений на основе рабочих станций, объединенных в вычислительный кластер. В то же время, можно использовать предложенный метод хеширования для ускорения поиска в среднем в (25\u002F13)\u003Csup\u003E7\u003C\u002Fsup\u003E » 100 раз (\u003Cem\u003EQ\u003C\u002Fem\u003E = 4) и обрабатывать с приемлемыми временными затратами на поиск по хеш-коду базы объемами около 10\u003Csup\u003E7\u003C\u002Fsup\u003E персон даже на персональных компьютерах. При этом базы такого объема обеспечивают отсутствие необходимости их переиндексации вследствие добавления в них новых элементов, имеющих в рамках предложенного подхода ничтожный статистический вес. Переиндексацию таких баз целесообразно проводить по счетчику новых элементов, когда их общее количество станет соизмеримым с количеством первичных элементов в базах.\u003C\u002Fp\u003E\u003Ch3\u003EРезультаты\u003C\u002Fh3\u003E\u003Cp\u003EРассмотрим теперь непосредственно сам алгоритм поиска наиболее схожего изображения лица из базы лиц на изображение лица сличаемой персоны по косинусной похожести отвечающих этим изображениям дескрипторов. Итак, пусть имеется подготовленная согласно описанному выше алгоритму база изображений лиц и соответствующих им дескрипторов, обладающая достаточной статистической репрезентативностью (\u003E\u003E 10\u003Csup\u003E5\u003C\u002Fsup\u003E персон). Предположим, что сформирован запрос на поиск для некого изображения лица по отвечающему ему дескриптору. И пусть, для определенности, это будет дескриптор, для которого с помощью вышеописанной процедуры (хеш-функции) для него получается следующий хеш-код: 0442103. Далее для всех дескрипторных \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9A%D0%BE%D0%BB%D0%BB%D0%B8%D0%B7%D0%B8%D1%8F_%D1%85%D0%B5%D1%88-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8\" rel=\"noopener noreferrer nofollow\"\u003Eколлизий хеш-кода\u003C\u002Fa\u003E по локальным окрестностям его компонент, в частности, при\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003Er\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E5\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E6\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E7\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E2..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003Eосуществляется полный перебор отфильтрованных дескрипторов из базы (приблизительно 0.006 от их общего количества) по максимуму косинусной похожести дескрипторов. Если результатом поиска является дескриптор с косинусной похожестью не менее \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(7)\u003C\u002Fsup\u003E (в общем случае может быть запрос на поиск нескольких наиболее похожих дескрипторов), то поиск считается удачным и заканчивается. Иначе поиск продолжается с расширением локальных хеш-окрестностей слева и справа вплоть до полного перебора на текущем уровне \u003Cem\u003Er\u003C\u002Fem\u003E с последующим переходом к следующему уровню \u003Cem\u003Er\u003C\u002Fem\u003E (от больших значений \u003Cem\u003Er\u003C\u002Fem\u003E к меньшим) пока либо найденное текущее максимальное значение косинусной похожести не сравняется или превысит \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(\u003C\u002Fsup\u003E\u003Cem\u003E\u003Csup\u003Er\u003C\u002Fsup\u003E\u003C\u002Fem\u003E\u003Csup\u003E)\u003C\u002Fsup\u003E, либо не будет осуществлен полный перебор всех дескрипторов в базе. Например, пусть для рассмотренных коллизий максимальная косинусная похожесть \u003Cem\u003EC\u003Csub\u003Emax\u003C\u002Fsub\u003E\u003C\u002Fem\u003E составляет 0.52. Тогда поиск необходимо дополнительно проводить и по коллизиям\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003Eи, пусть, с тем же результатом \u003Cem\u003EC\u003Csub\u003Emax\u003C\u002Fsub\u003E\u003C\u002Fem\u003E = 0.52. И так несколько раз подряд, то есть, по соответствующим нижеперечисленным коллизиям.\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1..3\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"83\" width=\"83\"\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0, 4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EА по коллизиям\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E2\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"84\" width=\"84\"\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E\u003Cem\u003EH\u003Csub\u003Er\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..1\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E3..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd data-colwidth=\"84\" width=\"84\"\u003E\u003Cp align=\"center\"\u003E0\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"center\"\u003E0..4\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003Eпусть был найден дескриптор, для которого \u003Cem\u003EC\u003Csub\u003Emax\u003C\u002Fsub\u003E\u003C\u002Fem\u003E = 0.586 \u003E \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(2)\u003C\u002Fsup\u003E. Полученный результат фиксируется, а поиск останавливается.\u003C\u002Fp\u003E\u003Cp\u003EТеперь возникает резонный вопрос, а насколько часто реализуются случаи, когда при первичном поиске \u003Cem\u003EC\u003Csub\u003Emax\u003C\u002Fsub\u003E\u003C\u002Fem\u003E &lt; \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(7)\u003C\u002Fsup\u003E. Ведь в таком случае скорость поиска может снижаться в разы вплоть до полного перебора. И если такие случаи будут частыми, то существенного выигрыша от индексного поиска по хеш-коду не будет. Однако, из практики использования нейросетевых технологий вроде ArcFace наблюдения следующие. Для конкретной полученной нами реализации нейросети в достаточно редких случаях дескриптора, соответствующие весьма качественным изображениям неких персон, могут иметь косинусную похожесть на наиболее репрезентативные дескриптора этих персон менее 0.57. В то же время, в каких-то крайне редких случаях дескриптора, отвечающие изображениям лиц каких-то персон, имеют косинусную похожесть на наиболее репрезентативные дескриптора каких-то других персон более 0.61. Все эти наблюдения позволяют, в том числе, сформулировать следующую гипотезу:\u003C\u002Fp\u003E\u003Cp\u003E– если в результате первичного поиска \u003Cem\u003EC\u003Csub\u003Emax\u003C\u002Fsub\u003E\u003C\u002Fem\u003E &lt; \u003Cem\u003EC\u003Csub\u003Eth\u003C\u002Fsub\u003E\u003C\u002Fem\u003E\u003Csup\u003E(7)\u003C\u002Fsup\u003E, то с высокой вероятностью в базе отсутствуют изображения лица сличаемой персоны.\u003C\u002Fp\u003E\u003Cp\u003EСам же эффект перекрытия дескрипторных кластеров для разных персон не обладает такой статистической значимостью, чтобы привести к практически полной редукции ускорения поиска по хеш-коду.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"быстрый поиск"},{"titleHtml":"хеширование"},{"titleHtml":"нейросети"},{"titleHtml":"глубокое обучение"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F00d\u002F4b5\u002Ff46\u002F00d4b5f46f5758b7f87efd4d7a992219.gif","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F00d\u002F4b5\u002Ff46\u002F00d4b5f46f5758b7f87efd4d7a992219.gif","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582708\\\u002F\"},\"headline\":\"Эффективное геометрическое хеширование пространства признаков для быстрого точного поиска наиболее близких дескрипторов\",\"datePublished\":\"2021-10-11T12:00:21+03:00\",\"dateModified\":\"2021-10-11T16:55:13+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Дмитрий Поздняков\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых п...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582708\\\u002F#post-content-body\",\"about\":[\"h_search_technologies\",\"h_algorithms\",\"h_maths\",\"h_machine_learning\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F582708\\\u002Fc26f7729404c29b7a90d266fe778a097\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F65f\\\u002F682\\\u002F67d\\\u002F65f68267d3d20a5cd6b141768b9e4370.svg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fbfb\\\u002F9fc\\\u002F16f\\\u002Fbfb9fc16fa351e244030af9d0a42497f.svg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fdad\\\u002Fa48\\\u002F306\\\u002Fdada483069f3465192f81b4b1d79ed70.svg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc60\\\u002F263\\\u002F096\\\u002Fc60263096c7cc4f96f6a86363139061c.svg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc2e\\\u002Fb62\\\u002F77a\\\u002Fc2eb6277a8e960b6fc902a81914f643c.svg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F00d\\\u002F4b5\\\u002Ff46\\\u002F00d4b5f46f5758b7f87efd4d7a992219.gif\"]}","metaDescription":"При решении задачи распознавания лиц в компании Оксаджайл (Oxagile) был разработан новый алгоритм эффективного геометрического хеширования пространства лицевых признаков с целью быстрого поиска двух...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"search_technologies,algorithms,maths,machine_learning"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
