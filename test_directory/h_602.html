<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Вячеслав Смирнов. Профилирование JVM в Kubernetes / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/583162\/"},"headline":"Вячеслав Смирнов. Профилирование JVM в Kubernetes","datePublished":"2021-10-13T10:14:43+03:00","dateModified":"2021-10-18T07:59:25+03:00","author":{"@type":"Person","name":"Пацев Антон"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы. Вячеславу повезло ис...","url":"https:\/\/habr.com\/ru\/post\/583162\/#post-content-body","about":["h_java","h_kubernetes","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/583162\/7d59b2b28dff9dae6abb201cc6ffd71b\/","https:\/\/habrastorage.org\/webt\/hn\/ko\/y8\/hnkoy8r68jeazhjtozsvwrxx5me.jpeg","https:\/\/habrastorage.org\/webt\/no\/yo\/14\/noyo14dncvmsz8etcbvlykvddqc.jpeg","https:\/\/habrastorage.org\/webt\/pa\/ce\/ll\/pacellg1cksokuumrupaltjwpmy.jpeg","https:\/\/habrastorage.org\/webt\/-8\/eu\/te\/-8eute6bkrpgmrwly6qrungumwu.jpeg","https:\/\/habrastorage.org\/webt\/fy\/vw\/qn\/fyvwqnlxidncyzyl5yf29pkh9zo.jpeg","https:\/\/habrastorage.org\/webt\/aq\/cm\/hi\/aqcmhi1x4ii3mja-gzsilztu8u0.jpeg","https:\/\/habrastorage.org\/webt\/at\/_d\/qg\/at_dqghy94xma1hxtqnvrucxpdm.jpeg","https:\/\/habrastorage.org\/webt\/bw\/9z\/v7\/bw9zv7quv5invqoahxjiwnxc5t0.jpeg","https:\/\/habrastorage.org\/webt\/n6\/yb\/0i\/n6yb0i_cemtrulu9t-swaq7l7z0.jpeg","https:\/\/habrastorage.org\/webt\/jq\/fx\/lg\/jqfxlgdqjt-g6lu0tltbx1hshpw.jpeg","https:\/\/habrastorage.org\/webt\/rg\/dl\/wy\/rgdlwydjpktsp3qdjoe7zb2rob4.jpeg","https:\/\/habrastorage.org\/webt\/ue\/uc\/vr\/ueucvr86lmuossfg2c3zqfzdzry.jpeg","https:\/\/habrastorage.org\/webt\/1f\/6l\/qb\/1f6lqbeawdsvhb31ql_xujtfioo.jpeg","https:\/\/habrastorage.org\/webt\/rs\/sg\/gk\/rssggk75w04ddavxozg43awhzie.jpeg","https:\/\/habrastorage.org\/webt\/em\/tx\/z2\/emtxz2pxcgyzmabgmqv7h804zpw.jpeg","https:\/\/habrastorage.org\/webt\/ci\/cw\/r8\/cicwr8ggfvoj9d1htdfhbksfrw8.jpeg","https:\/\/habrastorage.org\/webt\/-5\/66\/vo\/-566vo__nnajd120lysm07mzn90.jpeg","https:\/\/habrastorage.org\/webt\/pz\/xy\/jo\/pzxyjoozcc7iqxdc7ilye3orus0.jpeg","https:\/\/habrastorage.org\/webt\/eb\/ai\/lu\/ebailuzkmgbw455pa4avsqrti3u.jpeg","https:\/\/habrastorage.org\/webt\/69\/ck\/pk\/69ckpkrzaa1bilzcohazqfzeeho.jpeg","https:\/\/habrastorage.org\/webt\/lt\/ma\/wx\/ltmawxervogkegzhaz-guekjcms.jpeg","https:\/\/habrastorage.org\/webt\/ut\/yp\/sy\/utypsyb5bqbndmilhkg7_yi-xnw.jpeg","https:\/\/habrastorage.org\/webt\/me\/nl\/ec\/menleca841tcol15pzhtkoptijm.jpeg","https:\/\/habrastorage.org\/webt\/8b\/2r\/qu\/8b2rquowmcgk7zjs3f7ctqqip3g.jpeg","https:\/\/habrastorage.org\/webt\/d0\/0t\/fo\/d00tfocuhv-mppwu4m0ry-ongtq.jpeg","https:\/\/habrastorage.org\/webt\/z7\/r2\/6b\/z7r26b02hn-uawasgkfbssbsope.jpeg","https:\/\/habrastorage.org\/webt\/fz\/cd\/8g\/fzcd8g9zai1ux-dch6rtt2wz5ms.jpeg","https:\/\/habrastorage.org\/webt\/ad\/b4\/o1\/adb4o1q66jgx0afilusmault95w.jpeg","https:\/\/habrastorage.org\/webt\/rl\/fj\/mv\/rlfjmvtlu7czo866k0reyekmpxq.jpeg","https:\/\/habrastorage.org\/webt\/r2\/zr\/_q\/r2zr_qyrsnbxforlbmsf6uvf09q.jpeg","https:\/\/habrastorage.org\/webt\/jx\/ww\/4a\/jxww4at_gvfph3dyxu5nvheoqum.jpeg","https:\/\/habrastorage.org\/webt\/ez\/eo\/bi\/ezeobiclkpy1rtwsw7plzhmmfai.jpeg","https:\/\/habrastorage.org\/webt\/xg\/gs\/cc\/xggsccv90e3ydb1_-wfsq0u1wfs.jpeg","https:\/\/habrastorage.org\/webt\/7s\/xm\/a5\/7sxma5tbbst7xvkh7z6ohyjctro.jpeg","https:\/\/habrastorage.org\/webt\/hx\/eq\/iy\/hxeqiyh3u2li6ztyk9_seazgvyi.jpeg","https:\/\/habrastorage.org\/webt\/0t\/fg\/bg\/0tfgbg5j69e6hkcsmwxofzb6m9k.jpeg","https:\/\/habrastorage.org\/webt\/dw\/my\/vz\/dwmyvz-0afchhl4zuousixldfh8.jpeg","https:\/\/habrastorage.org\/webt\/zt\/9j\/do\/zt9jdolj-2ob45jrzlxilqpjjtg.jpeg","https:\/\/habrastorage.org\/webt\/v_\/cr\/hq\/v_crhqlaf2mkeqp3t4nfiydzxd8.jpeg","https:\/\/habrastorage.org\/webt\/ko\/zb\/z2\/kozbz2nh_164ot54ppj1vzjgd5i.jpeg","https:\/\/habrastorage.org\/webt\/6a\/by\/tu\/6abyturr-ucm3avblx9j2gjybog.jpeg","https:\/\/habrastorage.org\/webt\/ec\/dp\/rx\/ecdprxigdzbocka_ie5edcfwsdi.jpeg","https:\/\/habrastorage.org\/webt\/hl\/ch\/ha\/hlchhadip95mvx6lde19gvo7c5s.jpeg","https:\/\/habrastorage.org\/webt\/dk\/3i\/9g\/dk3i9guxkkh1cde_zjbkdrbk7vu.jpeg","https:\/\/habrastorage.org\/webt\/5d\/ij\/ix\/5dijixusurfrqnkpk--rr4zv40w.jpeg","https:\/\/habrastorage.org\/webt\/d-\/tl\/tw\/d-tltwba3ewxip9b5ma82iog7wk.jpeg","https:\/\/habrastorage.org\/webt\/xe\/ny\/fu\/xenyfuuixezdfu-ijy16tivghyi.jpeg","https:\/\/habrastorage.org\/webt\/nr\/4k\/0g\/nr4k0gjy_cm5abykzmeh5cx1x94.jpeg","https:\/\/habrastorage.org\/webt\/ac\/-a\/bw\/ac-abwzfp_kwlr-myugumevx6-k.jpeg","https:\/\/habrastorage.org\/webt\/je\/jp\/vp\/jejpvpqi6ba_kh5cktlhoqlk2nw.jpeg","https:\/\/habrastorage.org\/webt\/bz\/3d\/_x\/bz3d_xjbzgvmq5b1hdvjrcxadxm.jpeg","https:\/\/habrastorage.org\/webt\/ur\/zj\/pr\/urzjprtm956dvkebbpdqmixc4da.jpeg","https:\/\/habrastorage.org\/webt\/iw\/n8\/gz\/iwn8gzq1_-zikndj9kslg1zc7g8.jpeg","https:\/\/habrastorage.org\/webt\/br\/_z\/qv\/br_zqvbb1zfcxqojjp-glpnvwqo.jpeg","https:\/\/habrastorage.org\/webt\/fk\/d5\/v5\/fkd5v53vfw535q-s6kcanqbhipw.jpeg","https:\/\/habrastorage.org\/webt\/ez\/sd\/qu\/ezsdqu_gsg5t2tv7rguza6tnx7y.jpeg","https:\/\/habrastorage.org\/webt\/mf\/mh\/ag\/mfmhagbahjpvucxqhhuhmdp3mom.jpeg","https:\/\/habrastorage.org\/webt\/xg\/dw\/gw\/xgdwgwqbitjwambd7m5xey00nhw.jpeg","https:\/\/habrastorage.org\/webt\/vp\/bb\/sf\/vpbbsfxd4iimvon-fumqlrdbpe0.jpeg","https:\/\/habrastorage.org\/webt\/oc\/7k\/ty\/oc7ktyjyeruv_87sntqhaurbfag.jpeg","https:\/\/habrastorage.org\/webt\/ob\/ok\/nk\/oboknkoqudqd65v8ct-ra6gajke.jpeg","https:\/\/habrastorage.org\/webt\/el\/7e\/og\/el7eog7bhmsoo6uqfpfae85uvf0.jpeg","https:\/\/habrastorage.org\/webt\/su\/wm\/cy\/suwmcynefsoiton-igolgkiwsqk.jpeg","https:\/\/habrastorage.org\/webt\/ju\/ls\/b7\/julsb7wg_ofa81vx_9ayoi9ujjg.jpeg","https:\/\/habrastorage.org\/webt\/xv\/cw\/5u\/xvcw5un_udsqedu0kc3gu0p5quq.jpeg","https:\/\/habrastorage.org\/webt\/jf\/py\/es\/jfpyes6uch7_fhwdjkf6s84rbiw.jpeg","https:\/\/habrastorage.org\/webt\/bl\/jn\/9l\/bljn9lh1kxy3d3zuvhueg8febwm.jpeg","https:\/\/habrastorage.org\/webt\/yj\/dx\/2s\/yjdx2sbj7xwq3s6vitbc4l8m3ji.jpeg","https:\/\/habrastorage.org\/webt\/vw\/rg\/z-\/vwrgz-ohzmw4plbkxmhdpzuqdpq.jpeg","https:\/\/habrastorage.org\/webt\/wg\/nh\/k2\/wgnhk2qrqb4gb4a26lwnuejxfw8.jpeg","https:\/\/habrastorage.org\/webt\/gd\/tb\/su\/gdtbsu9k3ufavyzkeb3cdxjmrsk.jpeg","https:\/\/habrastorage.org\/webt\/j7\/ij\/fu\/j7ijfurzgva2juo-vtwf8wdiatc.jpeg","https:\/\/habrastorage.org\/webt\/xk\/a-\/e1\/xka-e1xa1glk-yh7vymv9y1xmi0.jpeg","https:\/\/habrastorage.org\/webt\/mw\/yi\/xv\/mwyixvzc7ouauiyu-v3fsv5j5ve.jpeg","https:\/\/habrastorage.org\/webt\/bk\/y8\/3m\/bky83mem98kkdzv7zvwgl_huhww.jpeg","https:\/\/habrastorage.org\/webt\/es\/vy\/ng\/esvyngwjwqij_fua2wtdkzehvjy.jpeg","https:\/\/habrastorage.org\/webt\/ci\/ql\/te\/ciqltefefdlfb0fbqx8si-oaiu4.jpeg","https:\/\/habrastorage.org\/webt\/dg\/np\/lv\/dgnplveff9n9r9hkxgpe3dqpbxs.jpeg","https:\/\/habrastorage.org\/webt\/jy\/cc\/ef\/jyccef_fvympzg2kfup9r2ohp7k.jpeg","https:\/\/habrastorage.org\/webt\/0w\/ms\/hb\/0wmshbf1acm3uidnlupe6gc0tcg.jpeg","https:\/\/habrastorage.org\/webt\/-5\/9y\/g-\/-59yg-kunlq-x0fudevwcprhn84.jpeg","https:\/\/habrastorage.org\/webt\/zu\/jw\/l_\/zujwl_cdori5hc-glk_viw41yfu.jpeg","https:\/\/habrastorage.org\/webt\/yb\/bv\/xe\/ybbvxexf5ssclntovjxgb49vrvi.jpeg","https:\/\/habrastorage.org\/webt\/ad\/-0\/dq\/ad-0dq51cb2aap0zrpqkhzc-m0u.jpeg","https:\/\/habrastorage.org\/webt\/df\/ls\/g8\/dflsg86nylelxahea1yz0uz9dn4.jpeg","https:\/\/habrastorage.org\/webt\/b7\/us\/pa\/b7uspafftsfom6dramgi53vqd_u.jpeg","https:\/\/habrastorage.org\/webt\/7f\/xw\/do\/7fxwdox6iwnqbwybojbt-hj0qri.jpeg","https:\/\/habrastorage.org\/webt\/le\/-f\/xv\/le-fxvieyupxz8avmd4xyuhbdua.jpeg","https:\/\/habrastorage.org\/webt\/vv\/q4\/29\/vvq429gy94jiieflrn5d58bqc3y.jpeg","https:\/\/habrastorage.org\/webt\/zv\/jc\/nj\/zvjcnjprxdrxqzi4xr8cubihyvw.jpeg","https:\/\/habrastorage.org\/webt\/js\/fu\/po\/jsfupouzcard_pajcjjsumtmque.jpeg","https:\/\/habrastorage.org\/webt\/qe\/80\/6x\/qe806x79_tdmgzhd4ueyczcyrx0.jpeg","https:\/\/habrastorage.org\/webt\/jy\/1s\/p4\/jy1sp4mugndp0pbbguyslzr81xw.jpeg","https:\/\/habrastorage.org\/webt\/my\/sa\/2d\/mysa2depg6p_cuv7uhldaiqnx5a.jpeg","https:\/\/habrastorage.org\/webt\/j5\/0u\/tz\/j50utzpuq7qyw_ujwnqzqaiwdjm.jpeg","https:\/\/habrastorage.org\/webt\/8-\/zc\/jj\/8-zcjjmqxj0qy5oy2mft9ciase8.jpeg","https:\/\/habrastorage.org\/webt\/k6\/8f\/ny\/k68fnymw8vhevaq5e0mzyt1h9f4.jpeg","https:\/\/habrastorage.org\/webt\/6t\/po\/aa\/6tpoaad8yroroy8bludua3vcbh4.jpeg","https:\/\/habrastorage.org\/webt\/np\/yj\/zw\/npyjzwk0dluc3y_bxvx2b_frujy.jpeg","https:\/\/habrastorage.org\/webt\/_b\/nn\/iu\/_bnniuuplqr8xfjvvkbon17drjs.jpeg","https:\/\/habrastorage.org\/webt\/_g\/9l\/an\/_g9lanusei-bd9mqxa1ayzc403s.jpeg","https:\/\/habrastorage.org\/webt\/48\/nl\/bo\/48nlbooxwpa9zyu9ppdliitx-z4.jpeg","https:\/\/habrastorage.org\/webt\/w2\/-q\/3u\/w2-q3u2yh-yjtitckzdi7waexks.jpeg","https:\/\/habrastorage.org\/webt\/ok\/b9\/uh\/okb9uhsa2oybftxfqmvdif9mric.jpeg","https:\/\/habrastorage.org\/webt\/aq\/iw\/ur\/aqiwurprh48ezo5bbkj9xzf06om.jpeg","https:\/\/habrastorage.org\/webt\/b4\/xe\/s4\/b4xes4t8xujivffxydzbq5stmds.jpeg","https:\/\/habrastorage.org\/webt\/bj\/qx\/do\/bjqxdogcqvi6demn6e1mgpo8kfu.jpeg","https:\/\/habrastorage.org\/webt\/ku\/uv\/rp\/kuuvrprb2o67naigcrzyfvafrlk.jpeg","https:\/\/habrastorage.org\/webt\/st\/et\/bo\/stetbon8lvgvo37hqupvm_zikay.jpeg","https:\/\/habrastorage.org\/webt\/6r\/pj\/zl\/6rpjzlejwv7xjmfz-aqqunofeja.jpeg","https:\/\/habrastorage.org\/webt\/hx\/ln\/rs\/hxlnrsbquqdnyggzvjeq0f8c3ng.jpeg","https:\/\/habrastorage.org\/webt\/g8\/el\/af\/g8elafdugqfcppidp0m42yuevt0.jpeg","https:\/\/habrastorage.org\/webt\/sw\/zk\/d9\/swzkd90m1tyksfzb8lk0jmw5mey.jpeg","https:\/\/habrastorage.org\/webt\/pq\/_l\/qk\/pq_lqkboysntswre8do-ijzqftg.jpeg","https:\/\/habrastorage.org\/webt\/zp\/26\/gv\/zp26gvqhwda7tkxmsmicukfiq1m.jpeg","https:\/\/habrastorage.org\/webt\/5p\/jc\/wy\/5pjcwy5hsbm-qiy8ilmdlulb8to.jpeg","https:\/\/habrastorage.org\/webt\/8c\/rt\/im\/8crtimfttv8vscbdqsz-g0d3dra.jpeg","https:\/\/habrastorage.org\/webt\/_n\/73\/5t\/_n735titight87grzx6n-wfyk0w.jpeg","https:\/\/habrastorage.org\/webt\/yd\/zh\/zc\/ydzhzco4sdch6ugvzzh2rxzfrqm.jpeg","https:\/\/habrastorage.org\/webt\/cl\/hr\/fb\/clhrfbd-wgodh8jlcvy7yzc8irm.jpeg","https:\/\/habrastorage.org\/webt\/aq\/t9\/cf\/aqt9cfwqbxwirq4fykssfx0z2pa.jpeg","https:\/\/habrastorage.org\/webt\/zq\/mh\/bp\/zqmhbpx49wvzpuevp6ztjspaday.jpeg","https:\/\/habrastorage.org\/webt\/ej\/vt\/vh\/ejvtvhf5ccmpwjtieaxpxunmxqe.jpeg","https:\/\/habrastorage.org\/webt\/pe\/8y\/xy\/pe8yxyxmhfuirsygfid2ff20ilo.jpeg","https:\/\/habrastorage.org\/webt\/at\/wa\/f0\/atwaf0xgicsozvknt0yeac-liao.jpeg","https:\/\/habrastorage.org\/webt\/_2\/4y\/h5\/_24yh5tmrt1096li6ta2xnallhm.jpeg","https:\/\/habrastorage.org\/webt\/zx\/pr\/k5\/zxprk564xnimjwbk9gzstf9p07m.jpeg","https:\/\/habrastorage.org\/webt\/od\/be\/u3\/odbeu357ttwq2fkjrx821chomh8.jpeg","https:\/\/habrastorage.org\/webt\/rs\/jm\/7s\/rsjm7sxkzbe9oukfwsdvlyo4qxk.jpeg","https:\/\/habrastorage.org\/webt\/w3\/tc\/xk\/w3tcxkfazbx88vic-ihllo40w4u.jpeg","https:\/\/habrastorage.org\/webt\/_z\/xh\/s8\/_zxhs8rlrjaaycfmg3pvfavtlg8.jpeg","https:\/\/habrastorage.org\/webt\/hl\/uy\/l9\/hluyl9-r0_svf94kidhnsdlkpeo.jpeg","https:\/\/habrastorage.org\/webt\/eu\/nk\/5h\/eunk5hgs8w1zb1kv8ynszhhwv3u.jpeg","https:\/\/habrastorage.org\/webt\/dk\/yl\/aa\/dkylaapdynv_stlpr4obg9znb5s.jpeg","https:\/\/habrastorage.org\/webt\/0c\/cf\/fn\/0ccffngbmjuj6sopb4wrdm5vqdi.jpeg","https:\/\/habrastorage.org\/webt\/c6\/r7\/q3\/c6r7q3_h4domw6dkwtignxyumru.jpeg","https:\/\/habrastorage.org\/webt\/pl\/ig\/1z\/plig1zfp84jshmdbkzjurc8aquk.jpeg","https:\/\/habrastorage.org\/webt\/hw\/x7\/ua\/hwx7uazplk4ijvgy3wdtujrbqc8.jpeg","https:\/\/habrastorage.org\/webt\/5u\/1f\/vw\/5u1fvwd8fjgxdbjguwpjsqltrga.jpeg","https:\/\/habrastorage.org\/webt\/74\/x0\/lg\/74x0lgzta9-bxfhnxccs6q_sd88.jpeg","https:\/\/habrastorage.org\/webt\/ia\/ca\/_w\/iaca_wwhji4mt9fhs_end_pcx80.jpeg","https:\/\/habrastorage.org\/webt\/ub\/j0\/ne\/ubj0necvh_vji9tgwvvzcm7hyb8.jpeg","https:\/\/habrastorage.org\/webt\/2e\/6m\/dx\/2e6mdx4ugb6wbhuhnpgrpb_aoq0.jpeg","https:\/\/habrastorage.org\/webt\/po\/j9\/yw\/poj9ywslknhwfqia-lt0_lxniem.jpeg","https:\/\/habrastorage.org\/webt\/rh\/kd\/2-\/rhkd2-gnkwkkdfgj_zeqtnfjxx4.jpeg","https:\/\/habrastorage.org\/webt\/t6\/jx\/pd\/t6jxpdxn4vl2cxkivhe3v_el5hs.jpeg","https:\/\/habrastorage.org\/webt\/hf\/2l\/5x\/hf2l5xhlfcv2v2cod4fhrrvpbvq.jpeg","https:\/\/habrastorage.org\/webt\/xk\/pl\/pm\/xkplpm5tvpjon4gv2nelihg_v_y.jpeg","https:\/\/habrastorage.org\/webt\/qp\/un\/zp\/qpunzpf7nuubt3cuc4p1nfh1fhi.jpeg","https:\/\/habrastorage.org\/webt\/3s\/w3\/gn\/3sw3gn3xlpovg0sjupphnyruals.jpeg","https:\/\/habrastorage.org\/webt\/o9\/fw\/jo\/o9fwjoolqwws48ct5887vx17r0q.jpeg","https:\/\/habrastorage.org\/webt\/vj\/al\/3u\/vjal3u2eiujudv9ahpiibzwlwjq.jpeg","https:\/\/habrastorage.org\/webt\/3z\/uz\/_z\/3zuz_z2y0qzcx7xbny9kjsqg4wk.jpeg","https:\/\/habrastorage.org\/webt\/ya\/c8\/8r\/yac88rc-d4iihfpev1wownmkn8g.jpeg","https:\/\/habrastorage.org\/webt\/zf\/lf\/s2\/zflfs29vwbepgzygjfbhl2ufsyq.jpeg","https:\/\/habrastorage.org\/webt\/d0\/mn\/nh\/d0mnnhuri3shibagmsqugbakkou.jpeg","https:\/\/habrastorage.org\/webt\/i5\/vc\/72\/i5vc72253g8osgtac34q2xr0rhs.jpeg","https:\/\/habrastorage.org\/webt\/6u\/9b\/q1\/6u9bq1xvdugeaiioovskosbmja0.jpeg","https:\/\/habrastorage.org\/webt\/y2\/sj\/xf\/y2sjxfunobdyxmbndq5wt5wgsdu.jpeg","https:\/\/habrastorage.org\/webt\/oe\/pn\/f9\/oepnf9-m8caimaxdzwn4lvyctpi.jpeg","https:\/\/habrastorage.org\/webt\/nm\/kl\/tq\/nmkltqjde2ftyxoy1m3mciyy-ce.jpeg","https:\/\/habrastorage.org\/webt\/hr\/ct\/n1\/hrctn1b8ga9gwf0bjm5s0zo_3aq.jpeg","https:\/\/habrastorage.org\/webt\/xf\/n0\/ag\/xfn0agcdndmfphsp5hos_gkimqm.jpeg","https:\/\/habrastorage.org\/webt\/ho\/cg\/ap\/hocgapt1kizx3jhtbyr5dvilyge.jpeg","https:\/\/habrastorage.org\/webt\/bw\/ks\/om\/bwksomzy199yzw60kl0ic_o64u4.jpeg","https:\/\/habrastorage.org\/webt\/zl\/zj\/dr\/zlzjdrhhaij26bkpursynqz5dok.jpeg","https:\/\/habrastorage.org\/webt\/si\/id\/-s\/siid-s2eymkoazohnqunb1kiory.jpeg","https:\/\/habrastorage.org\/webt\/h2\/sg\/i_\/h2sgi_g_lpr6610kmwsw-umdyca.jpeg","https:\/\/habrastorage.org\/webt\/ai\/dm\/ey\/aidmeyyktf7meevqmrmlk1i6jkc.jpeg","https:\/\/habrastorage.org\/webt\/lt\/eb\/-w\/lteb-wvoyigitgcpqtfzjvt1ukg.jpeg","https:\/\/habrastorage.org\/webt\/j8\/od\/rq\/j8odrqd_m2nqwahrj4wmynw2zqw.jpeg","https:\/\/habrastorage.org\/webt\/et\/y_\/bs\/ety_bsgjdwms52f_lqugxbt6bya.jpeg","https:\/\/habrastorage.org\/webt\/eu\/fx\/om\/eufxomk6kqh3jtun43ep0qdym9m.jpeg","https:\/\/habrastorage.org\/webt\/3u\/tm\/ew\/3utmewzqhydphd3y2dwctwuiapi.jpeg","https:\/\/habrastorage.org\/webt\/6g\/8i\/id\/6g8iid1wlognz4xrjj9lhcmlgzg.jpeg","https:\/\/habrastorage.org\/webt\/me\/fs\/mm\/mefsmmifese-nvv4qhwf800a6ck.jpeg","https:\/\/habrastorage.org\/webt\/87\/xc\/9d\/87xc9d96odydv0nq0uheag9zn-k.jpeg","https:\/\/habrastorage.org\/webt\/en\/hp\/5f\/enhp5fhj_mrtusqxqh2_qse-hxk.jpeg","https:\/\/habrastorage.org\/webt\/ud\/f9\/yw\/udf9ywwiibgeapsycsddvvt5-m0.jpeg","https:\/\/habrastorage.org\/webt\/yi\/h3\/x1\/yih3x100yimhxi_vvxmraa3fz78.jpeg","https:\/\/habrastorage.org\/webt\/yd\/ip\/9c\/ydip9cjizxycg0grloiqailbq_m.jpeg","https:\/\/habrastorage.org\/webt\/-m\/md\/wa\/-mmdwagmbs5dad1o0roke2fo45u.jpeg","https:\/\/habrastorage.org\/webt\/cn\/kv\/tx\/cnkvtxbjfon4omopuneua88mhds.jpeg","https:\/\/habrastorage.org\/webt\/uq\/do\/nz\/uqdonz_zn-izrqb79_jaa8yvfuu.jpeg","https:\/\/habrastorage.org\/webt\/0i\/bc\/r8\/0ibcr8sgpmbqvbgp2e-um8wj2aa.jpeg","https:\/\/habrastorage.org\/webt\/sl\/id\/tm\/slidtmvla5h1gvf9pf4ys1e1nmk.jpeg","https:\/\/habrastorage.org\/webt\/j3\/em\/-w\/j3em-whzfq4dt-vugi_hxw29yls.jpeg","https:\/\/habrastorage.org\/webt\/ky\/s2\/h2\/kys2h2jpjkpwyj7vhhcwrbc6fd0.jpeg","https:\/\/habrastorage.org\/webt\/bd\/07\/dm\/bd07dm_dgkr_6z0r8iw4rctjvym.jpeg","https:\/\/habrastorage.org\/webt\/rn\/yt\/rp\/rnytrpisfys9nc5abnhjpn68n_y.jpeg","https:\/\/habrastorage.org\/webt\/t-\/4o\/ml\/t-4omltjqghlnkaawbqgtdpbmeq.jpeg","https:\/\/habrastorage.org\/webt\/zr\/qq\/49\/zrqq49ny2fmtcq2dfrp-habagia.jpeg","https:\/\/habrastorage.org\/webt\/ed\/p-\/au\/edp-aua3lc_k0cthfxjxyr6rchw.jpeg","https:\/\/habrastorage.org\/webt\/ix\/tr\/em\/ixtreml4kaei5ulcqumwmyx7_mq.jpeg","https:\/\/habrastorage.org\/webt\/nx\/id\/tf\/nxidtfhgiwfoabgdsgo1ni0ib6g.jpeg","https:\/\/habrastorage.org\/webt\/-r\/yl\/-2\/-ryl-2vzokc1pwkehczpbpn-z30.jpeg","https:\/\/habrastorage.org\/webt\/fr\/pd\/vj\/frpdvj6x5dyqj8q-xyq4tll2tji.jpeg","https:\/\/habrastorage.org\/webt\/ml\/uc\/hv\/mluchv-uc8klvq03ceempuk6cvy.jpeg","https:\/\/habrastorage.org\/webt\/fp\/nj\/wl\/fpnjwliubi8qauwjkhrewugfpjy.jpeg","https:\/\/habrastorage.org\/webt\/7o\/an\/ar\/7oanarve-p5l5sex9mx-3aqtqu0.jpeg","https:\/\/habrastorage.org\/webt\/ep\/pt\/qf\/epptqfjvel_vyvupgkji6j26uss.jpeg","https:\/\/habrastorage.org\/webt\/lm\/bt\/na\/lmbtnaa5niwew7sz-a7lriaexwu.jpeg","https:\/\/habrastorage.org\/webt\/yk\/rd\/qa\/ykrdqacggepipmm_2dvp7fly5ia.jpeg","https:\/\/habrastorage.org\/webt\/a_\/sw\/ls\/a_swlss32pli6b1d7ascin7n4eo.jpeg","https:\/\/habrastorage.org\/webt\/yp\/sv\/ny\/ypsvnyf7yr7ib_hfz25enj_f4aa.jpeg","https:\/\/habrastorage.org\/webt\/es\/bx\/f2\/esbxf2kot34p-xx9xemz-lvhib0.jpeg","https:\/\/habrastorage.org\/webt\/v8\/ce\/2j\/v8ce2j_9upd8dtb0rhp6gyax-5i.jpeg","https:\/\/habrastorage.org\/webt\/3v\/_f\/f0\/3v_ff052tx42jn7nfnqkhdhxuwu.jpeg","https:\/\/habrastorage.org\/webt\/fr\/pc\/ia\/frpciayq0wc4xi9qzzwbjmvbyau.jpeg","https:\/\/habrastorage.org\/webt\/hx\/p2\/4n\/hxp24ndpklksbmoeztmxl0wdjjg.jpeg","https:\/\/habrastorage.org\/webt\/r0\/be\/i1\/r0bei1ks8o-r_fbvmceorp_npf8.jpeg","https:\/\/habrastorage.org\/webt\/xx\/rn\/1w\/xxrn1w2s6iu7b9iehqnya7qqkwa.jpeg","https:\/\/habrastorage.org\/webt\/rp\/ya\/40\/rpya40swjqdveohidlfkuyf3e8y.jpeg","https:\/\/habrastorage.org\/webt\/c5\/mc\/ml\/c5mcmlgnk6vdat6o_n4p9v6gytu.jpeg","https:\/\/habrastorage.org\/webt\/6n\/4w\/-g\/6n4w-gnqiyglhtfc0vclwaed1yy.jpeg","https:\/\/habrastorage.org\/webt\/ih\/kw\/6y\/ihkw6ykhtfn4xd3dl--2zshsl-g.jpeg","https:\/\/habrastorage.org\/webt\/pd\/5l\/fx\/pd5lfxbnv9c07cxmegiky0lfoae.jpeg","https:\/\/habrastorage.org\/webt\/-e\/u4\/c9\/-eu4c95cm2dg8hrk5wfrg3ohbdo.jpeg","https:\/\/habrastorage.org\/webt\/ht\/gp\/cu\/htgpcu303cw7nimg3mi114fnqmc.jpeg","https:\/\/habrastorage.org\/webt\/ll\/tv\/ts\/lltvtsd4ihdl48bfjthcoevyu2i.jpeg","https:\/\/habrastorage.org\/webt\/if\/3c\/vm\/if3cvmcusuyktyj41vwqwv0_ida.jpeg","https:\/\/habrastorage.org\/webt\/pp\/xx\/0y\/ppxx0yi2f6viesaw5q5scmxl1mu.jpeg","https:\/\/habrastorage.org\/webt\/ry\/eg\/zb\/ryegzb1fkppn1nllxloiqzjd9le.jpeg","https:\/\/habrastorage.org\/webt\/4q\/gb\/0x\/4qgb0xshn5lxnuc3eyuqb9j6xxi.jpeg","https:\/\/habrastorage.org\/webt\/zv\/nj\/6q\/zvnj6qffcio68biuzjgsxjr0bau.jpeg","https:\/\/habrastorage.org\/webt\/lm\/2c\/nl\/lm2cnlzge9lu-3-oqq6dmbhtclo.jpeg","https:\/\/habrastorage.org\/webt\/ks\/oy\/so\/ksoysogjqnxxcjeyhsuhuzzprq0.jpeg","https:\/\/habrastorage.org\/webt\/r3\/3o\/ph\/r33oph19l_ck3ibskjd0-qqqq5m.jpeg","https:\/\/habrastorage.org\/webt\/0t\/gb\/gt\/0tgbgtakij4edf5oyxuf2x-knfs.jpeg","https:\/\/habrastorage.org\/webt\/bj\/ez\/oo\/bjezoonjmvwwgoliudblncmktsw.jpeg","https:\/\/habrastorage.org\/webt\/rf\/cm\/bn\/rfcmbnisl78ihsu2va5j0atkulo.jpeg","https:\/\/habrastorage.org\/webt\/d_\/gr\/pi\/d_grpigjqmd2hy-1pwebcx_8maq.jpeg","https:\/\/habrastorage.org\/webt\/qp\/hh\/zn\/qphhzndfso8nve9ftd63ncckco4.jpeg","https:\/\/habrastorage.org\/webt\/xh\/v-\/ge\/xhv-gezaesqmvbvlydr4_1mhg9q.jpeg","https:\/\/habrastorage.org\/webt\/ip\/9g\/-e\/ip9g-egv9ik9ygljw4v3fglwruk.jpeg","https:\/\/habrastorage.org\/webt\/gq\/lv\/bj\/gqlvbjh-0ilbyr7jmbyjszvz0wy.jpeg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Вячеслав Смирнов. Профилирование JVM в Kubernetes" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Вячеслав Смирнов. Профилирование JVM в Kubernetes" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Вячеслав Смирнов. Профилирование JVM в Kubernetes" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.
Вячеславу повезло использовать разные инструменты. И..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.
Вячеславу повезло использовать разные инструменты. И..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.
Вячеславу повезло использовать разные инструменты. И..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.
Вячеславу повезло использовать разные инструменты. И..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.
Вячеславу повезло использовать разные инструменты. И..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="583162" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-13T07:14:43.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/583162/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/583162/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/chemtech/" title="chemtech" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/e18/935/57e/e1893557eeaacf388b0e596d910014c8.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/chemtech/" class="tm-user-info__username">
      chemtech
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-13T07:14:43.000Z" title="2021-10-13, 10:14">13  октября   в 10:14</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Вячеслав Смирнов. Профилирование JVM в Kubernetes</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/java/" class="tm-article-snippet__hubs-item-link"><span>Java</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/kubernetes/" class="tm-article-snippet__hubs-item-link"><span>Kubernetes</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p>Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.</p><br/>
<p>Вячеславу повезло использовать разные инструменты. И повезло найти разные дефекты микросервисов на основе JVM. Спикер проанализировал, разделил инструменты и дефекты микросервисов на группы, и хочет рассказать о:</p><br/>
<ul>
<li>подборе профайлеров и их настройках под задачу;</li>
<li>собранных рецептах профилирования JVM в Kubernetes;</li>
<li>моментах, когда профилирование вредит, а когда помогает.</li>
</ul><a name="habracut"></a><br/>
<p>Видео:</p><br/>
<div class="oembed"><div class="tm-iframe_temp" data-src="https://embedd.srv.habr.com/iframe/61668741ad041b3b9bfdc792" data-style="" id="61668741ad041b3b9bfdc792" width=""></div></div><br/>
<ul>
<li><p>(Сергей Бойцов) Я бы хотел начать с легкого, разгоняющего вопроса. Микросервисы и Kubernetes – это наша новая реальность. Вы согласны с этим?</p><br/>
</li>
<li><p>(Вячеслав Смирнов) Скорее всего, да. Микросервисы есть сейчас почти во всех проектах так или иначе. Их выделают, даже если это большие сервисы, т. е. макросервисы, упакованные в контейнеры и раскатанные с помощью Kubernetes, чтобы они лучше масштабировались. Все равно их называют микросервисами. Так что эта новая реальность. </p><br/>
</li>
<li><p>(Владимир Ситников) Я вижу, что люди движутся и в одну, и другую сторону. Кто-то движется в сторону разделения, кто-то уже попробовал и движется в противоположную сторону, поэтому предсказывать, что будет через 5-10 лет я бы не стал. Я бы Вячеславу задал бы следующий вопрос. Когда был один монолит, то его как-то разработали, потом администраторы устанавливали и единороги-нагрузочники тестировали под нагрузкой. Когда делят на микросервисы, команды говорят, что мы сами с усами, все сами сделаем, все сами протестируем и не приставайте к нам. Слава, когда возникает Kubernetes, там нагрузочники вымирают или нет?</p><br/>
</li>
<li><p>(Вячеслав Смирнов) Не совсем. Есть множество технологий, которые обещают, что тестирование производительности не понадобится, но тестирование производительности нужно и профилирование в том числе, как некий такой следующий шаг после того, как вы получили результаты и они вам не понравились. Этот этап все равно остается. И о нем я как раз хочу рассказать.</p><br/>
</li>
<li><p>(Сергей Бойцов) Здорово! Давайте тогда послушаем. Очень интересно. Задавайте вопросы в Телеграм-чат, чтобы что-то узнать, чему-то научиться. Потому что самое плохое – это незаданный вопрос. </p><br/>
</li>
<li><p>(Вячеслав Смирнов) Начнем.</p><br/>
</li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-src="https://habrastorage.org/webt/hn/ko/y8/hnkoy8r68jeazhjtozsvwrxx5me.jpeg" data-blurred="true"/></p><br/>
<p>Я вам расскажу про профилирование JVM в Kubernetes. Я назвал этот доклад «Три больших шага». Меня зовут Вячеслав и я из ВТБ.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/no/yo/14/noyo14dncvmsz8etcbvlykvddqc.jpeg" data-src="https://habrastorage.org/webt/no/yo/14/noyo14dncvmsz8etcbvlykvddqc.jpeg" data-blurred="true"/></p><br/>
<p>В ВТБ занимаюсь тем, что исследую и создаю результаты нагрузки. Проект у меня называется ДБО. Если вам интересно, то зайдите на сайт vtbbo.ru.</p><br/>
<p>Кроме работы занимаюсь развитием чата @qa_load, где помогаю инженерам. Помогаю я не один. Там мы делимся опытом. Отвечаем на вопросы тех, кто впервые начал заниматься тестированием производительности. У них вопросов много. Мы общаемся достаточно дружелюбно. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pa/ce/ll/pacellg1cksokuumrupaltjwpmy.jpeg" data-src="https://habrastorage.org/webt/pa/ce/ll/pacellg1cksokuumrupaltjwpmy.jpeg" data-blurred="true"/></p><br/>
<p>Проект, который мы нагружаем, можно описать в двух словах. Это 100 Java Virtual Machines, работающие друг с другом и с базой данной. Это так на тестовом стенде. </p><br/>
<p>На продуктивном стенде он гораздо мощнее, он геораспределенный. Там более 200 микросервисов. С учетом геораспределения можно сказать, что даже более 400, но они так или иначе совпадают с тем, что есть на тестовом стенде. </p><br/>
<p>Доклад посвящен как раз профилированию на тестовом стенде, где вам можно в любой момент перезапустить поду, поменять какие-то настройки, поэкспериментировать, поэтому он пригодится в таком случае. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/-8/eu/te/-8eute6bkrpgmrwly6qrungumwu.jpeg" data-src="https://habrastorage.org/webt/-8/eu/te/-8eute6bkrpgmrwly6qrungumwu.jpeg" data-blurred="true"/></p><br/>
<p>Расскажу про особенности профилирования JVM в Kubernetes. Что же именно добавил Kubernetes? </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/fy/vw/qn/fyvwqnlxidncyzyl5yf29pkh9zo.jpeg" data-src="https://habrastorage.org/webt/fy/vw/qn/fyvwqnlxidncyzyl5yf29pkh9zo.jpeg" data-blurred="true"/></p><br/>
<p>Kubernetes добавил выделение ресурсов для нужд профилирования: что есть различные requests, есть различные лимиты и об этом надо помнить.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/aq/cm/hi/aqcmhi1x4ii3mja-gzsilztu8u0.jpeg" data-src="https://habrastorage.org/webt/aq/cm/hi/aqcmhi1x4ii3mja-gzsilztu8u0.jpeg" data-blurred="true"/></p><br/>
<p>Расскажу о том, как выполнять анализ результатов, как перейти от анализа потоков к детализации что же в этом потоке выполняется и перейти на код. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/at/_d/qg/at_dqghy94xma1hxtqnvrucxpdm.jpeg" data-src="https://habrastorage.org/webt/at/_d/qg/at_dqghy94xma1hxtqnvrucxpdm.jpeg" data-blurred="true"/></p><br/>
<p>Тут будет интересный момент, как оценить взаимодействие микросервисов. Например, есть медленно работающий запрос. Он работает медленно, потому что мы ждем ответа от другого сервиса.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bw/9z/v7/bw9zv7quv5invqoahxjiwnxc5t0.jpeg" data-src="https://habrastorage.org/webt/bw/9z/v7/bw9zv7quv5invqoahxjiwnxc5t0.jpeg" data-blurred="true"/></p><br/>
<p>И расскажу, как стандартизировать процесс профилирования в большой команде. У нас в команде 6 человек. Ее уже можно назвать большой командой. Я не везде такие команды видел. Тут уже требуется масштабирование. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/n6/yb/0i/n6yb0i_cemtrulu9t-swaq7l7z0.jpeg" data-src="https://habrastorage.org/webt/n6/yb/0i/n6yb0i_cemtrulu9t-swaq7l7z0.jpeg" data-blurred="true"/></p><br/>
<p>И следующий этап – это обмен знаниями, т. е. как масштабировать, как обменяться знаниями, как стандартизировать все, чтобы процесс мог выполнять любой человек на любом количестве контуров, пусть у вас даже 3 Kubernetes-кластеров.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/jq/fx/lg/jqfxlgdqjt-g6lu0tltbx1hshpw.jpeg" data-src="https://habrastorage.org/webt/jq/fx/lg/jqfxlgdqjt-g6lu0tltbx1hshpw.jpeg" data-blurred="true"/></p><br/>
<p>Доклад можно представить, как сложный пазл. И мы по кусочкам будем его собирать. Расскажу про мелкие детали и про крупные блоки. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rg/dl/wy/rgdlwydjpktsp3qdjoe7zb2rob4.jpeg" data-src="https://habrastorage.org/webt/rg/dl/wy/rgdlwydjpktsp3qdjoe7zb2rob4.jpeg" data-blurred="true"/></p><br/>
<p>Начнем с первого этапа. Какие есть в Kubernetes особенности при профилировании? Что он добавляет сам Kubernetes в весь процесс?</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ue/uc/vr/ueucvr86lmuossfg2c3zqfzdzry.jpeg" data-src="https://habrastorage.org/webt/ue/uc/vr/ueucvr86lmuossfg2c3zqfzdzry.jpeg" data-blurred="true"/></p><br/>
<p>Раньше мы проводили два вида тестирования: нагрузочный и стабильности, т. е. находили максимум во время нагрузки. И во время стабильности подтверждаем, что в найденном максимуме 8-10 часов держится система и не падает.</p><br/>
<p>А теперь, как минимум, нужно еще тестирование масштабируемости.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/1f/6l/qb/1f6lqbeawdsvhb31ql_xujtfioo.jpeg" data-src="https://habrastorage.org/webt/1f/6l/qb/1f6lqbeawdsvhb31ql_xujtfioo.jpeg" data-blurred="true"/></p><br/>
<p>После того, как вы провели 3 вида тестирования, во всем этом есть еще одна особенность. Заказчику интересно уже не только число, что мы достигаем такой-то производительности. Важен и второй фактор. Заказчик спрашивает: «Сколько реплик сервису нужно? Какие настройки нужны? Сколько ресурсов нам нужно на кластер, чтобы все это работало достаточно производительно». Т. е. появляются дополнительные вопросы. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rs/sg/gk/rssggk75w04ddavxozg43awhzie.jpeg" data-src="https://habrastorage.org/webt/rs/sg/gk/rssggk75w04ddavxozg43awhzie.jpeg" data-blurred="true"/></p><br/>
<p>Самый легкий – это вопрос настроек, т. е. мы ничего не масштабируем, а меняем настройки. Поменяли некоторые конфигурации и все стало быстрее. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/em/tx/z2/emtxz2pxcgyzmabgmqv7h804zpw.jpeg" data-src="https://habrastorage.org/webt/em/tx/z2/emtxz2pxcgyzmabgmqv7h804zpw.jpeg" data-blurred="true"/></p><br/>
<p>Если мы настройками справиться не можем и натыкаемся на то, что на тестовом стенде закончились ресурсы, то появляется интересная задача – ускорение всей этой системы. </p><br/>
<p>Мне очень повезло. Я попал в команду ВТБ, когда как раз этих ресурсов не хватало, и команда занималась ускорением. Поэтому я набрался опыта по ускорению Kubernetes-кластера. И первое время занимался не столько рутинной работой по запуску тестов, сколько профилированием. И могу поделиться этим. </p><br/>
<p>Когда вы начнете ускорение, сначала нужно посмотреть на результаты мониторинга, на логи. И, предположим, вы по результату мониторинга, по логам, по высокоуровневым метрикам не смогли найти способ оптимизировать систему. Условно, есть у нас кластер, 10 серверов. В него влезает 100 сервисов. Зафиксировали, промониторили и так ничего не смогли найти. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ci/cw/r8/cicwr8ggfvoj9d1htdfhbksfrw8.jpeg" data-src="https://habrastorage.org/webt/ci/cw/r8/cicwr8ggfvoj9d1htdfhbksfrw8.jpeg" data-blurred="true"/></p><br/>
<p>Тогда уже можно подключить профайлер. Можно не сильно масштабировать. И можно посмотреть изнутри JVM с помощью профайлера изменение каких настроек нам сможет помочь все это ускорить и сократить ресурсы. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/-5/66/vo/-566vo__nnajd120lysm07mzn90.jpeg" data-src="https://habrastorage.org/webt/-5/66/vo/-566vo__nnajd120lysm07mzn90.jpeg" data-blurred="true"/></p><br/>
<p>Я несколько раз сказал уже о настройках. В Kubernetes принято увеличивать производительность системы очень просто, т. е. увеличивать количество реплик. Считается, что 2 реплики работают быстрее, чем одна. Но на самом деле нет. </p><br/>
<p>Есть способ не увеличивать количество реплик, а увеличивать количество потоков внутри каждой реплики. Если мы говорим про JVM, то тут, как правило не однопоточное приложение, а многопоточное. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pz/xy/jo/pzxyjoozcc7iqxdc7ilye3orus0.jpeg" data-src="https://habrastorage.org/webt/pz/xy/jo/pzxyjoozcc7iqxdc7ilye3orus0.jpeg" data-blurred="true"/></p><br/>
<p>Я написал несложный алгоритм, чтобы понять нужно ли нам сейчас реплики увеличивать или нет.</p><br/>
<p>Если у нас приложение однопоточное, но упакованное в Kubernetes и у нас нет возможности количество потоков изменить, то чтобы его масштабировать, будем увеличивать количество реплик. И это черный прямоугольник снизу. </p><br/>
<p>А если количество потоков можно менять, то стоит попробовать их увеличить или уменьшить, т. е. как-то настроить, чтобы добиться лучшей производительности. </p><br/>
<p>Если производительность при этом увеличивается и после увеличения пула потоков у нас все еще есть свободные ресурсы, то можем этот процесс повторять до тех пор, пока мы не упремся в лимит нашего контейнера, в лимит нашей поды.</p><br/>
<p>И когда мы уже уперлись в лимит нашей поды (можем создавать там 2-3-4 поды), то мы знаем, что для 50 потоков нужна такая конфигурация. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/eb/ai/lu/ebailuzkmgbw455pa4avsqrti3u.jpeg" data-src="https://habrastorage.org/webt/eb/ai/lu/ebailuzkmgbw455pa4avsqrti3u.jpeg" data-blurred="true"/></p><br/>
<p>При увеличении количества реплик аналогичная ситуация. Если мы изменяем количество реплик, и становится быстрее, и при этом у нас еще есть свободные ресурсы, то мы можем этот процесс наращивать, т. е. проводить тестирование масштабируемости.</p><br/>
<p>А если мы увеличиваем количество реплик, например, сделали вместо одной две, но быстрее не становится, то это второй момент, когда нам нужно подключить профайлер или какие-то другие инструменты, которые нам помогут узнать, почему не становится быстрее. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/69/ck/pk/69ckpkrzaa1bilzcohazqfzeeho.jpeg" data-src="https://habrastorage.org/webt/69/ck/pk/69ckpkrzaa1bilzcohazqfzeeho.jpeg" data-blurred="true"/></p><br/>
<p>Какие это могут быть инструменты? Это тоже хороший вопрос. В Kubernetes не все так однозначно. Иногда Kubernetes JVM профайлер не нужен.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/lt/ma/wx/ltmawxervogkegzhaz-guekjcms.jpeg" data-src="https://habrastorage.org/webt/lt/ma/wx/ltmawxervogkegzhaz-guekjcms.jpeg" data-blurred="true"/></p><br/>
<ol>
<li>Есть цикл тестирования, где мы сначала проводим регрессионный тест, т. е. просто сравниваем. Например, была версия 1, у нее производительность стала версия 2. И ее метрики в JMeter, Gatling сравниваем. И можем определить узкое место, если видим деградацию по той дельте изменений, которая была между версией 1 и версией 2. И даже можем определить место, которое сильнее всего тормозит. </li>
<li>Если нужно копнуть глубже, то нужно посмотреть на статистику балансировщика нагрузки, детализацию по логам ошибок, если вдруг в новой версии появились ошибки. </li>
<li>Можем посмотреть на бизнес-метрики производительности. Например, посмотреть в Яндекс.Метрике, Google Analytics, как там пользователь на prod’е чувствует себя. В нашем проекте есть встроенные метрики внутренней производительности. </li>
<li>Кроме этих метрик, как правило, во всех Kubernetes-инсталляциях есть такие сервисы, как Zipkin, Jaeger, которые собирают статистику за счет трассировки запросов при передачи их от микросервиса к сервису. Это более детальная статистика, чем даже в самом JMeter. </li>
<li>Кроме того, не стоит забывать про мониторинг системных метрик. </li>
<li>Мониторинг более внутренних метрик, например, внутри JML, SQL</li>
<li>И если после всего этого объема информации вам недостаточно, то тогда 7-ым этапом можно запрофилировать JVM. </li>
<li>Профилировщик сможет найти не все. Иногда в моей практике пригождаются утилиты strace, perf и другие, которые позволяют найти то, что изнутри JVM не видно. </li>
</ol><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ut/yp/sy/utypsyb5bqbndmilhkg7_yi-xnw.jpeg" data-src="https://habrastorage.org/webt/ut/yp/sy/utypsyb5bqbndmilhkg7_yi-xnw.jpeg" data-blurred="true"/></p><br/>
<p>Если это визуализировать как-то в картинку, то визуализацию я смогу для вас изобразить вот такую. </p><br/>
<p>Вот у вас есть браузер, т. е. клиент. Этот браузер обращается к вашему сервису. Он представляет из себя 4 сервиса переднего уровня и там есть 100 микросервисов на бэке. </p><br/>
<p>И нам нужно определить, какой микросервис самый медленный. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/me/nl/ec/menleca841tcol15pzhtkoptijm.jpeg" data-src="https://habrastorage.org/webt/me/nl/ec/menleca841tcol15pzhtkoptijm.jpeg" data-blurred="true"/></p><br/>
<p>Чтобы это определить, нам не обязательно использовать профилировщик. Нам хватит отчета по нагрузке. Т. е. такая статистика будет в JMeter, Gatling. А также бизнес-метрики или даже статистики по логам. В том же nginx можно настроить детальное логирование. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/8b/2r/qu/8b2rquowmcgk7zjs3f7ctqqip3g.jpeg" data-src="https://habrastorage.org/webt/8b/2r/qu/8b2rquowmcgk7zjs3f7ctqqip3g.jpeg" data-blurred="true"/></p><br/>
<p>Предположим, вам нужно определить, при каких параметрам этого запроса данный микросервис более медленный.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/d0/0t/fo/d00tfocuhv-mppwu4m0ry-ongtq.jpeg" data-src="https://habrastorage.org/webt/d0/0t/fo/d00tfocuhv-mppwu4m0ry-ongtq.jpeg" data-blurred="true"/></p><br/>
<p>Это в отчете по нагрузке, если вы эти параметры использовали или в более детальных логах. Там можно уровень логирования поднять и узнать все детали, т. е. какой же параметр приводит к замедлению. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/z7/r2/6b/z7r26b02hn-uawasgkfbssbsope.jpeg" data-src="https://habrastorage.org/webt/z7/r2/6b/z7r26b02hn-uawasgkfbssbsope.jpeg" data-blurred="true"/></p><br/>
<p>Если бы у нас был монолит, мы бы тыкали в какую-нибудь url монолита и желали узнать, что внутри приложения тормозит, т. е. какой модуль, компонент, то, скорее всего, мы бы взяли профайлер. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/fz/cd/8g/fzcd8g9zai1ux-dch6rtt2wz5ms.jpeg" data-src="https://habrastorage.org/webt/fz/cd/8g/fzcd8g9zai1ux-dch6rtt2wz5ms.jpeg" data-blurred="true"/></p><br/>
<p>Мы бы профилировали этот монолит и сказали, что тормозит. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ad/b4/o1/adb4o1q66jgx0afilusmault95w.jpeg" data-src="https://habrastorage.org/webt/ad/b4/o1/adb4o1q66jgx0afilusmault95w.jpeg" data-blurred="true"/></p><br/>
<p>А с микросервисами не так все просто. Нет единого исполняемого файла. У нас целая россыпь микросервисов. Они общаются друг с другом. Каждый из них может самостоятельно ходить в базу и другие системы. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rl/fj/mv/rlfjmvtlu7czo866k0reyekmpxq.jpeg" data-src="https://habrastorage.org/webt/rl/fj/mv/rlfjmvtlu7czo866k0reyekmpxq.jpeg" data-blurred="true"/></p><br/>
<p>И тут очень полезными являются инструменты Zipkin и Jaeger, которые трассируют запросы между сервисами и предоставляют полезную статистику. </p><br/>
<p>О чем я? О том, что профайлер нужен не всегда. Иногда могут пригодиться и другие инструменты, чтобы закрыть все ваши нужды. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/r2/zr/_q/r2zr_qyrsnbxforlbmsf6uvf09q.jpeg" data-src="https://habrastorage.org/webt/r2/zr/_q/r2zr_qyrsnbxforlbmsf6uvf09q.jpeg" data-blurred="true"/></p><br/>
<p>Чуть ранее я упоминал о особенности Kubernetes, что при начальном масштабировании мы можем увеличивать количество потоков.</p><br/>
<p>Но бывает и обратная ситуация, когда потоков внутри нашего приложения изначально очень много, т. е. больше, чем нужно. И если мы занялись профилированием, и мой доклад об этом, то расскажу вам, как влияет количество ненужных потоков на эффективность профилирования. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/jx/ww/4a/jxww4at_gvfph3dyxu5nvheoqum.jpeg" data-src="https://habrastorage.org/webt/jx/ww/4a/jxww4at_gvfph3dyxu5nvheoqum.jpeg" data-blurred="true"/></p><br/>
<p>Самый частый способ профилирования, который использую я, это вычисление процента активности того или иного метода. Делается это, как правило семплированием. </p><br/>
<p>В JFR, SJK, AsyncProfiler, VisualVM и т. д. есть режим семплирования. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ez/eo/bi/ezeobiclkpy1rtwsw7plzhmmfai.jpeg" data-src="https://habrastorage.org/webt/ez/eo/bi/ezeobiclkpy1rtwsw7plzhmmfai.jpeg" data-blurred="true"/></p><br/>
<p>Если вы не знаете, что это такое, то вы наверняка знаете, что такое Stack Trace. Видели это в логах или в различных инструментах. Это последовательность вызовов Java-методов. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xg/gs/cc/xggsccv90e3ydb1_-wfsq0u1wfs.jpeg" data-src="https://habrastorage.org/webt/xg/gs/cc/xggsccv90e3ydb1_-wfsq0u1wfs.jpeg" data-blurred="true"/></p><br/>
<p>И если накопить статистику по этим Stack Trace, то можно что-то понять. Например, вот у нас 4 раза метод putVal, 8 раз метод sample в строчке 613. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/7s/xm/a5/7sxma5tbbst7xvkh7z6ohyjctro.jpeg" data-src="https://habrastorage.org/webt/7s/xm/a5/7sxma5tbbst7xvkh7z6ohyjctro.jpeg" data-blurred="true"/></p><br/>
<p>Я накапливаю, накапливаю и получаю статистику, какие методы у меня более часто встречаются во время работы потока, какие менее часто. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hx/eq/iy/hxeqiyh3u2li6ztyk9_seazgvyi.jpeg" data-src="https://habrastorage.org/webt/hx/eq/iy/hxeqiyh3u2li6ztyk9_seazgvyi.jpeg" data-blurred="true"/></p><br/>
<p>И как на сбор этой статистики, т. е. на процесс семплирования, влияет количество потоков? Чтобы это определить, я собрал небольшой тестовый стенд. У меня был один сервис, принимающий запросы по http. В нем можно было менять количество потоков от 200 (по умолчанию) до 5. И использовать JMeter, который подавал нагрузку всего лишь тремя потоками. Т. е. чтобы со всеми этими запросами справится, сервису достаточно тоже всего лишь 3 потока у себя. Все остальные спали и ждали, когда к ним перепадет запрос и перепрофилироваться с помощью SJK.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/0t/fg/bg/0tfgbg5j69e6hkcsmwxofzb6m9k.jpeg" data-src="https://habrastorage.org/webt/0t/fg/bg/0tfgbg5j69e6hkcsmwxofzb6m9k.jpeg" data-blurred="true"/></p><br/>
<p>Какие результаты я получил? Получил такие результаты, что запросы в среднем выполнялись 100 миллисекунд. Самые тяжелые методы – 10 миллисекунд. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/dw/my/vz/dwmyvz-0afchhl4zuousixldfh8.jpeg" data-src="https://habrastorage.org/webt/dw/my/vz/dwmyvz-0afchhl4zuousixldfh8.jpeg" data-blurred="true"/></p><br/>
<p>И когда у меня было 120 лишних потоков, то SJK, профилируя все активные потоки, в том числе 120 спящих, собирал метрики с интенсивностью 90 раз в секунду. Получается, что в среднем каждые 11 миллисекунд он лишь собирал stack trace. </p><br/>
<p>При такой интенсивности он мог легко пропустить Java-методы, которые работают даже в среднем быстрее. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zt/9j/do/zt9jdolj-2ob45jrzlxilqpjjtg.jpeg" data-src="https://habrastorage.org/webt/zt/9j/do/zt9jdolj-2ob45jrzlxilqpjjtg.jpeg" data-blurred="true"/></p><br/>
<p>Конечно, он ловит все http-запросы, т. е. кто их отправляет и как долго ждет, а Java-методы может легко пропустить. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/v_/cr/hq/v_crhqlaf2mkeqp3t4nfiydzxd8.jpeg" data-src="https://habrastorage.org/webt/v_/cr/hq/v_crhqlaf2mkeqp3t4nfiydzxd8.jpeg" data-blurred="true"/></p><br/>
<p>Если снизить количество потоков до 20, оставить только 20 спящих, то частота семплирования гораздо выше становилась. И уже интервал семплирования снижался до 3 миллисекунд. Это значит, что туда попадали даже те методы Java, которые быстрее, чем средние. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ko/zb/z2/kozbz2nh_164ot54ppj1vzjgd5i.jpeg" data-src="https://habrastorage.org/webt/ko/zb/z2/kozbz2nh_164ot54ppj1vzjgd5i.jpeg" data-blurred="true"/></p><br/>
<p>Результаты можно представить на таком графике. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/6a/by/tu/6abyturr-ucm3avblx9j2gjybog.jpeg" data-src="https://habrastorage.org/webt/6a/by/tu/6abyturr-ucm3avblx9j2gjybog.jpeg" data-blurred="true"/></p><br/>
<p>Я провел серию замеров. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ec/dp/rx/ecdprxigdzbocka_ie5edcfwsdi.jpeg" data-src="https://habrastorage.org/webt/ec/dp/rx/ecdprxigdzbocka_ie5edcfwsdi.jpeg" data-blurred="true"/></p><br/>
<p>Если снизить количество потоков со 120 до 20, то у нас интенсивность семплирования повышается в 3 раза.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hl/ch/ha/hlchhadip95mvx6lde19gvo7c5s.jpeg" data-src="https://habrastorage.org/webt/hl/ch/ha/hlchhadip95mvx6lde19gvo7c5s.jpeg" data-blurred="true"/></p><br/>
<p>А по умолчанию tomcat.mat-threads – это 200 потоков. </p><br/>
<p>Если постепенно снижаться с 200 до 5, то интенсивность повышается в 5 раз. Это о том, что не только увеличение количества потоков полезно. Для задач профилирования снижение – это тоже интересный момент, хоть и неочевидный.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/dk/3i/9g/dk3i9guxkkh1cde_zjbkdrbk7vu.jpeg" data-src="https://habrastorage.org/webt/dk/3i/9g/dk3i9guxkkh1cde_zjbkdrbk7vu.jpeg" data-blurred="true"/></p><br/>
<p>Какая получалась частота семплирования в SJK? Я измерял с помощью команды ssa, которая есть в SJK. Это Stack Analyzer. Выводил колонку интенсивности, которая получилась. И смотрел, что по интенсивности получается. В данном случае почти 60 раз в секунду.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/5d/ij/ix/5dijixusurfrqnkpk--rr4zv40w.jpeg" data-src="https://habrastorage.org/webt/5d/ij/ix/5dijixusurfrqnkpk--rr4zv40w.jpeg" data-blurred="true"/></p><br/>
<p>Следующей особенностью в Kubernetes является влияние CPU Limit на профилирование и на сам процесс профилирования. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/d-/tl/tw/d-tltwba3ewxip9b5ma82iog7wk.jpeg" data-src="https://habrastorage.org/webt/d-/tl/tw/d-tltwba3ewxip9b5ma82iog7wk.jpeg" data-blurred="true"/></p><br/>
<p>Я использовал тот же самый стенд, но в нем ограничил возможности использования процессора данным сервисом до 1 ядра. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xe/ny/fu/xenyfuuixezdfu-ijy16tivghyi.jpeg" data-src="https://habrastorage.org/webt/xe/ny/fu/xenyfuuixezdfu-ijy16tivghyi.jpeg" data-blurred="true"/></p><br/>
<p>Получились следующие результаты. Когда я не ограничивал, то я собирал интенсивность метрики 90 раз в секунду, а как ограничил, и весь сервис замедлился, то интенсивность профилирования снизилась. Стало всего лишь 7 раз в секунду. И с такой интенсивностью я не поймаю различные супербыстрые метрики. Т. е. при неправильной настроенном лимите и запуске профилирования можно хорошие метрики не собрать.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/nr/4k/0g/nr4k0gjy_cm5abykzmeh5cx1x94.jpeg" data-src="https://habrastorage.org/webt/nr/4k/0g/nr4k0gjy_cm5abykzmeh5cx1x94.jpeg" data-blurred="true"/></p><br/>
<p>Примеры показали, что SJK на большом количестве потоков затрачивает где-то 0,36 ядра. Об этом надо помнить. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ac/-a/bw/ac-abwzfp_kwlr-myugumevx6-k.jpeg" data-src="https://habrastorage.org/webt/ac/-a/bw/ac-abwzfp_kwlr-myugumevx6-k.jpeg" data-blurred="true"/></p><br/>
<p>И если вы начали профилирование в Kubernetes, то чуть-чуть добавьте для накладных расходов самого профайлера CPU, т. е. поднимите лимит. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/je/jp/vp/jejpvpqi6ba_kh5cktlhoqlk2nw.jpeg" data-src="https://habrastorage.org/webt/je/jp/vp/jejpvpqi6ba_kh5cktlhoqlk2nw.jpeg" data-blurred="true"/></p><br/>
<p>Если вы не можете поднять, то можете просто снизить интенсивность семплирования. Это настраивается во всех профайлерах. В VisualVM, например, интенсивность семплирования по умолчанию 100 миллисекунд. И такую же интенсивность можно задать во всех других профайлерах. Но в этом случае вам нужно будет профилировать чуть подольше. Не 10-30 секунд, а, например, 10 минут профилировать.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bz/3d/_x/bz3d_xjbzgvmq5b1hdvjrcxadxm.jpeg" data-src="https://habrastorage.org/webt/bz/3d/_x/bz3d_xjbzgvmq5b1hdvjrcxadxm.jpeg" data-blurred="true"/></p><br/>
<p>Кроме CPU Limit в Docker и Kubernetes есть Memory Limit. Он также влияет на профайлер, но уже на другие. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ur/zj/pr/urzjprtm956dvkebbpdqmixc4da.jpeg" data-src="https://habrastorage.org/webt/ur/zj/pr/urzjprtm956dvkebbpdqmixc4da.jpeg" data-blurred="true"/></p><br/>
<p>Здесь несколько иная задача профилирования. Задача посчитать не просто процент активности, а посчитать точную длительность и количество выполнений каждого метода. И это позволяют уже выполнить инструментирующие профайлеры. </p><br/>
<p>Среди тех, которые я успешно пробовал, могу назвать VisualVM. В режиме Startup Profiler его можно подключить и запрофилировать в таком инструментирующем виде. А также JProfiler и YourKit Java Profiler.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/iw/n8/gz/iwn8gzq1_-zikndj9kslg1zc7g8.jpeg" data-src="https://habrastorage.org/webt/iw/n8/gz/iwn8gzq1_-zikndj9kslg1zc7g8.jpeg" data-blurred="true"/></p><br/>
<p>Что такое инструментация? Если ее описывать в виде схемы, то это непростой процесс при работе с JVM профайлером. Например, для C проектов инструментация есть на уровне компилятора. В GCC вы можете заинструментировать компилируемый код и получить там какие-то метрики. И все эти метрики будут на уровне исходников туда вшиты, и выполняться до запуска. </p><br/>
<p>А при JVM инструментации более популярен подход на лету с помощью JVM-агентов, когда меняется JVM Byte-код. Это уникальная фишка JVM. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/br/_z/qv/br_zqvbb1zfcxqojjp-glpnvwqo.jpeg" data-src="https://habrastorage.org/webt/br/_z/qv/br_zqvbb1zfcxqojjp-glpnvwqo.jpeg" data-blurred="true"/></p><br/>
<p>Когда ваше приложение запустилось, в нем уже 1 000 классов, различные объекты, и вы начинаете каждый класс перелопачивать, т. е. до запуска каждого метода вставлять некий быстрый, но все же код, то это все потребует дополнительных расходов памяти. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/fk/d5/v5/fkd5v53vfw535q-s6kcanqbhipw.jpeg" data-src="https://habrastorage.org/webt/fk/d5/v5/fkd5v53vfw535q-s6kcanqbhipw.jpeg" data-blurred="true"/></p><br/>
<p>И сам процесс инструментации потребует дополнительных расходов процессора. </p><br/>
<p>Мы сталкивались в команде с такими эффектами, что приложение падало из-за недостатка ресурсов памяти, если сделали вот такое инструментирующие профилирование. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ez/sd/qu/ezsdqu_gsg5t2tv7rguza6tnx7y.jpeg" data-src="https://habrastorage.org/webt/ez/sd/qu/ezsdqu_gsg5t2tv7rguza6tnx7y.jpeg" data-blurred="true"/></p><br/>
<p>Тут общая рекомендация, что если вы запускаете еще инструментирующее профилирование с помощью JVM-агента, то добавьте себе в поду немножко памяти тоже. </p><br/>
<p>Если вы явно не влияете в вашей поде на размер heap size, т. е. Xmx, а влияете только на лимит. Например, Xmx вычисляется с помощью MAX_MEM_RATIO, есть такая опция в некоторых контейнерах. И чтобы добавить 1 гигабайт, вам нужно лимит поднять на + 2 гигабайта. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/mf/mh/ag/mfmhagbahjpvucxqhhuhmdp3mom.jpeg" data-src="https://habrastorage.org/webt/mf/mh/ag/mfmhagbahjpvucxqhhuhmdp3mom.jpeg" data-blurred="true"/></p><br/>
<p>Так или иначе помните, что нужно добавлять ресурсы, если вы делаете тяжелое профилирование. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xg/dw/gw/xgdwgwqbitjwambd7m5xey00nhw.jpeg" data-src="https://habrastorage.org/webt/xg/dw/gw/xgdwgwqbitjwambd7m5xey00nhw.jpeg" data-blurred="true"/></p><br/>
<p>Почему это важно? Что это за такие ресурсы? Можно описать это двумя словами.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/vp/bb/sf/vpbbsfxd4iimvon-fumqlrdbpe0.jpeg" data-src="https://habrastorage.org/webt/vp/bb/sf/vpbbsfxd4iimvon-fumqlrdbpe0.jpeg" data-blurred="true"/></p><br/>
<p>Вот здесь request, т. е. внутренняя граница контейнера. И есть лимит – внешняя граница контейнера. </p><br/>
<p>Для контейнера можно задавать только request – это первая картинка. И делать его изначально маленьким. </p><br/>
<p>Можно задавать маленький request и достаточно крупный лимит – это вторая картинка. </p><br/>
<p>Некоторые выбирают стратегию, когда request практически равен лимиту и он изначально большой. </p><br/>
<p>Некоторые выбирают, когда request огромный, а лимит не задан. Это для тяжелых гибких сервисов.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/oc/7k/ty/oc7ktyjyeruv_87sntqhaurbfag.jpeg" data-src="https://habrastorage.org/webt/oc/7k/ty/oc7ktyjyeruv_87sntqhaurbfag.jpeg" data-blurred="true"/></p><br/>
<p>А рекомендация – накинуть 1 гигабайт и 1 гигабайт CPU. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ob/ok/nk/oboknkoqudqd65v8ct-ra6gajke.jpeg" data-src="https://habrastorage.org/webt/ob/ok/nk/oboknkoqudqd65v8ct-ra6gajke.jpeg" data-blurred="true"/></p><br/>
<p>Что будет, если мы не накинем и у нас есть вот такая инсталляция, где есть профилируемые сервисы и в двух из них лимиты не заданы? </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/el/7e/og/el7eog7bhmsoo6uqfpfae85uvf0.jpeg" data-src="https://habrastorage.org/webt/el/7e/og/el7eog7bhmsoo6uqfpfae85uvf0.jpeg" data-blurred="true"/></p><br/>
<p>Сначала они будут маленькими. Под нагрузкой, конечно, сервисы начнут потреблять больше ресурсов.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/su/wm/cy/suwmcynefsoiton-igolgkiwsqk.jpeg" data-src="https://habrastorage.org/webt/su/wm/cy/suwmcynefsoiton-igolgkiwsqk.jpeg" data-blurred="true"/></p><br/>
<p>И вот они все выросли.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ju/ls/b7/julsb7wg_ofa81vx_9ayoi9ujjg.jpeg" data-src="https://habrastorage.org/webt/ju/ls/b7/julsb7wg_ofa81vx_9ayoi9ujjg.jpeg" data-blurred="true"/></p><br/>
<p>И первому центральному сервису стало не хватать ресурсов.</p><br/>
<p>Если ему не хватает CPU, то ничего страшного не случится. Как я вам рассказал, интенсивность семплирования снизится, т. е. она застынет на какой-то планке. Возможно, это будет даже 7 sample в секунду, но ничего не случится.</p><br/>
<p>А если так случилось, что в приложение выделено heap в 2 гигабайта, а у нас физически на кластере остался один гигабайт памяти, то JVM будет думать, что ей можно выделить столько памяти, а физически столько памяти нет. И контейнер, т. е. приложение упадет по out of memory error. В этом случае весь контейнер схлопнется и перезапустится. Там начнется все с начала. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xv/cw/5u/xvcw5un_udsqedu0kc3gu0p5quq.jpeg" data-src="https://habrastorage.org/webt/xv/cw/5u/xvcw5un_udsqedu0kc3gu0p5quq.jpeg" data-blurred="true"/></p><br/>
<p>Но процесс профилирования прекратиться, т. е. что-то разломается, сессию с профайлером мы потеряем.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/jf/py/es/jfpyes6uch7_fhwdjkf6s84rbiw.jpeg" data-src="https://habrastorage.org/webt/jf/py/es/jfpyes6uch7_fhwdjkf6s84rbiw.jpeg" data-blurred="true"/></p><br/>
<p>Второй случай, если у нас лимит задан, но не у всех. Сначала тоже будет все хорошо. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bl/jn/9l/bljn9lh1kxy3d3zuvhueg8febwm.jpeg" data-src="https://habrastorage.org/webt/bl/jn/9l/bljn9lh1kxy3d3zuvhueg8febwm.jpeg" data-blurred="true"/></p><br/>
<p>Мы начнем подавать нагрузку. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yj/dx/2s/yjdx2sbj7xwq3s6vitbc4l8m3ji.jpeg" data-src="https://habrastorage.org/webt/yj/dx/2s/yjdx2sbj7xwq3s6vitbc4l8m3ji.jpeg" data-blurred="true"/></p><br/>
<p>Контейнеры начнут потреблять больше ресурсов. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/vw/rg/z-/vwrgz-ohzmw4plbkxmhdpzuqdpq.jpeg" data-src="https://habrastorage.org/webt/vw/rg/z-/vwrgz-ohzmw4plbkxmhdpzuqdpq.jpeg" data-blurred="true"/></p><br/>
<p>И может так случиться, что одному из контейнеров, у которого лимит задан, ресурсов будет не хватать. </p><br/>
<p>Тут важный момент проявляется в особенностях самого Kubernetes. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/wg/nh/k2/wgnhk2qrqb4gb4a26lwnuejxfw8.jpeg" data-src="https://habrastorage.org/webt/wg/nh/k2/wgnhk2qrqb4gb4a26lwnuejxfw8.jpeg" data-blurred="true"/></p><br/>
<p>Если ресурсы можно выделить Kubernetes’у за счет того, чтобы погасить какие-либо сервисы, у которых ниже приоритет, чем у текущего, а если у нас лимит задан и приоритет выше, то Kubernetes так и поступит. Он возьмет другую поду, у которой лимит не задан и погасит ее, перезапустит ее. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/gd/tb/su/gdtbsu9k3ufavyzkeb3cdxjmrsk.jpeg" data-src="https://habrastorage.org/webt/gd/tb/su/gdtbsu9k3ufavyzkeb3cdxjmrsk.jpeg" data-blurred="true"/></p><br/>
<p>В этом случае данная пода не сломается, она получит свои ресурсы, но, возможно, сломается что-то еще. Сервис контроля доступа и профилирование или весь процесс все равно разрушатся, потому что что-то пошло не так. </p><br/>
<p>В случае, если у нас всех сервисов по одной штуке, тогда вообще бизнес-процесс остановится. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/j7/ij/fu/j7ijfurzgva2juo-vtwf8wdiatc.jpeg" data-src="https://habrastorage.org/webt/j7/ij/fu/j7ijfurzgva2juo-vtwf8wdiatc.jpeg" data-blurred="true"/></p><br/>
<p>И самый желательный вариант, когда везде лимиты заданы.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xk/a-/e1/xka-e1xa1glk-yh7vymv9y1xmi0.jpeg" data-src="https://habrastorage.org/webt/xk/a-/e1/xka-e1xa1glk-yh7vymv9y1xmi0.jpeg" data-blurred="true"/></p><br/>
<p>Мы начинаем нагрузку. Сервисы были маленькие. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/mw/yi/xv/mwyixvzc7ouauiyu-v3fsv5j5ve.jpeg" data-src="https://habrastorage.org/webt/mw/yi/xv/mwyixvzc7ouauiyu-v3fsv5j5ve.jpeg" data-blurred="true"/></p><br/>
<p>Вот они стали побольше. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bk/y8/3m/bky83mem98kkdzv7zvwgl_huhww.jpeg" data-src="https://habrastorage.org/webt/bk/y8/3m/bky83mem98kkdzv7zvwgl_huhww.jpeg" data-blurred="true"/></p><br/>
<p>И вот им ресурсов не хватило. </p><br/>
<p>Какой тут вариант? Мы знаем, что этому сервису нужно столько-то ресурсов.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/es/vy/ng/esvyngwjwqij_fua2wtdkzehvjy.jpeg" data-src="https://habrastorage.org/webt/es/vy/ng/esvyngwjwqij_fua2wtdkzehvjy.jpeg" data-blurred="true"/></p><br/>
<p>И при профилировании накидываем чуть-чуть. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ci/ql/te/ciqltefefdlfb0fbqx8si-oaiu4.jpeg" data-src="https://habrastorage.org/webt/ci/ql/te/ciqltefefdlfb0fbqx8si-oaiu4.jpeg" data-blurred="true"/></p><br/>
<p>Можно 0,3-0,4, можно +1. И все будет работать, как будто бы и не было никакого профилирования. Это такая особенность Kubernetes.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/dg/np/lv/dgnplveff9n9r9hkxgpe3dqpbxs.jpeg" data-src="https://habrastorage.org/webt/dg/np/lv/dgnplveff9n9r9hkxgpe3dqpbxs.jpeg" data-blurred="true"/></p><br/>
<p>Какие есть особенности у самих профайлеров при работе с распределенными системами?</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/jy/cc/ef/jyccef_fvympzg2kfup9r2ohp7k.jpeg" data-src="https://habrastorage.org/webt/jy/cc/ef/jyccef_fvympzg2kfup9r2ohp7k.jpeg" data-blurred="true"/></p><br/>
<p>Можно все профайлеры и способы их подключения разделить на 2 больших типа: </p><br/>
<ul>
<li>Мы подключаемся удаленно, т. е. запускаем профайлер у себя на рабочей станции и подключаемся к поде или сервису; </li>
<li>Мы подключаемся локально. </li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/0w/ms/hb/0wmshbf1acm3uidnlupe6gc0tcg.jpeg" data-src="https://habrastorage.org/webt/0w/ms/hb/0wmshbf1acm3uidnlupe6gc0tcg.jpeg" data-blurred="true"/></p><br/>
<p>Самый привычный, когда вы запускаете профайлер с графической оболочкой у себя на рабочей станции. Это удаленный вариант. </p><br/>
<p>В чем его особенности? Его особенности в том, что вам нужно пробросить сетевое подключение от вашей рабочей станции до профайлера, т. е. есть несколько фишек самого Kubernetes. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/-5/9y/g-/-59yg-kunlq-x0fudevwcprhn84.jpeg" data-src="https://habrastorage.org/webt/-5/9y/g-/-59yg-kunlq-x0fudevwcprhn84.jpeg" data-blurred="true"/></p><br/>
<ul>
<li>Предположим, вам нужен доступ до поды лишь на время. Тогда воспользуйтесь kubectl и ее опцией PortForward с пробросом локального порта в поду. <br/>
<ul>
<li>Если вам нужен постоянный доступ, то проще зафиксировать выставление порта для профилирования из пода наружу, например, задав эти настройки уже в сервисе. </li>
</ul></li>
<li>Очень удобно делать, если ваш сервис всегда заскейлен в 1. В этом случае вы всегда, начиная профилирование, будете попадать в профилируемую вами поду. <br/>
<ul>
<li>Это можно сделать через NodePort.</li>
<li>Можно сделать через LoadBalancer.</li>
</ul></li>
<li>А если вы заскейлили сервис в две реплики и хотите сделать тоже самое через внешний порт, то, скорее всего, не получится. <br/>
<ul>
<li>Потому что ваш профайлер будет обращаться за результатами профилирования в поду. И будет попадать то на первую, то на вторую. И профилирование не получится. Или получится каким-то неправильным. Это единственное такое ограничение.</li>
</ul></li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zu/jw/l_/zujwl_cdori5hc-glk_viw41yfu.jpeg" data-src="https://habrastorage.org/webt/zu/jw/l_/zujwl_cdori5hc-glk_viw41yfu.jpeg" data-blurred="true"/></p><br/>
<p>Если вы выбрали такой способ, то две техники: с помощью Java-агента и с помощью технологии JSR 160 Standard, где вам нужно открыть два порта: JMX и RMI и пробросить их себе.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yb/bv/xe/ybbvxexf5ssclntovjxgb49vrvi.jpeg" data-src="https://habrastorage.org/webt/yb/bv/xe/ybbvxexf5ssclntovjxgb49vrvi.jpeg" data-blurred="true"/></p><br/>
<p>Расскажу сначала про этот вариант. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ad/-0/dq/ad-0dq51cb2aap0zrpqkhzc-m0u.jpeg" data-src="https://habrastorage.org/webt/ad/-0/dq/ad-0dq51cb2aap0zrpqkhzc-m0u.jpeg" data-blurred="true"/></p><br/>
<p>Чтобы открыть эти порты JMX, RMI, вам понадобится в опции JVM запускаемого сервиса внутри докера добавить вот такой перечень опций. Как правило, я задаю такие опции в deployment-файле. </p><br/>
<p>Вот вы открываете порт 9010. Можно и для JMX, и для RMI задать одинаковый порт. В данном случае это не критично. И с помощью kubectl или с помощью другого инструмента взаимодействия с Kubernetes CPI пробрасываете свой порт внутрь поды. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/df/ls/g8/dflsg86nylelxahea1yz0uz9dn4.jpeg" data-src="https://habrastorage.org/webt/df/ls/g8/dflsg86nylelxahea1yz0uz9dn4.jpeg" data-blurred="true"/></p><br/>
<p>Если вам нужно запрофилировать и пробросить порты и для сервиса аутентификации и для сервиса генерации отчетов, и для сервиса генерации отчета, то у вас получится такое сделать, если вы во всех подах задали одинаковый порт. Потому что, когда вы будете открывать соответствующий порт у себя на станции, kubectl скажет: «Я не могу дважды открыть порт 9010, он уже кем-то занят».</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/b7/us/pa/b7uspafftsfom6dramgi53vqd_u.jpeg" data-src="https://habrastorage.org/webt/b7/us/pa/b7uspafftsfom6dramgi53vqd_u.jpeg" data-blurred="true"/></p><br/>
<p>В этом случае вам в другом сервисе нужно отсылать в другой порт. Например, 9011, т. е. какой-то иной. Помните об этом. И нужный порт к нужному подсоединить. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/7f/xw/do/7fxwdox6iwnqbwybojbt-hj0qri.jpeg" data-src="https://habrastorage.org/webt/7f/xw/do/7fxwdox6iwnqbwybojbt-hj0qri.jpeg" data-blurred="true"/></p><br/>
<p>Если вы решили это делать не с помощью таких постоянных действий, как пробрасывание порта, можете зафиксировать порт через NodePort в разделе Service. В этом случае вам в опции JVM нужно прописать именно тот порт, который вы открываете в сервисе. </p><br/>
<p>И тут последовательность несколько иная. Вы сначала в разделе Service говорите: «Я хочу, чтобы из данного сервиса наружу торчал порт 31111». Если такой порт не занят, то он открывается. Если вы убедились, что он открылся, он зафиксирован и вашему сервису принадлежит, то потом идете в настройки сервиса в раздел Deployment и там соответствующий порт задаете, т. е. в обратном порядке. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/le/-f/xv/le-fxvieyupxz8avmd4xyuhbdua.jpeg" data-src="https://habrastorage.org/webt/le/-f/xv/le-fxvieyupxz8avmd4xyuhbdua.jpeg" data-blurred="true"/></p><br/>
<p>Если вы никогда работали с Kubernetes-дашбордом, то это Deployments и Service. Т. е. сначала во внешний раздел идете, там настраиваете, открываете порт. А потом в Deployment его указываете. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/vv/q4/29/vvq429gy94jiieflrn5d58bqc3y.jpeg" data-src="https://habrastorage.org/webt/vv/q4/29/vvq429gy94jiieflrn5d58bqc3y.jpeg" data-blurred="true"/></p><br/>
<p>Хорошую документацию, где есть инструкции с картинками, что это за порты и как их прокинуть именно из докер-контейнера, описал Алексей Рагозин в блоге компании BellSoft. Это один из разработчиков JVM. Называется «JVM in Linux containers, surviving the isolation». Всем рекомендую прочитать эту статью, если вы пользуетесь таким способом. Она доступна по ссылке, данная ссылочка кликабельная. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zv/jc/nj/zvjcnjprxdrxqzi4xr8cubihyvw.jpeg" data-src="https://habrastorage.org/webt/zv/jc/nj/zvjcnjprxdrxqzi4xr8cubihyvw.jpeg" data-blurred="true"/></p><br/>
<p>По такой технологии вы можете подключить различные инструменты: SJK, JMC, VisualVM.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/js/fu/po/jsfupouzcard_pajcjjsumtmque.jpeg" data-src="https://habrastorage.org/webt/js/fu/po/jsfupouzcard_pajcjjsumtmque.jpeg" data-blurred="true"/></p><br/>
<p>Один из самых простых инструментов – это SJK.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/qe/80/6x/qe806x79_tdmgzhd4ueyczcyrx0.jpeg" data-src="https://habrastorage.org/webt/qe/80/6x/qe806x79_tdmgzhd4ueyczcyrx0.jpeg" data-blurred="true"/></p><br/>
<p>Вот вы пробросили порт, потом у себя пишите такую команду, где можете выставить профилирование с ограниченной интенсивностью или с максимальной интенсивностью на 5 минут. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/jy/1s/p4/jy1sp4mugndp0pbbguyslzr81xw.jpeg" data-src="https://habrastorage.org/webt/jy/1s/p4/jy1sp4mugndp0pbbguyslzr81xw.jpeg" data-blurred="true"/></p><br/>
<p>Второй по простоте – это, наверное, JMC и технология Java Flight Recorder. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/my/sa/2d/mysa2depg6p_cuv7uhldaiqnx5a.jpeg" data-src="https://habrastorage.org/webt/my/sa/2d/mysa2depg6p_cuv7uhldaiqnx5a.jpeg" data-blurred="true"/></p><br/>
<p>С ней есть несколько особенностей. Она заключается в том, что технология JFR появилась в OpenJDK в 8-ой не сразу, а только с версией 272.</p><br/>
<p>И если у вас версия 272, то открывайте JMX, RMI также, как для предыдущих инструментов и пользуетесь.</p><br/>
<p>Если у вас старый 8-й OpenJDK, то у вас просто ничего не получится. Вам нужно или монтировать Java в контейнер, или не пользоваться этим способом.</p><br/>
<p>Если у вас Oracle JDK, то там есть еще более тонкий момент. До build 161, даже до build 162 лицензия на Oracle JDK позволяла использовать JFR на тестовых стендах при включении опции UnlockCommercialFeatures и опции FLightRecorder. </p><br/>
<p>Если у вас более старшая версия, то вам нужно будет купить лицензию. Она исчисляется стоимостью по ядрам. Сам я не использовал такой способ после смены лицензии. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/j5/0u/tz/j50utzpuq7qyw_ujwnqzqaiwdjm.jpeg" data-src="https://habrastorage.org/webt/j5/0u/tz/j50utzpuq7qyw_ujwnqzqaiwdjm.jpeg" data-blurred="true"/></p><br/>
<p>Если вы все настроили, то дальше в Java Mission Control создаете подключение. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/8-/zc/jj/8-zcjjmqxj0qy5oy2mft9ciase8.jpeg" data-src="https://habrastorage.org/webt/8-/zc/jj/8-zcjjmqxj0qy5oy2mft9ciase8.jpeg" data-blurred="true"/></p><br/>
<p>Указываете порт, который вы открыли. Например, 9010. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/k6/8f/ny/k68fnymw8vhevaq5e0mzyt1h9f4.jpeg" data-src="https://habrastorage.org/webt/k6/8f/ny/k68fnymw8vhevaq5e0mzyt1h9f4.jpeg" data-blurred="true"/></p><br/>
<p>Открываете JMX Console с помощью Java Mission Control.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/6t/po/aa/6tpoaad8yroroy8bludua3vcbh4.jpeg" data-src="https://habrastorage.org/webt/6t/po/aa/6tpoaad8yroroy8bludua3vcbh4.jpeg" data-blurred="true"/></p><br/>
<p>Проверяете, что с вашей подой все хорошо и запускаете с помощью пункта Start Flight Recording процесс профилирования.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/np/yj/zw/npyjzwk0dluc3y_bxvx2b_frujy.jpeg" data-src="https://habrastorage.org/webt/np/yj/zw/npyjzwk0dluc3y_bxvx2b_frujy.jpeg" data-blurred="true"/></p><br/>
<p>С VisualVM все аналогично. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/_b/nn/iu/_bnniuuplqr8xfjvvkbon17drjs.jpeg" data-src="https://habrastorage.org/webt/_b/nn/iu/_bnniuuplqr8xfjvvkbon17drjs.jpeg" data-blurred="true"/></p><br/>
<p>Вы так же создаете подключение.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/_g/9l/an/_g9lanusei-bd9mqxa1ayzc403s.jpeg" data-src="https://habrastorage.org/webt/_g/9l/an/_g9lanusei-bd9mqxa1ayzc403s.jpeg" data-blurred="true"/></p><br/>
<p>Так же указываете локальный хост и порт после того, как пробросили все. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/48/nl/bo/48nlbooxwpa9zyu9ppdliitx-z4.jpeg" data-src="https://habrastorage.org/webt/48/nl/bo/48nlbooxwpa9zyu9ppdliitx-z4.jpeg" data-blurred="true"/></p><br/>
<p>Открываете. У вас появляется в разделе Local созданное вами подключение. Locolhost 9010 открываете. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/w2/-q/3u/w2-q3u2yh-yjtitckzdi7waexks.jpeg" data-src="https://habrastorage.org/webt/w2/-q/3u/w2-q3u2yh-yjtitckzdi7waexks.jpeg" data-blurred="true"/></p><br/>
<p>И на вкладке Sampler можно начать профилирование потоков, нажав на кнопку CPU.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ok/b9/uh/okb9uhsa2oybftxfqmvdif9mric.jpeg" data-src="https://habrastorage.org/webt/ok/b9/uh/okb9uhsa2oybftxfqmvdif9mric.jpeg" data-blurred="true"/></p><br/>
<p>Более интересную и, возможно, более детальную информацию можно получить у JavaAgent-профайлеров. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/aq/iw/ur/aqiwurprh48ezo5bbkj9xzf06om.jpeg" data-src="https://habrastorage.org/webt/aq/iw/ur/aqiwurprh48ezo5bbkj9xzf06om.jpeg" data-blurred="true"/></p><br/>
<p>Таких как JProfiler, YourKit Java Profiler. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/b4/xe/s4/b4xes4t8xujivffxydzbq5stmds.jpeg" data-src="https://habrastorage.org/webt/b4/xe/s4/b4xes4t8xujivffxydzbq5stmds.jpeg" data-blurred="true"/></p><br/>
<p>Но тут несколько иной способ подключения. Вам нужно доставить и сам профайлер внутрь поды. Вот эти агенты нельзя просто опциями подключить. Это не встроенная возможность Java. Это определенный программный код, т. е. программный продукт, который подключается дополнительно к JVM. И мы в команде такие опции кладем в некий каталог, а каталог монтируем в поду. И потом настраиваем все эти опции, создаем сетевое подключение.</p><br/>
<p>Какие тут преимущества? </p><br/>
<ul>
<li>Всего один порт, нет JMX, RMI. Всего один сетевой порт для агента.</li>
<li>Можно уже подключаться к двум подам одного сервиса. И у самих этих инструментов более интересный интерфейс.</li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bj/qx/do/bjqxdogcqvi6demn6e1mgpo8kfu.jpeg" data-src="https://habrastorage.org/webt/bj/qx/do/bjqxdogcqvi6demn6e1mgpo8kfu.jpeg" data-blurred="true"/></p><br/>
<p>Расскажу про интерфейс для профайлера. Он достаточно хороший. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ku/uv/rp/kuuvrprb2o67naigcrzyfvafrlk.jpeg" data-src="https://habrastorage.org/webt/ku/uv/rp/kuuvrprb2o67naigcrzyfvafrlk.jpeg" data-blurred="true"/></p><br/>
<p>Если вы начнете профилировать с ним, то вам понадобится 2 дистрибутива. Один для вашего клиентского рабочего места, например, у вас Windows. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/st/et/bo/stetbon8lvgvo37hqupvm_zikay.jpeg" data-src="https://habrastorage.org/webt/st/et/bo/stetbon8lvgvo37hqupvm_zikay.jpeg" data-blurred="true"/></p><br/>
<p>Второй дистрибутив, который будет работать внутри поды. Как правило, это Linux. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/6r/pj/zl/6rpjzlejwv7xjmfz-aqqunofeja.jpeg" data-src="https://habrastorage.org/webt/6r/pj/zl/6rpjzlejwv7xjmfz-aqqunofeja.jpeg" data-blurred="true"/></p><br/>
<p>Но вам не все файлы из этого дистрибутива понадобятся, а лишь две подпапки. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hx/ln/rs/hxlnrsbquqdnyggzvjeq0f8c3ng.jpeg" data-src="https://habrastorage.org/webt/hx/ln/rs/hxlnrsbquqdnyggzvjeq0f8c3ng.jpeg" data-blurred="true"/></p><br/>
<p>В случае Alpine Linux папка называется Linux_musl. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/g8/el/af/g8elafdugqfcppidp0m42yuevt0.jpeg" data-src="https://habrastorage.org/webt/g8/el/af/g8elafdugqfcppidp0m42yuevt0.jpeg" data-blurred="true"/></p><br/>
<p>В случае всех остальных – Lunux-x64.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/sw/zk/d9/swzkd90m1tyksfzb8lk0jmw5mey.jpeg" data-src="https://habrastorage.org/webt/sw/zk/d9/swzkd90m1tyksfzb8lk0jmw5mey.jpeg" data-blurred="true"/></p><br/>
<p>Узнать, какая у вас ОС используется несложно. Откройте командную консоль для вашей поды и введите туда команду «cat /etc/os-release». Увидите там Alpine, значит Alpine, иначе это что-то другое. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pq/_l/qk/pq_lqkboysntswre8do-ijzqftg.jpeg" data-src="https://habrastorage.org/webt/pq/_l/qk/pq_lqkboysntswre8do-ijzqftg.jpeg" data-blurred="true"/></p><br/>
<p>При подключении агента нужно в deployment смонтировать этот агент, чтобы он появился на диске, т. е. чтобы он был у вас на сервере. Далее смонтировать это в поду. И подключить уже к Java через Java options. Как правило, можно сделать вот таким образом.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zp/26/gv/zp26gvqhwda7tkxmsmicukfiq1m.jpeg" data-src="https://habrastorage.org/webt/zp/26/gv/zp26gvqhwda7tkxmsmicukfiq1m.jpeg" data-blurred="true"/></p><br/>
<p>для CentOS получится тоже самое, только каталог из дистрибутива, который будет подключаться в поду, будет другой, т. е. linux-x64.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/5p/jc/wy/5pjcwy5hsbm-qiy8ilmdlulb8to.jpeg" data-src="https://habrastorage.org/webt/5p/jc/wy/5pjcwy5hsbm-qiy8ilmdlulb8to.jpeg" data-blurred="true"/></p><br/>
<p>Особенность тут в том, что если вы подключаете это на несколько сервисов, то настройки можно оставить такие, т. е. сохранить тот же самый порт. Максимум, что будет меняться в зависимости от дистрибутива это musl или x64.</p><br/>
<p>Вы это сделали, сервис перезапустился.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/8c/rt/im/8crtimfttv8vscbdqsz-g0d3dra.jpeg" data-src="https://habrastorage.org/webt/8c/rt/im/8crtimfttv8vscbdqsz-g0d3dra.jpeg" data-blurred="true"/></p><br/>
<p>И вы в JProfiler создаете новую сессию. Про это тоже буду рассказывать, потому что не самый тривиальный интерфейс, можете запутаться.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/_n/73/5t/_n735titight87grzx6n-wfyk0w.jpeg" data-src="https://habrastorage.org/webt/_n/73/5t/_n735titight87grzx6n-wfyk0w.jpeg" data-blurred="true"/></p><br/>
<p>Пробросили себе порт. Вы говорите, что хотите удаленное подключение, но к своему локальному рабочему месту: 127.0.0.1 и указываете порт, который вы пробросили. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yd/zh/zc/ydzhzco4sdch6ugvzzh2rxzfrqm.jpeg" data-src="https://habrastorage.org/webt/yd/zh/zc/ydzhzco4sdch6ugvzzh2rxzfrqm.jpeg" data-blurred="true"/></p><br/>
<p>Далее в настройках Call Recording выбрать обычное семплирование. Этот способ называется full sampling, потому что он выполняется максимально быстро, но с дополнительной опцией, что нужно сохранять и номера строчек, чтобы потом это можно было проще смапить на код.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/cl/hr/fb/clhrfbd-wgodh8jlcvy7yzc8irm.jpeg" data-src="https://habrastorage.org/webt/cl/hr/fb/clhrfbd-wgodh8jlcvy7yzc8irm.jpeg" data-blurred="true"/></p><br/>
<p>А дальше в профайлере открываются все его фишки. Он может перехватывать все SQL-запросы с параметрами. Вы видите всю статистику по каждому SQL-запросу.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/aq/t9/cf/aqt9cfwqbxwirq4fykssfx0z2pa.jpeg" data-src="https://habrastorage.org/webt/aq/t9/cf/aqt9cfwqbxwirq4fykssfx0z2pa.jpeg" data-blurred="true"/></p><br/>
<p>А также http-запросы к exceptions, т. е. то, чего нет, например, в VisualVM. Тут оно есть. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zq/mh/bp/zqmhbpx49wvzpuevp6ztjspaday.jpeg" data-src="https://habrastorage.org/webt/zq/mh/bp/zqmhbpx49wvzpuevp6ztjspaday.jpeg" data-blurred="true"/></p><br/>
<p>Тут вы подтверждаете, что хотите простое семплирование. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ej/vt/vh/ejvtvhf5ccmpwjtieaxpxunmxqe.jpeg" data-src="https://habrastorage.org/webt/ej/vt/vh/ejvtvhf5ccmpwjtieaxpxunmxqe.jpeg" data-blurred="true"/></p><br/>
<p>Но и после этого семплирование не запустится. В этом сложность интерфейса. Чтобы запустить вам нужно нажать Start recording. И когда вы попытаетесь в первый раз это сделать, увидите, что все эти опции, которые вы выставили, все равно собираться не станут. </p><br/>
<p>Нажмите на пункт, что вы хотите настроить новый профиль сбора метрик. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pe/8y/xy/pe8yxyxmhfuirsygfid2ff20ilo.jpeg" data-src="https://habrastorage.org/webt/pe/8y/xy/pe8yxyxmhfuirsygfid2ff20ilo.jpeg" data-blurred="true"/></p><br/>
<p>Назовите его как-нибудь по-своему. Например, что я буду собирать CPU, HTTP, JDBC, Exceptions.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/at/wa/f0/atwaf0xgicsozvknt0yeac-liao.jpeg" data-src="https://habrastorage.org/webt/at/wa/f0/atwaf0xgicsozvknt0yeac-liao.jpeg" data-blurred="true"/></p><br/>
<p>Отметьте среди галочек CPU и все, что вы включили при начале сессии. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/_2/4y/h5/_24yh5tmrt1096li6ta2xnallhm.jpeg" data-src="https://habrastorage.org/webt/_2/4y/h5/_24yh5tmrt1096li6ta2xnallhm.jpeg" data-blurred="true"/></p><br/>
<p>Это будет уже более тяжелое профилирование. И тогда его запускайте.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zx/pr/k5/zxprk564xnimjwbk9gzstf9p07m.jpeg" data-src="https://habrastorage.org/webt/zx/pr/k5/zxprk564xnimjwbk9gzstf9p07m.jpeg" data-blurred="true"/></p><br/>
<p>Я попробовал так на тестовом стенде и при профилировании в JMeter, и при различных профилированиях миникуба. Мне очень понравился JProfiler. </p><br/>
<p>Но с использованием удаленного, сложного, долгого профилирования есть один недостаток. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/od/be/u3/odbeu357ttwq2fkjrx821chomh8.jpeg" data-src="https://habrastorage.org/webt/od/be/u3/odbeu357ttwq2fkjrx821chomh8.jpeg" data-blurred="true"/></p><br/>
<p>Давным-давно мы работали из офиса и не знали таких проблем, как лаганул wi-fi, отвалился VPN. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rs/jm/7s/rsjm7sxkzbe9oukfwsdvlyo4qxk.jpeg" data-src="https://habrastorage.org/webt/rs/jm/7s/rsjm7sxkzbe9oukfwsdvlyo4qxk.jpeg" data-blurred="true"/></p><br/>
<p>А теперь у нас счастливая жизнь, а, возможно, кому-то это и не нравится, когда мы работаем из дома и про все эти проблемы знаем. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/w3/tc/xk/w3tcxkfazbx88vic-ihllo40w4u.jpeg" data-src="https://habrastorage.org/webt/w3/tc/xk/w3tcxkfazbx88vic-ihllo40w4u.jpeg" data-blurred="true"/></p><br/>
<p>И в этом случае удаленное профилирование становится не совсем удобным. Когда вы профилируете через 5 firewalls, то, во-первых, трафик лишний гоняется, во-вторых, может это все прекратиться по независящим от вас причинам.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/_z/xh/s8/_zxhs8rlrjaaycfmg3pvfavtlg8.jpeg" data-src="https://habrastorage.org/webt/_z/xh/s8/_zxhs8rlrjaaycfmg3pvfavtlg8.jpeg" data-blurred="true"/></p><br/>
<p>И тут свое применение нашло локальное профилирование. Есть очень много способов его выполнить. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hl/uy/l9/hluyl9-r0_svf94kidhnsdlkpeo.jpeg" data-src="https://habrastorage.org/webt/hl/uy/l9/hluyl9-r0_svf94kidhnsdlkpeo.jpeg" data-blurred="true"/></p><br/>
<p>Один из самых простых – это сделать nginx подключение с помощью SJK, но уже изнутри пода. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/eu/nk/5h/eunk5hgs8w1zb1kv8ynszhhwv3u.jpeg" data-src="https://habrastorage.org/webt/eu/nk/5h/eunk5hgs8w1zb1kv8ynszhhwv3u.jpeg" data-blurred="true"/></p><br/>
<p>SJK (Swiss Java Knife) – это профайлер, разработанный Алексеем Рагозиным. Он очень простой, позволяет подключаться и удаленно, и локально. И он очень маленький, поэтому его можно запускать изнутри контейнера. Это большого overhead не создаст. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/dk/yl/aa/dkylaapdynv_stlpr4obg9znb5s.jpeg" data-src="https://habrastorage.org/webt/dk/yl/aa/dkylaapdynv_stlpr4obg9znb5s.jpeg" data-blurred="true"/></p><br/>
<p>Кроме того, при запуске из контейнера его опции подключения сильно проще. Можно уже некоторые опции не задавать.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/0c/cf/fn/0ccffngbmjuj6sopb4wrdm5vqdi.jpeg" data-src="https://habrastorage.org/webt/0c/cf/fn/0ccffngbmjuj6sopb4wrdm5vqdi.jpeg" data-blurred="true"/></p><br/>
<p>А задать только те, которые необходимы тоже в Java options.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/c6/r7/q3/c6r7q3_h4domw6dkwtignxyumru.jpeg" data-src="https://habrastorage.org/webt/c6/r7/q3/c6r7q3_h4domw6dkwtignxyumru.jpeg" data-blurred="true"/></p><br/>
<p>Узнать имя пода, который вы хотите профилировать с помощью get pods. Скопировать маленький jar внутрь контейнера с помощью команды cp. И с помощью команды exec собрать результаты профилирования. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pl/ig/1z/plig1zfp84jshmdbkzjurc8aquk.jpeg" data-src="https://habrastorage.org/webt/pl/ig/1z/plig1zfp84jshmdbkzjurc8aquk.jpeg" data-blurred="true"/></p><br/>
<p>Все эти опции вы можете записать в командный файл. Вот этот предлагаемый командный файл позволяет уже больший перечень команд выполнять за раз. Позволяет сохранить результаты в tmp/result. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hw/x7/ua/hwx7uazplk4ijvgy3wdtujrbqc8.jpeg" data-src="https://habrastorage.org/webt/hw/x7/ua/hwx7uazplk4ijvgy3wdtujrbqc8.jpeg" data-blurred="true"/></p><br/>
<p>И потом с помощью kubectl или других инструментов скачать результаты.</p><br/>
<p>Я делал это следующим образом. Внутри пода захожу в каталог с результатами и упаковываю их в старый архив. Передаю результаты выполнения, т. е. вот этой упаковки, на консоль, на стандартный вывод. Через pipe получаю с консоли уже в своей станции эти результаты. И с помощью того же инструмента tar распаковываю результаты со стандартного вывода в текущий каталог. </p><br/>
<p>После чего данный каталог можно там открыть. В Windows это будет команда explorer. Этот скрипт можно выполнять в Git Bash, т. е. он для Windows тоже будет работать, если у вас есть Git, а Git есть у всех. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/5u/1f/vw/5u1fvwd8fjgxdbjguwpjsqltrga.jpeg" data-src="https://habrastorage.org/webt/5u/1f/vw/5u1fvwd8fjgxdbjguwpjsqltrga.jpeg" data-blurred="true"/></p><br/>
<p>Не менее сложный способ подключения с помощью Java Flight Recorder.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/74/x0/lg/74x0lgzta9-bxfhnxccs6q_sd88.jpeg" data-src="https://habrastorage.org/webt/74/x0/lg/74x0lgzta9-bxfhnxccs6q_sd88.jpeg" data-blurred="true"/></p><br/>
<p>Его лучше всех описал в статье на Habr Виктор Вербицкий. Статья называется «Управление Java Flight Recorder». И опции, которые я пробовал, как раз подчерпнул из этой статьи. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ia/ca/_w/iaca_wwhji4mt9fhs_end_pcx80.jpeg" data-src="https://habrastorage.org/webt/ia/ca/_w/iaca_wwhji4mt9fhs_end_pcx80.jpeg" data-blurred="true"/></p><br/>
<p>Основные – это две опции: это StartFlightRecording и FlightRecorderOptions. В этом случае нет интерактивного подключения с помощью Mission Control. </p><br/>
<ul>
<li><p>Вы говорите, что метрики нужно собирать и писать на диск, не хранить в оперативной памяти. </p><br/>
</li>
<li><p>Чтобы дисковая квота не переполнилась, задаете какое-то ограничение, например, 1 гигабайт. </p><br/>
</li>
<li><p>Перечень событий, который нужно собирать, загружаете из файлика, путь к которому указываете в этом параметре. </p><br/>
</li>
<li><p>Говорите в какой каталог сохранять. </p><br/>
</li>
<li><p>И можно еще некоторые опции задать, например, максимальный размер одного файла. Если вы будете запускать с настройками семплирования по умолчанию, то при задании максимального размера файла в 1 мегабайт, фактически будет 2-3 мегабайта. Потому что после сбора метрик, т. е. когда они в сыром виде собрались на мегабайт, из записи этого сбора записываются еще дополнительные события, и файлик становится чуть больше. Если вы собираете помимо стандартных реплик еще метрики по памяти, то при задании maxchunksize=1m размер результирующего файла будет 300 мегабайт. </p><br/>
</li>
<li><p>И еще полезная опция stackdepth. Глубина stack по умолчанию 64. И для spring-boot приложения, где stack очень огромный, вы не увидите, где у вас узкое место. И рекомендую его увеличить. </p><br/>
</li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ub/j0/ne/ubj0necvh_vji9tgwvvzcm7hyb8.jpeg" data-src="https://habrastorage.org/webt/ub/j0/ne/ubj0necvh_vji9tgwvvzcm7hyb8.jpeg" data-blurred="true"/></p><br/>
<ul>
<li><p>Все опции семплирования для JFR, которые задаются в filename, мы можем посмотреть, как они выглядят по умолчанию в файле jre\lib\jfr\default.jfc.</p><br/>
</li>
<li><p>Это простой файл в формате XML. </p><br/>
</li>
<li><p>Но его можно редактировать в JMC. </p><br/>
</li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/2e/6m/dx/2e6mdx4ugb6wbhuhnpgrpb_aoq0.jpeg" data-src="https://habrastorage.org/webt/2e/6m/dx/2e6mdx4ugb6wbhuhnpgrpb_aoq0.jpeg" data-blurred="true"/></p><br/>
<p>Если вы хотите сделать процесс профилирования, то там будет кнопка Template Manager. Нажмите ее, откроется Flight Recording Template Manager, где вы можете сдублировать существующие профили, отредактировать их, нажав «Edit» или экспортировать в файл. А потом этот файл замонтировать в поду и использовать. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/po/j9/yw/poj9ywslknhwfqia-lt0_lxniem.jpeg" data-src="https://habrastorage.org/webt/po/j9/yw/poj9ywslknhwfqia-lt0_lxniem.jpeg" data-blurred="true"/></p><br/>
<p>Если вы вообще ничего не замонтируете, то можете использовать настройки по умолчанию. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rh/kd/2-/rhkd2-gnkwkkdfgj_zeqtnfjxx4.jpeg" data-src="https://habrastorage.org/webt/rh/kd/2-/rhkd2-gnkwkkdfgj_zeqtnfjxx4.jpeg" data-blurred="true"/></p><br/>
<p>Если у вас есть какие-то пожелания по выбору метрик, то вам нужно смонтировать также, как и для агента каталог. Это необходимый для вас файлик. И нужно подключить этот файлик в опциях JVM. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/t6/jx/pd/t6jxpdxn4vl2cxkivhe3v_el5hs.jpeg" data-src="https://habrastorage.org/webt/t6/jx/pd/t6jxpdxn4vl2cxkivhe3v_el5hs.jpeg" data-blurred="true"/></p><br/>
<p>Вот так можно называть каталог, в котором будут опции. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hf/2l/5x/hf2l5xhlfcv2v2cod4fhrrvpbvq.jpeg" data-src="https://habrastorage.org/webt/hf/2l/5x/hf2l5xhlfcv2v2cod4fhrrvpbvq.jpeg" data-blurred="true"/></p><br/>
<p>Вот так его подмонтировать.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xk/pl/pm/xkplpm5tvpjon4gv2nelihg_v_y.jpeg" data-src="https://habrastorage.org/webt/xk/pl/pm/xkplpm5tvpjon4gv2nelihg_v_y.jpeg" data-blurred="true"/></p><br/>
<p>И вот так указать этот путь: filename /tmp/jfr/prof.jfc.</p><br/>
<p>Вот такой способ подключения JFR.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/qp/un/zp/qpunzpf7nuubt3cuc4p1nfh1fhi.jpeg" data-src="https://habrastorage.org/webt/qp/un/zp/qpunzpf7nuubt3cuc4p1nfh1fhi.jpeg" data-blurred="true"/></p><br/>
<p>С помощью JavaAgent тоже можно все локально делать самыми разными профайлерами. Я, правда, не пользовался, поэтому и рассказывать вам не буду. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/3s/w3/gn/3sw3gn3xlpovg0sjupphnyruals.jpeg" data-src="https://habrastorage.org/webt/3s/w3/gn/3sw3gn3xlpovg0sjupphnyruals.jpeg" data-blurred="true"/></p><br/>
<p>И есть очень интересный способ, как все сделать на лету. Он обещает, что вы можете в любую поду зайти и начать профилирование. </p><br/>
<p>Сложность в том, что у меня этот способ сработал ровно с одним профайлером и не сработал со всеми остальными. </p><br/>
<p>В чем суть? Чтобы все это на лету сработало, вам нужны инструменты разработчика, т. е. не просто Java Runtime Environment, а JDK внутри контейнера. А все стремятся сделать контейнеры легковесным, никаких дополнительных инструментов и утилит в контейнере нет. Я пробовал это сделать, но у меня ничего не получалось. А с Async Profiler получилось.</p><br/>
<p>Его фишка еще в том, что он может не только stack traces собирать, а собирать большее количество метрик более точно.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/o9/fw/jo/o9fwjoolqwws48ct5887vx17r0q.jpeg" data-src="https://habrastorage.org/webt/o9/fw/jo/o9fwjoolqwws48ct5887vx17r0q.jpeg" data-blurred="true"/></p><br/>
<p>Поэтому на него я бы хотел обратить особое ваше внимание. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/vj/al/3u/vjal3u2eiujudv9ahpiibzwlwjq.jpeg" data-src="https://habrastorage.org/webt/vj/al/3u/vjal3u2eiujudv9ahpiibzwlwjq.jpeg" data-blurred="true"/></p><br/>
<p>Разработал его Андрей Паньгин. И в Async Profiler я могу отметить наилучшую поддержку Alpine Linux и не только. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/3z/uz/_z/3zuz_z2y0qzcx7xbny9kjsqg4wk.jpeg" data-src="https://habrastorage.org/webt/3z/uz/_z/3zuz_z2y0qzcx7xbny9kjsqg4wk.jpeg" data-blurred="true"/></p><br/>
<p>Что это за штука Alpine Linux? Почему на нее нужно обращать внимание? Если вы зададитесь вопросом: «Какие Linux-дистрибутивы и с какими опциями используются в ваших контейнерах?», то вы, скорее всего, зайдете на Docker Hub, начнете выбирать контейнеры, которые у вас будут базовыми для ваших сервисов. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ya/c8/8r/yac88rc-d4iihfpev1wownmkn8g.jpeg" data-src="https://habrastorage.org/webt/ya/c8/8r/yac88rc-d4iihfpev1wownmkn8g.jpeg" data-blurred="true"/></p><br/>
<p>И у вас будут некоторые факторы выбора их. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zf/lf/s2/zflfs29vwbepgzygjfbhl2ufsyq.jpeg" data-src="https://habrastorage.org/webt/zf/lf/s2/zflfs29vwbepgzygjfbhl2ufsyq.jpeg" data-blurred="true"/></p><br/>
<p>Среди них – это операционная система, т. к. они бывают разными. А также – JDK или JRE, какая там версия. Можете обращать внимание на популярность. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/d0/mn/nh/d0mnnhuri3shibagmsqugbakkou.jpeg" data-src="https://habrastorage.org/webt/d0/mn/nh/d0mnnhuri3shibagmsqugbakkou.jpeg" data-blurred="true"/></p><br/>
<p>Я зашел и составил табличку для тех контейнеров, которые используются у нас на проекте. </p><br/>
<p>По статистике среди пользователей Docker Hub наиболее популярный дистрибутив – это CentOS. Наиболее популярная версия – Java 8.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/i5/vc/72/i5vc72253g8osgtac34q2xr0rhs.jpeg" data-src="https://habrastorage.org/webt/i5/vc/72/i5vc72253g8osgtac34q2xr0rhs.jpeg" data-blurred="true"/></p><br/>
<p>На нашем проекте первое место совпадает с этой статистикой. А второе место – это Alpine. </p><br/>
<p>И в разделении CentOS против Alpine есть важный фактор для инженера производительности при выборе профайлера. При выборе профайлера вам нужно будет выбирать Linux-musl различные инструменты, которые содержат слово «musl» в своем названии. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/6u/9b/q1/6u9bq1xvdugeaiioovskosbmja0.jpeg" data-src="https://habrastorage.org/webt/6u/9b/q1/6u9bq1xvdugeaiioovskosbmja0.jpeg" data-blurred="true"/></p><br/>
<p>При скачивании Async Profiler нужно выбрать нужную сборку. У него есть сборки и для Macos, и для самых разных Linuxs. У вас будет выбор между x64 и musl. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/y2/sj/xf/y2sjxfunobdyxmbndq5wt5wgsdu.jpeg" data-src="https://habrastorage.org/webt/y2/sj/xf/y2sjxfunobdyxmbndq5wt5wgsdu.jpeg" data-blurred="true"/></p><br/>
<p>И как вы заметили, внутри Alpine есть JDK. Это популярный дистрибутив. У нас он тоже встроен. </p><br/>
<p>И я пытался пользоваться утилитами JDK из контейнера, и оказалось, что они не работают. Все-таки Alpine-дистрибутив урезанный. Несмотря на то, что там есть утилиты, ими нельзя воспользоваться. </p><br/>
<p>Я расстроился, что вообще никакого шанса нет, но оказалось, что в Async Profiler есть замечательная утилита jattach. </p><br/>
<p>Она выполняет функции jcmd.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/oe/pn/f9/oepnf9-m8caimaxdzwn4lvyctpi.jpeg" data-src="https://habrastorage.org/webt/oe/pn/f9/oepnf9-m8caimaxdzwn4lvyctpi.jpeg" data-blurred="true"/></p><br/>
<p>Его особенность в том, что нужны ROOT-права и они не всегда есть. Но если они есть, то все получится. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/nm/kl/tq/nmkltqjde2ftyxoy1m3mciyy-ce.jpeg" data-src="https://habrastorage.org/webt/nm/kl/tq/nmkltqjde2ftyxoy1m3mciyy-ce.jpeg" data-blurred="true"/></p><br/>
<p>Вот такая сложная получилась схема, как подключиться и начать профилирование. Надеюсь, она вам когда-нибудь пригодится в жизни, и вы сэкономите свое время. </p><br/>
<p>Рассказывая про удаленное профилирование, я немного затронул тему того, что иногда можно запрофилировать две поды, а иногда одну. Это тоже важный аспект профилирования в Kubernetes. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hr/ct/n1/hrctn1b8ga9gwf0bjm5s0zo_3aq.jpeg" data-src="https://habrastorage.org/webt/hr/ct/n1/hrctn1b8ga9gwf0bjm5s0zo_3aq.jpeg" data-blurred="true"/></p><br/>
<p>Но он все-таки зависит не от того способа профилирования, который вы выбрали, а от другого момента. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xf/n0/ag/xfn0agcdndmfphsp5hos_gkimqm.jpeg" data-src="https://habrastorage.org/webt/xf/n0/ag/xfn0agcdndmfphsp5hos_gkimqm.jpeg" data-blurred="true"/></p><br/>
<p>Если ваш дефект производительности проявляется при единичном запросе, при ручном, то тут один способ масштабирования и подбора инструментов.</p><br/>
<p>Например, вы в браузере тыкаете на ссылку, и ваш сервис зависает.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ho/cg/ap/hocgapt1kizx3jhtbyr5dvilyge.jpeg" data-src="https://habrastorage.org/webt/ho/cg/ap/hocgapt1kizx3jhtbyr5dvilyge.jpeg" data-blurred="true"/></p><br/>
<p>Чтобы найти узкое место в таком сервисе, вам не нужно 10 реплик, достаточно одной. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bw/ks/om/bwksomzy199yzw60kl0ic_o64u4.jpeg" data-src="https://habrastorage.org/webt/bw/ks/om/bwksomzy199yzw60kl0ic_o64u4.jpeg" data-blurred="true"/></p><br/>
<p>И ее можно профилировать максимально детально с инструментацией, с использованием Java-агентов.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zl/zj/dr/zlzjdrhhaij26bkpursynqz5dok.jpeg" data-src="https://habrastorage.org/webt/zl/zj/dr/zlzjdrhhaij26bkpursynqz5dok.jpeg" data-blurred="true"/></p><br/>
<p>А также с помощью таких инструментов, как JProfiler, YourKit для детального сбора метрик по всем аспектам. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/si/id/-s/siid-s2eymkoazohnqunb1kiory.jpeg" data-src="https://habrastorage.org/webt/si/id/-s/siid-s2eymkoazohnqunb1kiory.jpeg" data-blurred="true"/></p><br/>
<p>А если для профилирования вам надо подать большую нагрузку, а при большой нагрузке, как правило, нужен более большой кластер, например, 5 реплик выдерживают такую нагрузку, то в этом случае рекомендую оставить все 5 реплик, но к ним добавить 6-ую реплику для дополнительного масштабирования. И 6-ую начать нагружать. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/h2/sg/i_/h2sgi_g_lpr6610kmwsw-umdyca.jpeg" data-src="https://habrastorage.org/webt/h2/sg/i_/h2sgi_g_lpr6610kmwsw-umdyca.jpeg" data-blurred="true"/></p><br/>
<p>Если от данного сервиса зависят другие сервисы, то из всех созданных 6 реплик рекомендую профилировать только одну, чтобы 5 других не замедлялись. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ai/dm/ey/aidmeyyktf7meevqmrmlk1i6jkc.jpeg" data-src="https://habrastorage.org/webt/ai/dm/ey/aidmeyyktf7meevqmrmlk1i6jkc.jpeg" data-blurred="true"/></p><br/>
<p>Это у меня на схеме отмечено, как быстрое выборочное профилирование. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/lt/eb/-w/lteb-wvoyigitgcpqtfzjvt1ukg.jpeg" data-src="https://habrastorage.org/webt/lt/eb/-w/lteb-wvoyigitgcpqtfzjvt1ukg.jpeg" data-blurred="true"/></p><br/>
<p>Тут выберите такие инструменты, как JDK или Async Profiler. Они создают наименьшую нагрузку на профилирование приложения. </p><br/>
<p>Если у вас задача запрофилировать все поды с небольшим overhead, то можете выбрать те же самые инструменты или сделать массовый запуск JFR.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/j8/od/rq/j8odrqd_m2nqwahrj4wmynw2zqw.jpeg" data-src="https://habrastorage.org/webt/j8/od/rq/j8odrqd_m2nqwahrj4wmynw2zqw.jpeg" data-blurred="true"/></p><br/>
<p>Решая вопрос, какое количество под, сервисов профилировать, идите по пути наименьшего сопротивления. </p><br/>
<p>Если у вас есть возможность использовать тяжелый профайлер, то используйте его в одной реплике. Если вам нужно много реплик, то используйте более легкие инструменты. Если у вас есть ROOT-права, то используйте Async Profiler. Если у вас нет ROOT-прав, то JDK. Если у вас достаточно новая OpenJDK и там есть поддержка JFR, то попробуйте его. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/et/y_/bs/ety_bsgjdwms52f_lqugxbt6bya.jpeg" data-src="https://habrastorage.org/webt/et/y_/bs/ety_bsgjdwms52f_lqugxbt6bya.jpeg" data-blurred="true"/></p><br/>
<p>Надеюсь, я рассказал все про подключение и особенности Kubernetes и роли профилирования в нем. И некоторые части пазла у вас сложились и осталось совсем немного белых пятен. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/eu/fx/om/eufxomk6kqh3jtun43ep0qdym9m.jpeg" data-src="https://habrastorage.org/webt/eu/fx/om/eufxomk6kqh3jtun43ep0qdym9m.jpeg" data-blurred="true"/></p><br/>
<p>Сейчас быстро расскажу, как анализировать результаты. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/3u/tm/ew/3utmewzqhydphd3y2dwctwuiapi.jpeg" data-src="https://habrastorage.org/webt/3u/tm/ew/3utmewzqhydphd3y2dwctwuiapi.jpeg" data-blurred="true"/></p><br/>
<p>Самая частая у меня задача – это анализировать результаты семплирования.</p><br/>
<ol>
<li>Первый шаг – это визуально оценить работу потоков.</li>
<li>Собрать статистику по работе потоков. Т. е. мы посмотрели визуально, оценили это в виде чисел. </li>
<li>Выбрать из всех этих потоков только проблемные, исключить непроблемные. </li>
<li>Детально собрать статистику только по проблемным. </li>
<li>И разделить на методы прикладные. </li>
<li>Т. е. тут у нас Postgres тормозил, тут какой-то http-запрос. </li>
<li>И наложить эту статистику на исходный код.</li>
</ol><br/>
<p>Вот такой семишаговый процесс. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/6g/8i/id/6g8iid1wlognz4xrjj9lhcmlgzg.jpeg" data-src="https://habrastorage.org/webt/6g/8i/id/6g8iid1wlognz4xrjj9lhcmlgzg.jpeg" data-blurred="true"/></p><br/>
<p>Первый этап – визуальная оценка. Этот этап очень важен. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/me/fs/mm/mefsmmifese-nvv4qhwf800a6ck.jpeg" data-src="https://habrastorage.org/webt/me/fs/mm/mefsmmifese-nvv4qhwf800a6ck.jpeg" data-blurred="true"/></p><br/>
<p>Его можно сделать в бесплатном инструменте JVisionVM.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/87/xc/9d/87xc9d96odydv0nq0uheag9zn-k.jpeg" data-src="https://habrastorage.org/webt/87/xc/9d/87xc9d96odydv0nq0uheag9zn-k.jpeg" data-blurred="true"/></p><br/>
<p>Если вы посмотрите на свои потоки и увидите, что они параллельно работают, то у вас нет проблем с параллельностью. Вы создали 20 или 120 потоков, и они как-то параллельно живут. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/en/hp/5f/enhp5fhj_mrtusqxqh2_qse-hxk.jpeg" data-src="https://habrastorage.org/webt/en/hp/5f/enhp5fhj_mrtusqxqh2_qse-hxk.jpeg" data-blurred="true"/></p><br/>
<p>В этом случае вы будете сосредоточены на анализе эффективности, на работе каждого отдельного потока. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ud/f9/yw/udf9ywwiibgeapsycsddvvt5-m0.jpeg" data-src="https://habrastorage.org/webt/ud/f9/yw/udf9ywwiibgeapsycsddvvt5-m0.jpeg" data-blurred="true"/></p><br/>
<p>А бывает другая картина. Вы смотрите визуально в JVisionVM и видите, что ни один поток параллельно с другим не работает. И даже если кажется, что они накладываются, то это не так. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yi/h3/x1/yih3x100yimhxi_vvxmraa3fz78.jpeg" data-src="https://habrastorage.org/webt/yi/h3/x1/yih3x100yimhxi_vvxmraa3fz78.jpeg" data-blurred="true"/></p><br/>
<p>В этом случае у вас совсем другая проблема. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yd/ip/9c/ydip9cjizxycg0grloiqailbq_m.jpeg" data-src="https://habrastorage.org/webt/yd/ip/9c/ydip9cjizxycg0grloiqailbq_m.jpeg" data-blurred="true"/></p><br/>
<p>Система работает медленно не из-за недостатка масштабирования, а по причинам блокировок. И вам нужно анализировать уже этот момент. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/-m/md/wa/-mmdwagmbs5dad1o0roke2fo45u.jpeg" data-src="https://habrastorage.org/webt/-m/md/wa/-mmdwagmbs5dad1o0roke2fo45u.jpeg" data-blurred="true"/></p><br/>
<p>Еще замечу, что при выборе потоков важно ориентироваться в них хоть немножко. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/cn/kv/tx/cnkvtxbjfon4omopuneua88mhds.jpeg" data-src="https://habrastorage.org/webt/cn/kv/tx/cnkvtxbjfon4omopuneua88mhds.jpeg" data-blurred="true"/></p><br/>
<p>Статистику достаточно смотреть по ключевым местам. И совсем не смотреть, например, по JMX и RMI. Это RMI Scheduler, RMI TCP Accept, RMI TCP Connection. Kafka Heartbeat обычно не доставляет проблем. И различные потоки, которые отвечают за сборку мусора, тоже нам не интересны. </p><br/>
<p>Нам достаточно посмотреть, какой вес они занимают в процессе профилирования, т. е. в работе сервиса, но не нужно залезать в детали, потому что мы ничего там не поменяем. Если только вы заметили, что поток сборщика мусора выделяется из всех потоков, то посмотрите на настройки сборки мусора. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/uq/do/nz/uqdonz_zn-izrqb79_jaa8yvfuu.jpeg" data-src="https://habrastorage.org/webt/uq/do/nz/uqdonz_zn-izrqb79_jaa8yvfuu.jpeg" data-blurred="true"/></p><br/>
<p>А заглянуть внутрь нужно уже при таких потоках: http-nio-8080, Thread-pool, OkHttp, WebSocket.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/0i/bc/r8/0ibcr8sgpmbqvbgp2e-um8wj2aa.jpeg" data-src="https://habrastorage.org/webt/0i/bc/r8/0ibcr8sgpmbqvbgp2e-um8wj2aa.jpeg" data-blurred="true"/></p><br/>
<p>Как это делается в больших профайлерах? </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/sl/id/tm/slidtmvla5h1gvf9pf4ys1e1nmk.jpeg" data-src="https://habrastorage.org/webt/sl/id/tm/slidtmvla5h1gvf9pf4ys1e1nmk.jpeg" data-blurred="true"/></p><br/>
<p>В том же JProfiler рекомендую зайти в Thread History. Там можно увидеть диаграмму работы потоков. Выбрать самый тяжелый. И перейти по пункту Show Call Three Selected Thread. </p><br/>
<p>Недостаток или особенность JProfiler в том, что для двух потоков эту статистику собрать нельзя, т. е. нельзя объединить. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/j3/em/-w/j3em-whzfq4dt-vugi_hxw29yls.jpeg" data-src="https://habrastorage.org/webt/j3/em/-w/j3em-whzfq4dt-vugi_hxw29yls.jpeg" data-blurred="true"/></p><br/>
<p>Но такое можно сделать с помощью других инструментов. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ky/s2/h2/kys2h2jpjkpwyj7vhhcwrbc6fd0.jpeg" data-src="https://habrastorage.org/webt/ky/s2/h2/kys2h2jpjkpwyj7vhhcwrbc6fd0.jpeg" data-blurred="true"/></p><br/>
<p>С помощью того же JDK. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bd/07/dm/bd07dm_dgkr_6z0r8iw4rctjvym.jpeg" data-src="https://habrastorage.org/webt/bd/07/dm/bd07dm_dgkr_6z0r8iw4rctjvym.jpeg" data-blurred="true"/></p><br/>
<p>Я на слайдах привел пошаговые готовые скрипты, которые вы сможете использовать у себя, чтобы объединить статистику.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rn/yt/rp/rnytrpisfys9nc5abnhjpn68n_y.jpeg" data-src="https://habrastorage.org/webt/rn/yt/rp/rnytrpisfys9nc5abnhjpn68n_y.jpeg" data-blurred="true"/></p><br/>
<p>И построить в диаграмму. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/t-/4o/ml/t-4omltjqghlnkaawbqgtdpbmeq.jpeg" data-src="https://habrastorage.org/webt/t-/4o/ml/t-4omltjqghlnkaawbqgtdpbmeq.jpeg" data-blurred="true"/></p><br/>
<p>Диаграмма – это такой красивый график. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zr/qq/49/zrqq49ny2fmtcq2dfrp-habagia.jpeg" data-src="https://habrastorage.org/webt/zr/qq/49/zrqq49ny2fmtcq2dfrp-habagia.jpeg" data-blurred="true"/></p><br/>
<p>Кроме того, он будет снабжен статистикой уже с номерами строк. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ed/p-/au/edp-aua3lc_k0cthfxjxyr6rchw.jpeg" data-src="https://habrastorage.org/webt/ed/p-/au/edp-aua3lc_k0cthfxjxyr6rchw.jpeg" data-blurred="true"/></p><br/>
<p>А если вам нужно из всей работы потоков выделить отдельный метод, то это тоже возможно. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ix/tr/em/ixtreml4kaei5ulcqumwmyx7_mq.jpeg" data-src="https://habrastorage.org/webt/ix/tr/em/ixtreml4kaei5ulcqumwmyx7_mq.jpeg" data-blurred="true"/></p><br/>
<p>Вот вы смотрите на эту большую flame-диаграмму. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/nx/id/tf/nxidtfhgiwfoabgdsgo1ni0ib6g.jpeg" data-src="https://habrastorage.org/webt/nx/id/tf/nxidtfhgiwfoabgdsgo1ni0ib6g.jpeg" data-blurred="true"/></p><br/>
<p>Она может показаться на первый взгляд непонятной.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/-r/yl/-2/-ryl-2vzokc1pwkehczpbpn-z30.jpeg" data-src="https://habrastorage.org/webt/-r/yl/-2/-ryl-2vzokc1pwkehczpbpn-z30.jpeg" data-blurred="true"/></p><br/>
<p>Давайте к ней приглядимся.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/fr/pd/vj/frpdvj6x5dyqj8q-xyq4tll2tji.jpeg" data-src="https://habrastorage.org/webt/fr/pd/vj/frpdvj6x5dyqj8q-xyq4tll2tji.jpeg" data-blurred="true"/></p><br/>
<p>Вот мы приглядываемся-приглядываемся и понимаем, что у нас есть post-запросы и get-запросы. Вот в данном случае есть post-запрос, есть get-запрос. И это уже нам позволяет как-то сориентироваться и выделить наши запросы среди всех. Т. е. смапить их на некоторые бизнес-задачи.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ml/uc/hv/mluchv-uc8klvq03ceempuk6cvy.jpeg" data-src="https://habrastorage.org/webt/ml/uc/hv/mluchv-uc8klvq03ceempuk6cvy.jpeg" data-blurred="true"/></p><br/>
<p>Наши запросы, как правило, выделяются по префиксу. Если наша команда называется ВТБ, то вот наши прикладные методы. Вот ru.vtb.dbo и т. д.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/fp/nj/wl/fpnjwliubi8qauwjkhrewugfpjy.jpeg" data-src="https://habrastorage.org/webt/fp/nj/wl/fpnjwliubi8qauwjkhrewugfpjy.jpeg" data-blurred="true"/></p><br/>
<p>Кроме этого, есть имя самого запроса. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/7o/an/ar/7oanarve-p5l5sex9mx-3aqtqu0.jpeg" data-src="https://habrastorage.org/webt/7o/an/ar/7oanarve-p5l5sex9mx-3aqtqu0.jpeg" data-blurred="true"/></p><br/>
<p>Вот оно: organizationsSearch. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ep/pt/qf/epptqfjvel_vyvupgkji6j26uss.jpeg" data-src="https://habrastorage.org/webt/ep/pt/qf/epptqfjvel_vyvupgkji6j26uss.jpeg" data-blurred="true"/></p><br/>
<p>Все эти три признака позволяют из stack traces выделить интересующие вас участки.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/lm/bt/na/lmbtnaa5niwew7sz-a7lriaexwu.jpeg" data-src="https://habrastorage.org/webt/lm/bt/na/lmbtnaa5niwew7sz-a7lriaexwu.jpeg" data-blurred="true"/></p><br/>
<p>Фишкой JDK является то, что можно объединить фильтры, т. е. ряд фильтров накладывать на собранные stack traces и таким образом автоматизировать выделение статистики по отдельному методу.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yk/rd/qa/ykrdqacggepipmm_2dvp7fly5ia.jpeg" data-src="https://habrastorage.org/webt/yk/rd/qa/ykrdqacggepipmm_2dvp7fly5ia.jpeg" data-blurred="true"/></p><br/>
<p>Вот таким несложным скриптом у вас это получится сделать.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/a_/sw/ls/a_swlss32pli6b1d7ascin7n4eo.jpeg" data-src="https://habrastorage.org/webt/a_/sw/ls/a_swlss32pli6b1d7ascin7n4eo.jpeg" data-blurred="true"/></p><br/>
<p>И после этого можно даже накладывать на эти отдельные методы еще дополнительные фильтры.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/yp/sv/ny/ypsvnyf7yr7ib_hfz25enj_f4aa.jpeg" data-src="https://habrastorage.org/webt/yp/sv/ny/ypsvnyf7yr7ib_hfz25enj_f4aa.jpeg" data-blurred="true"/></p><br/>
<p>Вот такие. Тут уже trace-filter. И можно сказать, какую долю в этом методе занимает PostgreSQL.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/es/bx/f2/esbxf2kot34p-xx9xemz-lvhib0.jpeg" data-src="https://habrastorage.org/webt/es/bx/f2/esbxf2kot34p-xx9xemz-lvhib0.jpeg" data-blurred="true"/></p><br/>
<p>Или, наоборот, без PostgreSQL. За счет таких фильтров вы можете оценить взаимодействие текущего сервиса и текущего метода с другими сервисами и с другими компонентами. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/v8/ce/2j/v8ce2j_9upd8dtb0rhp6gyax-5i.jpeg" data-src="https://habrastorage.org/webt/v8/ce/2j/v8ce2j_9upd8dtb0rhp6gyax-5i.jpeg" data-blurred="true"/></p><br/>
<p>И после всего этого у вас получится автоматическое формирование отчета с разбивкой по методам, потокам, классам и другим интересующим вас моментам. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/3v/_f/f0/3v_ff052tx42jn7nfnqkhdhxuwu.jpeg" data-src="https://habrastorage.org/webt/3v/_f/f0/3v_ff052tx42jn7nfnqkhdhxuwu.jpeg" data-blurred="true"/></p><br/>
<p>Это все, что я хотел бы вам рассказать про анализ метрик. Надеюсь, у вас еще меньше белых пятен осталось. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/fr/pc/ia/frpciayq0wc4xi9qzzwbjmvbyau.jpeg" data-src="https://habrastorage.org/webt/fr/pc/ia/frpciayq0wc4xi9qzzwbjmvbyau.jpeg" data-blurred="true"/></p><br/>
<p>И финальный шаг – это как масштабировать профилирование на всю команду. Об этом расскажу быстро.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/hx/p2/4n/hxp24ndpklksbmoeztmxl0wdjjg.jpeg" data-src="https://habrastorage.org/webt/hx/p2/4n/hxp24ndpklksbmoeztmxl0wdjjg.jpeg" data-blurred="true"/></p><br/>
<p>Первое, что я вам рекомендую делать, это если вы разобрались в профилировании и успешно нашли какие-то дефекты с помощью профайлера, — напишите самый подробный отчет результатов вашей работы. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/r0/be/i1/r0bei1ks8o-r_fbvmceorp_npf8.jpeg" data-src="https://habrastorage.org/webt/r0/be/i1/r0bei1ks8o-r_fbvmceorp_npf8.jpeg" data-blurred="true"/></p><br/>
<p>Вот я пишу суперподробный отчет по профилированию. В шапке есть отчеты по бизнес-составляющим, которые прочитают все. Это какую версию мы тестировали, какие дефекты нашли и какие узкие места были или не были. </p><br/>
<p>Ниже этой шапки, ниже бизнес-составляющей есть пошаговый процесс, какие окна я посмотрел, какие потоки смотрел, почему я решил, что это узкое место. Эту часть уже не будет читать никто: ни разработчики, ни менеджеры. Но ее прочитают ваши коллеги, которые при следующей итерации регрессионного тестирования, возможно, захотят проверить осталось ли это узкое место. Таким образом ваш подробный отчет – это своеобразная инструкция для ваших коллег. Это обучающий материал.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xx/rn/1w/xxrn1w2s6iu7b9iehqnya7qqkwa.jpeg" data-src="https://habrastorage.org/webt/xx/rn/1w/xxrn1w2s6iu7b9iehqnya7qqkwa.jpeg" data-blurred="true"/></p><br/>
<p>Кроме обучающего материала нужно написать саму инструкцию. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rp/ya/40/rpya40swjqdveohidlfkuyf3e8y.jpeg" data-src="https://habrastorage.org/webt/rp/ya/40/rpya40swjqdveohidlfkuyf3e8y.jpeg" data-blurred="true"/></p><br/>
<p>Первым делом рекомендую написать инструкцию, как выполнить профилирование в ручном режиме. Я вам рассказывал про Alpine и о том, как посмотреть версию, и т. д. Все это нужно задокументировать в том же Confluence. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/c5/mc/ml/c5mcmlgnk6vdat6o_n4p9v6gytu.jpeg" data-src="https://habrastorage.org/webt/c5/mc/ml/c5mcmlgnk6vdat6o_n4p9v6gytu.jpeg" data-blurred="true"/></p><br/>
<p>Инструкцию нужно не просто записать и сохранить в Confluence, а еще и снабдить видео. Я понял, что это важный шаг. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/6n/4w/-g/6n4w-gnqiyglhtfc0vclwaed1yy.jpeg" data-src="https://habrastorage.org/webt/6n/4w/-g/6n4w-gnqiyglhtfc0vclwaed1yy.jpeg" data-blurred="true"/></p><br/>
<p>И вот моя суперпростая диаграмма, что же делать, если вы написали инструкцию. </p><br/>
<p>Если вы написали инструкцию и решили замолчать о ней, то это неправильный вариант. Надо рассказать о ней. Если вы решили рассказать об инструкции и в где-то в чате скинули ссылку, то это тоже неправильный вариант. Вам нужно скинуть ссылку и прямо по шагам пройтись по инструкции, записав коротенькое видео минуты на 2. Что вот это я открываю, сюда кликаю, потому что кому-то проще воспринимать такой формат. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ih/kw/6y/ihkw6ykhtfn4xd3dl--2zshsl-g.jpeg" data-src="https://habrastorage.org/webt/ih/kw/6y/ihkw6ykhtfn4xd3dl--2zshsl-g.jpeg" data-blurred="true"/></p><br/>
<p>И среди тех, кому проще воспринимать такой формат, найдутся те, кто не сможет это сделать с первого раза. И тут я рекомендую вам парное профилирование и анализ результатов профилирования. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pd/5l/fx/pd5lfxbnv9c07cxmegiky0lfoae.jpeg" data-src="https://habrastorage.org/webt/pd/5l/fx/pd5lfxbnv9c07cxmegiky0lfoae.jpeg" data-blurred="true"/></p><br/>
<p>Т. е. кроме того, что вы рассказали инструкцию о том, что она существует и, возможно, даже записали видео, приложили скрипты, попробуйте спрофилировать какой-то сервис чужими руками. По Skype подключитесь, пусть он расшарит экран. И он будет выполнять все эти действия с вашей помощью, с вашими подсказками, но сам. В этом случае это сильно отложится в памяти и будет большим подспорьем для человека.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/-e/u4/c9/-eu4c95cm2dg8hrk5wfrg3ohbdo.jpeg" data-src="https://habrastorage.org/webt/-e/u4/c9/-eu4c95cm2dg8hrk5wfrg3ohbdo.jpeg" data-blurred="true"/></p><br/>
<p>И последний шаг – это записать все в виде скриптом автоматизации, чтобы это выполнялось как-то совсем просто. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ht/gp/cu/htgpcu303cw7nimg3mi114fnqmc.jpeg" data-src="https://habrastorage.org/webt/ht/gp/cu/htgpcu303cw7nimg3mi114fnqmc.jpeg" data-blurred="true"/></p><br/>
<p>Как вы поняли, автоматизировать надо не сильно много вещей. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ll/tv/ts/lltvtsd4ihdl48bfjthcoevyu2i.jpeg" data-src="https://habrastorage.org/webt/ll/tv/ts/lltvtsd4ihdl48bfjthcoevyu2i.jpeg" data-blurred="true"/></p><br/>
<p>Нужно примонтировать, загрузить какие-то файлы в поду. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/if/3c/vm/if3cvmcusuyktyj41vwqwv0_ida.jpeg" data-src="https://habrastorage.org/webt/if/3c/vm/if3cvmcusuyktyj41vwqwv0_ida.jpeg" data-blurred="true"/></p><br/>
<p>Нужно поменять Java options. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/pp/xx/0y/ppxx0yi2f6viesaw5q5scmxl1mu.jpeg" data-src="https://habrastorage.org/webt/pp/xx/0y/ppxx0yi2f6viesaw5q5scmxl1mu.jpeg" data-blurred="true"/></p><br/>
<p>Запустить процесс профилирования удаленно, локально. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ry/eg/zb/ryegzb1fkppn1nllxloiqzjd9le.jpeg" data-src="https://habrastorage.org/webt/ry/eg/zb/ryegzb1fkppn1nllxloiqzjd9le.jpeg" data-blurred="true"/></p><br/>
<p>И потом скачать результаты. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/4q/gb/0x/4qgb0xshn5lxnuc3eyuqb9j6xxi.jpeg" data-src="https://habrastorage.org/webt/4q/gb/0x/4qgb0xshn5lxnuc3eyuqb9j6xxi.jpeg" data-blurred="true"/></p><br/>
<p>Как вы понимаете, все это в Kubernetes возможно, например, с помощью Kubectl.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/zv/nj/6q/zvnj6qffcio68biuzjgsxjr0bau.jpeg" data-src="https://habrastorage.org/webt/zv/nj/6q/zvnj6qffcio68biuzjgsxjr0bau.jpeg" data-blurred="true"/></p><br/>
<p>А также с помощью Web-дашборда, который есть. Там, конечно, не совсем тривиальный способ будет по скачиванию результатов, но отдельные шаги можно реализовать. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/lm/2c/nl/lm2cnlzge9lu-3-oqq6dmbhtclo.jpeg" data-src="https://habrastorage.org/webt/lm/2c/nl/lm2cnlzge9lu-3-oqq6dmbhtclo.jpeg" data-blurred="true"/></p><br/>
<p>Или какие-то другие инструменты использовать. Мне понравился Lens.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ks/oy/so/ksoysogjqnxxcjeyhsuhuzzprq0.jpeg" data-src="https://habrastorage.org/webt/ks/oy/so/ksoysogjqnxxcjeyhsuhuzzprq0.jpeg" data-blurred="true"/></p><br/>
<p>Когда вы это сделали и заскриптовали, то к скриптам тоже напишите документацию, потому что программный продукт – это не только код, но и документация к нему. После того, как вы написали документацию, можно считать, что вы что-то заскриптовали.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/r3/3o/ph/r33oph19l_ck3ibskjd0-qqqq5m.jpeg" data-src="https://habrastorage.org/webt/r3/3o/ph/r33oph19l_ck3ibskjd0-qqqq5m.jpeg" data-blurred="true"/></p><br/>
<p>И когда у вас есть скрипты, неплохо бы поместить это в CI/CD окружение, чем я в текущий момент и стараюсь заниматься. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/0t/gb/gt/0tgbgtakij4edf5oyxuf2x-knfs.jpeg" data-src="https://habrastorage.org/webt/0t/gb/gt/0tgbgtakij4edf5oyxuf2x-knfs.jpeg" data-blurred="true"/></p><br/>
<p>На этом у меня, наверное, все. Надеюсь, совсем минимум белых пятен у вас осталось. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/bj/ez/oo/bjezoonjmvwwgoliudblncmktsw.jpeg" data-src="https://habrastorage.org/webt/bj/ez/oo/bjezoonjmvwwgoliudblncmktsw.jpeg" data-blurred="true"/></p><br/>
<p>Я вам рассказывал про то, что с переходом на микросервисы задач меньше не стало. Тут появилось много особенностей Kubernetes’а. Вам нужно профилировать больше сервисов.</p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/rf/cm/bn/rfcmbnisl78ihsu2va5j0atkulo.jpeg" data-src="https://habrastorage.org/webt/rf/cm/bn/rfcmbnisl78ihsu2va5j0atkulo.jpeg" data-blurred="true"/></p><br/>
<p>Топ-3 советов для Kubernetes такие:</p><br/>
<ol>
<li>Начали профилирование, добавьте чуть-чуть ресурсов и задайте какие-то границы для этих ресурсов. </li>
<li>При большой нагрузке лучше использовать семплирование локально, чем инструментацию удаленно. </li>
<li>И важный момент про Alpline. Я не знал раньше про такую особенность, что musl реализации инструментов как раз для него, а Alpline сейчас популярен. </li>
</ol><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/d_/gr/pi/d_grpigjqmd2hy-1pwebcx_8maq.jpeg" data-src="https://habrastorage.org/webt/d_/gr/pi/d_grpigjqmd2hy-1pwebcx_8maq.jpeg" data-blurred="true"/></p><br/>
<p>При выполнении анализа результатов профилирования стремитесь идти от крупного к мелкому, т. е. дробите-дробите. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/qp/hh/zn/qphhzndfso8nve9ftd63ncckco4.jpeg" data-src="https://habrastorage.org/webt/qp/hh/zn/qphhzndfso8nve9ftd63ncckco4.jpeg" data-blurred="true"/></p><br/>
<ul>
<li>Сначала оцените все визуально. </li>
<li>Соберите статистику. </li>
<li>И перейдите к деталям. Возможно, отфильтруете что-то по обращению в другие сервисы. </li>
<li>JProfiler и YourKit могут перехватывать SQL и HTTP-запросы.</li>
<li>С SJK несложно автоматизировать процесс формирования отчета. </li>
<li>И с JDK тоже такое можно. </li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/xh/v-/ge/xhv-gezaesqmvbvlydr4_1mhg9q.jpeg" data-src="https://habrastorage.org/webt/xh/v-/ge/xhv-gezaesqmvbvlydr4_1mhg9q.jpeg" data-blurred="true"/></p><br/>
<p>Обмен знаниями – это очень индивидуальный процесс. </p><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/ip/9g/-e/ip9g-egv9ik9ygljw4v3fglwruk.jpeg" data-src="https://habrastorage.org/webt/ip/9g/-e/ip9g-egv9ik9ygljw4v3fglwruk.jpeg" data-blurred="true"/></p><br/>
<ul>
<li>Документируйте все, что делаете. </li>
<li>Будьте терпеливы, когда объясняете и передаете знания. </li>
<li>И стремитесь делать так, чтобы при следующей итерации вам не нужно было повторять все снова, чтобы это было как-то автоматизировано. </li>
</ul><br/>
<p><img src="https://habrastorage.org/r/w780q1/webt/gq/lv/bj/gqlvbjh-0ilbyr7jmbyjszvz0wy.jpeg" data-src="https://habrastorage.org/webt/gq/lv/bj/gqlvbjh-0ilbyr7jmbyjszvz0wy.jpeg" data-blurred="true"/></p><br/>
<p>На этом у меня все. Я вам рассказывал про профилирование. Если у вас есть вопросы, я буду рад ответить на них. </p><br/>
<ul>
<li><p>(Владимир Ситников) У нас времени осталось мало, поэтому будут блиц-вопросы. Тебе Kubernetes нравится: да или нет?</p><br/>
</li>
<li><p>(Вячеслав Смирнов) Нравится. </p><br/>
</li>
<li><p>Профилировать Kubernetes нравится?</p><br/>
</li>
<li><p>Не очень. </p><br/>
</li>
<li><p>На монолит вернешься?</p><br/>
</li>
<li><p>Нет, не получится.</p><br/>
</li>
<li><p>Java или Go?</p><br/>
</li>
<li><p>Я пока что знаю только Java.</p><br/>
</li>
<li><p>Alpine или нет?</p><br/>
</li>
<li><p>Наверное, нет, слишком он урезанный.</p><br/>
</li>
</ul></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjava%5D" class="tm-tags-list__link">java</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bkubernetes%5D" class="tm-tags-list__link">kubernetes</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/java/" class="tm-hubs-list__link">
    Java
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/kubernetes/" class="tm-hubs-list__link">
    Kubernetes
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 13: ↑13 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 13: ↑13 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+13</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.9K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    62
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/chemtech/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/e18/935/57e/e1893557eeaacf388b0e596d910014c8.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 160 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    114.5
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">51.9</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Пацев Антон</span> <a href="/ru/users/chemtech/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @chemtech
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">DevOps-инженер</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <button type="submit" class="tm-user-card__button btn btn_transparent btn_small">
      Задонатить
    </button> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/583162/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 7 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/583162/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/583162/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"583162":{"id":"583162","timePublished":"2021-10-13T07:14:43+00:00","isCorporative":false,"lang":"ru","titleHtml":"Вячеслав Смирнов. Профилирование JVM в Kubernetes","leadData":{"textHtml":"\u003Cp\u003EВариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВячеславу повезло использовать разные инструменты. И повезло найти разные дефекты микросервисов на основе JVM. Спикер проанализировал, разделил инструменты и дефекты микросервисов на группы, и хочет рассказать о:\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eподборе профайлеров и их настройках под задачу;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eсобранных рецептах профилирования JVM в Kubernetes;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eмоментах, когда профилирование вредит, а когда помогает.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":114.5,"votesCount":160},"rating":51.9,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":"410012939892356","paymentPayPalMe":null,"paymentWebmoney":null},"id":"106514","alias":"chemtech","fullname":"Пацев Антон","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fe18\u002F935\u002F57e\u002Fe1893557eeaacf388b0e596d910014c8.jpg","speciality":"DevOps-инженер"},"statistics":{"commentsCount":7,"favoritesCount":62,"readingCount":2942,"score":13,"votesCount":13},"hubs":[{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true},{"relatedData":null,"id":"22196","alias":"kubernetes","type":"collective","title":"Kubernetes","titleHtml":"Kubernetes","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВячеславу повезло использовать разные инструменты. И повезло найти разные дефекты микросервисов на основе JVM. Спикер проанализировал, разделил инструменты и дефекты микросервисов на группы, и хочет рассказать о:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eподборе профайлеров и их настройках под задачу;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eсобранных рецептах профилирования JVM в Kubernetes;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eмоментах, когда профилирование вредит, а когда помогает.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВидео:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"oembed\"\u003E\u003Cdiv class=\"tm-iframe_temp\" data-src=\"https:\u002F\u002Fembedd.srv.habr.com\u002Fiframe\u002F61668741ad041b3b9bfdc792\" data-style=\"\" id=\"61668741ad041b3b9bfdc792\" width=\"\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Сергей Бойцов) Я бы хотел начать с легкого, разгоняющего вопроса. Микросервисы и Kubernetes – это наша новая реальность. Вы согласны с этим?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Вячеслав Смирнов) Скорее всего, да. Микросервисы есть сейчас почти во всех проектах так или иначе. Их выделают, даже если это большие сервисы, т. е. макросервисы, упакованные в контейнеры и раскатанные с помощью Kubernetes, чтобы они лучше масштабировались. Все равно их называют микросервисами. Так что эта новая реальность. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Владимир Ситников) Я вижу, что люди движутся и в одну, и другую сторону. Кто-то движется в сторону разделения, кто-то уже попробовал и движется в противоположную сторону, поэтому предсказывать, что будет через 5-10 лет я бы не стал. Я бы Вячеславу задал бы следующий вопрос. Когда был один монолит, то его как-то разработали, потом администраторы устанавливали и единороги-нагрузочники тестировали под нагрузкой. Когда делят на микросервисы, команды говорят, что мы сами с усами, все сами сделаем, все сами протестируем и не приставайте к нам. Слава, когда возникает Kubernetes, там нагрузочники вымирают или нет?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Вячеслав Смирнов) Не совсем. Есть множество технологий, которые обещают, что тестирование производительности не понадобится, но тестирование производительности нужно и профилирование в том числе, как некий такой следующий шаг после того, как вы получили результаты и они вам не понравились. Этот этап все равно остается. И о нем я как раз хочу рассказать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Сергей Бойцов) Здорово! Давайте тогда послушаем. Очень интересно. Задавайте вопросы в Телеграм-чат, чтобы что-то узнать, чему-то научиться. Потому что самое плохое – это незаданный вопрос. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Вячеслав Смирнов) Начнем.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhn\u002Fko\u002Fy8\u002Fhnkoy8r68jeazhjtozsvwrxx5me.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhn\u002Fko\u002Fy8\u002Fhnkoy8r68jeazhjtozsvwrxx5me.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ вам расскажу про профилирование JVM в Kubernetes. Я назвал этот доклад «Три больших шага». Меня зовут Вячеслав и я из ВТБ.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fno\u002Fyo\u002F14\u002Fnoyo14dncvmsz8etcbvlykvddqc.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fno\u002Fyo\u002F14\u002Fnoyo14dncvmsz8etcbvlykvddqc.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ ВТБ занимаюсь тем, что исследую и создаю результаты нагрузки. Проект у меня называется ДБО. Если вам интересно, то зайдите на сайт vtbbo.ru.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКроме работы занимаюсь развитием чата @qa_load, где помогаю инженерам. Помогаю я не один. Там мы делимся опытом. Отвечаем на вопросы тех, кто впервые начал заниматься тестированием производительности. У них вопросов много. Мы общаемся достаточно дружелюбно. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpa\u002Fce\u002Fll\u002Fpacellg1cksokuumrupaltjwpmy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpa\u002Fce\u002Fll\u002Fpacellg1cksokuumrupaltjwpmy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПроект, который мы нагружаем, можно описать в двух словах. Это 100 Java Virtual Machines, работающие друг с другом и с базой данной. Это так на тестовом стенде. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа продуктивном стенде он гораздо мощнее, он геораспределенный. Там более 200 микросервисов. С учетом геораспределения можно сказать, что даже более 400, но они так или иначе совпадают с тем, что есть на тестовом стенде. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДоклад посвящен как раз профилированию на тестовом стенде, где вам можно в любой момент перезапустить поду, поменять какие-то настройки, поэкспериментировать, поэтому он пригодится в таком случае. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F-8\u002Feu\u002Fte\u002F-8eute6bkrpgmrwly6qrungumwu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-8\u002Feu\u002Fte\u002F-8eute6bkrpgmrwly6qrungumwu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРасскажу про особенности профилирования JVM в Kubernetes. Что же именно добавил Kubernetes? \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ffy\u002Fvw\u002Fqn\u002Ffyvwqnlxidncyzyl5yf29pkh9zo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffy\u002Fvw\u002Fqn\u002Ffyvwqnlxidncyzyl5yf29pkh9zo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EKubernetes добавил выделение ресурсов для нужд профилирования: что есть различные requests, есть различные лимиты и об этом надо помнить.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Faq\u002Fcm\u002Fhi\u002Faqcmhi1x4ii3mja-gzsilztu8u0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Faq\u002Fcm\u002Fhi\u002Faqcmhi1x4ii3mja-gzsilztu8u0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРасскажу о том, как выполнять анализ результатов, как перейти от анализа потоков к детализации что же в этом потоке выполняется и перейти на код. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fat\u002F_d\u002Fqg\u002Fat_dqghy94xma1hxtqnvrucxpdm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fat\u002F_d\u002Fqg\u002Fat_dqghy94xma1hxtqnvrucxpdm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТут будет интересный момент, как оценить взаимодействие микросервисов. Например, есть медленно работающий запрос. Он работает медленно, потому что мы ждем ответа от другого сервиса.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbw\u002F9z\u002Fv7\u002Fbw9zv7quv5invqoahxjiwnxc5t0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbw\u002F9z\u002Fv7\u002Fbw9zv7quv5invqoahxjiwnxc5t0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ расскажу, как стандартизировать процесс профилирования в большой команде. У нас в команде 6 человек. Ее уже можно назвать большой командой. Я не везде такие команды видел. Тут уже требуется масштабирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fn6\u002Fyb\u002F0i\u002Fn6yb0i_cemtrulu9t-swaq7l7z0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fn6\u002Fyb\u002F0i\u002Fn6yb0i_cemtrulu9t-swaq7l7z0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ следующий этап – это обмен знаниями, т. е. как масштабировать, как обменяться знаниями, как стандартизировать все, чтобы процесс мог выполнять любой человек на любом количестве контуров, пусть у вас даже 3 Kubernetes-кластеров.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjq\u002Ffx\u002Flg\u002Fjqfxlgdqjt-g6lu0tltbx1hshpw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjq\u002Ffx\u002Flg\u002Fjqfxlgdqjt-g6lu0tltbx1hshpw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДоклад можно представить, как сложный пазл. И мы по кусочкам будем его собирать. Расскажу про мелкие детали и про крупные блоки. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frg\u002Fdl\u002Fwy\u002Frgdlwydjpktsp3qdjoe7zb2rob4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frg\u002Fdl\u002Fwy\u002Frgdlwydjpktsp3qdjoe7zb2rob4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНачнем с первого этапа. Какие есть в Kubernetes особенности при профилировании? Что он добавляет сам Kubernetes в весь процесс?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fue\u002Fuc\u002Fvr\u002Fueucvr86lmuossfg2c3zqfzdzry.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fue\u002Fuc\u002Fvr\u002Fueucvr86lmuossfg2c3zqfzdzry.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРаньше мы проводили два вида тестирования: нагрузочный и стабильности, т. е. находили максимум во время нагрузки. И во время стабильности подтверждаем, что в найденном максимуме 8-10 часов держится система и не падает.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА теперь, как минимум, нужно еще тестирование масштабируемости.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F1f\u002F6l\u002Fqb\u002F1f6lqbeawdsvhb31ql_xujtfioo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F1f\u002F6l\u002Fqb\u002F1f6lqbeawdsvhb31ql_xujtfioo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПосле того, как вы провели 3 вида тестирования, во всем этом есть еще одна особенность. Заказчику интересно уже не только число, что мы достигаем такой-то производительности. Важен и второй фактор. Заказчик спрашивает: «Сколько реплик сервису нужно? Какие настройки нужны? Сколько ресурсов нам нужно на кластер, чтобы все это работало достаточно производительно». Т. е. появляются дополнительные вопросы. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frs\u002Fsg\u002Fgk\u002Frssggk75w04ddavxozg43awhzie.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frs\u002Fsg\u002Fgk\u002Frssggk75w04ddavxozg43awhzie.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСамый легкий – это вопрос настроек, т. е. мы ничего не масштабируем, а меняем настройки. Поменяли некоторые конфигурации и все стало быстрее. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fem\u002Ftx\u002Fz2\u002Femtxz2pxcgyzmabgmqv7h804zpw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fem\u002Ftx\u002Fz2\u002Femtxz2pxcgyzmabgmqv7h804zpw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли мы настройками справиться не можем и натыкаемся на то, что на тестовом стенде закончились ресурсы, то появляется интересная задача – ускорение всей этой системы. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМне очень повезло. Я попал в команду ВТБ, когда как раз этих ресурсов не хватало, и команда занималась ускорением. Поэтому я набрался опыта по ускорению Kubernetes-кластера. И первое время занимался не столько рутинной работой по запуску тестов, сколько профилированием. И могу поделиться этим. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКогда вы начнете ускорение, сначала нужно посмотреть на результаты мониторинга, на логи. И, предположим, вы по результату мониторинга, по логам, по высокоуровневым метрикам не смогли найти способ оптимизировать систему. Условно, есть у нас кластер, 10 серверов. В него влезает 100 сервисов. Зафиксировали, промониторили и так ничего не смогли найти. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fci\u002Fcw\u002Fr8\u002Fcicwr8ggfvoj9d1htdfhbksfrw8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fci\u002Fcw\u002Fr8\u002Fcicwr8ggfvoj9d1htdfhbksfrw8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТогда уже можно подключить профайлер. Можно не сильно масштабировать. И можно посмотреть изнутри JVM с помощью профайлера изменение каких настроек нам сможет помочь все это ускорить и сократить ресурсы. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F-5\u002F66\u002Fvo\u002F-566vo__nnajd120lysm07mzn90.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-5\u002F66\u002Fvo\u002F-566vo__nnajd120lysm07mzn90.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ несколько раз сказал уже о настройках. В Kubernetes принято увеличивать производительность системы очень просто, т. е. увеличивать количество реплик. Считается, что 2 реплики работают быстрее, чем одна. Но на самом деле нет. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсть способ не увеличивать количество реплик, а увеличивать количество потоков внутри каждой реплики. Если мы говорим про JVM, то тут, как правило не однопоточное приложение, а многопоточное. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpz\u002Fxy\u002Fjo\u002Fpzxyjoozcc7iqxdc7ilye3orus0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpz\u002Fxy\u002Fjo\u002Fpzxyjoozcc7iqxdc7ilye3orus0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ написал несложный алгоритм, чтобы понять нужно ли нам сейчас реплики увеличивать или нет.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у нас приложение однопоточное, но упакованное в Kubernetes и у нас нет возможности количество потоков изменить, то чтобы его масштабировать, будем увеличивать количество реплик. И это черный прямоугольник снизу. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА если количество потоков можно менять, то стоит попробовать их увеличить или уменьшить, т. е. как-то настроить, чтобы добиться лучшей производительности. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли производительность при этом увеличивается и после увеличения пула потоков у нас все еще есть свободные ресурсы, то можем этот процесс повторять до тех пор, пока мы не упремся в лимит нашего контейнера, в лимит нашей поды.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ когда мы уже уперлись в лимит нашей поды (можем создавать там 2-3-4 поды), то мы знаем, что для 50 потоков нужна такая конфигурация. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Feb\u002Fai\u002Flu\u002Febailuzkmgbw455pa4avsqrti3u.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feb\u002Fai\u002Flu\u002Febailuzkmgbw455pa4avsqrti3u.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри увеличении количества реплик аналогичная ситуация. Если мы изменяем количество реплик, и становится быстрее, и при этом у нас еще есть свободные ресурсы, то мы можем этот процесс наращивать, т. е. проводить тестирование масштабируемости.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА если мы увеличиваем количество реплик, например, сделали вместо одной две, но быстрее не становится, то это второй момент, когда нам нужно подключить профайлер или какие-то другие инструменты, которые нам помогут узнать, почему не становится быстрее. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F69\u002Fck\u002Fpk\u002F69ckpkrzaa1bilzcohazqfzeeho.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F69\u002Fck\u002Fpk\u002F69ckpkrzaa1bilzcohazqfzeeho.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКакие это могут быть инструменты? Это тоже хороший вопрос. В Kubernetes не все так однозначно. Иногда Kubernetes JVM профайлер не нужен.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Flt\u002Fma\u002Fwx\u002Fltmawxervogkegzhaz-guekjcms.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flt\u002Fma\u002Fwx\u002Fltmawxervogkegzhaz-guekjcms.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EЕсть цикл тестирования, где мы сначала проводим регрессионный тест, т. е. просто сравниваем. Например, была версия 1, у нее производительность стала версия 2. И ее метрики в JMeter, Gatling сравниваем. И можем определить узкое место, если видим деградацию по той дельте изменений, которая была между версией 1 и версией 2. И даже можем определить место, которое сильнее всего тормозит. \u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли нужно копнуть глубже, то нужно посмотреть на статистику балансировщика нагрузки, детализацию по логам ошибок, если вдруг в новой версии появились ошибки. \u003C\u002Fli\u003E\r\n\u003Cli\u003EМожем посмотреть на бизнес-метрики производительности. Например, посмотреть в Яндекс.Метрике, Google Analytics, как там пользователь на prod’е чувствует себя. В нашем проекте есть встроенные метрики внутренней производительности. \u003C\u002Fli\u003E\r\n\u003Cli\u003EКроме этих метрик, как правило, во всех Kubernetes-инсталляциях есть такие сервисы, как Zipkin, Jaeger, которые собирают статистику за счет трассировки запросов при передачи их от микросервиса к сервису. Это более детальная статистика, чем даже в самом JMeter. \u003C\u002Fli\u003E\r\n\u003Cli\u003EКроме того, не стоит забывать про мониторинг системных метрик. \u003C\u002Fli\u003E\r\n\u003Cli\u003EМониторинг более внутренних метрик, например, внутри JML, SQL\u003C\u002Fli\u003E\r\n\u003Cli\u003EИ если после всего этого объема информации вам недостаточно, то тогда 7-ым этапом можно запрофилировать JVM. \u003C\u002Fli\u003E\r\n\u003Cli\u003EПрофилировщик сможет найти не все. Иногда в моей практике пригождаются утилиты strace, perf и другие, которые позволяют найти то, что изнутри JVM не видно. \u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fut\u002Fyp\u002Fsy\u002Futypsyb5bqbndmilhkg7_yi-xnw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fut\u002Fyp\u002Fsy\u002Futypsyb5bqbndmilhkg7_yi-xnw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли это визуализировать как-то в картинку, то визуализацию я смогу для вас изобразить вот такую. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот у вас есть браузер, т. е. клиент. Этот браузер обращается к вашему сервису. Он представляет из себя 4 сервиса переднего уровня и там есть 100 микросервисов на бэке. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ нам нужно определить, какой микросервис самый медленный. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fme\u002Fnl\u002Fec\u002Fmenleca841tcol15pzhtkoptijm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fme\u002Fnl\u002Fec\u002Fmenleca841tcol15pzhtkoptijm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧтобы это определить, нам не обязательно использовать профилировщик. Нам хватит отчета по нагрузке. Т. е. такая статистика будет в JMeter, Gatling. А также бизнес-метрики или даже статистики по логам. В том же nginx можно настроить детальное логирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F8b\u002F2r\u002Fqu\u002F8b2rquowmcgk7zjs3f7ctqqip3g.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8b\u002F2r\u002Fqu\u002F8b2rquowmcgk7zjs3f7ctqqip3g.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПредположим, вам нужно определить, при каких параметрам этого запроса данный микросервис более медленный.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fd0\u002F0t\u002Ffo\u002Fd00tfocuhv-mppwu4m0ry-ongtq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fd0\u002F0t\u002Ffo\u002Fd00tfocuhv-mppwu4m0ry-ongtq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭто в отчете по нагрузке, если вы эти параметры использовали или в более детальных логах. Там можно уровень логирования поднять и узнать все детали, т. е. какой же параметр приводит к замедлению. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fz7\u002Fr2\u002F6b\u002Fz7r26b02hn-uawasgkfbssbsope.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fz7\u002Fr2\u002F6b\u002Fz7r26b02hn-uawasgkfbssbsope.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли бы у нас был монолит, мы бы тыкали в какую-нибудь url монолита и желали узнать, что внутри приложения тормозит, т. е. какой модуль, компонент, то, скорее всего, мы бы взяли профайлер. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ffz\u002Fcd\u002F8g\u002Ffzcd8g9zai1ux-dch6rtt2wz5ms.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffz\u002Fcd\u002F8g\u002Ffzcd8g9zai1ux-dch6rtt2wz5ms.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы бы профилировали этот монолит и сказали, что тормозит. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fad\u002Fb4\u002Fo1\u002Fadb4o1q66jgx0afilusmault95w.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fad\u002Fb4\u002Fo1\u002Fadb4o1q66jgx0afilusmault95w.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА с микросервисами не так все просто. Нет единого исполняемого файла. У нас целая россыпь микросервисов. Они общаются друг с другом. Каждый из них может самостоятельно ходить в базу и другие системы. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frl\u002Ffj\u002Fmv\u002Frlfjmvtlu7czo866k0reyekmpxq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frl\u002Ffj\u002Fmv\u002Frlfjmvtlu7czo866k0reyekmpxq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ тут очень полезными являются инструменты Zipkin и Jaeger, которые трассируют запросы между сервисами и предоставляют полезную статистику. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EО чем я? О том, что профайлер нужен не всегда. Иногда могут пригодиться и другие инструменты, чтобы закрыть все ваши нужды. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fr2\u002Fzr\u002F_q\u002Fr2zr_qyrsnbxforlbmsf6uvf09q.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fr2\u002Fzr\u002F_q\u002Fr2zr_qyrsnbxforlbmsf6uvf09q.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧуть ранее я упоминал о особенности Kubernetes, что при начальном масштабировании мы можем увеличивать количество потоков.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо бывает и обратная ситуация, когда потоков внутри нашего приложения изначально очень много, т. е. больше, чем нужно. И если мы занялись профилированием, и мой доклад об этом, то расскажу вам, как влияет количество ненужных потоков на эффективность профилирования. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjx\u002Fww\u002F4a\u002Fjxww4at_gvfph3dyxu5nvheoqum.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjx\u002Fww\u002F4a\u002Fjxww4at_gvfph3dyxu5nvheoqum.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСамый частый способ профилирования, который использую я, это вычисление процента активности того или иного метода. Делается это, как правило семплированием. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ JFR, SJK, AsyncProfiler, VisualVM и т. д. есть режим семплирования. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fez\u002Feo\u002Fbi\u002Fezeobiclkpy1rtwsw7plzhmmfai.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fez\u002Feo\u002Fbi\u002Fezeobiclkpy1rtwsw7plzhmmfai.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы не знаете, что это такое, то вы наверняка знаете, что такое Stack Trace. Видели это в логах или в различных инструментах. Это последовательность вызовов Java-методов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxg\u002Fgs\u002Fcc\u002Fxggsccv90e3ydb1_-wfsq0u1wfs.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxg\u002Fgs\u002Fcc\u002Fxggsccv90e3ydb1_-wfsq0u1wfs.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ если накопить статистику по этим Stack Trace, то можно что-то понять. Например, вот у нас 4 раза метод putVal, 8 раз метод sample в строчке 613. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F7s\u002Fxm\u002Fa5\u002F7sxma5tbbst7xvkh7z6ohyjctro.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F7s\u002Fxm\u002Fa5\u002F7sxma5tbbst7xvkh7z6ohyjctro.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ накапливаю, накапливаю и получаю статистику, какие методы у меня более часто встречаются во время работы потока, какие менее часто. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhx\u002Feq\u002Fiy\u002Fhxeqiyh3u2li6ztyk9_seazgvyi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhx\u002Feq\u002Fiy\u002Fhxeqiyh3u2li6ztyk9_seazgvyi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ как на сбор этой статистики, т. е. на процесс семплирования, влияет количество потоков? Чтобы это определить, я собрал небольшой тестовый стенд. У меня был один сервис, принимающий запросы по http. В нем можно было менять количество потоков от 200 (по умолчанию) до 5. И использовать JMeter, который подавал нагрузку всего лишь тремя потоками. Т. е. чтобы со всеми этими запросами справится, сервису достаточно тоже всего лишь 3 потока у себя. Все остальные спали и ждали, когда к ним перепадет запрос и перепрофилироваться с помощью SJK.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F0t\u002Ffg\u002Fbg\u002F0tfgbg5j69e6hkcsmwxofzb6m9k.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F0t\u002Ffg\u002Fbg\u002F0tfgbg5j69e6hkcsmwxofzb6m9k.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКакие результаты я получил? Получил такие результаты, что запросы в среднем выполнялись 100 миллисекунд. Самые тяжелые методы – 10 миллисекунд. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fdw\u002Fmy\u002Fvz\u002Fdwmyvz-0afchhl4zuousixldfh8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdw\u002Fmy\u002Fvz\u002Fdwmyvz-0afchhl4zuousixldfh8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ когда у меня было 120 лишних потоков, то SJK, профилируя все активные потоки, в том числе 120 спящих, собирал метрики с интенсивностью 90 раз в секунду. Получается, что в среднем каждые 11 миллисекунд он лишь собирал stack trace. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри такой интенсивности он мог легко пропустить Java-методы, которые работают даже в среднем быстрее. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzt\u002F9j\u002Fdo\u002Fzt9jdolj-2ob45jrzlxilqpjjtg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzt\u002F9j\u002Fdo\u002Fzt9jdolj-2ob45jrzlxilqpjjtg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКонечно, он ловит все http-запросы, т. е. кто их отправляет и как долго ждет, а Java-методы может легко пропустить. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fv_\u002Fcr\u002Fhq\u002Fv_crhqlaf2mkeqp3t4nfiydzxd8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fv_\u002Fcr\u002Fhq\u002Fv_crhqlaf2mkeqp3t4nfiydzxd8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли снизить количество потоков до 20, оставить только 20 спящих, то частота семплирования гораздо выше становилась. И уже интервал семплирования снижался до 3 миллисекунд. Это значит, что туда попадали даже те методы Java, которые быстрее, чем средние. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fko\u002Fzb\u002Fz2\u002Fkozbz2nh_164ot54ppj1vzjgd5i.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fko\u002Fzb\u002Fz2\u002Fkozbz2nh_164ot54ppj1vzjgd5i.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРезультаты можно представить на таком графике. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F6a\u002Fby\u002Ftu\u002F6abyturr-ucm3avblx9j2gjybog.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F6a\u002Fby\u002Ftu\u002F6abyturr-ucm3avblx9j2gjybog.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ провел серию замеров. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fec\u002Fdp\u002Frx\u002Fecdprxigdzbocka_ie5edcfwsdi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fec\u002Fdp\u002Frx\u002Fecdprxigdzbocka_ie5edcfwsdi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли снизить количество потоков со 120 до 20, то у нас интенсивность семплирования повышается в 3 раза.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhl\u002Fch\u002Fha\u002Fhlchhadip95mvx6lde19gvo7c5s.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhl\u002Fch\u002Fha\u002Fhlchhadip95mvx6lde19gvo7c5s.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА по умолчанию tomcat.mat-threads – это 200 потоков. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли постепенно снижаться с 200 до 5, то интенсивность повышается в 5 раз. Это о том, что не только увеличение количества потоков полезно. Для задач профилирования снижение – это тоже интересный момент, хоть и неочевидный.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fdk\u002F3i\u002F9g\u002Fdk3i9guxkkh1cde_zjbkdrbk7vu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdk\u002F3i\u002F9g\u002Fdk3i9guxkkh1cde_zjbkdrbk7vu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКакая получалась частота семплирования в SJK? Я измерял с помощью команды ssa, которая есть в SJK. Это Stack Analyzer. Выводил колонку интенсивности, которая получилась. И смотрел, что по интенсивности получается. В данном случае почти 60 раз в секунду.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F5d\u002Fij\u002Fix\u002F5dijixusurfrqnkpk--rr4zv40w.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F5d\u002Fij\u002Fix\u002F5dijixusurfrqnkpk--rr4zv40w.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСледующей особенностью в Kubernetes является влияние CPU Limit на профилирование и на сам процесс профилирования. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fd-\u002Ftl\u002Ftw\u002Fd-tltwba3ewxip9b5ma82iog7wk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fd-\u002Ftl\u002Ftw\u002Fd-tltwba3ewxip9b5ma82iog7wk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ использовал тот же самый стенд, но в нем ограничил возможности использования процессора данным сервисом до 1 ядра. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxe\u002Fny\u002Ffu\u002Fxenyfuuixezdfu-ijy16tivghyi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxe\u002Fny\u002Ffu\u002Fxenyfuuixezdfu-ijy16tivghyi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПолучились следующие результаты. Когда я не ограничивал, то я собирал интенсивность метрики 90 раз в секунду, а как ограничил, и весь сервис замедлился, то интенсивность профилирования снизилась. Стало всего лишь 7 раз в секунду. И с такой интенсивностью я не поймаю различные супербыстрые метрики. Т. е. при неправильной настроенном лимите и запуске профилирования можно хорошие метрики не собрать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fnr\u002F4k\u002F0g\u002Fnr4k0gjy_cm5abykzmeh5cx1x94.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fnr\u002F4k\u002F0g\u002Fnr4k0gjy_cm5abykzmeh5cx1x94.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПримеры показали, что SJK на большом количестве потоков затрачивает где-то 0,36 ядра. Об этом надо помнить. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fac\u002F-a\u002Fbw\u002Fac-abwzfp_kwlr-myugumevx6-k.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fac\u002F-a\u002Fbw\u002Fac-abwzfp_kwlr-myugumevx6-k.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ если вы начали профилирование в Kubernetes, то чуть-чуть добавьте для накладных расходов самого профайлера CPU, т. е. поднимите лимит. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fje\u002Fjp\u002Fvp\u002Fjejpvpqi6ba_kh5cktlhoqlk2nw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fje\u002Fjp\u002Fvp\u002Fjejpvpqi6ba_kh5cktlhoqlk2nw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы не можете поднять, то можете просто снизить интенсивность семплирования. Это настраивается во всех профайлерах. В VisualVM, например, интенсивность семплирования по умолчанию 100 миллисекунд. И такую же интенсивность можно задать во всех других профайлерах. Но в этом случае вам нужно будет профилировать чуть подольше. Не 10-30 секунд, а, например, 10 минут профилировать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbz\u002F3d\u002F_x\u002Fbz3d_xjbzgvmq5b1hdvjrcxadxm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbz\u002F3d\u002F_x\u002Fbz3d_xjbzgvmq5b1hdvjrcxadxm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКроме CPU Limit в Docker и Kubernetes есть Memory Limit. Он также влияет на профайлер, но уже на другие. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fur\u002Fzj\u002Fpr\u002Furzjprtm956dvkebbpdqmixc4da.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fur\u002Fzj\u002Fpr\u002Furzjprtm956dvkebbpdqmixc4da.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЗдесь несколько иная задача профилирования. Задача посчитать не просто процент активности, а посчитать точную длительность и количество выполнений каждого метода. И это позволяют уже выполнить инструментирующие профайлеры. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСреди тех, которые я успешно пробовал, могу назвать VisualVM. В режиме Startup Profiler его можно подключить и запрофилировать в таком инструментирующем виде. А также JProfiler и YourKit Java Profiler.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fiw\u002Fn8\u002Fgz\u002Fiwn8gzq1_-zikndj9kslg1zc7g8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fiw\u002Fn8\u002Fgz\u002Fiwn8gzq1_-zikndj9kslg1zc7g8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧто такое инструментация? Если ее описывать в виде схемы, то это непростой процесс при работе с JVM профайлером. Например, для C проектов инструментация есть на уровне компилятора. В GCC вы можете заинструментировать компилируемый код и получить там какие-то метрики. И все эти метрики будут на уровне исходников туда вшиты, и выполняться до запуска. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА при JVM инструментации более популярен подход на лету с помощью JVM-агентов, когда меняется JVM Byte-код. Это уникальная фишка JVM. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbr\u002F_z\u002Fqv\u002Fbr_zqvbb1zfcxqojjp-glpnvwqo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbr\u002F_z\u002Fqv\u002Fbr_zqvbb1zfcxqojjp-glpnvwqo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКогда ваше приложение запустилось, в нем уже 1 000 классов, различные объекты, и вы начинаете каждый класс перелопачивать, т. е. до запуска каждого метода вставлять некий быстрый, но все же код, то это все потребует дополнительных расходов памяти. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ffk\u002Fd5\u002Fv5\u002Ffkd5v53vfw535q-s6kcanqbhipw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffk\u002Fd5\u002Fv5\u002Ffkd5v53vfw535q-s6kcanqbhipw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ сам процесс инструментации потребует дополнительных расходов процессора. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы сталкивались в команде с такими эффектами, что приложение падало из-за недостатка ресурсов памяти, если сделали вот такое инструментирующие профилирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fez\u002Fsd\u002Fqu\u002Fezsdqu_gsg5t2tv7rguza6tnx7y.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fez\u002Fsd\u002Fqu\u002Fezsdqu_gsg5t2tv7rguza6tnx7y.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТут общая рекомендация, что если вы запускаете еще инструментирующее профилирование с помощью JVM-агента, то добавьте себе в поду немножко памяти тоже. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы явно не влияете в вашей поде на размер heap size, т. е. Xmx, а влияете только на лимит. Например, Xmx вычисляется с помощью MAX_MEM_RATIO, есть такая опция в некоторых контейнерах. И чтобы добавить 1 гигабайт, вам нужно лимит поднять на + 2 гигабайта. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fmf\u002Fmh\u002Fag\u002Fmfmhagbahjpvucxqhhuhmdp3mom.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fmf\u002Fmh\u002Fag\u002Fmfmhagbahjpvucxqhhuhmdp3mom.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТак или иначе помните, что нужно добавлять ресурсы, если вы делаете тяжелое профилирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxg\u002Fdw\u002Fgw\u002Fxgdwgwqbitjwambd7m5xey00nhw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxg\u002Fdw\u002Fgw\u002Fxgdwgwqbitjwambd7m5xey00nhw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПочему это важно? Что это за такие ресурсы? Можно описать это двумя словами.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fvp\u002Fbb\u002Fsf\u002Fvpbbsfxd4iimvon-fumqlrdbpe0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fvp\u002Fbb\u002Fsf\u002Fvpbbsfxd4iimvon-fumqlrdbpe0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот здесь request, т. е. внутренняя граница контейнера. И есть лимит – внешняя граница контейнера. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДля контейнера можно задавать только request – это первая картинка. И делать его изначально маленьким. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМожно задавать маленький request и достаточно крупный лимит – это вторая картинка. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНекоторые выбирают стратегию, когда request практически равен лимиту и он изначально большой. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНекоторые выбирают, когда request огромный, а лимит не задан. Это для тяжелых гибких сервисов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Foc\u002F7k\u002Fty\u002Foc7ktyjyeruv_87sntqhaurbfag.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Foc\u002F7k\u002Fty\u002Foc7ktyjyeruv_87sntqhaurbfag.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА рекомендация – накинуть 1 гигабайт и 1 гигабайт CPU. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fob\u002Fok\u002Fnk\u002Foboknkoqudqd65v8ct-ra6gajke.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fob\u002Fok\u002Fnk\u002Foboknkoqudqd65v8ct-ra6gajke.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧто будет, если мы не накинем и у нас есть вот такая инсталляция, где есть профилируемые сервисы и в двух из них лимиты не заданы? \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fel\u002F7e\u002Fog\u002Fel7eog7bhmsoo6uqfpfae85uvf0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fel\u002F7e\u002Fog\u002Fel7eog7bhmsoo6uqfpfae85uvf0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСначала они будут маленькими. Под нагрузкой, конечно, сервисы начнут потреблять больше ресурсов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fsu\u002Fwm\u002Fcy\u002Fsuwmcynefsoiton-igolgkiwsqk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsu\u002Fwm\u002Fcy\u002Fsuwmcynefsoiton-igolgkiwsqk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ вот они все выросли.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fju\u002Fls\u002Fb7\u002Fjulsb7wg_ofa81vx_9ayoi9ujjg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fju\u002Fls\u002Fb7\u002Fjulsb7wg_ofa81vx_9ayoi9ujjg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ первому центральному сервису стало не хватать ресурсов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли ему не хватает CPU, то ничего страшного не случится. Как я вам рассказал, интенсивность семплирования снизится, т. е. она застынет на какой-то планке. Возможно, это будет даже 7 sample в секунду, но ничего не случится.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА если так случилось, что в приложение выделено heap в 2 гигабайта, а у нас физически на кластере остался один гигабайт памяти, то JVM будет думать, что ей можно выделить столько памяти, а физически столько памяти нет. И контейнер, т. е. приложение упадет по out of memory error. В этом случае весь контейнер схлопнется и перезапустится. Там начнется все с начала. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxv\u002Fcw\u002F5u\u002Fxvcw5un_udsqedu0kc3gu0p5quq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxv\u002Fcw\u002F5u\u002Fxvcw5un_udsqedu0kc3gu0p5quq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо процесс профилирования прекратиться, т. е. что-то разломается, сессию с профайлером мы потеряем.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjf\u002Fpy\u002Fes\u002Fjfpyes6uch7_fhwdjkf6s84rbiw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjf\u002Fpy\u002Fes\u002Fjfpyes6uch7_fhwdjkf6s84rbiw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВторой случай, если у нас лимит задан, но не у всех. Сначала тоже будет все хорошо. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbl\u002Fjn\u002F9l\u002Fbljn9lh1kxy3d3zuvhueg8febwm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbl\u002Fjn\u002F9l\u002Fbljn9lh1kxy3d3zuvhueg8febwm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы начнем подавать нагрузку. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyj\u002Fdx\u002F2s\u002Fyjdx2sbj7xwq3s6vitbc4l8m3ji.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyj\u002Fdx\u002F2s\u002Fyjdx2sbj7xwq3s6vitbc4l8m3ji.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКонтейнеры начнут потреблять больше ресурсов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fvw\u002Frg\u002Fz-\u002Fvwrgz-ohzmw4plbkxmhdpzuqdpq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fvw\u002Frg\u002Fz-\u002Fvwrgz-ohzmw4plbkxmhdpzuqdpq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ может так случиться, что одному из контейнеров, у которого лимит задан, ресурсов будет не хватать. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТут важный момент проявляется в особенностях самого Kubernetes. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fwg\u002Fnh\u002Fk2\u002Fwgnhk2qrqb4gb4a26lwnuejxfw8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fwg\u002Fnh\u002Fk2\u002Fwgnhk2qrqb4gb4a26lwnuejxfw8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли ресурсы можно выделить Kubernetes’у за счет того, чтобы погасить какие-либо сервисы, у которых ниже приоритет, чем у текущего, а если у нас лимит задан и приоритет выше, то Kubernetes так и поступит. Он возьмет другую поду, у которой лимит не задан и погасит ее, перезапустит ее. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fgd\u002Ftb\u002Fsu\u002Fgdtbsu9k3ufavyzkeb3cdxjmrsk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgd\u002Ftb\u002Fsu\u002Fgdtbsu9k3ufavyzkeb3cdxjmrsk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ этом случае данная пода не сломается, она получит свои ресурсы, но, возможно, сломается что-то еще. Сервис контроля доступа и профилирование или весь процесс все равно разрушатся, потому что что-то пошло не так. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ случае, если у нас всех сервисов по одной штуке, тогда вообще бизнес-процесс остановится. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fj7\u002Fij\u002Ffu\u002Fj7ijfurzgva2juo-vtwf8wdiatc.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fj7\u002Fij\u002Ffu\u002Fj7ijfurzgva2juo-vtwf8wdiatc.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ самый желательный вариант, когда везде лимиты заданы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxk\u002Fa-\u002Fe1\u002Fxka-e1xa1glk-yh7vymv9y1xmi0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxk\u002Fa-\u002Fe1\u002Fxka-e1xa1glk-yh7vymv9y1xmi0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы начинаем нагрузку. Сервисы были маленькие. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fmw\u002Fyi\u002Fxv\u002Fmwyixvzc7ouauiyu-v3fsv5j5ve.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fmw\u002Fyi\u002Fxv\u002Fmwyixvzc7ouauiyu-v3fsv5j5ve.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот они стали побольше. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbk\u002Fy8\u002F3m\u002Fbky83mem98kkdzv7zvwgl_huhww.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbk\u002Fy8\u002F3m\u002Fbky83mem98kkdzv7zvwgl_huhww.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ вот им ресурсов не хватило. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКакой тут вариант? Мы знаем, что этому сервису нужно столько-то ресурсов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fes\u002Fvy\u002Fng\u002Fesvyngwjwqij_fua2wtdkzehvjy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fes\u002Fvy\u002Fng\u002Fesvyngwjwqij_fua2wtdkzehvjy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ при профилировании накидываем чуть-чуть. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fci\u002Fql\u002Fte\u002Fciqltefefdlfb0fbqx8si-oaiu4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fci\u002Fql\u002Fte\u002Fciqltefefdlfb0fbqx8si-oaiu4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМожно 0,3-0,4, можно +1. И все будет работать, как будто бы и не было никакого профилирования. Это такая особенность Kubernetes.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fdg\u002Fnp\u002Flv\u002Fdgnplveff9n9r9hkxgpe3dqpbxs.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdg\u002Fnp\u002Flv\u002Fdgnplveff9n9r9hkxgpe3dqpbxs.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКакие есть особенности у самих профайлеров при работе с распределенными системами?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjy\u002Fcc\u002Fef\u002Fjyccef_fvympzg2kfup9r2ohp7k.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjy\u002Fcc\u002Fef\u002Fjyccef_fvympzg2kfup9r2ohp7k.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМожно все профайлеры и способы их подключения разделить на 2 больших типа: \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EМы подключаемся удаленно, т. е. запускаем профайлер у себя на рабочей станции и подключаемся к поде или сервису; \u003C\u002Fli\u003E\r\n\u003Cli\u003EМы подключаемся локально. \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F0w\u002Fms\u002Fhb\u002F0wmshbf1acm3uidnlupe6gc0tcg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F0w\u002Fms\u002Fhb\u002F0wmshbf1acm3uidnlupe6gc0tcg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСамый привычный, когда вы запускаете профайлер с графической оболочкой у себя на рабочей станции. Это удаленный вариант. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ чем его особенности? Его особенности в том, что вам нужно пробросить сетевое подключение от вашей рабочей станции до профайлера, т. е. есть несколько фишек самого Kubernetes. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F-5\u002F9y\u002Fg-\u002F-59yg-kunlq-x0fudevwcprhn84.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-5\u002F9y\u002Fg-\u002F-59yg-kunlq-x0fudevwcprhn84.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EПредположим, вам нужен доступ до поды лишь на время. Тогда воспользуйтесь kubectl и ее опцией PortForward с пробросом локального порта в поду. \u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЕсли вам нужен постоянный доступ, то проще зафиксировать выставление порта для профилирования из пода наружу, например, задав эти настройки уже в сервисе. \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EОчень удобно делать, если ваш сервис всегда заскейлен в 1. В этом случае вы всегда, начиная профилирование, будете попадать в профилируемую вами поду. \u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЭто можно сделать через NodePort.\u003C\u002Fli\u003E\r\n\u003Cli\u003EМожно сделать через LoadBalancer.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EА если вы заскейлили сервис в две реплики и хотите сделать тоже самое через внешний порт, то, скорее всего, не получится. \u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EПотому что ваш профайлер будет обращаться за результатами профилирования в поду. И будет попадать то на первую, то на вторую. И профилирование не получится. Или получится каким-то неправильным. Это единственное такое ограничение.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzu\u002Fjw\u002Fl_\u002Fzujwl_cdori5hc-glk_viw41yfu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzu\u002Fjw\u002Fl_\u002Fzujwl_cdori5hc-glk_viw41yfu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы выбрали такой способ, то две техники: с помощью Java-агента и с помощью технологии JSR 160 Standard, где вам нужно открыть два порта: JMX и RMI и пробросить их себе.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyb\u002Fbv\u002Fxe\u002Fybbvxexf5ssclntovjxgb49vrvi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyb\u002Fbv\u002Fxe\u002Fybbvxexf5ssclntovjxgb49vrvi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРасскажу сначала про этот вариант. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fad\u002F-0\u002Fdq\u002Fad-0dq51cb2aap0zrpqkhzc-m0u.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fad\u002F-0\u002Fdq\u002Fad-0dq51cb2aap0zrpqkhzc-m0u.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧтобы открыть эти порты JMX, RMI, вам понадобится в опции JVM запускаемого сервиса внутри докера добавить вот такой перечень опций. Как правило, я задаю такие опции в deployment-файле. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот вы открываете порт 9010. Можно и для JMX, и для RMI задать одинаковый порт. В данном случае это не критично. И с помощью kubectl или с помощью другого инструмента взаимодействия с Kubernetes CPI пробрасываете свой порт внутрь поды. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fdf\u002Fls\u002Fg8\u002Fdflsg86nylelxahea1yz0uz9dn4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdf\u002Fls\u002Fg8\u002Fdflsg86nylelxahea1yz0uz9dn4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вам нужно запрофилировать и пробросить порты и для сервиса аутентификации и для сервиса генерации отчетов, и для сервиса генерации отчета, то у вас получится такое сделать, если вы во всех подах задали одинаковый порт. Потому что, когда вы будете открывать соответствующий порт у себя на станции, kubectl скажет: «Я не могу дважды открыть порт 9010, он уже кем-то занят».\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fb7\u002Fus\u002Fpa\u002Fb7uspafftsfom6dramgi53vqd_u.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fb7\u002Fus\u002Fpa\u002Fb7uspafftsfom6dramgi53vqd_u.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ этом случае вам в другом сервисе нужно отсылать в другой порт. Например, 9011, т. е. какой-то иной. Помните об этом. И нужный порт к нужному подсоединить. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F7f\u002Fxw\u002Fdo\u002F7fxwdox6iwnqbwybojbt-hj0qri.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F7f\u002Fxw\u002Fdo\u002F7fxwdox6iwnqbwybojbt-hj0qri.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы решили это делать не с помощью таких постоянных действий, как пробрасывание порта, можете зафиксировать порт через NodePort в разделе Service. В этом случае вам в опции JVM нужно прописать именно тот порт, который вы открываете в сервисе. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ тут последовательность несколько иная. Вы сначала в разделе Service говорите: «Я хочу, чтобы из данного сервиса наружу торчал порт 31111». Если такой порт не занят, то он открывается. Если вы убедились, что он открылся, он зафиксирован и вашему сервису принадлежит, то потом идете в настройки сервиса в раздел Deployment и там соответствующий порт задаете, т. е. в обратном порядке. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fle\u002F-f\u002Fxv\u002Fle-fxvieyupxz8avmd4xyuhbdua.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fle\u002F-f\u002Fxv\u002Fle-fxvieyupxz8avmd4xyuhbdua.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы никогда работали с Kubernetes-дашбордом, то это Deployments и Service. Т. е. сначала во внешний раздел идете, там настраиваете, открываете порт. А потом в Deployment его указываете. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fvv\u002Fq4\u002F29\u002Fvvq429gy94jiieflrn5d58bqc3y.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fvv\u002Fq4\u002F29\u002Fvvq429gy94jiieflrn5d58bqc3y.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EХорошую документацию, где есть инструкции с картинками, что это за порты и как их прокинуть именно из докер-контейнера, описал Алексей Рагозин в блоге компании BellSoft. Это один из разработчиков JVM. Называется «JVM in Linux containers, surviving the isolation». Всем рекомендую прочитать эту статью, если вы пользуетесь таким способом. Она доступна по ссылке, данная ссылочка кликабельная. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzv\u002Fjc\u002Fnj\u002Fzvjcnjprxdrxqzi4xr8cubihyvw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzv\u002Fjc\u002Fnj\u002Fzvjcnjprxdrxqzi4xr8cubihyvw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПо такой технологии вы можете подключить различные инструменты: SJK, JMC, VisualVM.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjs\u002Ffu\u002Fpo\u002Fjsfupouzcard_pajcjjsumtmque.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjs\u002Ffu\u002Fpo\u002Fjsfupouzcard_pajcjjsumtmque.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОдин из самых простых инструментов – это SJK.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fqe\u002F80\u002F6x\u002Fqe806x79_tdmgzhd4ueyczcyrx0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fqe\u002F80\u002F6x\u002Fqe806x79_tdmgzhd4ueyczcyrx0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот вы пробросили порт, потом у себя пишите такую команду, где можете выставить профилирование с ограниченной интенсивностью или с максимальной интенсивностью на 5 минут. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fjy\u002F1s\u002Fp4\u002Fjy1sp4mugndp0pbbguyslzr81xw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjy\u002F1s\u002Fp4\u002Fjy1sp4mugndp0pbbguyslzr81xw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВторой по простоте – это, наверное, JMC и технология Java Flight Recorder. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fmy\u002Fsa\u002F2d\u002Fmysa2depg6p_cuv7uhldaiqnx5a.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fmy\u002Fsa\u002F2d\u002Fmysa2depg6p_cuv7uhldaiqnx5a.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС ней есть несколько особенностей. Она заключается в том, что технология JFR появилась в OpenJDK в 8-ой не сразу, а только с версией 272.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ если у вас версия 272, то открывайте JMX, RMI также, как для предыдущих инструментов и пользуетесь.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас старый 8-й OpenJDK, то у вас просто ничего не получится. Вам нужно или монтировать Java в контейнер, или не пользоваться этим способом.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас Oracle JDK, то там есть еще более тонкий момент. До build 161, даже до build 162 лицензия на Oracle JDK позволяла использовать JFR на тестовых стендах при включении опции UnlockCommercialFeatures и опции FLightRecorder. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас более старшая версия, то вам нужно будет купить лицензию. Она исчисляется стоимостью по ядрам. Сам я не использовал такой способ после смены лицензии. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fj5\u002F0u\u002Ftz\u002Fj50utzpuq7qyw_ujwnqzqaiwdjm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fj5\u002F0u\u002Ftz\u002Fj50utzpuq7qyw_ujwnqzqaiwdjm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы все настроили, то дальше в Java Mission Control создаете подключение. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F8-\u002Fzc\u002Fjj\u002F8-zcjjmqxj0qy5oy2mft9ciase8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8-\u002Fzc\u002Fjj\u002F8-zcjjmqxj0qy5oy2mft9ciase8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EУказываете порт, который вы открыли. Например, 9010. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fk6\u002F8f\u002Fny\u002Fk68fnymw8vhevaq5e0mzyt1h9f4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fk6\u002F8f\u002Fny\u002Fk68fnymw8vhevaq5e0mzyt1h9f4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОткрываете JMX Console с помощью Java Mission Control.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F6t\u002Fpo\u002Faa\u002F6tpoaad8yroroy8bludua3vcbh4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F6t\u002Fpo\u002Faa\u002F6tpoaad8yroroy8bludua3vcbh4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПроверяете, что с вашей подой все хорошо и запускаете с помощью пункта Start Flight Recording процесс профилирования.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fnp\u002Fyj\u002Fzw\u002Fnpyjzwk0dluc3y_bxvx2b_frujy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fnp\u002Fyj\u002Fzw\u002Fnpyjzwk0dluc3y_bxvx2b_frujy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС VisualVM все аналогично. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F_b\u002Fnn\u002Fiu\u002F_bnniuuplqr8xfjvvkbon17drjs.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F_b\u002Fnn\u002Fiu\u002F_bnniuuplqr8xfjvvkbon17drjs.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВы так же создаете подключение.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F_g\u002F9l\u002Fan\u002F_g9lanusei-bd9mqxa1ayzc403s.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F_g\u002F9l\u002Fan\u002F_g9lanusei-bd9mqxa1ayzc403s.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТак же указываете локальный хост и порт после того, как пробросили все. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F48\u002Fnl\u002Fbo\u002F48nlbooxwpa9zyu9ppdliitx-z4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F48\u002Fnl\u002Fbo\u002F48nlbooxwpa9zyu9ppdliitx-z4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОткрываете. У вас появляется в разделе Local созданное вами подключение. Locolhost 9010 открываете. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fw2\u002F-q\u002F3u\u002Fw2-q3u2yh-yjtitckzdi7waexks.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fw2\u002F-q\u002F3u\u002Fw2-q3u2yh-yjtitckzdi7waexks.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ на вкладке Sampler можно начать профилирование потоков, нажав на кнопку CPU.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fok\u002Fb9\u002Fuh\u002Fokb9uhsa2oybftxfqmvdif9mric.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fok\u002Fb9\u002Fuh\u002Fokb9uhsa2oybftxfqmvdif9mric.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EБолее интересную и, возможно, более детальную информацию можно получить у JavaAgent-профайлеров. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Faq\u002Fiw\u002Fur\u002Faqiwurprh48ezo5bbkj9xzf06om.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Faq\u002Fiw\u002Fur\u002Faqiwurprh48ezo5bbkj9xzf06om.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТаких как JProfiler, YourKit Java Profiler. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fb4\u002Fxe\u002Fs4\u002Fb4xes4t8xujivffxydzbq5stmds.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fb4\u002Fxe\u002Fs4\u002Fb4xes4t8xujivffxydzbq5stmds.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо тут несколько иной способ подключения. Вам нужно доставить и сам профайлер внутрь поды. Вот эти агенты нельзя просто опциями подключить. Это не встроенная возможность Java. Это определенный программный код, т. е. программный продукт, который подключается дополнительно к JVM. И мы в команде такие опции кладем в некий каталог, а каталог монтируем в поду. И потом настраиваем все эти опции, создаем сетевое подключение.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКакие тут преимущества? \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EВсего один порт, нет JMX, RMI. Всего один сетевой порт для агента.\u003C\u002Fli\u003E\r\n\u003Cli\u003EМожно уже подключаться к двум подам одного сервиса. И у самих этих инструментов более интересный интерфейс.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbj\u002Fqx\u002Fdo\u002Fbjqxdogcqvi6demn6e1mgpo8kfu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbj\u002Fqx\u002Fdo\u002Fbjqxdogcqvi6demn6e1mgpo8kfu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРасскажу про интерфейс для профайлера. Он достаточно хороший. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fku\u002Fuv\u002Frp\u002Fkuuvrprb2o67naigcrzyfvafrlk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fku\u002Fuv\u002Frp\u002Fkuuvrprb2o67naigcrzyfvafrlk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы начнете профилировать с ним, то вам понадобится 2 дистрибутива. Один для вашего клиентского рабочего места, например, у вас Windows. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fst\u002Fet\u002Fbo\u002Fstetbon8lvgvo37hqupvm_zikay.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fst\u002Fet\u002Fbo\u002Fstetbon8lvgvo37hqupvm_zikay.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВторой дистрибутив, который будет работать внутри поды. Как правило, это Linux. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F6r\u002Fpj\u002Fzl\u002F6rpjzlejwv7xjmfz-aqqunofeja.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F6r\u002Fpj\u002Fzl\u002F6rpjzlejwv7xjmfz-aqqunofeja.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо вам не все файлы из этого дистрибутива понадобятся, а лишь две подпапки. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhx\u002Fln\u002Frs\u002Fhxlnrsbquqdnyggzvjeq0f8c3ng.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhx\u002Fln\u002Frs\u002Fhxlnrsbquqdnyggzvjeq0f8c3ng.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ случае Alpine Linux папка называется Linux_musl. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fg8\u002Fel\u002Faf\u002Fg8elafdugqfcppidp0m42yuevt0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fg8\u002Fel\u002Faf\u002Fg8elafdugqfcppidp0m42yuevt0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ случае всех остальных – Lunux-x64.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fsw\u002Fzk\u002Fd9\u002Fswzkd90m1tyksfzb8lk0jmw5mey.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsw\u002Fzk\u002Fd9\u002Fswzkd90m1tyksfzb8lk0jmw5mey.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EУзнать, какая у вас ОС используется несложно. Откройте командную консоль для вашей поды и введите туда команду «cat \u002Fetc\u002Fos-release». Увидите там Alpine, значит Alpine, иначе это что-то другое. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpq\u002F_l\u002Fqk\u002Fpq_lqkboysntswre8do-ijzqftg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpq\u002F_l\u002Fqk\u002Fpq_lqkboysntswre8do-ijzqftg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри подключении агента нужно в deployment смонтировать этот агент, чтобы он появился на диске, т. е. чтобы он был у вас на сервере. Далее смонтировать это в поду. И подключить уже к Java через Java options. Как правило, можно сделать вот таким образом.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzp\u002F26\u002Fgv\u002Fzp26gvqhwda7tkxmsmicukfiq1m.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzp\u002F26\u002Fgv\u002Fzp26gvqhwda7tkxmsmicukfiq1m.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003Eдля CentOS получится тоже самое, только каталог из дистрибутива, который будет подключаться в поду, будет другой, т. е. linux-x64.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F5p\u002Fjc\u002Fwy\u002F5pjcwy5hsbm-qiy8ilmdlulb8to.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F5p\u002Fjc\u002Fwy\u002F5pjcwy5hsbm-qiy8ilmdlulb8to.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОсобенность тут в том, что если вы подключаете это на несколько сервисов, то настройки можно оставить такие, т. е. сохранить тот же самый порт. Максимум, что будет меняться в зависимости от дистрибутива это musl или x64.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВы это сделали, сервис перезапустился.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F8c\u002Frt\u002Fim\u002F8crtimfttv8vscbdqsz-g0d3dra.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8c\u002Frt\u002Fim\u002F8crtimfttv8vscbdqsz-g0d3dra.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ вы в JProfiler создаете новую сессию. Про это тоже буду рассказывать, потому что не самый тривиальный интерфейс, можете запутаться.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F_n\u002F73\u002F5t\u002F_n735titight87grzx6n-wfyk0w.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F_n\u002F73\u002F5t\u002F_n735titight87grzx6n-wfyk0w.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПробросили себе порт. Вы говорите, что хотите удаленное подключение, но к своему локальному рабочему месту: 127.0.0.1 и указываете порт, который вы пробросили. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyd\u002Fzh\u002Fzc\u002Fydzhzco4sdch6ugvzzh2rxzfrqm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyd\u002Fzh\u002Fzc\u002Fydzhzco4sdch6ugvzzh2rxzfrqm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДалее в настройках Call Recording выбрать обычное семплирование. Этот способ называется full sampling, потому что он выполняется максимально быстро, но с дополнительной опцией, что нужно сохранять и номера строчек, чтобы потом это можно было проще смапить на код.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fcl\u002Fhr\u002Ffb\u002Fclhrfbd-wgodh8jlcvy7yzc8irm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fcl\u002Fhr\u002Ffb\u002Fclhrfbd-wgodh8jlcvy7yzc8irm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА дальше в профайлере открываются все его фишки. Он может перехватывать все SQL-запросы с параметрами. Вы видите всю статистику по каждому SQL-запросу.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Faq\u002Ft9\u002Fcf\u002Faqt9cfwqbxwirq4fykssfx0z2pa.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Faq\u002Ft9\u002Fcf\u002Faqt9cfwqbxwirq4fykssfx0z2pa.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА также http-запросы к exceptions, т. е. то, чего нет, например, в VisualVM. Тут оно есть. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzq\u002Fmh\u002Fbp\u002Fzqmhbpx49wvzpuevp6ztjspaday.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzq\u002Fmh\u002Fbp\u002Fzqmhbpx49wvzpuevp6ztjspaday.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТут вы подтверждаете, что хотите простое семплирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fej\u002Fvt\u002Fvh\u002Fejvtvhf5ccmpwjtieaxpxunmxqe.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fej\u002Fvt\u002Fvh\u002Fejvtvhf5ccmpwjtieaxpxunmxqe.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо и после этого семплирование не запустится. В этом сложность интерфейса. Чтобы запустить вам нужно нажать Start recording. И когда вы попытаетесь в первый раз это сделать, увидите, что все эти опции, которые вы выставили, все равно собираться не станут. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНажмите на пункт, что вы хотите настроить новый профиль сбора метрик. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpe\u002F8y\u002Fxy\u002Fpe8yxyxmhfuirsygfid2ff20ilo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpe\u002F8y\u002Fxy\u002Fpe8yxyxmhfuirsygfid2ff20ilo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНазовите его как-нибудь по-своему. Например, что я буду собирать CPU, HTTP, JDBC, Exceptions.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fat\u002Fwa\u002Ff0\u002Fatwaf0xgicsozvknt0yeac-liao.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fat\u002Fwa\u002Ff0\u002Fatwaf0xgicsozvknt0yeac-liao.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОтметьте среди галочек CPU и все, что вы включили при начале сессии. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F_2\u002F4y\u002Fh5\u002F_24yh5tmrt1096li6ta2xnallhm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F_2\u002F4y\u002Fh5\u002F_24yh5tmrt1096li6ta2xnallhm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭто будет уже более тяжелое профилирование. И тогда его запускайте.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzx\u002Fpr\u002Fk5\u002Fzxprk564xnimjwbk9gzstf9p07m.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzx\u002Fpr\u002Fk5\u002Fzxprk564xnimjwbk9gzstf9p07m.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ попробовал так на тестовом стенде и при профилировании в JMeter, и при различных профилированиях миникуба. Мне очень понравился JProfiler. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо с использованием удаленного, сложного, долгого профилирования есть один недостаток. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fod\u002Fbe\u002Fu3\u002Fodbeu357ttwq2fkjrx821chomh8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fod\u002Fbe\u002Fu3\u002Fodbeu357ttwq2fkjrx821chomh8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДавным-давно мы работали из офиса и не знали таких проблем, как лаганул wi-fi, отвалился VPN. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frs\u002Fjm\u002F7s\u002Frsjm7sxkzbe9oukfwsdvlyo4qxk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frs\u002Fjm\u002F7s\u002Frsjm7sxkzbe9oukfwsdvlyo4qxk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА теперь у нас счастливая жизнь, а, возможно, кому-то это и не нравится, когда мы работаем из дома и про все эти проблемы знаем. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fw3\u002Ftc\u002Fxk\u002Fw3tcxkfazbx88vic-ihllo40w4u.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fw3\u002Ftc\u002Fxk\u002Fw3tcxkfazbx88vic-ihllo40w4u.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ в этом случае удаленное профилирование становится не совсем удобным. Когда вы профилируете через 5 firewalls, то, во-первых, трафик лишний гоняется, во-вторых, может это все прекратиться по независящим от вас причинам.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F_z\u002Fxh\u002Fs8\u002F_zxhs8rlrjaaycfmg3pvfavtlg8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F_z\u002Fxh\u002Fs8\u002F_zxhs8rlrjaaycfmg3pvfavtlg8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ тут свое применение нашло локальное профилирование. Есть очень много способов его выполнить. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhl\u002Fuy\u002Fl9\u002Fhluyl9-r0_svf94kidhnsdlkpeo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhl\u002Fuy\u002Fl9\u002Fhluyl9-r0_svf94kidhnsdlkpeo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОдин из самых простых – это сделать nginx подключение с помощью SJK, но уже изнутри пода. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Feu\u002Fnk\u002F5h\u002Feunk5hgs8w1zb1kv8ynszhhwv3u.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feu\u002Fnk\u002F5h\u002Feunk5hgs8w1zb1kv8ynszhhwv3u.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003ESJK (Swiss Java Knife) – это профайлер, разработанный Алексеем Рагозиным. Он очень простой, позволяет подключаться и удаленно, и локально. И он очень маленький, поэтому его можно запускать изнутри контейнера. Это большого overhead не создаст. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fdk\u002Fyl\u002Faa\u002Fdkylaapdynv_stlpr4obg9znb5s.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdk\u002Fyl\u002Faa\u002Fdkylaapdynv_stlpr4obg9znb5s.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКроме того, при запуске из контейнера его опции подключения сильно проще. Можно уже некоторые опции не задавать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F0c\u002Fcf\u002Ffn\u002F0ccffngbmjuj6sopb4wrdm5vqdi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F0c\u002Fcf\u002Ffn\u002F0ccffngbmjuj6sopb4wrdm5vqdi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА задать только те, которые необходимы тоже в Java options.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fc6\u002Fr7\u002Fq3\u002Fc6r7q3_h4domw6dkwtignxyumru.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fc6\u002Fr7\u002Fq3\u002Fc6r7q3_h4domw6dkwtignxyumru.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EУзнать имя пода, который вы хотите профилировать с помощью get pods. Скопировать маленький jar внутрь контейнера с помощью команды cp. И с помощью команды exec собрать результаты профилирования. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpl\u002Fig\u002F1z\u002Fplig1zfp84jshmdbkzjurc8aquk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpl\u002Fig\u002F1z\u002Fplig1zfp84jshmdbkzjurc8aquk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВсе эти опции вы можете записать в командный файл. Вот этот предлагаемый командный файл позволяет уже больший перечень команд выполнять за раз. Позволяет сохранить результаты в tmp\u002Fresult. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhw\u002Fx7\u002Fua\u002Fhwx7uazplk4ijvgy3wdtujrbqc8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhw\u002Fx7\u002Fua\u002Fhwx7uazplk4ijvgy3wdtujrbqc8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ потом с помощью kubectl или других инструментов скачать результаты.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ делал это следующим образом. Внутри пода захожу в каталог с результатами и упаковываю их в старый архив. Передаю результаты выполнения, т. е. вот этой упаковки, на консоль, на стандартный вывод. Через pipe получаю с консоли уже в своей станции эти результаты. И с помощью того же инструмента tar распаковываю результаты со стандартного вывода в текущий каталог. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПосле чего данный каталог можно там открыть. В Windows это будет команда explorer. Этот скрипт можно выполнять в Git Bash, т. е. он для Windows тоже будет работать, если у вас есть Git, а Git есть у всех. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F5u\u002F1f\u002Fvw\u002F5u1fvwd8fjgxdbjguwpjsqltrga.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F5u\u002F1f\u002Fvw\u002F5u1fvwd8fjgxdbjguwpjsqltrga.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНе менее сложный способ подключения с помощью Java Flight Recorder.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F74\u002Fx0\u002Flg\u002F74x0lgzta9-bxfhnxccs6q_sd88.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F74\u002Fx0\u002Flg\u002F74x0lgzta9-bxfhnxccs6q_sd88.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕго лучше всех описал в статье на Habr Виктор Вербицкий. Статья называется «Управление Java Flight Recorder». И опции, которые я пробовал, как раз подчерпнул из этой статьи. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fia\u002Fca\u002F_w\u002Fiaca_wwhji4mt9fhs_end_pcx80.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fia\u002Fca\u002F_w\u002Fiaca_wwhji4mt9fhs_end_pcx80.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОсновные – это две опции: это StartFlightRecording и FlightRecorderOptions. В этом случае нет интерактивного подключения с помощью Mission Control. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Cp\u003EВы говорите, что метрики нужно собирать и писать на диск, не хранить в оперативной памяти. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EЧтобы дисковая квота не переполнилась, задаете какое-то ограничение, например, 1 гигабайт. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EПеречень событий, который нужно собирать, загружаете из файлика, путь к которому указываете в этом параметре. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EГоворите в какой каталог сохранять. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EИ можно еще некоторые опции задать, например, максимальный размер одного файла. Если вы будете запускать с настройками семплирования по умолчанию, то при задании максимального размера файла в 1 мегабайт, фактически будет 2-3 мегабайта. Потому что после сбора метрик, т. е. когда они в сыром виде собрались на мегабайт, из записи этого сбора записываются еще дополнительные события, и файлик становится чуть больше. Если вы собираете помимо стандартных реплик еще метрики по памяти, то при задании maxchunksize=1m размер результирующего файла будет 300 мегабайт. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EИ еще полезная опция stackdepth. Глубина stack по умолчанию 64. И для spring-boot приложения, где stack очень огромный, вы не увидите, где у вас узкое место. И рекомендую его увеличить. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fub\u002Fj0\u002Fne\u002Fubj0necvh_vji9tgwvvzcm7hyb8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fub\u002Fj0\u002Fne\u002Fubj0necvh_vji9tgwvvzcm7hyb8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Cp\u003EВсе опции семплирования для JFR, которые задаются в filename, мы можем посмотреть, как они выглядят по умолчанию в файле jre\\lib\\jfr\\default.jfc.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EЭто простой файл в формате XML. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EНо его можно редактировать в JMC. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F2e\u002F6m\u002Fdx\u002F2e6mdx4ugb6wbhuhnpgrpb_aoq0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F2e\u002F6m\u002Fdx\u002F2e6mdx4ugb6wbhuhnpgrpb_aoq0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы хотите сделать процесс профилирования, то там будет кнопка Template Manager. Нажмите ее, откроется Flight Recording Template Manager, где вы можете сдублировать существующие профили, отредактировать их, нажав «Edit» или экспортировать в файл. А потом этот файл замонтировать в поду и использовать. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpo\u002Fj9\u002Fyw\u002Fpoj9ywslknhwfqia-lt0_lxniem.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpo\u002Fj9\u002Fyw\u002Fpoj9ywslknhwfqia-lt0_lxniem.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы вообще ничего не замонтируете, то можете использовать настройки по умолчанию. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frh\u002Fkd\u002F2-\u002Frhkd2-gnkwkkdfgj_zeqtnfjxx4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frh\u002Fkd\u002F2-\u002Frhkd2-gnkwkkdfgj_zeqtnfjxx4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас есть какие-то пожелания по выбору метрик, то вам нужно смонтировать также, как и для агента каталог. Это необходимый для вас файлик. И нужно подключить этот файлик в опциях JVM. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ft6\u002Fjx\u002Fpd\u002Ft6jxpdxn4vl2cxkivhe3v_el5hs.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ft6\u002Fjx\u002Fpd\u002Ft6jxpdxn4vl2cxkivhe3v_el5hs.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот так можно называть каталог, в котором будут опции. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhf\u002F2l\u002F5x\u002Fhf2l5xhlfcv2v2cod4fhrrvpbvq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhf\u002F2l\u002F5x\u002Fhf2l5xhlfcv2v2cod4fhrrvpbvq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот так его подмонтировать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxk\u002Fpl\u002Fpm\u002Fxkplpm5tvpjon4gv2nelihg_v_y.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxk\u002Fpl\u002Fpm\u002Fxkplpm5tvpjon4gv2nelihg_v_y.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ вот так указать этот путь: filename \u002Ftmp\u002Fjfr\u002Fprof.jfc.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот такой способ подключения JFR.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fqp\u002Fun\u002Fzp\u002Fqpunzpf7nuubt3cuc4p1nfh1fhi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fqp\u002Fun\u002Fzp\u002Fqpunzpf7nuubt3cuc4p1nfh1fhi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС помощью JavaAgent тоже можно все локально делать самыми разными профайлерами. Я, правда, не пользовался, поэтому и рассказывать вам не буду. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F3s\u002Fw3\u002Fgn\u002F3sw3gn3xlpovg0sjupphnyruals.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F3s\u002Fw3\u002Fgn\u002F3sw3gn3xlpovg0sjupphnyruals.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ есть очень интересный способ, как все сделать на лету. Он обещает, что вы можете в любую поду зайти и начать профилирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСложность в том, что у меня этот способ сработал ровно с одним профайлером и не сработал со всеми остальными. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ чем суть? Чтобы все это на лету сработало, вам нужны инструменты разработчика, т. е. не просто Java Runtime Environment, а JDK внутри контейнера. А все стремятся сделать контейнеры легковесным, никаких дополнительных инструментов и утилит в контейнере нет. Я пробовал это сделать, но у меня ничего не получалось. А с Async Profiler получилось.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕго фишка еще в том, что он может не только stack traces собирать, а собирать большее количество метрик более точно.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fo9\u002Ffw\u002Fjo\u002Fo9fwjoolqwws48ct5887vx17r0q.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fo9\u002Ffw\u002Fjo\u002Fo9fwjoolqwws48ct5887vx17r0q.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПоэтому на него я бы хотел обратить особое ваше внимание. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fvj\u002Fal\u002F3u\u002Fvjal3u2eiujudv9ahpiibzwlwjq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fvj\u002Fal\u002F3u\u002Fvjal3u2eiujudv9ahpiibzwlwjq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРазработал его Андрей Паньгин. И в Async Profiler я могу отметить наилучшую поддержку Alpine Linux и не только. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F3z\u002Fuz\u002F_z\u002F3zuz_z2y0qzcx7xbny9kjsqg4wk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F3z\u002Fuz\u002F_z\u002F3zuz_z2y0qzcx7xbny9kjsqg4wk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧто это за штука Alpine Linux? Почему на нее нужно обращать внимание? Если вы зададитесь вопросом: «Какие Linux-дистрибутивы и с какими опциями используются в ваших контейнерах?», то вы, скорее всего, зайдете на Docker Hub, начнете выбирать контейнеры, которые у вас будут базовыми для ваших сервисов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fya\u002Fc8\u002F8r\u002Fyac88rc-d4iihfpev1wownmkn8g.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fya\u002Fc8\u002F8r\u002Fyac88rc-d4iihfpev1wownmkn8g.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ у вас будут некоторые факторы выбора их. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzf\u002Flf\u002Fs2\u002Fzflfs29vwbepgzygjfbhl2ufsyq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzf\u002Flf\u002Fs2\u002Fzflfs29vwbepgzygjfbhl2ufsyq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСреди них – это операционная система, т. к. они бывают разными. А также – JDK или JRE, какая там версия. Можете обращать внимание на популярность. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fd0\u002Fmn\u002Fnh\u002Fd0mnnhuri3shibagmsqugbakkou.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fd0\u002Fmn\u002Fnh\u002Fd0mnnhuri3shibagmsqugbakkou.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ зашел и составил табличку для тех контейнеров, которые используются у нас на проекте. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПо статистике среди пользователей Docker Hub наиболее популярный дистрибутив – это CentOS. Наиболее популярная версия – Java 8.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fi5\u002Fvc\u002F72\u002Fi5vc72253g8osgtac34q2xr0rhs.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fi5\u002Fvc\u002F72\u002Fi5vc72253g8osgtac34q2xr0rhs.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа нашем проекте первое место совпадает с этой статистикой. А второе место – это Alpine. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ в разделении CentOS против Alpine есть важный фактор для инженера производительности при выборе профайлера. При выборе профайлера вам нужно будет выбирать Linux-musl различные инструменты, которые содержат слово «musl» в своем названии. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F6u\u002F9b\u002Fq1\u002F6u9bq1xvdugeaiioovskosbmja0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F6u\u002F9b\u002Fq1\u002F6u9bq1xvdugeaiioovskosbmja0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри скачивании Async Profiler нужно выбрать нужную сборку. У него есть сборки и для Macos, и для самых разных Linuxs. У вас будет выбор между x64 и musl. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fy2\u002Fsj\u002Fxf\u002Fy2sjxfunobdyxmbndq5wt5wgsdu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fy2\u002Fsj\u002Fxf\u002Fy2sjxfunobdyxmbndq5wt5wgsdu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ как вы заметили, внутри Alpine есть JDK. Это популярный дистрибутив. У нас он тоже встроен. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ я пытался пользоваться утилитами JDK из контейнера, и оказалось, что они не работают. Все-таки Alpine-дистрибутив урезанный. Несмотря на то, что там есть утилиты, ими нельзя воспользоваться. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ расстроился, что вообще никакого шанса нет, но оказалось, что в Async Profiler есть замечательная утилита jattach. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОна выполняет функции jcmd.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Foe\u002Fpn\u002Ff9\u002Foepnf9-m8caimaxdzwn4lvyctpi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Foe\u002Fpn\u002Ff9\u002Foepnf9-m8caimaxdzwn4lvyctpi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕго особенность в том, что нужны ROOT-права и они не всегда есть. Но если они есть, то все получится. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fnm\u002Fkl\u002Ftq\u002Fnmkltqjde2ftyxoy1m3mciyy-ce.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fnm\u002Fkl\u002Ftq\u002Fnmkltqjde2ftyxoy1m3mciyy-ce.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот такая сложная получилась схема, как подключиться и начать профилирование. Надеюсь, она вам когда-нибудь пригодится в жизни, и вы сэкономите свое время. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРассказывая про удаленное профилирование, я немного затронул тему того, что иногда можно запрофилировать две поды, а иногда одну. Это тоже важный аспект профилирования в Kubernetes. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhr\u002Fct\u002Fn1\u002Fhrctn1b8ga9gwf0bjm5s0zo_3aq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhr\u002Fct\u002Fn1\u002Fhrctn1b8ga9gwf0bjm5s0zo_3aq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо он все-таки зависит не от того способа профилирования, который вы выбрали, а от другого момента. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxf\u002Fn0\u002Fag\u002Fxfn0agcdndmfphsp5hos_gkimqm.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxf\u002Fn0\u002Fag\u002Fxfn0agcdndmfphsp5hos_gkimqm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли ваш дефект производительности проявляется при единичном запросе, при ручном, то тут один способ масштабирования и подбора инструментов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНапример, вы в браузере тыкаете на ссылку, и ваш сервис зависает.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fho\u002Fcg\u002Fap\u002Fhocgapt1kizx3jhtbyr5dvilyge.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fho\u002Fcg\u002Fap\u002Fhocgapt1kizx3jhtbyr5dvilyge.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧтобы найти узкое место в таком сервисе, вам не нужно 10 реплик, достаточно одной. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbw\u002Fks\u002Fom\u002Fbwksomzy199yzw60kl0ic_o64u4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbw\u002Fks\u002Fom\u002Fbwksomzy199yzw60kl0ic_o64u4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ ее можно профилировать максимально детально с инструментацией, с использованием Java-агентов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzl\u002Fzj\u002Fdr\u002Fzlzjdrhhaij26bkpursynqz5dok.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzl\u002Fzj\u002Fdr\u002Fzlzjdrhhaij26bkpursynqz5dok.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА также с помощью таких инструментов, как JProfiler, YourKit для детального сбора метрик по всем аспектам. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fsi\u002Fid\u002F-s\u002Fsiid-s2eymkoazohnqunb1kiory.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsi\u002Fid\u002F-s\u002Fsiid-s2eymkoazohnqunb1kiory.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА если для профилирования вам надо подать большую нагрузку, а при большой нагрузке, как правило, нужен более большой кластер, например, 5 реплик выдерживают такую нагрузку, то в этом случае рекомендую оставить все 5 реплик, но к ним добавить 6-ую реплику для дополнительного масштабирования. И 6-ую начать нагружать. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fh2\u002Fsg\u002Fi_\u002Fh2sgi_g_lpr6610kmwsw-umdyca.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fh2\u002Fsg\u002Fi_\u002Fh2sgi_g_lpr6610kmwsw-umdyca.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли от данного сервиса зависят другие сервисы, то из всех созданных 6 реплик рекомендую профилировать только одну, чтобы 5 других не замедлялись. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fai\u002Fdm\u002Fey\u002Faidmeyyktf7meevqmrmlk1i6jkc.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fai\u002Fdm\u002Fey\u002Faidmeyyktf7meevqmrmlk1i6jkc.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭто у меня на схеме отмечено, как быстрое выборочное профилирование. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Flt\u002Feb\u002F-w\u002Flteb-wvoyigitgcpqtfzjvt1ukg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flt\u002Feb\u002F-w\u002Flteb-wvoyigitgcpqtfzjvt1ukg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТут выберите такие инструменты, как JDK или Async Profiler. Они создают наименьшую нагрузку на профилирование приложения. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас задача запрофилировать все поды с небольшим overhead, то можете выбрать те же самые инструменты или сделать массовый запуск JFR.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fj8\u002Fod\u002Frq\u002Fj8odrqd_m2nqwahrj4wmynw2zqw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fj8\u002Fod\u002Frq\u002Fj8odrqd_m2nqwahrj4wmynw2zqw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРешая вопрос, какое количество под, сервисов профилировать, идите по пути наименьшего сопротивления. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас есть возможность использовать тяжелый профайлер, то используйте его в одной реплике. Если вам нужно много реплик, то используйте более легкие инструменты. Если у вас есть ROOT-права, то используйте Async Profiler. Если у вас нет ROOT-прав, то JDK. Если у вас достаточно новая OpenJDK и там есть поддержка JFR, то попробуйте его. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fet\u002Fy_\u002Fbs\u002Fety_bsgjdwms52f_lqugxbt6bya.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fet\u002Fy_\u002Fbs\u002Fety_bsgjdwms52f_lqugxbt6bya.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНадеюсь, я рассказал все про подключение и особенности Kubernetes и роли профилирования в нем. И некоторые части пазла у вас сложились и осталось совсем немного белых пятен. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Feu\u002Ffx\u002Fom\u002Feufxomk6kqh3jtun43ep0qdym9m.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feu\u002Ffx\u002Fom\u002Feufxomk6kqh3jtun43ep0qdym9m.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСейчас быстро расскажу, как анализировать результаты. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F3u\u002Ftm\u002Few\u002F3utmewzqhydphd3y2dwctwuiapi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F3u\u002Ftm\u002Few\u002F3utmewzqhydphd3y2dwctwuiapi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСамая частая у меня задача – это анализировать результаты семплирования.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EПервый шаг – это визуально оценить работу потоков.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСобрать статистику по работе потоков. Т. е. мы посмотрели визуально, оценили это в виде чисел. \u003C\u002Fli\u003E\r\n\u003Cli\u003EВыбрать из всех этих потоков только проблемные, исключить непроблемные. \u003C\u002Fli\u003E\r\n\u003Cli\u003EДетально собрать статистику только по проблемным. \u003C\u002Fli\u003E\r\n\u003Cli\u003EИ разделить на методы прикладные. \u003C\u002Fli\u003E\r\n\u003Cli\u003EТ. е. тут у нас Postgres тормозил, тут какой-то http-запрос. \u003C\u002Fli\u003E\r\n\u003Cli\u003EИ наложить эту статистику на исходный код.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот такой семишаговый процесс. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F6g\u002F8i\u002Fid\u002F6g8iid1wlognz4xrjj9lhcmlgzg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F6g\u002F8i\u002Fid\u002F6g8iid1wlognz4xrjj9lhcmlgzg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПервый этап – визуальная оценка. Этот этап очень важен. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fme\u002Ffs\u002Fmm\u002Fmefsmmifese-nvv4qhwf800a6ck.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fme\u002Ffs\u002Fmm\u002Fmefsmmifese-nvv4qhwf800a6ck.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕго можно сделать в бесплатном инструменте JVisionVM.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F87\u002Fxc\u002F9d\u002F87xc9d96odydv0nq0uheag9zn-k.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F87\u002Fxc\u002F9d\u002F87xc9d96odydv0nq0uheag9zn-k.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы посмотрите на свои потоки и увидите, что они параллельно работают, то у вас нет проблем с параллельностью. Вы создали 20 или 120 потоков, и они как-то параллельно живут. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fen\u002Fhp\u002F5f\u002Fenhp5fhj_mrtusqxqh2_qse-hxk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fen\u002Fhp\u002F5f\u002Fenhp5fhj_mrtusqxqh2_qse-hxk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ этом случае вы будете сосредоточены на анализе эффективности, на работе каждого отдельного потока. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fud\u002Ff9\u002Fyw\u002Fudf9ywwiibgeapsycsddvvt5-m0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fud\u002Ff9\u002Fyw\u002Fudf9ywwiibgeapsycsddvvt5-m0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА бывает другая картина. Вы смотрите визуально в JVisionVM и видите, что ни один поток параллельно с другим не работает. И даже если кажется, что они накладываются, то это не так. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyi\u002Fh3\u002Fx1\u002Fyih3x100yimhxi_vvxmraa3fz78.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyi\u002Fh3\u002Fx1\u002Fyih3x100yimhxi_vvxmraa3fz78.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ этом случае у вас совсем другая проблема. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyd\u002Fip\u002F9c\u002Fydip9cjizxycg0grloiqailbq_m.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyd\u002Fip\u002F9c\u002Fydip9cjizxycg0grloiqailbq_m.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСистема работает медленно не из-за недостатка масштабирования, а по причинам блокировок. И вам нужно анализировать уже этот момент. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F-m\u002Fmd\u002Fwa\u002F-mmdwagmbs5dad1o0roke2fo45u.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-m\u002Fmd\u002Fwa\u002F-mmdwagmbs5dad1o0roke2fo45u.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕще замечу, что при выборе потоков важно ориентироваться в них хоть немножко. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fcn\u002Fkv\u002Ftx\u002Fcnkvtxbjfon4omopuneua88mhds.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fcn\u002Fkv\u002Ftx\u002Fcnkvtxbjfon4omopuneua88mhds.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСтатистику достаточно смотреть по ключевым местам. И совсем не смотреть, например, по JMX и RMI. Это RMI Scheduler, RMI TCP Accept, RMI TCP Connection. Kafka Heartbeat обычно не доставляет проблем. И различные потоки, которые отвечают за сборку мусора, тоже нам не интересны. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНам достаточно посмотреть, какой вес они занимают в процессе профилирования, т. е. в работе сервиса, но не нужно залезать в детали, потому что мы ничего там не поменяем. Если только вы заметили, что поток сборщика мусора выделяется из всех потоков, то посмотрите на настройки сборки мусора. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fuq\u002Fdo\u002Fnz\u002Fuqdonz_zn-izrqb79_jaa8yvfuu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fuq\u002Fdo\u002Fnz\u002Fuqdonz_zn-izrqb79_jaa8yvfuu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА заглянуть внутрь нужно уже при таких потоках: http-nio-8080, Thread-pool, OkHttp, WebSocket.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F0i\u002Fbc\u002Fr8\u002F0ibcr8sgpmbqvbgp2e-um8wj2aa.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F0i\u002Fbc\u002Fr8\u002F0ibcr8sgpmbqvbgp2e-um8wj2aa.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак это делается в больших профайлерах? \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fsl\u002Fid\u002Ftm\u002Fslidtmvla5h1gvf9pf4ys1e1nmk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsl\u002Fid\u002Ftm\u002Fslidtmvla5h1gvf9pf4ys1e1nmk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ том же JProfiler рекомендую зайти в Thread History. Там можно увидеть диаграмму работы потоков. Выбрать самый тяжелый. И перейти по пункту Show Call Three Selected Thread. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНедостаток или особенность JProfiler в том, что для двух потоков эту статистику собрать нельзя, т. е. нельзя объединить. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fj3\u002Fem\u002F-w\u002Fj3em-whzfq4dt-vugi_hxw29yls.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fj3\u002Fem\u002F-w\u002Fj3em-whzfq4dt-vugi_hxw29yls.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо такое можно сделать с помощью других инструментов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fky\u002Fs2\u002Fh2\u002Fkys2h2jpjkpwyj7vhhcwrbc6fd0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fky\u002Fs2\u002Fh2\u002Fkys2h2jpjkpwyj7vhhcwrbc6fd0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС помощью того же JDK. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbd\u002F07\u002Fdm\u002Fbd07dm_dgkr_6z0r8iw4rctjvym.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbd\u002F07\u002Fdm\u002Fbd07dm_dgkr_6z0r8iw4rctjvym.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ на слайдах привел пошаговые готовые скрипты, которые вы сможете использовать у себя, чтобы объединить статистику.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frn\u002Fyt\u002Frp\u002Frnytrpisfys9nc5abnhjpn68n_y.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frn\u002Fyt\u002Frp\u002Frnytrpisfys9nc5abnhjpn68n_y.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ построить в диаграмму. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ft-\u002F4o\u002Fml\u002Ft-4omltjqghlnkaawbqgtdpbmeq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ft-\u002F4o\u002Fml\u002Ft-4omltjqghlnkaawbqgtdpbmeq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДиаграмма – это такой красивый график. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzr\u002Fqq\u002F49\u002Fzrqq49ny2fmtcq2dfrp-habagia.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzr\u002Fqq\u002F49\u002Fzrqq49ny2fmtcq2dfrp-habagia.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКроме того, он будет снабжен статистикой уже с номерами строк. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fed\u002Fp-\u002Fau\u002Fedp-aua3lc_k0cthfxjxyr6rchw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fed\u002Fp-\u002Fau\u002Fedp-aua3lc_k0cthfxjxyr6rchw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА если вам нужно из всей работы потоков выделить отдельный метод, то это тоже возможно. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fix\u002Ftr\u002Fem\u002Fixtreml4kaei5ulcqumwmyx7_mq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fix\u002Ftr\u002Fem\u002Fixtreml4kaei5ulcqumwmyx7_mq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот вы смотрите на эту большую flame-диаграмму. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fnx\u002Fid\u002Ftf\u002Fnxidtfhgiwfoabgdsgo1ni0ib6g.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fnx\u002Fid\u002Ftf\u002Fnxidtfhgiwfoabgdsgo1ni0ib6g.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОна может показаться на первый взгляд непонятной.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F-r\u002Fyl\u002F-2\u002F-ryl-2vzokc1pwkehczpbpn-z30.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-r\u002Fyl\u002F-2\u002F-ryl-2vzokc1pwkehczpbpn-z30.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДавайте к ней приглядимся.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ffr\u002Fpd\u002Fvj\u002Ffrpdvj6x5dyqj8q-xyq4tll2tji.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffr\u002Fpd\u002Fvj\u002Ffrpdvj6x5dyqj8q-xyq4tll2tji.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот мы приглядываемся-приглядываемся и понимаем, что у нас есть post-запросы и get-запросы. Вот в данном случае есть post-запрос, есть get-запрос. И это уже нам позволяет как-то сориентироваться и выделить наши запросы среди всех. Т. е. смапить их на некоторые бизнес-задачи.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fml\u002Fuc\u002Fhv\u002Fmluchv-uc8klvq03ceempuk6cvy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fml\u002Fuc\u002Fhv\u002Fmluchv-uc8klvq03ceempuk6cvy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНаши запросы, как правило, выделяются по префиксу. Если наша команда называется ВТБ, то вот наши прикладные методы. Вот ru.vtb.dbo и т. д.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ffp\u002Fnj\u002Fwl\u002Ffpnjwliubi8qauwjkhrewugfpjy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffp\u002Fnj\u002Fwl\u002Ffpnjwliubi8qauwjkhrewugfpjy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКроме этого, есть имя самого запроса. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F7o\u002Fan\u002Far\u002F7oanarve-p5l5sex9mx-3aqtqu0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F7o\u002Fan\u002Far\u002F7oanarve-p5l5sex9mx-3aqtqu0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот оно: organizationsSearch. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fep\u002Fpt\u002Fqf\u002Fepptqfjvel_vyvupgkji6j26uss.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fep\u002Fpt\u002Fqf\u002Fepptqfjvel_vyvupgkji6j26uss.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВсе эти три признака позволяют из stack traces выделить интересующие вас участки.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Flm\u002Fbt\u002Fna\u002Flmbtnaa5niwew7sz-a7lriaexwu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flm\u002Fbt\u002Fna\u002Flmbtnaa5niwew7sz-a7lriaexwu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EФишкой JDK является то, что можно объединить фильтры, т. е. ряд фильтров накладывать на собранные stack traces и таким образом автоматизировать выделение статистики по отдельному методу.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyk\u002Frd\u002Fqa\u002Fykrdqacggepipmm_2dvp7fly5ia.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyk\u002Frd\u002Fqa\u002Fykrdqacggepipmm_2dvp7fly5ia.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот таким несложным скриптом у вас это получится сделать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fa_\u002Fsw\u002Fls\u002Fa_swlss32pli6b1d7ascin7n4eo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fa_\u002Fsw\u002Fls\u002Fa_swlss32pli6b1d7ascin7n4eo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ после этого можно даже накладывать на эти отдельные методы еще дополнительные фильтры.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fyp\u002Fsv\u002Fny\u002Fypsvnyf7yr7ib_hfz25enj_f4aa.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fyp\u002Fsv\u002Fny\u002Fypsvnyf7yr7ib_hfz25enj_f4aa.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот такие. Тут уже trace-filter. И можно сказать, какую долю в этом методе занимает PostgreSQL.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fes\u002Fbx\u002Ff2\u002Fesbxf2kot34p-xx9xemz-lvhib0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fes\u002Fbx\u002Ff2\u002Fesbxf2kot34p-xx9xemz-lvhib0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИли, наоборот, без PostgreSQL. За счет таких фильтров вы можете оценить взаимодействие текущего сервиса и текущего метода с другими сервисами и с другими компонентами. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fv8\u002Fce\u002F2j\u002Fv8ce2j_9upd8dtb0rhp6gyax-5i.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fv8\u002Fce\u002F2j\u002Fv8ce2j_9upd8dtb0rhp6gyax-5i.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ после всего этого у вас получится автоматическое формирование отчета с разбивкой по методам, потокам, классам и другим интересующим вас моментам. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F3v\u002F_f\u002Ff0\u002F3v_ff052tx42jn7nfnqkhdhxuwu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F3v\u002F_f\u002Ff0\u002F3v_ff052tx42jn7nfnqkhdhxuwu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭто все, что я хотел бы вам рассказать про анализ метрик. Надеюсь, у вас еще меньше белых пятен осталось. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Ffr\u002Fpc\u002Fia\u002Ffrpciayq0wc4xi9qzzwbjmvbyau.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffr\u002Fpc\u002Fia\u002Ffrpciayq0wc4xi9qzzwbjmvbyau.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ финальный шаг – это как масштабировать профилирование на всю команду. Об этом расскажу быстро.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fhx\u002Fp2\u002F4n\u002Fhxp24ndpklksbmoeztmxl0wdjjg.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhx\u002Fp2\u002F4n\u002Fhxp24ndpklksbmoeztmxl0wdjjg.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПервое, что я вам рекомендую делать, это если вы разобрались в профилировании и успешно нашли какие-то дефекты с помощью профайлера, — напишите самый подробный отчет результатов вашей работы. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fr0\u002Fbe\u002Fi1\u002Fr0bei1ks8o-r_fbvmceorp_npf8.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fr0\u002Fbe\u002Fi1\u002Fr0bei1ks8o-r_fbvmceorp_npf8.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот я пишу суперподробный отчет по профилированию. В шапке есть отчеты по бизнес-составляющим, которые прочитают все. Это какую версию мы тестировали, какие дефекты нашли и какие узкие места были или не были. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНиже этой шапки, ниже бизнес-составляющей есть пошаговый процесс, какие окна я посмотрел, какие потоки смотрел, почему я решил, что это узкое место. Эту часть уже не будет читать никто: ни разработчики, ни менеджеры. Но ее прочитают ваши коллеги, которые при следующей итерации регрессионного тестирования, возможно, захотят проверить осталось ли это узкое место. Таким образом ваш подробный отчет – это своеобразная инструкция для ваших коллег. Это обучающий материал.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxx\u002Frn\u002F1w\u002Fxxrn1w2s6iu7b9iehqnya7qqkwa.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxx\u002Frn\u002F1w\u002Fxxrn1w2s6iu7b9iehqnya7qqkwa.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКроме обучающего материала нужно написать саму инструкцию. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frp\u002Fya\u002F40\u002Frpya40swjqdveohidlfkuyf3e8y.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frp\u002Fya\u002F40\u002Frpya40swjqdveohidlfkuyf3e8y.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПервым делом рекомендую написать инструкцию, как выполнить профилирование в ручном режиме. Я вам рассказывал про Alpine и о том, как посмотреть версию, и т. д. Все это нужно задокументировать в том же Confluence. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fc5\u002Fmc\u002Fml\u002Fc5mcmlgnk6vdat6o_n4p9v6gytu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fc5\u002Fmc\u002Fml\u002Fc5mcmlgnk6vdat6o_n4p9v6gytu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИнструкцию нужно не просто записать и сохранить в Confluence, а еще и снабдить видео. Я понял, что это важный шаг. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F6n\u002F4w\u002F-g\u002F6n4w-gnqiyglhtfc0vclwaed1yy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F6n\u002F4w\u002F-g\u002F6n4w-gnqiyglhtfc0vclwaed1yy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ вот моя суперпростая диаграмма, что же делать, если вы написали инструкцию. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы написали инструкцию и решили замолчать о ней, то это неправильный вариант. Надо рассказать о ней. Если вы решили рассказать об инструкции и в где-то в чате скинули ссылку, то это тоже неправильный вариант. Вам нужно скинуть ссылку и прямо по шагам пройтись по инструкции, записав коротенькое видео минуты на 2. Что вот это я открываю, сюда кликаю, потому что кому-то проще воспринимать такой формат. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fih\u002Fkw\u002F6y\u002Fihkw6ykhtfn4xd3dl--2zshsl-g.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fih\u002Fkw\u002F6y\u002Fihkw6ykhtfn4xd3dl--2zshsl-g.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ среди тех, кому проще воспринимать такой формат, найдутся те, кто не сможет это сделать с первого раза. И тут я рекомендую вам парное профилирование и анализ результатов профилирования. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpd\u002F5l\u002Ffx\u002Fpd5lfxbnv9c07cxmegiky0lfoae.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpd\u002F5l\u002Ffx\u002Fpd5lfxbnv9c07cxmegiky0lfoae.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТ. е. кроме того, что вы рассказали инструкцию о том, что она существует и, возможно, даже записали видео, приложили скрипты, попробуйте спрофилировать какой-то сервис чужими руками. По Skype подключитесь, пусть он расшарит экран. И он будет выполнять все эти действия с вашей помощью, с вашими подсказками, но сам. В этом случае это сильно отложится в памяти и будет большим подспорьем для человека.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F-e\u002Fu4\u002Fc9\u002F-eu4c95cm2dg8hrk5wfrg3ohbdo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-e\u002Fu4\u002Fc9\u002F-eu4c95cm2dg8hrk5wfrg3ohbdo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ последний шаг – это записать все в виде скриптом автоматизации, чтобы это выполнялось как-то совсем просто. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fht\u002Fgp\u002Fcu\u002Fhtgpcu303cw7nimg3mi114fnqmc.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fht\u002Fgp\u002Fcu\u002Fhtgpcu303cw7nimg3mi114fnqmc.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак вы поняли, автоматизировать надо не сильно много вещей. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fll\u002Ftv\u002Fts\u002Flltvtsd4ihdl48bfjthcoevyu2i.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fll\u002Ftv\u002Fts\u002Flltvtsd4ihdl48bfjthcoevyu2i.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНужно примонтировать, загрузить какие-то файлы в поду. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fif\u002F3c\u002Fvm\u002Fif3cvmcusuyktyj41vwqwv0_ida.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fif\u002F3c\u002Fvm\u002Fif3cvmcusuyktyj41vwqwv0_ida.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНужно поменять Java options. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fpp\u002Fxx\u002F0y\u002Fppxx0yi2f6viesaw5q5scmxl1mu.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpp\u002Fxx\u002F0y\u002Fppxx0yi2f6viesaw5q5scmxl1mu.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЗапустить процесс профилирования удаленно, локально. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fry\u002Feg\u002Fzb\u002Fryegzb1fkppn1nllxloiqzjd9le.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fry\u002Feg\u002Fzb\u002Fryegzb1fkppn1nllxloiqzjd9le.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ потом скачать результаты. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F4q\u002Fgb\u002F0x\u002F4qgb0xshn5lxnuc3eyuqb9j6xxi.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F4q\u002Fgb\u002F0x\u002F4qgb0xshn5lxnuc3eyuqb9j6xxi.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак вы понимаете, все это в Kubernetes возможно, например, с помощью Kubectl.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fzv\u002Fnj\u002F6q\u002Fzvnj6qffcio68biuzjgsxjr0bau.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fzv\u002Fnj\u002F6q\u002Fzvnj6qffcio68biuzjgsxjr0bau.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EА также с помощью Web-дашборда, который есть. Там, конечно, не совсем тривиальный способ будет по скачиванию результатов, но отдельные шаги можно реализовать. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Flm\u002F2c\u002Fnl\u002Flm2cnlzge9lu-3-oqq6dmbhtclo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flm\u002F2c\u002Fnl\u002Flm2cnlzge9lu-3-oqq6dmbhtclo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИли какие-то другие инструменты использовать. Мне понравился Lens.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fks\u002Foy\u002Fso\u002Fksoysogjqnxxcjeyhsuhuzzprq0.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fks\u002Foy\u002Fso\u002Fksoysogjqnxxcjeyhsuhuzzprq0.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКогда вы это сделали и заскриптовали, то к скриптам тоже напишите документацию, потому что программный продукт – это не только код, но и документация к нему. После того, как вы написали документацию, можно считать, что вы что-то заскриптовали.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fr3\u002F3o\u002Fph\u002Fr33oph19l_ck3ibskjd0-qqqq5m.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fr3\u002F3o\u002Fph\u002Fr33oph19l_ck3ibskjd0-qqqq5m.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ когда у вас есть скрипты, неплохо бы поместить это в CI\u002FCD окружение, чем я в текущий момент и стараюсь заниматься. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002F0t\u002Fgb\u002Fgt\u002F0tgbgtakij4edf5oyxuf2x-knfs.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F0t\u002Fgb\u002Fgt\u002F0tgbgtakij4edf5oyxuf2x-knfs.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа этом у меня, наверное, все. Надеюсь, совсем минимум белых пятен у вас осталось. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fbj\u002Fez\u002Foo\u002Fbjezoonjmvwwgoliudblncmktsw.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbj\u002Fez\u002Foo\u002Fbjezoonjmvwwgoliudblncmktsw.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ вам рассказывал про то, что с переходом на микросервисы задач меньше не стало. Тут появилось много особенностей Kubernetes’а. Вам нужно профилировать больше сервисов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Frf\u002Fcm\u002Fbn\u002Frfcmbnisl78ihsu2va5j0atkulo.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frf\u002Fcm\u002Fbn\u002Frfcmbnisl78ihsu2va5j0atkulo.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТоп-3 советов для Kubernetes такие:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EНачали профилирование, добавьте чуть-чуть ресурсов и задайте какие-то границы для этих ресурсов. \u003C\u002Fli\u003E\r\n\u003Cli\u003EПри большой нагрузке лучше использовать семплирование локально, чем инструментацию удаленно. \u003C\u002Fli\u003E\r\n\u003Cli\u003EИ важный момент про Alpline. Я не знал раньше про такую особенность, что musl реализации инструментов как раз для него, а Alpline сейчас популярен. \u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fd_\u002Fgr\u002Fpi\u002Fd_grpigjqmd2hy-1pwebcx_8maq.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fd_\u002Fgr\u002Fpi\u002Fd_grpigjqmd2hy-1pwebcx_8maq.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри выполнении анализа результатов профилирования стремитесь идти от крупного к мелкому, т. е. дробите-дробите. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fqp\u002Fhh\u002Fzn\u002Fqphhzndfso8nve9ftd63ncckco4.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fqp\u002Fhh\u002Fzn\u002Fqphhzndfso8nve9ftd63ncckco4.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСначала оцените все визуально. \u003C\u002Fli\u003E\r\n\u003Cli\u003EСоберите статистику. \u003C\u002Fli\u003E\r\n\u003Cli\u003EИ перейдите к деталям. Возможно, отфильтруете что-то по обращению в другие сервисы. \u003C\u002Fli\u003E\r\n\u003Cli\u003EJProfiler и YourKit могут перехватывать SQL и HTTP-запросы.\u003C\u002Fli\u003E\r\n\u003Cli\u003EС SJK несложно автоматизировать процесс формирования отчета. \u003C\u002Fli\u003E\r\n\u003Cli\u003EИ с JDK тоже такое можно. \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxh\u002Fv-\u002Fge\u002Fxhv-gezaesqmvbvlydr4_1mhg9q.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxh\u002Fv-\u002Fge\u002Fxhv-gezaesqmvbvlydr4_1mhg9q.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОбмен знаниями – это очень индивидуальный процесс. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fip\u002F9g\u002F-e\u002Fip9g-egv9ik9ygljw4v3fglwruk.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fip\u002F9g\u002F-e\u002Fip9g-egv9ik9ygljw4v3fglwruk.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EДокументируйте все, что делаете. \u003C\u002Fli\u003E\r\n\u003Cli\u003EБудьте терпеливы, когда объясняете и передаете знания. \u003C\u002Fli\u003E\r\n\u003Cli\u003EИ стремитесь делать так, чтобы при следующей итерации вам не нужно было повторять все снова, чтобы это было как-то автоматизировано. \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fgq\u002Flv\u002Fbj\u002Fgqlvbjh-0ilbyr7jmbyjszvz0wy.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgq\u002Flv\u002Fbj\u002Fgqlvbjh-0ilbyr7jmbyjszvz0wy.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа этом у меня все. Я вам рассказывал про профилирование. Если у вас есть вопросы, я буду рад ответить на них. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Владимир Ситников) У нас времени осталось мало, поэтому будут блиц-вопросы. Тебе Kubernetes нравится: да или нет?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003E(Вячеслав Смирнов) Нравится. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EПрофилировать Kubernetes нравится?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EНе очень. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EНа монолит вернешься?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EНет, не получится.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EJava или Go?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EЯ пока что знаю только Java.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EAlpine или нет?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cp\u003EНаверное, нет, слишком он урезанный.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"java"},{"titleHtml":"kubernetes"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhn\u002Fko\u002Fy8\u002Fhnkoy8r68jeazhjtozsvwrxx5me.jpeg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhn\u002Fko\u002Fy8\u002Fhnkoy8r68jeazhjtozsvwrxx5me.jpeg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583162\\\u002F\"},\"headline\":\"Вячеслав Смирнов. Профилирование JVM в Kubernetes\",\"datePublished\":\"2021-10-13T10:14:43+03:00\",\"dateModified\":\"2021-10-18T07:59:25+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Пацев Антон\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы. Вячеславу повезло ис...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583162\\\u002F#post-content-body\",\"about\":[\"h_java\",\"h_kubernetes\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F583162\\\u002F7d59b2b28dff9dae6abb201cc6ffd71b\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhn\\\u002Fko\\\u002Fy8\\\u002Fhnkoy8r68jeazhjtozsvwrxx5me.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fno\\\u002Fyo\\\u002F14\\\u002Fnoyo14dncvmsz8etcbvlykvddqc.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpa\\\u002Fce\\\u002Fll\\\u002Fpacellg1cksokuumrupaltjwpmy.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-8\\\u002Feu\\\u002Fte\\\u002F-8eute6bkrpgmrwly6qrungumwu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ffy\\\u002Fvw\\\u002Fqn\\\u002Ffyvwqnlxidncyzyl5yf29pkh9zo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Faq\\\u002Fcm\\\u002Fhi\\\u002Faqcmhi1x4ii3mja-gzsilztu8u0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fat\\\u002F_d\\\u002Fqg\\\u002Fat_dqghy94xma1hxtqnvrucxpdm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbw\\\u002F9z\\\u002Fv7\\\u002Fbw9zv7quv5invqoahxjiwnxc5t0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fn6\\\u002Fyb\\\u002F0i\\\u002Fn6yb0i_cemtrulu9t-swaq7l7z0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjq\\\u002Ffx\\\u002Flg\\\u002Fjqfxlgdqjt-g6lu0tltbx1hshpw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frg\\\u002Fdl\\\u002Fwy\\\u002Frgdlwydjpktsp3qdjoe7zb2rob4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fue\\\u002Fuc\\\u002Fvr\\\u002Fueucvr86lmuossfg2c3zqfzdzry.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F1f\\\u002F6l\\\u002Fqb\\\u002F1f6lqbeawdsvhb31ql_xujtfioo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frs\\\u002Fsg\\\u002Fgk\\\u002Frssggk75w04ddavxozg43awhzie.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fem\\\u002Ftx\\\u002Fz2\\\u002Femtxz2pxcgyzmabgmqv7h804zpw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fci\\\u002Fcw\\\u002Fr8\\\u002Fcicwr8ggfvoj9d1htdfhbksfrw8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-5\\\u002F66\\\u002Fvo\\\u002F-566vo__nnajd120lysm07mzn90.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpz\\\u002Fxy\\\u002Fjo\\\u002Fpzxyjoozcc7iqxdc7ilye3orus0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Feb\\\u002Fai\\\u002Flu\\\u002Febailuzkmgbw455pa4avsqrti3u.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F69\\\u002Fck\\\u002Fpk\\\u002F69ckpkrzaa1bilzcohazqfzeeho.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Flt\\\u002Fma\\\u002Fwx\\\u002Fltmawxervogkegzhaz-guekjcms.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fut\\\u002Fyp\\\u002Fsy\\\u002Futypsyb5bqbndmilhkg7_yi-xnw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fme\\\u002Fnl\\\u002Fec\\\u002Fmenleca841tcol15pzhtkoptijm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F8b\\\u002F2r\\\u002Fqu\\\u002F8b2rquowmcgk7zjs3f7ctqqip3g.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fd0\\\u002F0t\\\u002Ffo\\\u002Fd00tfocuhv-mppwu4m0ry-ongtq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fz7\\\u002Fr2\\\u002F6b\\\u002Fz7r26b02hn-uawasgkfbssbsope.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ffz\\\u002Fcd\\\u002F8g\\\u002Ffzcd8g9zai1ux-dch6rtt2wz5ms.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fad\\\u002Fb4\\\u002Fo1\\\u002Fadb4o1q66jgx0afilusmault95w.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frl\\\u002Ffj\\\u002Fmv\\\u002Frlfjmvtlu7czo866k0reyekmpxq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fr2\\\u002Fzr\\\u002F_q\\\u002Fr2zr_qyrsnbxforlbmsf6uvf09q.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjx\\\u002Fww\\\u002F4a\\\u002Fjxww4at_gvfph3dyxu5nvheoqum.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fez\\\u002Feo\\\u002Fbi\\\u002Fezeobiclkpy1rtwsw7plzhmmfai.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxg\\\u002Fgs\\\u002Fcc\\\u002Fxggsccv90e3ydb1_-wfsq0u1wfs.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F7s\\\u002Fxm\\\u002Fa5\\\u002F7sxma5tbbst7xvkh7z6ohyjctro.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhx\\\u002Feq\\\u002Fiy\\\u002Fhxeqiyh3u2li6ztyk9_seazgvyi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F0t\\\u002Ffg\\\u002Fbg\\\u002F0tfgbg5j69e6hkcsmwxofzb6m9k.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fdw\\\u002Fmy\\\u002Fvz\\\u002Fdwmyvz-0afchhl4zuousixldfh8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzt\\\u002F9j\\\u002Fdo\\\u002Fzt9jdolj-2ob45jrzlxilqpjjtg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fv_\\\u002Fcr\\\u002Fhq\\\u002Fv_crhqlaf2mkeqp3t4nfiydzxd8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fko\\\u002Fzb\\\u002Fz2\\\u002Fkozbz2nh_164ot54ppj1vzjgd5i.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F6a\\\u002Fby\\\u002Ftu\\\u002F6abyturr-ucm3avblx9j2gjybog.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fec\\\u002Fdp\\\u002Frx\\\u002Fecdprxigdzbocka_ie5edcfwsdi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhl\\\u002Fch\\\u002Fha\\\u002Fhlchhadip95mvx6lde19gvo7c5s.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fdk\\\u002F3i\\\u002F9g\\\u002Fdk3i9guxkkh1cde_zjbkdrbk7vu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F5d\\\u002Fij\\\u002Fix\\\u002F5dijixusurfrqnkpk--rr4zv40w.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fd-\\\u002Ftl\\\u002Ftw\\\u002Fd-tltwba3ewxip9b5ma82iog7wk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxe\\\u002Fny\\\u002Ffu\\\u002Fxenyfuuixezdfu-ijy16tivghyi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fnr\\\u002F4k\\\u002F0g\\\u002Fnr4k0gjy_cm5abykzmeh5cx1x94.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fac\\\u002F-a\\\u002Fbw\\\u002Fac-abwzfp_kwlr-myugumevx6-k.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fje\\\u002Fjp\\\u002Fvp\\\u002Fjejpvpqi6ba_kh5cktlhoqlk2nw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbz\\\u002F3d\\\u002F_x\\\u002Fbz3d_xjbzgvmq5b1hdvjrcxadxm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fur\\\u002Fzj\\\u002Fpr\\\u002Furzjprtm956dvkebbpdqmixc4da.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fiw\\\u002Fn8\\\u002Fgz\\\u002Fiwn8gzq1_-zikndj9kslg1zc7g8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbr\\\u002F_z\\\u002Fqv\\\u002Fbr_zqvbb1zfcxqojjp-glpnvwqo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ffk\\\u002Fd5\\\u002Fv5\\\u002Ffkd5v53vfw535q-s6kcanqbhipw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fez\\\u002Fsd\\\u002Fqu\\\u002Fezsdqu_gsg5t2tv7rguza6tnx7y.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fmf\\\u002Fmh\\\u002Fag\\\u002Fmfmhagbahjpvucxqhhuhmdp3mom.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxg\\\u002Fdw\\\u002Fgw\\\u002Fxgdwgwqbitjwambd7m5xey00nhw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fvp\\\u002Fbb\\\u002Fsf\\\u002Fvpbbsfxd4iimvon-fumqlrdbpe0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Foc\\\u002F7k\\\u002Fty\\\u002Foc7ktyjyeruv_87sntqhaurbfag.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fob\\\u002Fok\\\u002Fnk\\\u002Foboknkoqudqd65v8ct-ra6gajke.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fel\\\u002F7e\\\u002Fog\\\u002Fel7eog7bhmsoo6uqfpfae85uvf0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fsu\\\u002Fwm\\\u002Fcy\\\u002Fsuwmcynefsoiton-igolgkiwsqk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fju\\\u002Fls\\\u002Fb7\\\u002Fjulsb7wg_ofa81vx_9ayoi9ujjg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxv\\\u002Fcw\\\u002F5u\\\u002Fxvcw5un_udsqedu0kc3gu0p5quq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjf\\\u002Fpy\\\u002Fes\\\u002Fjfpyes6uch7_fhwdjkf6s84rbiw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbl\\\u002Fjn\\\u002F9l\\\u002Fbljn9lh1kxy3d3zuvhueg8febwm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyj\\\u002Fdx\\\u002F2s\\\u002Fyjdx2sbj7xwq3s6vitbc4l8m3ji.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fvw\\\u002Frg\\\u002Fz-\\\u002Fvwrgz-ohzmw4plbkxmhdpzuqdpq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fwg\\\u002Fnh\\\u002Fk2\\\u002Fwgnhk2qrqb4gb4a26lwnuejxfw8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fgd\\\u002Ftb\\\u002Fsu\\\u002Fgdtbsu9k3ufavyzkeb3cdxjmrsk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fj7\\\u002Fij\\\u002Ffu\\\u002Fj7ijfurzgva2juo-vtwf8wdiatc.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxk\\\u002Fa-\\\u002Fe1\\\u002Fxka-e1xa1glk-yh7vymv9y1xmi0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fmw\\\u002Fyi\\\u002Fxv\\\u002Fmwyixvzc7ouauiyu-v3fsv5j5ve.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbk\\\u002Fy8\\\u002F3m\\\u002Fbky83mem98kkdzv7zvwgl_huhww.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fes\\\u002Fvy\\\u002Fng\\\u002Fesvyngwjwqij_fua2wtdkzehvjy.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fci\\\u002Fql\\\u002Fte\\\u002Fciqltefefdlfb0fbqx8si-oaiu4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fdg\\\u002Fnp\\\u002Flv\\\u002Fdgnplveff9n9r9hkxgpe3dqpbxs.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjy\\\u002Fcc\\\u002Fef\\\u002Fjyccef_fvympzg2kfup9r2ohp7k.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F0w\\\u002Fms\\\u002Fhb\\\u002F0wmshbf1acm3uidnlupe6gc0tcg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-5\\\u002F9y\\\u002Fg-\\\u002F-59yg-kunlq-x0fudevwcprhn84.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzu\\\u002Fjw\\\u002Fl_\\\u002Fzujwl_cdori5hc-glk_viw41yfu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyb\\\u002Fbv\\\u002Fxe\\\u002Fybbvxexf5ssclntovjxgb49vrvi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fad\\\u002F-0\\\u002Fdq\\\u002Fad-0dq51cb2aap0zrpqkhzc-m0u.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fdf\\\u002Fls\\\u002Fg8\\\u002Fdflsg86nylelxahea1yz0uz9dn4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fb7\\\u002Fus\\\u002Fpa\\\u002Fb7uspafftsfom6dramgi53vqd_u.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F7f\\\u002Fxw\\\u002Fdo\\\u002F7fxwdox6iwnqbwybojbt-hj0qri.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fle\\\u002F-f\\\u002Fxv\\\u002Fle-fxvieyupxz8avmd4xyuhbdua.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fvv\\\u002Fq4\\\u002F29\\\u002Fvvq429gy94jiieflrn5d58bqc3y.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzv\\\u002Fjc\\\u002Fnj\\\u002Fzvjcnjprxdrxqzi4xr8cubihyvw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjs\\\u002Ffu\\\u002Fpo\\\u002Fjsfupouzcard_pajcjjsumtmque.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fqe\\\u002F80\\\u002F6x\\\u002Fqe806x79_tdmgzhd4ueyczcyrx0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjy\\\u002F1s\\\u002Fp4\\\u002Fjy1sp4mugndp0pbbguyslzr81xw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fmy\\\u002Fsa\\\u002F2d\\\u002Fmysa2depg6p_cuv7uhldaiqnx5a.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fj5\\\u002F0u\\\u002Ftz\\\u002Fj50utzpuq7qyw_ujwnqzqaiwdjm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F8-\\\u002Fzc\\\u002Fjj\\\u002F8-zcjjmqxj0qy5oy2mft9ciase8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fk6\\\u002F8f\\\u002Fny\\\u002Fk68fnymw8vhevaq5e0mzyt1h9f4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F6t\\\u002Fpo\\\u002Faa\\\u002F6tpoaad8yroroy8bludua3vcbh4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fnp\\\u002Fyj\\\u002Fzw\\\u002Fnpyjzwk0dluc3y_bxvx2b_frujy.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F_b\\\u002Fnn\\\u002Fiu\\\u002F_bnniuuplqr8xfjvvkbon17drjs.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F_g\\\u002F9l\\\u002Fan\\\u002F_g9lanusei-bd9mqxa1ayzc403s.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F48\\\u002Fnl\\\u002Fbo\\\u002F48nlbooxwpa9zyu9ppdliitx-z4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fw2\\\u002F-q\\\u002F3u\\\u002Fw2-q3u2yh-yjtitckzdi7waexks.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fok\\\u002Fb9\\\u002Fuh\\\u002Fokb9uhsa2oybftxfqmvdif9mric.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Faq\\\u002Fiw\\\u002Fur\\\u002Faqiwurprh48ezo5bbkj9xzf06om.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fb4\\\u002Fxe\\\u002Fs4\\\u002Fb4xes4t8xujivffxydzbq5stmds.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbj\\\u002Fqx\\\u002Fdo\\\u002Fbjqxdogcqvi6demn6e1mgpo8kfu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fku\\\u002Fuv\\\u002Frp\\\u002Fkuuvrprb2o67naigcrzyfvafrlk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fst\\\u002Fet\\\u002Fbo\\\u002Fstetbon8lvgvo37hqupvm_zikay.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F6r\\\u002Fpj\\\u002Fzl\\\u002F6rpjzlejwv7xjmfz-aqqunofeja.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhx\\\u002Fln\\\u002Frs\\\u002Fhxlnrsbquqdnyggzvjeq0f8c3ng.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fg8\\\u002Fel\\\u002Faf\\\u002Fg8elafdugqfcppidp0m42yuevt0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fsw\\\u002Fzk\\\u002Fd9\\\u002Fswzkd90m1tyksfzb8lk0jmw5mey.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpq\\\u002F_l\\\u002Fqk\\\u002Fpq_lqkboysntswre8do-ijzqftg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzp\\\u002F26\\\u002Fgv\\\u002Fzp26gvqhwda7tkxmsmicukfiq1m.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F5p\\\u002Fjc\\\u002Fwy\\\u002F5pjcwy5hsbm-qiy8ilmdlulb8to.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F8c\\\u002Frt\\\u002Fim\\\u002F8crtimfttv8vscbdqsz-g0d3dra.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F_n\\\u002F73\\\u002F5t\\\u002F_n735titight87grzx6n-wfyk0w.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyd\\\u002Fzh\\\u002Fzc\\\u002Fydzhzco4sdch6ugvzzh2rxzfrqm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fcl\\\u002Fhr\\\u002Ffb\\\u002Fclhrfbd-wgodh8jlcvy7yzc8irm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Faq\\\u002Ft9\\\u002Fcf\\\u002Faqt9cfwqbxwirq4fykssfx0z2pa.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzq\\\u002Fmh\\\u002Fbp\\\u002Fzqmhbpx49wvzpuevp6ztjspaday.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fej\\\u002Fvt\\\u002Fvh\\\u002Fejvtvhf5ccmpwjtieaxpxunmxqe.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpe\\\u002F8y\\\u002Fxy\\\u002Fpe8yxyxmhfuirsygfid2ff20ilo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fat\\\u002Fwa\\\u002Ff0\\\u002Fatwaf0xgicsozvknt0yeac-liao.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F_2\\\u002F4y\\\u002Fh5\\\u002F_24yh5tmrt1096li6ta2xnallhm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzx\\\u002Fpr\\\u002Fk5\\\u002Fzxprk564xnimjwbk9gzstf9p07m.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fod\\\u002Fbe\\\u002Fu3\\\u002Fodbeu357ttwq2fkjrx821chomh8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frs\\\u002Fjm\\\u002F7s\\\u002Frsjm7sxkzbe9oukfwsdvlyo4qxk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fw3\\\u002Ftc\\\u002Fxk\\\u002Fw3tcxkfazbx88vic-ihllo40w4u.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F_z\\\u002Fxh\\\u002Fs8\\\u002F_zxhs8rlrjaaycfmg3pvfavtlg8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhl\\\u002Fuy\\\u002Fl9\\\u002Fhluyl9-r0_svf94kidhnsdlkpeo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Feu\\\u002Fnk\\\u002F5h\\\u002Feunk5hgs8w1zb1kv8ynszhhwv3u.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fdk\\\u002Fyl\\\u002Faa\\\u002Fdkylaapdynv_stlpr4obg9znb5s.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F0c\\\u002Fcf\\\u002Ffn\\\u002F0ccffngbmjuj6sopb4wrdm5vqdi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fc6\\\u002Fr7\\\u002Fq3\\\u002Fc6r7q3_h4domw6dkwtignxyumru.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpl\\\u002Fig\\\u002F1z\\\u002Fplig1zfp84jshmdbkzjurc8aquk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhw\\\u002Fx7\\\u002Fua\\\u002Fhwx7uazplk4ijvgy3wdtujrbqc8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F5u\\\u002F1f\\\u002Fvw\\\u002F5u1fvwd8fjgxdbjguwpjsqltrga.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F74\\\u002Fx0\\\u002Flg\\\u002F74x0lgzta9-bxfhnxccs6q_sd88.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fia\\\u002Fca\\\u002F_w\\\u002Fiaca_wwhji4mt9fhs_end_pcx80.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fub\\\u002Fj0\\\u002Fne\\\u002Fubj0necvh_vji9tgwvvzcm7hyb8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F2e\\\u002F6m\\\u002Fdx\\\u002F2e6mdx4ugb6wbhuhnpgrpb_aoq0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpo\\\u002Fj9\\\u002Fyw\\\u002Fpoj9ywslknhwfqia-lt0_lxniem.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frh\\\u002Fkd\\\u002F2-\\\u002Frhkd2-gnkwkkdfgj_zeqtnfjxx4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ft6\\\u002Fjx\\\u002Fpd\\\u002Ft6jxpdxn4vl2cxkivhe3v_el5hs.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhf\\\u002F2l\\\u002F5x\\\u002Fhf2l5xhlfcv2v2cod4fhrrvpbvq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxk\\\u002Fpl\\\u002Fpm\\\u002Fxkplpm5tvpjon4gv2nelihg_v_y.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fqp\\\u002Fun\\\u002Fzp\\\u002Fqpunzpf7nuubt3cuc4p1nfh1fhi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F3s\\\u002Fw3\\\u002Fgn\\\u002F3sw3gn3xlpovg0sjupphnyruals.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fo9\\\u002Ffw\\\u002Fjo\\\u002Fo9fwjoolqwws48ct5887vx17r0q.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fvj\\\u002Fal\\\u002F3u\\\u002Fvjal3u2eiujudv9ahpiibzwlwjq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F3z\\\u002Fuz\\\u002F_z\\\u002F3zuz_z2y0qzcx7xbny9kjsqg4wk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fya\\\u002Fc8\\\u002F8r\\\u002Fyac88rc-d4iihfpev1wownmkn8g.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzf\\\u002Flf\\\u002Fs2\\\u002Fzflfs29vwbepgzygjfbhl2ufsyq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fd0\\\u002Fmn\\\u002Fnh\\\u002Fd0mnnhuri3shibagmsqugbakkou.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fi5\\\u002Fvc\\\u002F72\\\u002Fi5vc72253g8osgtac34q2xr0rhs.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F6u\\\u002F9b\\\u002Fq1\\\u002F6u9bq1xvdugeaiioovskosbmja0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fy2\\\u002Fsj\\\u002Fxf\\\u002Fy2sjxfunobdyxmbndq5wt5wgsdu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Foe\\\u002Fpn\\\u002Ff9\\\u002Foepnf9-m8caimaxdzwn4lvyctpi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fnm\\\u002Fkl\\\u002Ftq\\\u002Fnmkltqjde2ftyxoy1m3mciyy-ce.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhr\\\u002Fct\\\u002Fn1\\\u002Fhrctn1b8ga9gwf0bjm5s0zo_3aq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxf\\\u002Fn0\\\u002Fag\\\u002Fxfn0agcdndmfphsp5hos_gkimqm.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fho\\\u002Fcg\\\u002Fap\\\u002Fhocgapt1kizx3jhtbyr5dvilyge.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbw\\\u002Fks\\\u002Fom\\\u002Fbwksomzy199yzw60kl0ic_o64u4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzl\\\u002Fzj\\\u002Fdr\\\u002Fzlzjdrhhaij26bkpursynqz5dok.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fsi\\\u002Fid\\\u002F-s\\\u002Fsiid-s2eymkoazohnqunb1kiory.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fh2\\\u002Fsg\\\u002Fi_\\\u002Fh2sgi_g_lpr6610kmwsw-umdyca.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fai\\\u002Fdm\\\u002Fey\\\u002Faidmeyyktf7meevqmrmlk1i6jkc.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Flt\\\u002Feb\\\u002F-w\\\u002Flteb-wvoyigitgcpqtfzjvt1ukg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fj8\\\u002Fod\\\u002Frq\\\u002Fj8odrqd_m2nqwahrj4wmynw2zqw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fet\\\u002Fy_\\\u002Fbs\\\u002Fety_bsgjdwms52f_lqugxbt6bya.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Feu\\\u002Ffx\\\u002Fom\\\u002Feufxomk6kqh3jtun43ep0qdym9m.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F3u\\\u002Ftm\\\u002Few\\\u002F3utmewzqhydphd3y2dwctwuiapi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F6g\\\u002F8i\\\u002Fid\\\u002F6g8iid1wlognz4xrjj9lhcmlgzg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fme\\\u002Ffs\\\u002Fmm\\\u002Fmefsmmifese-nvv4qhwf800a6ck.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F87\\\u002Fxc\\\u002F9d\\\u002F87xc9d96odydv0nq0uheag9zn-k.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fen\\\u002Fhp\\\u002F5f\\\u002Fenhp5fhj_mrtusqxqh2_qse-hxk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fud\\\u002Ff9\\\u002Fyw\\\u002Fudf9ywwiibgeapsycsddvvt5-m0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyi\\\u002Fh3\\\u002Fx1\\\u002Fyih3x100yimhxi_vvxmraa3fz78.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyd\\\u002Fip\\\u002F9c\\\u002Fydip9cjizxycg0grloiqailbq_m.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-m\\\u002Fmd\\\u002Fwa\\\u002F-mmdwagmbs5dad1o0roke2fo45u.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fcn\\\u002Fkv\\\u002Ftx\\\u002Fcnkvtxbjfon4omopuneua88mhds.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fuq\\\u002Fdo\\\u002Fnz\\\u002Fuqdonz_zn-izrqb79_jaa8yvfuu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F0i\\\u002Fbc\\\u002Fr8\\\u002F0ibcr8sgpmbqvbgp2e-um8wj2aa.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fsl\\\u002Fid\\\u002Ftm\\\u002Fslidtmvla5h1gvf9pf4ys1e1nmk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fj3\\\u002Fem\\\u002F-w\\\u002Fj3em-whzfq4dt-vugi_hxw29yls.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fky\\\u002Fs2\\\u002Fh2\\\u002Fkys2h2jpjkpwyj7vhhcwrbc6fd0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbd\\\u002F07\\\u002Fdm\\\u002Fbd07dm_dgkr_6z0r8iw4rctjvym.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frn\\\u002Fyt\\\u002Frp\\\u002Frnytrpisfys9nc5abnhjpn68n_y.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ft-\\\u002F4o\\\u002Fml\\\u002Ft-4omltjqghlnkaawbqgtdpbmeq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzr\\\u002Fqq\\\u002F49\\\u002Fzrqq49ny2fmtcq2dfrp-habagia.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fed\\\u002Fp-\\\u002Fau\\\u002Fedp-aua3lc_k0cthfxjxyr6rchw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fix\\\u002Ftr\\\u002Fem\\\u002Fixtreml4kaei5ulcqumwmyx7_mq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fnx\\\u002Fid\\\u002Ftf\\\u002Fnxidtfhgiwfoabgdsgo1ni0ib6g.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-r\\\u002Fyl\\\u002F-2\\\u002F-ryl-2vzokc1pwkehczpbpn-z30.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ffr\\\u002Fpd\\\u002Fvj\\\u002Ffrpdvj6x5dyqj8q-xyq4tll2tji.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fml\\\u002Fuc\\\u002Fhv\\\u002Fmluchv-uc8klvq03ceempuk6cvy.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ffp\\\u002Fnj\\\u002Fwl\\\u002Ffpnjwliubi8qauwjkhrewugfpjy.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F7o\\\u002Fan\\\u002Far\\\u002F7oanarve-p5l5sex9mx-3aqtqu0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fep\\\u002Fpt\\\u002Fqf\\\u002Fepptqfjvel_vyvupgkji6j26uss.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Flm\\\u002Fbt\\\u002Fna\\\u002Flmbtnaa5niwew7sz-a7lriaexwu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyk\\\u002Frd\\\u002Fqa\\\u002Fykrdqacggepipmm_2dvp7fly5ia.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Fsw\\\u002Fls\\\u002Fa_swlss32pli6b1d7ascin7n4eo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fyp\\\u002Fsv\\\u002Fny\\\u002Fypsvnyf7yr7ib_hfz25enj_f4aa.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fes\\\u002Fbx\\\u002Ff2\\\u002Fesbxf2kot34p-xx9xemz-lvhib0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fv8\\\u002Fce\\\u002F2j\\\u002Fv8ce2j_9upd8dtb0rhp6gyax-5i.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F3v\\\u002F_f\\\u002Ff0\\\u002F3v_ff052tx42jn7nfnqkhdhxuwu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ffr\\\u002Fpc\\\u002Fia\\\u002Ffrpciayq0wc4xi9qzzwbjmvbyau.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fhx\\\u002Fp2\\\u002F4n\\\u002Fhxp24ndpklksbmoeztmxl0wdjjg.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fr0\\\u002Fbe\\\u002Fi1\\\u002Fr0bei1ks8o-r_fbvmceorp_npf8.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxx\\\u002Frn\\\u002F1w\\\u002Fxxrn1w2s6iu7b9iehqnya7qqkwa.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frp\\\u002Fya\\\u002F40\\\u002Frpya40swjqdveohidlfkuyf3e8y.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fc5\\\u002Fmc\\\u002Fml\\\u002Fc5mcmlgnk6vdat6o_n4p9v6gytu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F6n\\\u002F4w\\\u002F-g\\\u002F6n4w-gnqiyglhtfc0vclwaed1yy.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fih\\\u002Fkw\\\u002F6y\\\u002Fihkw6ykhtfn4xd3dl--2zshsl-g.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpd\\\u002F5l\\\u002Ffx\\\u002Fpd5lfxbnv9c07cxmegiky0lfoae.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-e\\\u002Fu4\\\u002Fc9\\\u002F-eu4c95cm2dg8hrk5wfrg3ohbdo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fht\\\u002Fgp\\\u002Fcu\\\u002Fhtgpcu303cw7nimg3mi114fnqmc.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fll\\\u002Ftv\\\u002Fts\\\u002Flltvtsd4ihdl48bfjthcoevyu2i.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fif\\\u002F3c\\\u002Fvm\\\u002Fif3cvmcusuyktyj41vwqwv0_ida.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fpp\\\u002Fxx\\\u002F0y\\\u002Fppxx0yi2f6viesaw5q5scmxl1mu.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fry\\\u002Feg\\\u002Fzb\\\u002Fryegzb1fkppn1nllxloiqzjd9le.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F4q\\\u002Fgb\\\u002F0x\\\u002F4qgb0xshn5lxnuc3eyuqb9j6xxi.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzv\\\u002Fnj\\\u002F6q\\\u002Fzvnj6qffcio68biuzjgsxjr0bau.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Flm\\\u002F2c\\\u002Fnl\\\u002Flm2cnlzge9lu-3-oqq6dmbhtclo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fks\\\u002Foy\\\u002Fso\\\u002Fksoysogjqnxxcjeyhsuhuzzprq0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fr3\\\u002F3o\\\u002Fph\\\u002Fr33oph19l_ck3ibskjd0-qqqq5m.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F0t\\\u002Fgb\\\u002Fgt\\\u002F0tgbgtakij4edf5oyxuf2x-knfs.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fbj\\\u002Fez\\\u002Foo\\\u002Fbjezoonjmvwwgoliudblncmktsw.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frf\\\u002Fcm\\\u002Fbn\\\u002Frfcmbnisl78ihsu2va5j0atkulo.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fd_\\\u002Fgr\\\u002Fpi\\\u002Fd_grpigjqmd2hy-1pwebcx_8maq.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fqp\\\u002Fhh\\\u002Fzn\\\u002Fqphhzndfso8nve9ftd63ncckco4.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxh\\\u002Fv-\\\u002Fge\\\u002Fxhv-gezaesqmvbvlydr4_1mhg9q.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fip\\\u002F9g\\\u002F-e\\\u002Fip9g-egv9ik9ygljw4v3fglwruk.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fgq\\\u002Flv\\\u002Fbj\\\u002Fgqlvbjh-0ilbyr7jmbyjszvz0wy.jpeg\"]}","metaDescription":"Вариантов и инструментов профилирования JVM много, так много, что обо всех и не рассказать. И каждый имеет свои особенности, плюсы и минусы.\r\nВячеславу повезло использовать разные инструменты. И...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"java,kubernetes"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
