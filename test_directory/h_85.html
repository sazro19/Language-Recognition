<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Подготовка эффективной среды для написания bash сценариев / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/583320\/"},"headline":"Подготовка эффективной среды для написания bash сценариев","datePublished":"2021-10-24T03:13:52+03:00","dateModified":"2021-10-25T01:12:49+03:00","author":{"@type":"Person","name":"Maxim Levchenko"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пыт...","url":"https:\/\/habr.com\/ru\/post\/583320\/#post-content-body","about":["h_sys_admin","h_nix","h_s_admin","h_devops","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/583320\/be3836f5bdffbfe5002d3a1f0e06b3f5\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/345\/9f9\/af1\/3459f9af1b708da2b5d3d729e44fe8e9.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/3ee\/d6c\/fdb\/3eed6cfdb7fcd20e9e8b8b89f7258503.jpeg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/53d\/019\/c96\/53d019c96f6f2adf3d87f977dd128098.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/b9e\/560\/10d\/b9e56010de26f69e4df8a6d99beec958.jpeg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c74\/cc6\/b4e\/c74cc6b4ebe49a484076d0dd2b1d5ddc.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/329\/502\/dc4\/329502dc4f59da30908726bb67324ba6.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/422\/a0a\/73b\/422a0a73b5b191b54dcaa728b9586804.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/41f\/b01\/ec8\/41fb01ec8cb4b51d45639efe8535b310.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/9e9\/671\/750\/9e9671750379364352e58162fcbb8736.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1bb\/324\/41d\/1bb32441d2f57deeb38805ad40ddd1a3.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/dea\/877\/94d\/dea87794de2dbe5a2cfb04e0e2ce1b3f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4a1\/db0\/691\/4a1db06911cbb77d76789adb5776c933.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c7f\/14e\/d13\/c7f14ed1327b1f3f1d646691bdfa6dc4.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/2d9\/3aa\/79a\/2d93aa79a6dce0af4f47fa61da482172.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f66\/dc1\/94f\/f66dc194f50c7bc4d365e37e6c4f365f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a57\/70c\/750\/a5770c750b1996b4af8675bbec042252.jpeg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/9be\/9cb\/cce\/9be9cbcce1ed7328073211721bd4a01a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/21b\/828\/894\/21b828894ce71105975c4744a625b899.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Подготовка эффективной среды для написания bash сценариев" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Подготовка эффективной среды для написания bash сценариев" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Подготовка эффективной среды для написания bash сценариев" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/1f4/221/06e/1f422106e68319cfc5cfd933e540d535.jpg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/1f4/221/06e/1f422106e68319cfc5cfd933e540d535.jpg" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/1f4/221/06e/1f422106e68319cfc5cfd933e540d535.jpg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/1f4/221/06e/1f422106e68319cfc5cfd933e540d535.jpg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/1f4/221/06e/1f422106e68319cfc5cfd933e540d535.jpg" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="583320" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-24T00:13:52.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/583320/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/583320/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/1f4/221/06e/1f422106e68319cfc5cfd933e540d535.jpg" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/583320/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/WoozyMasta/" title="WoozyMasta" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/d75/461/059/d75461059fc3bad6aad755545f51f802.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/WoozyMasta/" class="tm-user-info__username">
      WoozyMasta
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-24T00:13:52.000Z" title="2021-10-24, 03:13">вчера в 03:13</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Подготовка эффективной среды для написания bash сценариев</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/sys_admin/" class="tm-article-snippet__hubs-item-link"><span>Системное администрирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/nix/" class="tm-article-snippet__hubs-item-link"><span>*nix</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/s_admin/" class="tm-article-snippet__hubs-item-link"><span>Серверное администрирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/devops/" class="tm-article-snippet__hubs-item-link"><span>DevOps</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Bash, он же <abbr title="Bourne again shell">возрождённый shell</abbr>, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он присутствует вокруг нас и никуда не собирается исчезать. Если вам приходится писать bash скрипты или вы только планируете этим заняться, данная статья написана для вас.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/345/9f9/af1/3459f9af1b708da2b5d3d729e44fe8e9.jpg" width="780" height="440" data-src="https://habrastorage.org/getpro/habr/upload_files/345/9f9/af1/3459f9af1b708da2b5d3d729e44fe8e9.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Статья несет исключительно рекомендательный характер и затрагивает в первую очередь <a href="https://ru.wikipedia.org/wiki/Bash" rel="noopener noreferrer nofollow">bash</a>, но также будет полезна и для работы с совместимыми оболочками, такими как: <a href="https://ru.wikipedia.org/wiki/Bourne_shell" rel="noopener noreferrer nofollow">sh</a>, <a href="https://ru.wikipedia.org/wiki/Almquist_shell" rel="noopener noreferrer nofollow">ash</a>, <a href="https://ru.wikipedia.org/wiki/Csh" rel="noopener noreferrer nofollow">csh</a>, <a href="https://ru.wikipedia.org/wiki/Korn_shell" rel="noopener noreferrer nofollow">ksh</a> и <a href="https://ru.wikipedia.org/wiki/Tcsh" rel="noopener noreferrer nofollow">tcsh</a>.</p><p>На данный момент, тема bash скриптинга не менее актуальна чем 10 или 20 лет назад. Хотя большинство дистрибутивов <abbr title="GNU/Linux - семейство Unix-подобных операционных систем на базе ядра Linux">Linux</abbr> перешли на <abbr title="Подсистема инициализации и управления службами в Linux">Systemd</abbr> или аналоги, а <a href="https://ru.wikipedia.org/wiki/System_V" rel="noopener noreferrer nofollow">System V</a> с скриптами для запуска служб ушел на пенсию, многое по прежнему реализовано при помощи скриптов и многие из них - это shell скрипты. В ключевых и популярных дистрибутивах, bash является оболочкой по умолчанию, и это неспроста, при помощи него легко автоматизировать рутину. С появлением docker, а после и kubernetes, тема bash скриптов стала только актуальнее, количество всевозможных <code>docker-entrypoint.sh</code>, <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" rel="noopener noreferrer nofollow">Job</a>, <a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/" rel="noopener noreferrer nofollow">CronJob</a> и <a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" rel="noopener noreferrer nofollow">initContainers</a> растет, а реализуются они чаще всего при помощи bash. Инструкция <code>RUN</code> в <code>Dockerfile</code>, вовсе внесла огромный вклад в мировой запас shell строк.</p><p>Это несложно, но необходимо знать некоторые основы bash скриптинга. Поехали!</p><hr/><h2>Текстовый редактор</h2><p>Начнем с выбора среды разработки, именно она позволяет объединять различные аспекты написания программы, повышая продуктивность за счет объединения общих действий по написанию программного обеспечения в одном приложении.</p><p>Я в своей практике использовал разные редакторы для работы с shell скриптами, приведенный список не является конечным, и перечислю только те, которые запомнились больше всего. Разделим на три условные категории:</p><ul><li><p><strong>Консольные текстовые редакторы</strong>. <a href="https://ru.wikipedia.org/wiki/Vim" rel="noopener noreferrer nofollow">Vim</a>, <a href="https://ru.wikipedia.org/wiki/Emacs" rel="noopener noreferrer nofollow">Emacs</a> и <a href="https://ru.wikipedia.org/wiki/Nano" rel="noopener noreferrer nofollow">Nano</a> - классическая троица, сейчас уже редко кто использует на рабочих станциях как основной инструмент, но vi и nano <abbr title="Монтирование удаленной файловой системы и прочие варианты для редактирования из IDE мы опустим.">незаменимы</abbr> для быстрого редактирования файлов в удаленных ssh сессиях. Если вы еще не работали с ним, рекомендую освоить такие вещи как поиск, замена и форматирование, хотя бы в <abbr title="Лучше конечно vi, он есть везде, в плоть до роутеров и IoT устройств. Правда, вам сначала нужно научится из него выходить.">nano</abbr>.</p></li><li><p><strong>Графические текстовые редакторы</strong>. <a href="https://ru.wikipedia.org/wiki/Xfce#Mousepad" rel="noopener noreferrer nofollow">Mousepad</a>, <a href="https://ru.wikipedia.org/wiki/Gedit" rel="noopener noreferrer nofollow">Gedit</a>, <a href="https://ru.wikipedia.org/wiki/Notepad%2B%2B" rel="noopener noreferrer nofollow">Notepad++</a> и т.п. Легковесные редакторы, с подсветкой синтаксиса, автозаменой и прочим, что уже есть в консольных редакторах, но они всё еще не являются полноценной интегрированной средой разработки.</p></li><li><p><strong><abbr title="Интегрированная среда разработки">IDE</abbr></strong>. <a href="https://ru.wikipedia.org/wiki/Geany" rel="noopener noreferrer nofollow">Geany</a>, <a href="https://ru.wikipedia.org/wiki/Atom_(%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D1%8B%D0%B9_%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80)" rel="noopener noreferrer nofollow">Atom</a>, <a href="https://ru.wikipedia.org/wiki/IntelliJ_IDEA" rel="noopener noreferrer nofollow">IntelliJ IDEA</a>, <a href="https://ru.wikipedia.org/wiki/Sublime_Text" rel="noopener noreferrer nofollow">Sublime Text</a> и <a href="https://ru.wikipedia.org/wiki/Visual_Studio_Code" rel="noopener noreferrer nofollow">Visual Studio Code</a> - это уже полноценные и расширяемые среды разработки. Долгие годы я пользовался Geany и пробовал все перечисленные варианты, но только с появлением VSCode мне удалось сменить основную IDE для большинства задач.</p></li></ul><blockquote><p>ℹ️ Половина статьи затрагивает конфигурацию параметров и расширения для <a href="https://ru.wikipedia.org/wiki/Visual_Studio_Code" rel="noopener noreferrer nofollow">Visual Studio Code</a>. Хотя, эта IDE может быть не в вашем вкусе, но информация приведенная в статье будет полезна в академических целях, а полученные знания, вы можете адаптировать под свое любимое окружение.</p></blockquote><figure class="bordered full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/3ee/d6c/fdb/3eed6cfdb7fcd20e9e8b8b89f7258503.jpeg" width="1200" height="914" data-src="https://habrastorage.org/getpro/habr/upload_files/3ee/d6c/fdb/3eed6cfdb7fcd20e9e8b8b89f7258503.jpeg" data-blurred="true"/><figcaption></figcaption></figure><h3>Альтернативные редакторы</h3><p>Существует как минимум три альтернативных среды разработки для написания bash скриптов:</p><ul><li><p>Специализированная IDE <a href="https://sourceforge.net/projects/basheclipse/" rel="noopener noreferrer nofollow">BashEclipse</a> основанная на Eclipse. </p></li><li><p>В IntelliJ IDEA можно добиться расширенной поддержки bash скриптинга путем установки расширений <a href="https://plugins.jetbrains.com/plugin/13122-shell-script" rel="noopener noreferrer nofollow">Shell Script</a>, <a href="https://plugins.jetbrains.com/plugin/10195-shellcheck" rel="noopener noreferrer nofollow">ShellCheck</a> и <a href="https://plugins.jetbrains.com/plugin/4230-bashsupport" rel="noopener noreferrer nofollow">BashSupport</a>.</p></li><li><p><a href="https://github.com/takluyver/bash_kernel" rel="noopener noreferrer nofollow">Bash Kernel</a> для Jupyter Notebook.</p></li></ul><hr/><h2>Настройка окружения</h2><p>Сперва следует настроить редактор так, чтобы он помогал нам писать скрипты в едином стиле и исправлял за нас небольшие огрехи.</p><h3>Ширина строк кода</h3><p>Начнем мы с того, что выведем на экран вертикальные линии для отображения столбцов 72, 80 и 132 символов, данная длина является «<a href="https://en.wikipedia.org/wiki/Characters_per_line" rel="noopener noreferrer nofollow">стандартным</a>» пределом для ширины кода. И мы будем стараться при написании скриптов умещаться в границу 80 столбцов, 72 столбец будет нашим желанным ориентиром, а 132 столбец пометим как край документа, применимый в исключительных ситуациях, за ним же следует пропасть.</p><p>Добавим нижеприведенную конфигурацию в файл настроек <code>settings.json</code> для <a href="https://ru.wikipedia.org/wiki/Visual_Studio_Code" rel="noopener noreferrer nofollow">Visual Studio Code</a>.</p><details class="spoiler"><summary>Как найти settings.json</summary><div class="spoiler__content"><ol><li><p>Откройте <a href="https://code.visualstudio.com" rel="noopener noreferrer nofollow">Visual Studio Code</a></p></li><li><p>Нажмите <strong>F1</strong>, чтобы открыть командную панель</p></li><li><p>Введите в открывшуюся панель «open settings»</p></li><li><p>Вам представлены два варианта, выберите «Open Settings (JSON)»</p></li></ol></div></details><pre><code class="json">{
  "[shellscript]": { // настройки применимые только для shellscript файлов
    "editor.rulers": [ // вертикальные лини подсветки столбцов 72, 80, 132 
      { "column": 72,  "color": "#1e751633", },
      { "column": 80,  "color": "#c2790b99", },
      { "column": 132, "color": "#a10d2d99" }
    ],
    "editor.minimap.maxColumn": 132, // ширина миникарты
    "editor.wordWrap": "off", // запрещаем перенос строк
  },
  // ... прочие настройки
}</code></pre><details class="spoiler"><summary>Краткий ответ, почему именно 72, 80 и 132 символа</summary><div class="spoiler__content"><p>Вы можете поблагодарить <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D1%84%D0%BE%D0%BA%D0%B0%D1%80%D1%82%D0%B0" rel="noopener noreferrer nofollow">перфокарту IBM</a> 1928 года за этот предел - в ней было 80 столбцов. Почему 80? Дело в том, что типичный шаг пишущей машинки 10-12 символов на дюйм, а это приводит к документам шириной от 72 до 90 символов, в зависимости от размера полей. После этого ранние телетайпы, а затем видео-терминалы использовали 80 столбцов, а затем 132 столбца в качестве стандартной ширины. Сейчас же, к примеру, пропорции окна эмулятора терминала по умолчанию остаются равными 80x24.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Три файла с шириной в 80 символов в Full HD разрешении и 12 размером шрифта, уже немного не помещаются на экран." title="Три файла с шириной в 80 символов в Full HD разрешении и 12 размером шрифта, уже немного не помещаются на экран." height="591" data-src="https://habrastorage.org/getpro/habr/upload_files/53d/019/c96/53d019c96f6f2adf3d87f977dd128098.png" data-width="1862"/><figcaption>Три файла с шириной в 80 символов в Full HD разрешении и 12 размером шрифта, уже немного не помещаются на экран.</figcaption></figure><p>Но ведь сейчас же не 1928 год! Да, но эргономика чтения файлов в 80 столбцов гораздо выше, а при сравнении двух файлов мы используем в два раза большую ширину (бывают еще diff-ы трех состояний). Все еще используются удаленные параллельные терминалы в гипервизорах и <abbr title="KVM-переключатель — устройство, предназначенное для коммутации одного комплекта устройств ввода-вывода между несколькими компьютерами.">KVM-свитчи</abbr> в серверных, и порой приходится что-то быстро поправить через них, находясь в сессии с разрешением 1024x768, а может и меньшим.</p><p>Возможно, вы владелец 4K+ дисплея и думаете, что вас это не касается. Но подумайте о других, кто будет использовать ваши скрипты, если конечно они публикуются за рамками вашего localhost.</p></div></details><h3>Отступы и окончание строк</h3><p>Одной из проблем, которую я встретил 15 лет назад, когда только знакомился с bash и наблюдаю по сей день, это <abbr title="CR и LF это управляющие символы или байт-код которые можно использовать для обозначения разрыва строки в текстовых файлах.">CRLF</abbr> (<code>\r\n</code> или <code>0x0D0A</code>) в файлах сценариев. Источником проблемы, чаще всего является копипаста bash скриптов в windows системах, но также это может быть и просто по невнимательности. Давайте настроим завершение сток при помощи LF.</p><p>Помимо типа окончания строк, также включим добавление пустой строки в конец файла и настроим отступы и их визуализацию.</p><pre><code class="json">{
  "[shellscript]": { // настройки применимые только для shellscript
    "files.eol": "\n", // явно зададим LF формат EOL
    "files.insertFinalNewline": true, // завершаем все файлы новой строкой
    "files.trimFinalNewlines": true, // удалим лишние новые строки в конце файла
    "files.trimTrailingWhitespace": true, // удалим лишние пробелы в конце строк
    "editor.renderWhitespace": "boundary", // отобразим два и более пробелов
    "editor.insertSpaces": true, // отступы делаем пробелами
    "editor.tabSize": 2, // размер отступа в два пробела
  },
  // ... прочие настройки
}</code></pre><details class="spoiler"><summary>Чем страшен CRLF?</summary><div class="spoiler__content"><p>Возврат каретки - это управляющий символ.  Когда вы печатаете его на  терминале, вместо отображения глифа терминал выполняет некоторый  специальный эффект.  Для возврата каретки специальный эффект заключается  в перемещении курсора в начало текущей строки.  Таким образом, если вы напечатаете строку, содержащую возврат каретки посередине, то в результате вторая половина будет записана поверх первой.</p><p>Давайте рассмотрим на примере, у нас есть простейший скрипт:</p><pre><code class="bash">#!/usr/bin/env bash

set -eu

printf '%s ' "Hi ${USER:-John Doe}! Today is"
LANG=en date
</code></pre><p>Сохраним его в файл <code>test-eol.sh</code>, сделаем его исполняемым <code>chmod +x ./test-eol.sh</code> и проверим работу:</p><pre><code class="diff"># ./test-eol.sh
Hi woozymasta! Today is Mon Oct 18 00:48:13 MSK 2021</code></pre><p>Всё хорошо, давайте заменим LF на CRLF, можно воспользоваться командой <code>sed $'s/$/\r/' -i test-eol.sh</code> и запустим сценарий еще раз:</p><pre><code class="diff"># ./test-eol.sh
/usr/bin/env: 'bash\r': No such file or directory</code></pre><p>Скрипт упал с ошибкой о том, что файла <code>bash\r</code> не существует, утилита <abbr title="Позволяет запустить программу в измененной среде ">env</abbr> приняла на вход строку как есть. И это хорошо, что скрипт упал, ведь могло произойти что-то более непредвиденное. Давайте обойдем использование <abbr title="Шебанг — последовательность из двух символов &quot;#!&quot; в начале файла скрипта. Когда скрипт с шебангом выполняется как программа, загрузчик рассматривает остаток строки после шебанга как имя файла программы-интерпретатора, запускает эту программу и передаёт ей в качестве параметра имя файла скрипта с шебангом.">shebang</abbr>, передав путь к скрипту как аргумент для bash:</p><pre><code class="diff"># bash ./test-eol.sh
./bash-eol.sh: line 2: $'\r': command not found
: invalid optionine 3: set: -
set: usage: set [-abefhkmnptuvxBCHP] [-o option-name] [--] [arg ...]
./bash-eol.sh: line 4: $'\r': command not found
 ./bash-eol.sh: line 6: $'date\r': command not found</code></pre><p>Как видно, теперь были обработаны все инструкции скрипта. Правда <abbr title="Если установлено, оболочка завершает работу, когда простая команда в списке команд завершается с ненулевым значением">set -e</abbr> не смог выполниться, и каждая команда сценария, смогла выполниться с ненулевым кодом возврата.</p><p>В этом примере, ничего страшного не произошло, но, что если у вас был бы такой скрипт:</p><pre><code class="bash">#!/usr/bin/env bash

set -eu

printf '%s ' "Hi ${USER:-John Doe}! Today is"
LANG=en date || \
  { rm -rf / --no-preserve-root; echo "you will not pass"; }; echo Done
</code></pre><blockquote><p>❗ <strong>Осторожно!</strong> Для проверки этого скрипта, всё же лучше замените <code>rm -rf / --no-preserve-root</code> , к примеру на <code>touch test</code></p></blockquote></div></details><details class="spoiler"><summary>Зачем нужна пустая строка в конце файла?</summary><div class="spoiler__content"><p>Речь идет не о добавлении дополнительной строки в конец файла, а о том, чтобы не удалять новую строку, которая должна быть там.  </p><p>Текстовый файл в Unix состоит из серии строк, каждая из которых заканчивается символом новой строки <code>\n</code>.  Таким образом, файл, который не является пустым и не заканчивается новой строкой, не является текстовым файлом.</p><p>Утилиты, которые должны работать с текстовыми файлами, могут не справиться с файлами, которые не заканчиваются символом новой строки. Исторические утилиты Unix могут, например, игнорировать текст после последней новой строки. Утилиты GNU придерживаются политики приличного поведения с нетекстовыми файлами, как и большинство других современных утилит, но вы все равно можете столкнуться со странным поведением с файлами, в которых отсутствует последняя новая строка.</p><p>И я бы предложил использовать добавление новой строки по умолчанию, во все редактируемые файлы, естественно если на то нет ограничений у формата.</p></div></details><h3>Автосохранение</h3><p>Данный момент выделен отдельно неспроста, редактировать shell сценарии в процессе их работы крайне нежелательно. Всё потому, что файл читается построчно и внесенные правки во время работы сценария могут вызвать непредвиденное поведение.</p><p>Просто помните об этом, и не включайте автосохранение при написании bash скриптов. К сожалению параметр <code>files.autoSave</code> не поддерживается для выборочных типов файлов, а устанавливается глобально на всё окружение.</p><details class="spoiler"><summary>Проверим на практике редактирование уже исполняющегося скрипта</summary><div class="spoiler__content"><p>Ситуации могут быть разные, к примеру, у вас есть долгоиграющий скрипт, и вы, в процессе его работы решили, всего лишь добавить еще одно отладочное сообщение в теле цикла. Скорее всего вас ждут проблемы на выходе из цикла.</p><p>А теперь рассмотрим простой доказательный пример, создадим скрипт <code>test.sh</code> работающий две секунды:</p><pre><code class="bash">#!/usr/bin/env bash

sleep 1s
echo one
sleep 1s
echo two
</code></pre><p>Запустим скрипт и по итогу выполнения напечатаем код выхода, объединим это в группу и запустим в отдельном потоке, а пока он отработает половину отведенного ему времени, допишем в него еще одну команду <code>exit 42 :</code></p><pre><code class="bash">{ ./test.sh &amp;&amp; echo $?; } &amp; sleep 1s; echo 'exit 42' >> ./test.sh; wait</code></pre><a class="anchor" name="explainshell" id="explainshell"></a><blockquote><p>ℹ️ Если однострочники у вас вызывают некоторое волнение, воспользуйтесь сервисом <a href="https://explainshell.com" rel="noopener noreferrer nofollow">explainshell.com</a>, он поможет на первых порах разбирать такие конструкции.</p></blockquote><p>И вот итог:</p><pre><code class="markdown">[1] 1208831
one
two
[1]+  Выход 42           { ./test.sh &amp;&amp; echo $?; }</code></pre><p>Но допустим автосохранение отключать нельзя, или вы сами на автомате нажали <strong>Ctrl</strong>+<strong>S</strong>, можно как-то предостеречь это поведение?</p><p>Вариантов на самом деле много, начиная созданием копий файла, но я бы предложил отправить скрипт в <abbr title="Pipe, та самая вертикальная черта для связывания stdout и stdin двух команд">трубу</abbr>:</p><pre><code class="bash">cat ./test.sh | bash -s - "${args[@]}"</code></pre><p>Но и здесь имеется ограничение, это размер буфера, равный 65536 байтам, с скриптом вес которого превышает размер буфера, этот трюк уже не пройдет как ожидалось.</p></div></details><hr/><p>Пожалуй это все параметры для редактора, которые хотелось осветить. Для удобства настройки, все параметры которые были внесли в settings.json приведены ниже:</p><details class="spoiler"><summary>Все параметры в settings.json для shellscript</summary><div class="spoiler__content"><pre><code class="json">{
  "files.autoSave": "off",
  "[shellscript]": {
    "files.eol": "\n",
    "files.insertFinalNewline": true,
    "files.trimFinalNewlines": true,
    "files.trimTrailingWhitespace": true,
    "editor.renderWhitespace": "boundary",
    "editor.insertSpaces": true,
    "editor.tabSize": 2,
    "editor.tabCompletion": "on",
    "editor.wordWrap": "off",
    "editor.rulers": [
      {
        "column": 72,
        "color": "#1e751633",
      },
      {
        "column": 80,
        "color": "#c2790b99",
      },
      {
        "column": 132,
        "color": "#a10d2d99"
      }
    ],
    "editor.minimap.maxColumn": 132,
  }
}</code></pre></div></details><h2>Утилиты и расширения</h2><p>Всё обилие возможностей и расширенное погружение в написание bash сценариев, открывается при использовании дополнительных утилит, таких как: линтер, отладчик, форматер, языковой сервер и т.п. Сами по себе утилиты хоть и решают свои функциональные задачи, только с интеграцией в IDE они по настоящему раскрывают свою мощь.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/b9e/560/10d/b9e56010de26f69e4df8a6d99beec958.jpeg" alt="Модульность IDE, это большой плюс, главное не перестараться" title="Модульность IDE, это большой плюс, главное не перестараться" width="811" height="454" data-src="https://habrastorage.org/getpro/habr/upload_files/b9e/560/10d/b9e56010de26f69e4df8a6d99beec958.jpeg" data-blurred="true"/><figcaption>Модульность IDE, это большой плюс, главное не перестараться</figcaption></figure><h3>ShellCheck</h3><a class="anchor" name="shellchek" id="shellchek"></a><p><a href="https://github.com/koalaman/shellcheck" rel="noopener noreferrer nofollow">ShellCheck</a> - это инструмент который дает предупреждения и предложения для сценариев bash и sh. Незаменимая вещь, которую следует использовать повсеместно для написания скриптов и встраивать в CI пайплайны. Поможет писать сценарии более корректно и надежно, укажет на типичные проблемы синтаксиса и семантические проблемы, а также уведомит о тонкостях и возможных подводных камнях в разных конструкциях.</p><p>Рекомендуется использовать <a href="https://github.com/koalaman/shellcheck/releases" rel="noopener noreferrer nofollow">последний релиз</a> приложения.</p><p>Для проверки сценария достаточно выполнить:</p><pre><code class="bash">shellcheck /path/to/script.sh</code></pre><details class="spoiler"><summary>Пример результата работы shellcheck</summary><div class="spoiler__content"><pre><code class="markdown">In /path/to/script.sh line 5:
echo $none
     ^---^ SC2154: none is referenced but not assigned.
     ^---^ SC2086: Double quote to prevent globbing and word splitting.

Did you mean: 
echo "$none"


In /path/to/script.sh line 6:
. ./test
  ^----^ SC1091: Not following: ./test was not specified as input (see shellcheck -x).
</code></pre></div></details><p>Но гораздо нагляднее, будет видеть все предупреждения и подсказки в самой IDE. Для этого установим расширение <a href="https://marketplace.visualstudio.com/items?itemName=timonwong.shellcheck" rel="noopener noreferrer nofollow">ShellCheck</a>:</p><pre><code class="markdown">ext install timonwong.shellcheck</code></pre><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример обнаружения проблем, с сылками на документацию и возможностью хотфикса" title="Пример обнаружения проблем, с сылками на документацию и возможностью хотфикса" height="314" data-src="https://habrastorage.org/getpro/habr/upload_files/c74/cc6/b4e/c74cc6b4ebe49a484076d0dd2b1d5ddc.png" data-width="650"/><figcaption>Пример обнаружения проблем, с сылками на документацию и возможностью хотфикса</figcaption></figure><h3>BASH Debugger</h3><a class="anchor" name="#bashdb" id="#bashdb"></a><p><a href="http://bashdb.sourceforge.net" rel="noopener noreferrer nofollow">BASH Debugger</a> - это внешний отладчик для bash, который следует синтаксису команды <a href="https://ru.wikipedia.org/wiki/GNU_Debugger" rel="noopener noreferrer nofollow">gdb</a>.</p><p>К сожалению в большинстве дистрибутивов пакет или отсутствует, или имеет очень старую версию, по этому соберем проект из исходников. Скачаем <a href="https://sourceforge.net/projects/bashdb/files/bashdb/" rel="noopener noreferrer nofollow">последнюю версию</a> или клонируем с <a href="https://github.com/BashSupport-Pro/bashdb/tags" rel="noopener noreferrer nofollow">зеркала на github</a> и собираем:</p><pre><code class="bash">tar xf bashdb-5.0-1.1.2.tar.gz
cd bashdb-5.0-1.1.2/
./configure
make

sudo make install
# можно взять один бинарь и обойтись без make install
# если работать c bashdb будем только из vscode
# cp bashdb ~/.local/bin/</code></pre><p>Теперь для запуска отладки скрипта выполним команду:</p><pre><code class="bash">bash --debugger -- /path/to/script.sh
# или
bashdb /path/to/script.sh</code></pre><details class="spoiler"><summary>Пример результата работы bashdb</summary><div class="spoiler__content"><pre><code class="diff">bash debugger, bashdb, release 5.0-1.1.2

Copyright 2002-2004, 2006-2012, 2014, 2016-2019 Rocky Bernstein
This is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.

(/path/to/script.sh:5):
5:	echo $none
bashdb&lt;0> backtrace
->0 in file `./bash-eol.sh' at line 5
##1 main("/usr/share/bashdb/bashdb-main.inc") called from file `/path/to/script.sh' at line 0
bashdb&lt;1> debug
Debugging new script with /usr/bin/bash --init-file /tmp/bashdb_profile_1067091 --debugger echo 
/usr/bin/echo: /usr/bin/echo: не удалось запустить двоичный файл
bashdb&lt;2> continue

/path/to/script.sh: строка 6: ./test: Нет такого файла или каталога
(standard_in) 1: syntax error
hi
Done 
</code></pre></div></details><p>Но это не так удобно, как расставлять точки останова в IDE, по этому установим расширение <a href="https://marketplace.visualstudio.com/items?itemName=rogalmic.bash-debug" rel="noopener noreferrer nofollow">Bash-debug</a>:</p><blockquote><p>⚠️ <strong>Внимание!</strong> Для работы требует наличия <a href="http://bashdb.sourceforge.net" rel="noopener noreferrer nofollow">bashdb</a> в системе</p></blockquote><pre><code class="markdown">ext install rogalmic.bash-debug</code></pre><figure class="full-width "><img src="/img/image-loader.svg" alt="Точки останова в bash сценариях" title="Точки останова в bash сценариях" height="886" data-src="https://habrastorage.org/getpro/habr/upload_files/329/502/dc4/329502dc4f59da30908726bb67324ba6.png" data-width="1560"/><figcaption>Точки останова в bash сценариях</figcaption></figure><h3>Shell Format</h3><a class="anchor" name="shell-format" id="shell-format"></a><p><a href="https://github.com/mvdan/sh#shfmt" rel="noopener noreferrer nofollow">Shfmt</a> - утилита для форматирования shell сценариев. Установим <a href="https://github.com/mvdan/sh/releases" rel="noopener noreferrer nofollow">последний релиз</a> и попробуем на практике:</p><pre><code class="bash"># Форматировать скрипт с настройками по умолчанию, вывод направить файл
shfmt /path/to/script.sh > /path/to/script-formated.sh
# Перезаписать файл, использовать отступ в два пробела
shfmt -w -i 2 ~/desktop/bash-eol.sh</code></pre><p>Очередь расширения, установим <a href="https://marketplace.visualstudio.com/items?itemName=foxundermoon.shell-format" rel="noopener noreferrer nofollow">Shell Format</a>:</p><pre><code class="markdown">ext install foxundermoon.shell-format</code></pre><p>Нам стало доступно форматирование файлов <code>shellscript</code>, и им уже можно воспользоваться. Для этого вызовем палитру команд, нажав <strong>F1</strong>, введем в поле «format document» и выберем этот же пункт.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример форматирования документа" title="Пример форматирования документа" height="655" data-src="https://habrastorage.org/getpro/habr/upload_files/422/a0a/73b/422a0a73b5b191b54dcaa728b9586804.gif" data-width="1021"/><figcaption>Пример форматирования документа</figcaption></figure><p>Помимо этого, вы можете настроить автоматическое форматирование документов, при сохранении файла, параметр <code>editor.formatOnSave</code>. </p><blockquote><p>ℹ️ Увы расширение не позволяет форматировать выделенный блок кода, в связи с этим недоступен параметр <code>editor.formatOnPaste</code> , позволяющий форматировать код вставляемый из буфера обмена.</p></blockquote><h3>Bash Language Server</h3><a class="anchor" name="bash-ls" id="bash-ls"></a><p><a href="https://github.com/bash-lsp/bash-language-server" rel="noopener noreferrer nofollow">Bash Language Server</a> - языковой сервер для интеграции в множество различных IDE. Установка языкового сервера приносит нам поведение среды разработки, как у больших языков программирования, такие возможности как: поиск ссылок, переход к объявлению, автодополнение, документация и т.п.</p><p>Для VSCode достаточно установить расширение <a href="https://marketplace.visualstudio.com/items?itemName=mads-hartmann.bash-ide-vscode" rel="noopener noreferrer nofollow">Bash IDE</a>:</p><pre><code class="markdown">ext install mads-hartmann.bash-ide-vscode</code></pre><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример отображения ссылок на функцию и автодополнения" title="Пример отображения ссылок на функцию и автодополнения" height="608" data-src="https://habrastorage.org/getpro/habr/upload_files/41f/b01/ec8/41fb01ec8cb4b51d45639efe8535b310.png" data-width="1399"/><figcaption>Пример отображения ссылок на функцию и автодополнения</figcaption></figure><blockquote><p>ℹ️ Расширение также поддерживает интеграцию с <a href="https://github.com/idank/explainshell" rel="noopener noreferrer nofollow">explainshell</a>, но для этого вам понадобится держать запущенным сервер explainshell, а на выходе вы не получите всей той магии, что доступна на сайте <a href="https://explainshell.com" rel="noopener noreferrer nofollow">explainshell.com</a>. В связи с этим интеграцию считаю сомнительной, и у себя не использую.</p></blockquote><h3>Shell Completion</h3><a class="anchor" name="shell-completion" id="shell-completion"></a><p>Работая с bash как оболочкой, во многих моментах помогает автодополнение по <strong>TAB</strong>, так вот для VSCode есть возможность дополнять аргументы для команд, реализуется это при помощи расширения <a href="https://marketplace.visualstudio.com/items?itemName=tetradresearch.vscode-h2o" rel="noopener noreferrer nofollow">Shell Completion</a>. Давайте проверим:</p><pre><code class="markdown">ext install tetradresearch.vscode-h2o</code></pre><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример автодополнения ключей к утилитам" title="Пример автодополнения ключей к утилитам" height="231" data-src="https://habrastorage.org/getpro/habr/upload_files/9e9/671/750/9e9671750379364352e58162fcbb8736.gif" data-width="869"/><figcaption>Пример автодополнения ключей к утилитам</figcaption></figure><h3>Manpages</h3><a class="anchor" name="manpages" id="manpages"></a><p>Самая актуальные и корректные руководства к утилитам, зачастую находится локально в <abbr title="Команда Unix, предназначенная для форматирования и вывода справочных страниц. Поставляется почти со всеми UNIX-подобными дистрибутивами.">man</abbr>, почему бы не читать их напрямую в среде разработки. <a href="https://marketplace.visualstudio.com/items?itemName=meronz.manpages" rel="noopener noreferrer nofollow">Manpages</a> поможет нам в этом, установим его:</p><pre><code class="markdown">ext install meronz.manpages</code></pre><p>Использовать расширение просто, выделяем в теле скрипта имя интересной нам команды и просим показать man через палитру команд или в <abbr title="ПКМ">контекстном меню</abbr>.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример просмотра руководства jq с свернутыми заголовками" title="Пример просмотра руководства jq с свернутыми заголовками" height="681" data-src="https://habrastorage.org/getpro/habr/upload_files/1bb/324/41d/1bb32441d2f57deeb38805ad40ddd1a3.png" data-width="1473"/><figcaption>Пример просмотра руководства jq с свернутыми заголовками</figcaption></figure><h3>ShellMan</h3><a class="anchor" name="shellman" id="shellman"></a><p><a href="https://github.com/yousefvand/shellman" rel="noopener noreferrer nofollow">Shellman</a> - наверное единственная совместимая с <a href="#shellchek" rel="noopener noreferrer nofollow">ShellCheck</a> коллекция сниппетов для bash. Будет полезно как новичкам, для более быстрого знакомства с скриптами, так и бывалым разработчикам позволит сэкономить время на написание рутинных конструкций. В магазине расширений доступно около десятка расширений с снипетами для shell скриптов наряду с <a href="https://marketplace.visualstudio.com/items?itemName=Remisa.shellman" rel="noopener noreferrer nofollow">Shellman</a>, при желании вы можете комбинировать их.</p><p>Установка расширения:</p><pre><code class="markdown">ext install Remisa.shellman</code></pre><p>Подробно ознакомится с возможностями и советами как пользоваться ShellMan вы можете в книге <a href="https://github.com/yousefvand/shellman-ebook/releases" rel="noopener noreferrer nofollow">shellman-ebook</a>.</p><h3>Code Runner</h3><a class="anchor" name="code-runner" id="code-runner"></a><p><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner" rel="noopener noreferrer nofollow">Code Runner</a> - расширение, позволяющее выполнять произвольный блок кода в самой IDE, для этого достаточно выделить необходимые строки и нажать <strong>CTRL</strong>+<strong>ALT</strong>+<strong>N,</strong> или вызвать данную функцию из контекстного меню, или палитры команд. Это заметно ускорит процесс написания скриптов.</p><pre><code class="markdown">ext install formulahendry.code-runner</code></pre><details class="spoiler"><summary>Демонстрация работы (GIF 5МБ)</summary><div class="spoiler__content"><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример исполнения определенных строк кода" title="Пример исполнения определенных строк кода" height="421" data-src="https://habrastorage.org/getpro/habr/upload_files/dea/877/94d/dea87794de2dbe5a2cfb04e0e2ce1b3f.png" data-width="764"/><figcaption>Пример исполнения определенных строк кода</figcaption></figure><figure class=""><img src="/img/image-loader.svg" alt="Пример, как можно писать скрипты без походов в терминал для тестирования" title="Пример, как можно писать скрипты без походов в терминал для тестирования" height="603" data-src="https://habrastorage.org/getpro/habr/upload_files/4a1/db0/691/4a1db06911cbb77d76789adb5776c933.gif" data-width="914"/><figcaption>Пример, как можно писать скрипты без походов в терминал для тестирования</figcaption></figure></div></details><h3>Hadolint</h3><a class="anchor" name="hadolint" id="hadolint"></a><p><a href="https://github.com/hadolint/hadolint" rel="noopener noreferrer nofollow">Hadolint</a> - это, пожалуй лучший линтер для <code>Dockerfile</code>. Почему он оказался в этом списке? Всё довольно просто, в <code>Dockerfile</code> имеется инструкция <code>RUN</code> в которой размещается shell скрипт, а Hadolint помимо общей проверки синтаксиса файла, также использует <a href="#shellchek" rel="noopener noreferrer nofollow">ShellCheck</a> для проверки этих скриптов.</p><p>Скачаем последнюю версию приложения с <a href="https://github.com/hadolint/hadolint/releases" rel="noopener noreferrer nofollow">страницы релизов</a>. Запустим утилиту, передав путь к <code>Dockerfile</code> как аргумент.</p><pre><code class="bash">hadolint ./Dockerfile</code></pre><p>И установим расширение <a href="https://marketplace.visualstudio.com/items?itemName=exiasr.hadolint" rel="noopener noreferrer nofollow">Hadolint</a> в VSCode:</p><blockquote><p>⚠️ <strong>Внимание!</strong> Для работы требует наличия <a href="https://github.com/hadolint/hadolint/releases" rel="noopener noreferrer nofollow">hadolint</a> в системе</p></blockquote><pre><code class="markdown">ext install exiasr.hadolint</code></pre><figure class="full-width "><img src="/img/image-loader.svg" alt="ShellCheck проверки работают в секции RUN в Dockerfile" title="ShellCheck проверки работают в секции RUN в Dockerfile" height="421" data-src="https://habrastorage.org/getpro/habr/upload_files/c7f/14e/d13/c7f14ed1327b1f3f1d646691bdfa6dc4.png" data-width="814"/><figcaption>ShellCheck проверки работают в секции RUN в Dockerfile</figcaption></figure><p>И как бонус, для подсветки синтаксиса shell скриптов в RUN секции Dockerfile, можно воспользоваться расширением <a href="https://marketplace.visualstudio.com/items?itemName=jeff-hykin.better-dockerfile-syntax" rel="noopener noreferrer nofollow">Better Dockerfile Syntax</a>.</p><h3>Txt Syntax</h3><a class="anchor" name="txt-syntax" id="txt-syntax"></a><p>Еще одно вспомогательное расширение <a href="https://marketplace.visualstudio.com/items?itemName=xshrim.txt-syntax" rel="noopener noreferrer nofollow">Txt Syntax</a>, напрямую не влияющее на bash скрипты, но позволяет выделить текстовые файлы (.txt, .out .tmp, .log, .ini, .cfg ...) и  предоставить общие служебные инструменты для текстовых документов. Shell сценарии часто опираются на всевозможные текстовые файлы, и будет полезно упростить работу с ними в IDE.</p><pre><code class="markdown">ext install xshrim.txt-syntax</code></pre><blockquote><p>ℹ️ Данное расширение помогает работать расширению <a href="#manpages" rel="noopener noreferrer nofollow">manpages</a>, а именно складывать и раскладывать заголовки в документах справки.</p></blockquote><h3>Better Shell Syntax</h3><a class="anchor" name="better-shell-syntax" id="better-shell-syntax"></a><p>И в завершении списка, расширим подсветку синтаксиса. По умолчанию подсветка не настолько хороша как могла быть, и расширение <a href="https://marketplace.visualstudio.com/items?itemName=jeff-hykin.better-shellscript-syntax" rel="noopener noreferrer nofollow">Better Shell Syntax</a> пытается исправить это, позволяя вашей теме лучше раскрашивать код. </p><pre><code class="markdown">ext install jeff-hykin.better-shellscript-syntax</code></pre><blockquote><p>ℹ️ Расширение не будет работать с стандартной темой (не будет эффекта), но всё будет хорошо в таких темах как: <a href="https://marketplace.visualstudio.com/items?itemName=Equinusocio.vsc-material-theme" rel="noopener noreferrer nofollow">Material Theme</a>, <a href="https://marketplace.visualstudio.com/items?itemName=jdinhlife.gruvbox" rel="noopener noreferrer nofollow">Gruvbox</a>, <a href="https://marketplace.visualstudio.com/items?itemName=jeff-hykin.xd-theme" rel="noopener noreferrer nofollow">XD Theme</a> и подобных.</p><p>При этом может не очень хорошо работать с вашей любимой, нестандартной темой оформления, перед использованием, проверьте всё ли вас устраивает.</p></blockquote><details class="spoiler"><summary>Примеры</summary><div class="spoiler__content"><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример подсветки с использованием Better Shell Syntax и теме оформления Gruvbox" title="Пример подсветки с использованием Better Shell Syntax и теме оформления Gruvbox" height="561" data-src="https://habrastorage.org/getpro/habr/upload_files/2d9/3aa/79a/2d93aa79a6dce0af4f47fa61da482172.png" data-width="1104"/><figcaption>Пример подсветки с использованием Better Shell Syntax и теме оформления Gruvbox</figcaption></figure><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример подсветки с использованием Better Shell Syntax и теме оформления Community Material Theme" title="Пример подсветки с использованием Better Shell Syntax и теме оформления Community Material Theme" height="561" data-src="https://habrastorage.org/getpro/habr/upload_files/f66/dc1/94f/f66dc194f50c7bc4d365e37e6c4f365f.png" data-width="1104"/><figcaption>Пример подсветки с использованием Better Shell Syntax и теме оформления Community Material Theme</figcaption></figure></div></details><hr/><p>Вот мы и закончили с обзором утилит и расширений. Последние два (<a href="#txt-syntax" rel="noopener noreferrer nofollow">Txt Syntax</a> и <a href="#better-shell-syntax" rel="noopener noreferrer nofollow">Better Shell Syntax</a>) несут больше косметический характер, и их можно смело пропустить, чего не могу сказать про весь оставшийся список, рекомендую хотя бы попробовать их на практике.</p><p>Для удобства установки, все расширения собраны в один пакет <a href="https://marketplace.visualstudio.com/items?itemName=woozy-masta.shell-script-ide" rel="noopener noreferrer nofollow">Shell script IDE</a>, правда бинарные зависимости (<a href="https://sourceforge.net/projects/bashdb/files/bashdb/" rel="noopener noreferrer nofollow">bashdb</a> и <a href="https://github.com/hadolint/hadolint/releases" rel="noopener noreferrer nofollow">hadolint</a>) придется устанавливать самостоятельно.  </p><pre><code class="markdown">ext install woozy-masta.shell-script-ide</code></pre><h2>Отладка</h2><p>Хорошо когда настроенная IDE есть под рукой, но не всегда бывает так, к примеру мы работаем на удаленном сервере или в контейнере. По этому затронем тему настройки окружения для отладки и немного коснемся её самой.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/a57/70c/750/a5770c750b1996b4af8675bbec042252.jpeg" width="811" height="916" data-src="https://habrastorage.org/getpro/habr/upload_files/a57/70c/750/a5770c750b1996b4af8675bbec042252.jpeg" data-blurred="true"/><figcaption></figcaption></figure><p>Когда что-то идет не по плану, вам нужно определить, что именно вызывает  сбой сценария.  Bash предоставляет возможность для отладки, это запуск подоболочки с параметром <code>-x</code>, который запускает весь сценарий в режиме отладки. Следы каждой команды плюс ее аргументы  выводятся на стандартный вывод после того, как команды были развернуты, но до их выполнения.</p><details class="spoiler"><summary>Еще немного про ключи для отладки</summary><div class="spoiler__content"><p>Параметр отладки может быть установлен в произвольном месте в теле скрипта. Для отладки определенного блока кода, установим перед кодом<code>set -x</code> , а для выхода из отладки при достижении конца отлаживаемого блока, обратим параметр вызвав <code>set +x</code> . </p><p>Минус используется для активации опций оболочки, а плюс для деактивации.  Пусть это вас не смущает.</p><p>Параметры которые вам скорее всего понадобятся для отладки:</p><div><div class="table"><table><tbody><tr><td data-colwidth="223" width="223"><p><code>set -f</code></p><p><code>set -o noglob</code> </p></td><td><p>Отключить получение имени файла с использованием метасимволов (подстановка).    </p></td></tr><tr><td data-colwidth="223" width="223"><p><code>set -v</code></p><p><code>set -o verbose</code></p></td><td><p>Печатает строки ввода оболочки по мере их чтения. Листинг скрипта будет предварительно выводиться на экран перед командами.</p></td></tr><tr><td data-colwidth="223" width="223"><p><code>set -x</code></p><p><code>set -o xtrace</code></p></td><td><p>Печатает трассировку команд перед выполнением команды.</p></td></tr><tr><td data-colwidth="223" width="223"><p><code>set -n</code></p><p><code>set -o noexec</code></p></td><td><p>Не исполнять сценарий, а только проверить на наличие синтаксических ошибок. Проверка будет выполнена только для грубых ошибок, надежнее использовать <a href="#shellchek" rel="noopener noreferrer nofollow">shellchek</a>.</p></td></tr></tbody></table></div></div><p>Также длинные параметры следующие за <code>set -o</code> могут быть переданы через переменную <code>SHELLOPTS</code> или используя родную для bash команду <code>shopt</code>.</p><p>В shopt включение или отключение опций происходит при помощи флагов:</p><ul><li><p><code>-s (set)</code> - установить опцию;</p></li><li><p><code>-u (unset)</code> - отключить опцию.</p></li></ul><p>Для того что бы отобразить текущие настройки параметров, выполните <code>set -o</code> или <code>shopt</code></p></div></details><p>Для экспериментов, давайте создадим простой скрипт.</p><details class="spoiler"><summary>Скрипт test.sh</summary><div class="spoiler__content"><pre><code class="bash">#!/usr/bin/env bash

set -eu

function print-msg () {
  printf '%b%-20s%b' "${colors[${1:-0}]}" "${@:2}" "${colors[0]}"
}

function random-color-echo() {
  print-msg $((1 + RANDOM % $((4 - 1)))) "${*:-}"
}

function msg () {
  random-color-echo "Hi ${*:-}!"
}

colors=(
  "$(tput sgr0)"    # reset
  "$(tput setaf 1)" # red
  "$(tput setaf 2)" # green
  "$(tput setaf 3)" # yellow
  "$(tput setaf 4)" # blue
)

for item in {"Bob","Alice"}; do
  echo "$({ msg "$item"; ( date '+%s%N' ); } &amp; wait)"
done

echo 'Done'
</code></pre></div></details><p>И выполним его при помощи <code>bash -x ./test.sh</code> или добавив <code>set -x</code> в начало скрипта:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Пример работы стандартной трассировки вызовов bash" title="Пример работы стандартной трассировки вызовов bash" height="460" data-src="https://habrastorage.org/getpro/habr/upload_files/9be/9cb/cce/9be9cbcce1ed7328073211721bd4a01a.png" data-width="734"/><figcaption>Пример работы стандартной трассировки вызовов bash</figcaption></figure><p>Замечательно, теперь мы видим как работает наш скрипт. Стоит только пояснить, что означает <code>+</code> , во первых, как вы догадались, за ним следует трассировка команды из скрипта, а вот количество знаков меняется и оно обозначает несколько уровней косвенного обращения.</p><p>Для небольших блоков логики этого зачастую достаточно, но, что если хочется большего? И первое, что мы можем сделать, это добавить необходимую информацию в параметр <code>PS4</code>:</p><pre><code class="bash"># Levels of indirection and time
PS4='+\011\[\e[3;34m\]\t\[\e[0m\]'
# User ID [Effective user ID]: Groups of user is a member
PS4+=' \[\e[0;35m\]$UID[$EUID]:$GROUPS\[\e[0m\] '
# Shell level and subshell
PS4+='\011\[\e[1;31m\]L$SHLVL:S$BASH_SUBSHELL\[\e[0m\]'
# Source file
PS4+=' \[\e[1;33m\]${BASH_SOURCE:-$0}\[\e[0m\]'
# Line number
PS4+='\[\e[0;36m\]#:${LINENO}\[\e[0m\]'
# Function name
PS4+='\011\[\e[1;32m\]${FUNCNAME[0]:+${FUNCNAME[0]}(): }\[\e[0m\]'
# Executed command
PS4+='\n# '
export PS4
</code></pre><blockquote><p>ℹ️ Объявить <code>PS4</code> вы можете в своем <code>~/.bashrc</code> и он будет с вами постоянно, или определить свой формат отладки непосредственно в теле самого скрипта, или временно экспортировать изменения на время жизни оболочки bash.</p></blockquote><details class="spoiler"><summary>О назначении параметров: PS0, PS1, PS2, PS3 и PS4 </summary><div class="spoiler__content"><ul><li><p><code>PS0</code> - Значение этого параметра раскрывается и отображается интерактивными оболочками после прочтения команды и до ее выполнения. Т.е. это будет напечатано перед исполнением каждой команды, по умолчанию не установлено.</p></li><li><p><code>PS1</code> - Значение этого параметра раскрывается и используется в качестве основной строки приглашения. Это ваше стандартное приветствие <code>user@host:~</code></p></li><li><p><code>PS2</code> - Значение этого параметра раскрывается, как и в случае с <code>PS1</code>, и используется в качестве дополнительной строки приглашения.</p></li><li><p><code>PS3</code> - Значение этого параметра используется в качестве подсказки для команды <code>select</code>.</p></li><li><p><code>PS4</code> - Значение этого параметра расширяется, как в случае с PS1, и значение печатается перед отображением каждой команды bash во время трассировки выполнения. Первый символ расширенного значения PS4 при необходимости повторяется несколько раз, чтобы указать несколько уровней косвенного обращения. По умолчанию <code>+</code></p></li></ul></div></details><p>И снова запустив скрипт, мы увидим уже немного другой результат:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Расширенный вывод информации при трассировке вызовов bash" title="Расширенный вывод информации при трассировке вызовов bash" height="863" data-src="https://habrastorage.org/getpro/habr/upload_files/21b/828/894/21b828894ce71105975c4744a625b899.png" data-width="717"/><figcaption>Расширенный вывод информации при трассировке вызовов bash</figcaption></figure><p>Давайте разберем этот пример, а в дальнейшем вы сами сможете реализовать удобный вывод отладочной информации под ваши нужды.</p><ul><li><p><code>+</code> - Первый символ, отображает уровни косвенного обращения к командам, эта часть осталась как в оригинальном <code>PS4</code>.</p></li><li><p><code>\t</code> - Текущее время, полезно для изучения тайминга команд, может быть заменено к примеру командой <code>date '+%x %X:%N %z'</code> для более подробного информирования, включая отображение наносекунд.</p></li><li><p><code>$UID[$EUID]:$GROUPS</code> - Выведем ID и эффективный ID пользователя, перечисляем группы, членом которых является текущий пользователь. Это будет полезно для скриптов выполняющих действия от разных пользователей.</p></li><li><p><code>L$SHLVL:S$BASH_SUBSHELL</code> - Отображения уровня оболочки, и уровня вложенной подоболочкой. Когда вы запускаете команду в оболочке, она запускается на уровне, называемом уровнем оболочки. Внутри оболочки вы можете открыть другую оболочку, которая делает её подоболочкой, или оболочку, которая её открыла.</p><ul><li><p>Уровень оболочки <code>SHLVL</code> поможет понять насколько глубоко вы находитесь в дочерних сессиях,  ведь у каждой последующей оболочки могут быть добавлены или переопределены важные вам параметры.</p></li><li><p>Уровень подоболочки <code>BASH_SUBSHELL</code> позволяет отслеживать все дочерние вызванные оболочки, к примеру, дочерняя оболочка <abbr title="Стандартным способом, мы не рассматриваем здесь колдунство и запрещенные приемы кунг-фу">не может вернуть</abbr> переменную в родительскую оболочку.</p></li></ul></li><li><p><code>${BASH_SOURCE:-$0}</code> - Имя исполняемого файла или функции.</p></li><li><p><code>#:${LINENO}</code> - Номер трассируемой строки.</p></li><li><p><code>${FUNCNAME[0]:+${FUNCNAME[0]}(): }</code> - Имя функции в рамках которой происходит исполнение.</p></li></ul><blockquote><p>ℹ️ Подробную информацию о параметрах вы всегда найдете в <code>man bash</code> разделах PROMPTING и PARAMETERS/Shell Variables</p></blockquote><p>Если вы обрабатываете вывод скрипта на лету или объем отладочного лога очень велик, было бы удобно направить трассировку в отдельный файл. Для этих целей существует параметр <code>BASH_XTRACEFD</code> , он позволяет указать номер <abbr title="Стандартные файловые дескрипторы: 0 - stdin, 1 - stdout и 2 - stderr">файлового дескриптора</abbr> для вывода сообщений трассировки.</p><p>Для этого мы создадим ссылку для файлового дескриптора с номером 3 на файл <code>debug_$0.log</code> где <code>$0</code> это имя bash сценария, а переменной <code>BASH_XTRACEFD</code> передадим номер нашего нового дескриптора.</p><pre><code class="bash">set -x
exec 3> "debug_$0.log"
BASH_XTRACEFD="3"</code></pre><p>Также имеется возможность перенаправить вывод не в файл, а в утилиту, к примеру отправив сообщения утилите <code>logger</code> мы сможем обратится к журналу при помощи команды<code>journalctl -t test.sh</code>.</p><pre><code class="bash">set -x
exec 3> >(logger -t "$0")
BASH_XTRACEFD="3"</code></pre><p>Теперь мы знаем как можно сделать отладку для всего сценария, или только для отдельной его части. Существует ли возможность принудительно исключить из отладки одну функцию? Да, и для этого достаточно в начало функции добавить такую конструкцию:</p><pre><code class="bash">function some () {
  { local -; set +x; } 2>/dev/null
  echo 'Do some stuff'
}</code></pre><p>На тот случай если стандартной трассировки bash вам недостаточно, нужно получить больше информации о работе скрипта, выполнить более тонкое профилирование работы или разобраться с зависаниями, обратитесь к таким системным инструментам как <code>strace</code> или в очень специфичной ситуации <code>gdb</code> <em>(надеюсь с вами этого не произойдет)</em></p><p>Пример запуска отладки скрипта при помощи <code>strace</code>:</p><pre><code class="bash">strace -C -f bash -x ./test.sh</code></pre><hr/><p>Благодарю за ваше время и внимание, эффективного bash скриптинга вам!</p><blockquote><p><em>Присоединяйтесь в </em><a href="https://t.me/devops_su" rel="noopener noreferrer nofollow"><em>телеграмм канал</em></a><em>, где я периодически публикую заметки на тему DevOps, SRE и архитектурных решений.</em></p></blockquote></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbash%5D" class="tm-tags-list__link">bash</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbash%20scripting%5D" class="tm-tags-list__link">bash scripting</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbash-%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%5D" class="tm-tags-list__link">bash-скрипт</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbash-scripting%5D" class="tm-tags-list__link">bash-scripting</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bvscode%5D" class="tm-tags-list__link">vscode</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbashdb%5D" class="tm-tags-list__link">bashdb</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdebug%5D" class="tm-tags-list__link">debug</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bshell-%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%5D" class="tm-tags-list__link">shell-скрипт</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bshell%5D" class="tm-tags-list__link">shell</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bshell%20scripting%5D" class="tm-tags-list__link">shell scripting</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/sys_admin/" class="tm-hubs-list__link">
    Системное администрирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/nix/" class="tm-hubs-list__link">
    *nix
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/s_admin/" class="tm-hubs-list__link">
    Серверное администрирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/devops/" class="tm-hubs-list__link">
    DevOps
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 24: ↑23 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 24: ↑23 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+22</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.9K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    113
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/WoozyMasta/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/d75/461/059/d75461059fc3bad6aad755545f51f802.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 8 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    6
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">22</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Maxim Levchenko</span> <a href="/ru/users/WoozyMasta/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @WoozyMasta
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">DevOps Engineer Expert</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://woozymasta.ru" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a><a href="https://github.com/WoozyMasta/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Github
    </a><a href="https://telegram.me/woozymasta" rel="noopener" target="_blank" class="tm-article-author__contact">
      Telegram
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/583320/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 4 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/583320/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/583320/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"583320":{"id":"583320","timePublished":"2021-10-24T00:13:52+00:00","isCorporative":false,"lang":"ru","titleHtml":"Подготовка эффективной среды для написания bash сценариев","leadData":{"textHtml":"\u003Cp\u003EBash, он же \u003Cabbr title=\"Bourne again shell\"\u003Eвозрождённый shell\u003C\u002Fabbr\u003E, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он присутствует вокруг нас и никуда не собирается исчезать. Если вам приходится писать bash скрипты или вы только планируете этим заняться, данная статья написана для вас.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1f4\u002F221\u002F06e\u002F1f422106e68319cfc5cfd933e540d535.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1f4\u002F221\u002F06e\u002F1f422106e68319cfc5cfd933e540d535.jpg","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":6,"votesCount":8},"rating":22,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fwoozymasta.ru","value":"https:\u002F\u002Fwoozymasta.ru"},{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002FWoozyMasta\u002F","value":"WoozyMasta"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fwoozymasta","value":"woozymasta"}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fwoozymasta.ru","value":"https:\u002F\u002Fwoozymasta.ru"},{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002FWoozyMasta\u002F","value":"WoozyMasta"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fwoozymasta","value":"woozymasta"}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"99995","alias":"WoozyMasta","fullname":"Maxim Levchenko","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd75\u002F461\u002F059\u002Fd75461059fc3bad6aad755545f51f802.jpg","speciality":"DevOps Engineer Expert"},"statistics":{"commentsCount":4,"favoritesCount":113,"readingCount":6870,"score":22,"votesCount":24},"hubs":[{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true},{"relatedData":null,"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true},{"relatedData":null,"id":"20788","alias":"devops","type":"collective","title":"DevOps","titleHtml":"DevOps","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EBash, он же \u003Cabbr title=\"Bourne again shell\"\u003Eвозрождённый shell\u003C\u002Fabbr\u003E, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он присутствует вокруг нас и никуда не собирается исчезать. Если вам приходится писать bash скрипты или вы только планируете этим заняться, данная статья написана для вас.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F345\u002F9f9\u002Faf1\u002F3459f9af1b708da2b5d3d729e44fe8e9.jpg\" width=\"780\" height=\"440\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F345\u002F9f9\u002Faf1\u002F3459f9af1b708da2b5d3d729e44fe8e9.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСтатья несет исключительно рекомендательный характер и затрагивает в первую очередь \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FBash\" rel=\"noopener noreferrer nofollow\"\u003Ebash\u003C\u002Fa\u003E, но также будет полезна и для работы с совместимыми оболочками, такими как: \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FBourne_shell\" rel=\"noopener noreferrer nofollow\"\u003Esh\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FAlmquist_shell\" rel=\"noopener noreferrer nofollow\"\u003Eash\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FCsh\" rel=\"noopener noreferrer nofollow\"\u003Ecsh\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FKorn_shell\" rel=\"noopener noreferrer nofollow\"\u003Eksh\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FTcsh\" rel=\"noopener noreferrer nofollow\"\u003Etcsh\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНа данный момент, тема bash скриптинга не менее актуальна чем 10 или 20 лет назад. Хотя большинство дистрибутивов \u003Cabbr title=\"GNU\u002FLinux - семейство Unix-подобных операционных систем на базе ядра Linux\"\u003ELinux\u003C\u002Fabbr\u003E перешли на \u003Cabbr title=\"Подсистема инициализации и управления службами в Linux\"\u003ESystemd\u003C\u002Fabbr\u003E или аналоги, а \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FSystem_V\" rel=\"noopener noreferrer nofollow\"\u003ESystem V\u003C\u002Fa\u003E с скриптами для запуска служб ушел на пенсию, многое по прежнему реализовано при помощи скриптов и многие из них - это shell скрипты. В ключевых и популярных дистрибутивах, bash является оболочкой по умолчанию, и это неспроста, при помощи него легко автоматизировать рутину. С появлением docker, а после и kubernetes, тема bash скриптов стала только актуальнее, количество всевозможных \u003Ccode\u003Edocker-entrypoint.sh\u003C\u002Fcode\u003E, \u003Ca href=\"https:\u002F\u002Fkubernetes.io\u002Fdocs\u002Fconcepts\u002Fworkloads\u002Fcontrollers\u002Fjob\u002F\" rel=\"noopener noreferrer nofollow\"\u003EJob\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fkubernetes.io\u002Fdocs\u002Fconcepts\u002Fworkloads\u002Fcontrollers\u002Fcron-jobs\u002F\" rel=\"noopener noreferrer nofollow\"\u003ECronJob\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fkubernetes.io\u002Fdocs\u002Fconcepts\u002Fworkloads\u002Fpods\u002Finit-containers\u002F\" rel=\"noopener noreferrer nofollow\"\u003EinitContainers\u003C\u002Fa\u003E растет, а реализуются они чаще всего при помощи bash. Инструкция \u003Ccode\u003ERUN\u003C\u002Fcode\u003E в \u003Ccode\u003EDockerfile\u003C\u002Fcode\u003E, вовсе внесла огромный вклад в мировой запас shell строк.\u003C\u002Fp\u003E\u003Cp\u003EЭто несложно, но необходимо знать некоторые основы bash скриптинга. Поехали!\u003C\u002Fp\u003E\u003Chr\u002F\u003E\u003Ch2\u003EТекстовый редактор\u003C\u002Fh2\u003E\u003Cp\u003EНачнем с выбора среды разработки, именно она позволяет объединять различные аспекты написания программы, повышая продуктивность за счет объединения общих действий по написанию программного обеспечения в одном приложении.\u003C\u002Fp\u003E\u003Cp\u003EЯ в своей практике использовал разные редакторы для работы с shell скриптами, приведенный список не является конечным, и перечислю только те, которые запомнились больше всего. Разделим на три условные категории:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EКонсольные текстовые редакторы\u003C\u002Fstrong\u003E. \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FVim\" rel=\"noopener noreferrer nofollow\"\u003EVim\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FEmacs\" rel=\"noopener noreferrer nofollow\"\u003EEmacs\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FNano\" rel=\"noopener noreferrer nofollow\"\u003ENano\u003C\u002Fa\u003E - классическая троица, сейчас уже редко кто использует на рабочих станциях как основной инструмент, но vi и nano \u003Cabbr title=\"Монтирование удаленной файловой системы и прочие варианты для редактирования из IDE мы опустим.\"\u003Eнезаменимы\u003C\u002Fabbr\u003E для быстрого редактирования файлов в удаленных ssh сессиях. Если вы еще не работали с ним, рекомендую освоить такие вещи как поиск, замена и форматирование, хотя бы в \u003Cabbr title=\"Лучше конечно vi, он есть везде, в плоть до роутеров и IoT устройств. Правда, вам сначала нужно научится из него выходить.\"\u003Enano\u003C\u002Fabbr\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EГрафические текстовые редакторы\u003C\u002Fstrong\u003E. \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FXfce#Mousepad\" rel=\"noopener noreferrer nofollow\"\u003EMousepad\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FGedit\" rel=\"noopener noreferrer nofollow\"\u003EGedit\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FNotepad%2B%2B\" rel=\"noopener noreferrer nofollow\"\u003ENotepad++\u003C\u002Fa\u003E и т.п. Легковесные редакторы, с подсветкой синтаксиса, автозаменой и прочим, что уже есть в консольных редакторах, но они всё еще не являются полноценной интегрированной средой разработки.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cabbr title=\"Интегрированная среда разработки\"\u003EIDE\u003C\u002Fabbr\u003E\u003C\u002Fstrong\u003E. \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FGeany\" rel=\"noopener noreferrer nofollow\"\u003EGeany\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FAtom_(%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D1%8B%D0%B9_%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%BE%D1%80)\" rel=\"noopener noreferrer nofollow\"\u003EAtom\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FIntelliJ_IDEA\" rel=\"noopener noreferrer nofollow\"\u003EIntelliJ IDEA\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FSublime_Text\" rel=\"noopener noreferrer nofollow\"\u003ESublime Text\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FVisual_Studio_Code\" rel=\"noopener noreferrer nofollow\"\u003EVisual Studio Code\u003C\u002Fa\u003E - это уже полноценные и расширяемые среды разработки. Долгие годы я пользовался Geany и пробовал все перечисленные варианты, но только с появлением VSCode мне удалось сменить основную IDE для большинства задач.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Половина статьи затрагивает конфигурацию параметров и расширения для \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FVisual_Studio_Code\" rel=\"noopener noreferrer nofollow\"\u003EVisual Studio Code\u003C\u002Fa\u003E. Хотя, эта IDE может быть не в вашем вкусе, но информация приведенная в статье будет полезна в академических целях, а полученные знания, вы можете адаптировать под свое любимое окружение.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3ee\u002Fd6c\u002Ffdb\u002F3eed6cfdb7fcd20e9e8b8b89f7258503.jpeg\" width=\"1200\" height=\"914\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3ee\u002Fd6c\u002Ffdb\u002F3eed6cfdb7fcd20e9e8b8b89f7258503.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EАльтернативные редакторы\u003C\u002Fh3\u003E\u003Cp\u003EСуществует как минимум три альтернативных среды разработки для написания bash скриптов:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EСпециализированная IDE \u003Ca href=\"https:\u002F\u002Fsourceforge.net\u002Fprojects\u002Fbasheclipse\u002F\" rel=\"noopener noreferrer nofollow\"\u003EBashEclipse\u003C\u002Fa\u003E основанная на Eclipse. \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВ IntelliJ IDEA можно добиться расширенной поддержки bash скриптинга путем установки расширений \u003Ca href=\"https:\u002F\u002Fplugins.jetbrains.com\u002Fplugin\u002F13122-shell-script\" rel=\"noopener noreferrer nofollow\"\u003EShell Script\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fplugins.jetbrains.com\u002Fplugin\u002F10195-shellcheck\" rel=\"noopener noreferrer nofollow\"\u003EShellCheck\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fplugins.jetbrains.com\u002Fplugin\u002F4230-bashsupport\" rel=\"noopener noreferrer nofollow\"\u003EBashSupport\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftakluyver\u002Fbash_kernel\" rel=\"noopener noreferrer nofollow\"\u003EBash Kernel\u003C\u002Fa\u003E для Jupyter Notebook.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Chr\u002F\u003E\u003Ch2\u003EНастройка окружения\u003C\u002Fh2\u003E\u003Cp\u003EСперва следует настроить редактор так, чтобы он помогал нам писать скрипты в едином стиле и исправлял за нас небольшие огрехи.\u003C\u002Fp\u003E\u003Ch3\u003EШирина строк кода\u003C\u002Fh3\u003E\u003Cp\u003EНачнем мы с того, что выведем на экран вертикальные линии для отображения столбцов 72, 80 и 132 символов, данная длина является «\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FCharacters_per_line\" rel=\"noopener noreferrer nofollow\"\u003Eстандартным\u003C\u002Fa\u003E» пределом для ширины кода. И мы будем стараться при написании скриптов умещаться в границу 80 столбцов, 72 столбец будет нашим желанным ориентиром, а 132 столбец пометим как край документа, применимый в исключительных ситуациях, за ним же следует пропасть.\u003C\u002Fp\u003E\u003Cp\u003EДобавим нижеприведенную конфигурацию в файл настроек \u003Ccode\u003Esettings.json\u003C\u002Fcode\u003E для \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FVisual_Studio_Code\" rel=\"noopener noreferrer nofollow\"\u003EVisual Studio Code\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EКак найти settings.json\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EОткройте \u003Ca href=\"https:\u002F\u002Fcode.visualstudio.com\" rel=\"noopener noreferrer nofollow\"\u003EVisual Studio Code\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНажмите \u003Cstrong\u003EF1\u003C\u002Fstrong\u003E, чтобы открыть командную панель\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВведите в открывшуюся панель «open settings»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВам представлены два варианта, выберите «Open Settings (JSON)»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"[shellscript]\": { \u002F\u002F настройки применимые только для shellscript файлов\n    \"editor.rulers\": [ \u002F\u002F вертикальные лини подсветки столбцов 72, 80, 132 \n      { \"column\": 72,  \"color\": \"#1e751633\", },\n      { \"column\": 80,  \"color\": \"#c2790b99\", },\n      { \"column\": 132, \"color\": \"#a10d2d99\" }\n    ],\n    \"editor.minimap.maxColumn\": 132, \u002F\u002F ширина миникарты\n    \"editor.wordWrap\": \"off\", \u002F\u002F запрещаем перенос строк\n  },\n  \u002F\u002F ... прочие настройки\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EКраткий ответ, почему именно 72, 80 и 132 символа\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EВы можете поблагодарить \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9F%D0%B5%D1%80%D1%84%D0%BE%D0%BA%D0%B0%D1%80%D1%82%D0%B0\" rel=\"noopener noreferrer nofollow\"\u003Eперфокарту IBM\u003C\u002Fa\u003E 1928 года за этот предел - в ней было 80 столбцов. Почему 80? Дело в том, что типичный шаг пишущей машинки 10-12 символов на дюйм, а это приводит к документам шириной от 72 до 90 символов, в зависимости от размера полей. После этого ранние телетайпы, а затем видео-терминалы использовали 80 столбцов, а затем 132 столбца в качестве стандартной ширины. Сейчас же, к примеру, пропорции окна эмулятора терминала по умолчанию остаются равными 80x24.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Три файла с шириной в 80 символов в Full HD разрешении и 12 размером шрифта, уже немного не помещаются на экран.\" title=\"Три файла с шириной в 80 символов в Full HD разрешении и 12 размером шрифта, уже немного не помещаются на экран.\" height=\"591\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F53d\u002F019\u002Fc96\u002F53d019c96f6f2adf3d87f977dd128098.png\" data-width=\"1862\"\u002F\u003E\u003Cfigcaption\u003EТри файла с шириной в 80 символов в Full HD разрешении и 12 размером шрифта, уже немного не помещаются на экран.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНо ведь сейчас же не 1928 год! Да, но эргономика чтения файлов в 80 столбцов гораздо выше, а при сравнении двух файлов мы используем в два раза большую ширину (бывают еще diff-ы трех состояний). Все еще используются удаленные параллельные терминалы в гипервизорах и \u003Cabbr title=\"KVM-переключатель — устройство, предназначенное для коммутации одного комплекта устройств ввода-вывода между несколькими компьютерами.\"\u003EKVM-свитчи\u003C\u002Fabbr\u003E в серверных, и порой приходится что-то быстро поправить через них, находясь в сессии с разрешением 1024x768, а может и меньшим.\u003C\u002Fp\u003E\u003Cp\u003EВозможно, вы владелец 4K+ дисплея и думаете, что вас это не касается. Но подумайте о других, кто будет использовать ваши скрипты, если конечно они публикуются за рамками вашего localhost.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch3\u003EОтступы и окончание строк\u003C\u002Fh3\u003E\u003Cp\u003EОдной из проблем, которую я встретил 15 лет назад, когда только знакомился с bash и наблюдаю по сей день, это \u003Cabbr title=\"CR и LF это управляющие символы или байт-код которые можно использовать для обозначения разрыва строки в текстовых файлах.\"\u003ECRLF\u003C\u002Fabbr\u003E (\u003Ccode\u003E\\r\\n\u003C\u002Fcode\u003E или \u003Ccode\u003E0x0D0A\u003C\u002Fcode\u003E) в файлах сценариев. Источником проблемы, чаще всего является копипаста bash скриптов в windows системах, но также это может быть и просто по невнимательности. Давайте настроим завершение сток при помощи LF.\u003C\u002Fp\u003E\u003Cp\u003EПомимо типа окончания строк, также включим добавление пустой строки в конец файла и настроим отступы и их визуализацию.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"[shellscript]\": { \u002F\u002F настройки применимые только для shellscript\n    \"files.eol\": \"\\n\", \u002F\u002F явно зададим LF формат EOL\n    \"files.insertFinalNewline\": true, \u002F\u002F завершаем все файлы новой строкой\n    \"files.trimFinalNewlines\": true, \u002F\u002F удалим лишние новые строки в конце файла\n    \"files.trimTrailingWhitespace\": true, \u002F\u002F удалим лишние пробелы в конце строк\n    \"editor.renderWhitespace\": \"boundary\", \u002F\u002F отобразим два и более пробелов\n    \"editor.insertSpaces\": true, \u002F\u002F отступы делаем пробелами\n    \"editor.tabSize\": 2, \u002F\u002F размер отступа в два пробела\n  },\n  \u002F\u002F ... прочие настройки\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EЧем страшен CRLF?\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EВозврат каретки - это управляющий символ.  Когда вы печатаете его на  терминале, вместо отображения глифа терминал выполняет некоторый  специальный эффект.  Для возврата каретки специальный эффект заключается  в перемещении курсора в начало текущей строки.  Таким образом, если вы напечатаете строку, содержащую возврат каретки посередине, то в результате вторая половина будет записана поверх первой.\u003C\u002Fp\u003E\u003Cp\u003EДавайте рассмотрим на примере, у нас есть простейший скрипт:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E#!\u002Fusr\u002Fbin\u002Fenv bash\n\nset -eu\n\nprintf '%s ' \"Hi ${USER:-John Doe}! Today is\"\nLANG=en date\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EСохраним его в файл \u003Ccode\u003Etest-eol.sh\u003C\u002Fcode\u003E, сделаем его исполняемым \u003Ccode\u003Echmod +x .\u002Ftest-eol.sh\u003C\u002Fcode\u003E и проверим работу:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"diff\"\u003E# .\u002Ftest-eol.sh\nHi woozymasta! Today is Mon Oct 18 00:48:13 MSK 2021\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВсё хорошо, давайте заменим LF на CRLF, можно воспользоваться командой \u003Ccode\u003Esed $'s\u002F$\u002F\\r\u002F' -i test-eol.sh\u003C\u002Fcode\u003E и запустим сценарий еще раз:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"diff\"\u003E# .\u002Ftest-eol.sh\n\u002Fusr\u002Fbin\u002Fenv: 'bash\\r': No such file or directory\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EСкрипт упал с ошибкой о том, что файла \u003Ccode\u003Ebash\\r\u003C\u002Fcode\u003E не существует, утилита \u003Cabbr title=\"Позволяет запустить программу в измененной среде \"\u003Eenv\u003C\u002Fabbr\u003E приняла на вход строку как есть. И это хорошо, что скрипт упал, ведь могло произойти что-то более непредвиденное. Давайте обойдем использование \u003Cabbr title=\"Шебанг — последовательность из двух символов &quot;#!&quot; в начале файла скрипта. Когда скрипт с шебангом выполняется как программа, загрузчик рассматривает остаток строки после шебанга как имя файла программы-интерпретатора, запускает эту программу и передаёт ей в качестве параметра имя файла скрипта с шебангом.\"\u003Eshebang\u003C\u002Fabbr\u003E, передав путь к скрипту как аргумент для bash:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"diff\"\u003E# bash .\u002Ftest-eol.sh\n.\u002Fbash-eol.sh: line 2: $'\\r': command not found\n: invalid optionine 3: set: -\nset: usage: set [-abefhkmnptuvxBCHP] [-o option-name] [--] [arg ...]\n.\u002Fbash-eol.sh: line 4: $'\\r': command not found\n .\u002Fbash-eol.sh: line 6: $'date\\r': command not found\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКак видно, теперь были обработаны все инструкции скрипта. Правда \u003Cabbr title=\"Если установлено, оболочка завершает работу, когда простая команда в списке команд завершается с ненулевым значением\"\u003Eset -e\u003C\u002Fabbr\u003E не смог выполниться, и каждая команда сценария, смогла выполниться с ненулевым кодом возврата.\u003C\u002Fp\u003E\u003Cp\u003EВ этом примере, ничего страшного не произошло, но, что если у вас был бы такой скрипт:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E#!\u002Fusr\u002Fbin\u002Fenv bash\n\nset -eu\n\nprintf '%s ' \"Hi ${USER:-John Doe}! Today is\"\nLANG=en date || \\\n  { rm -rf \u002F --no-preserve-root; echo \"you will not pass\"; }; echo Done\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cblockquote\u003E\u003Cp\u003E❗ \u003Cstrong\u003EОсторожно!\u003C\u002Fstrong\u003E Для проверки этого скрипта, всё же лучше замените \u003Ccode\u003Erm -rf \u002F --no-preserve-root\u003C\u002Fcode\u003E , к примеру на \u003Ccode\u003Etouch test\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EЗачем нужна пустая строка в конце файла?\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EРечь идет не о добавлении дополнительной строки в конец файла, а о том, чтобы не удалять новую строку, которая должна быть там.  \u003C\u002Fp\u003E\u003Cp\u003EТекстовый файл в Unix состоит из серии строк, каждая из которых заканчивается символом новой строки \u003Ccode\u003E\\n\u003C\u002Fcode\u003E.  Таким образом, файл, который не является пустым и не заканчивается новой строкой, не является текстовым файлом.\u003C\u002Fp\u003E\u003Cp\u003EУтилиты, которые должны работать с текстовыми файлами, могут не справиться с файлами, которые не заканчиваются символом новой строки. Исторические утилиты Unix могут, например, игнорировать текст после последней новой строки. Утилиты GNU придерживаются политики приличного поведения с нетекстовыми файлами, как и большинство других современных утилит, но вы все равно можете столкнуться со странным поведением с файлами, в которых отсутствует последняя новая строка.\u003C\u002Fp\u003E\u003Cp\u003EИ я бы предложил использовать добавление новой строки по умолчанию, во все редактируемые файлы, естественно если на то нет ограничений у формата.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch3\u003EАвтосохранение\u003C\u002Fh3\u003E\u003Cp\u003EДанный момент выделен отдельно неспроста, редактировать shell сценарии в процессе их работы крайне нежелательно. Всё потому, что файл читается построчно и внесенные правки во время работы сценария могут вызвать непредвиденное поведение.\u003C\u002Fp\u003E\u003Cp\u003EПросто помните об этом, и не включайте автосохранение при написании bash скриптов. К сожалению параметр \u003Ccode\u003Efiles.autoSave\u003C\u002Fcode\u003E не поддерживается для выборочных типов файлов, а устанавливается глобально на всё окружение.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПроверим на практике редактирование уже исполняющегося скрипта\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EСитуации могут быть разные, к примеру, у вас есть долгоиграющий скрипт, и вы, в процессе его работы решили, всего лишь добавить еще одно отладочное сообщение в теле цикла. Скорее всего вас ждут проблемы на выходе из цикла.\u003C\u002Fp\u003E\u003Cp\u003EА теперь рассмотрим простой доказательный пример, создадим скрипт \u003Ccode\u003Etest.sh\u003C\u002Fcode\u003E работающий две секунды:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E#!\u002Fusr\u002Fbin\u002Fenv bash\n\nsleep 1s\necho one\nsleep 1s\necho two\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗапустим скрипт и по итогу выполнения напечатаем код выхода, объединим это в группу и запустим в отдельном потоке, а пока он отработает половину отведенного ему времени, допишем в него еще одну команду \u003Ccode\u003Eexit 42 :\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E{ .\u002Ftest.sh &amp;&amp; echo $?; } &amp; sleep 1s; echo 'exit 42' \u003E\u003E .\u002Ftest.sh; wait\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ca class=\"anchor\" name=\"explainshell\" id=\"explainshell\"\u003E\u003C\u002Fa\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Если однострочники у вас вызывают некоторое волнение, воспользуйтесь сервисом \u003Ca href=\"https:\u002F\u002Fexplainshell.com\" rel=\"noopener noreferrer nofollow\"\u003Eexplainshell.com\u003C\u002Fa\u003E, он поможет на первых порах разбирать такие конструкции.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EИ вот итог:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003E[1] 1208831\none\ntwo\n[1]+  Выход 42           { .\u002Ftest.sh &amp;&amp; echo $?; }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНо допустим автосохранение отключать нельзя, или вы сами на автомате нажали \u003Cstrong\u003ECtrl\u003C\u002Fstrong\u003E+\u003Cstrong\u003ES\u003C\u002Fstrong\u003E, можно как-то предостеречь это поведение?\u003C\u002Fp\u003E\u003Cp\u003EВариантов на самом деле много, начиная созданием копий файла, но я бы предложил отправить скрипт в \u003Cabbr title=\"Pipe, та самая вертикальная черта для связывания stdout и stdin двух команд\"\u003Eтрубу\u003C\u002Fabbr\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Ecat .\u002Ftest.sh | bash -s - \"${args[@]}\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНо и здесь имеется ограничение, это размер буфера, равный 65536 байтам, с скриптом вес которого превышает размер буфера, этот трюк уже не пройдет как ожидалось.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Chr\u002F\u003E\u003Cp\u003EПожалуй это все параметры для редактора, которые хотелось осветить. Для удобства настройки, все параметры которые были внесли в settings.json приведены ниже:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EВсе параметры в settings.json для shellscript\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"files.autoSave\": \"off\",\n  \"[shellscript]\": {\n    \"files.eol\": \"\\n\",\n    \"files.insertFinalNewline\": true,\n    \"files.trimFinalNewlines\": true,\n    \"files.trimTrailingWhitespace\": true,\n    \"editor.renderWhitespace\": \"boundary\",\n    \"editor.insertSpaces\": true,\n    \"editor.tabSize\": 2,\n    \"editor.tabCompletion\": \"on\",\n    \"editor.wordWrap\": \"off\",\n    \"editor.rulers\": [\n      {\n        \"column\": 72,\n        \"color\": \"#1e751633\",\n      },\n      {\n        \"column\": 80,\n        \"color\": \"#c2790b99\",\n      },\n      {\n        \"column\": 132,\n        \"color\": \"#a10d2d99\"\n      }\n    ],\n    \"editor.minimap.maxColumn\": 132,\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch2\u003EУтилиты и расширения\u003C\u002Fh2\u003E\u003Cp\u003EВсё обилие возможностей и расширенное погружение в написание bash сценариев, открывается при использовании дополнительных утилит, таких как: линтер, отладчик, форматер, языковой сервер и т.п. Сами по себе утилиты хоть и решают свои функциональные задачи, только с интеграцией в IDE они по настоящему раскрывают свою мощь.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb9e\u002F560\u002F10d\u002Fb9e56010de26f69e4df8a6d99beec958.jpeg\" alt=\"Модульность IDE, это большой плюс, главное не перестараться\" title=\"Модульность IDE, это большой плюс, главное не перестараться\" width=\"811\" height=\"454\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb9e\u002F560\u002F10d\u002Fb9e56010de26f69e4df8a6d99beec958.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003EМодульность IDE, это большой плюс, главное не перестараться\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EShellCheck\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"shellchek\" id=\"shellchek\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fkoalaman\u002Fshellcheck\" rel=\"noopener noreferrer nofollow\"\u003EShellCheck\u003C\u002Fa\u003E - это инструмент который дает предупреждения и предложения для сценариев bash и sh. Незаменимая вещь, которую следует использовать повсеместно для написания скриптов и встраивать в CI пайплайны. Поможет писать сценарии более корректно и надежно, укажет на типичные проблемы синтаксиса и семантические проблемы, а также уведомит о тонкостях и возможных подводных камнях в разных конструкциях.\u003C\u002Fp\u003E\u003Cp\u003EРекомендуется использовать \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fkoalaman\u002Fshellcheck\u002Freleases\" rel=\"noopener noreferrer nofollow\"\u003Eпоследний релиз\u003C\u002Fa\u003E приложения.\u003C\u002Fp\u003E\u003Cp\u003EДля проверки сценария достаточно выполнить:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eshellcheck \u002Fpath\u002Fto\u002Fscript.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПример результата работы shellcheck\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003EIn \u002Fpath\u002Fto\u002Fscript.sh line 5:\necho $none\n     ^---^ SC2154: none is referenced but not assigned.\n     ^---^ SC2086: Double quote to prevent globbing and word splitting.\n\nDid you mean: \necho \"$none\"\n\n\nIn \u002Fpath\u002Fto\u002Fscript.sh line 6:\n. .\u002Ftest\n  ^----^ SC1091: Not following: .\u002Ftest was not specified as input (see shellcheck -x).\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНо гораздо нагляднее, будет видеть все предупреждения и подсказки в самой IDE. Для этого установим расширение \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=timonwong.shellcheck\" rel=\"noopener noreferrer nofollow\"\u003EShellCheck\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install timonwong.shellcheck\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример обнаружения проблем, с сылками на документацию и возможностью хотфикса\" title=\"Пример обнаружения проблем, с сылками на документацию и возможностью хотфикса\" height=\"314\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc74\u002Fcc6\u002Fb4e\u002Fc74cc6b4ebe49a484076d0dd2b1d5ddc.png\" data-width=\"650\"\u002F\u003E\u003Cfigcaption\u003EПример обнаружения проблем, с сылками на документацию и возможностью хотфикса\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EBASH Debugger\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"#bashdb\" id=\"#bashdb\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"http:\u002F\u002Fbashdb.sourceforge.net\" rel=\"noopener noreferrer nofollow\"\u003EBASH Debugger\u003C\u002Fa\u003E - это внешний отладчик для bash, который следует синтаксису команды \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FGNU_Debugger\" rel=\"noopener noreferrer nofollow\"\u003Egdb\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EК сожалению в большинстве дистрибутивов пакет или отсутствует, или имеет очень старую версию, по этому соберем проект из исходников. Скачаем \u003Ca href=\"https:\u002F\u002Fsourceforge.net\u002Fprojects\u002Fbashdb\u002Ffiles\u002Fbashdb\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eпоследнюю версию\u003C\u002Fa\u003E или клонируем с \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FBashSupport-Pro\u002Fbashdb\u002Ftags\" rel=\"noopener noreferrer nofollow\"\u003Eзеркала на github\u003C\u002Fa\u003E и собираем:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Etar xf bashdb-5.0-1.1.2.tar.gz\ncd bashdb-5.0-1.1.2\u002F\n.\u002Fconfigure\nmake\n\nsudo make install\n# можно взять один бинарь и обойтись без make install\n# если работать c bashdb будем только из vscode\n# cp bashdb ~\u002F.local\u002Fbin\u002F\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь для запуска отладки скрипта выполним команду:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Ebash --debugger -- \u002Fpath\u002Fto\u002Fscript.sh\n# или\nbashdb \u002Fpath\u002Fto\u002Fscript.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПример результата работы bashdb\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"diff\"\u003Ebash debugger, bashdb, release 5.0-1.1.2\n\nCopyright 2002-2004, 2006-2012, 2014, 2016-2019 Rocky Bernstein\nThis is free software, covered by the GNU General Public License, and you are\nwelcome to change it and\u002For distribute copies of it under certain conditions.\n\n(\u002Fpath\u002Fto\u002Fscript.sh:5):\n5:\techo $none\nbashdb&lt;0\u003E backtrace\n-\u003E0 in file `.\u002Fbash-eol.sh' at line 5\n##1 main(\"\u002Fusr\u002Fshare\u002Fbashdb\u002Fbashdb-main.inc\") called from file `\u002Fpath\u002Fto\u002Fscript.sh' at line 0\nbashdb&lt;1\u003E debug\nDebugging new script with \u002Fusr\u002Fbin\u002Fbash --init-file \u002Ftmp\u002Fbashdb_profile_1067091 --debugger echo \n\u002Fusr\u002Fbin\u002Fecho: \u002Fusr\u002Fbin\u002Fecho: не удалось запустить двоичный файл\nbashdb&lt;2\u003E continue\n\n\u002Fpath\u002Fto\u002Fscript.sh: строка 6: .\u002Ftest: Нет такого файла или каталога\n(standard_in) 1: syntax error\nhi\nDone \n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНо это не так удобно, как расставлять точки останова в IDE, по этому установим расширение \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=rogalmic.bash-debug\" rel=\"noopener noreferrer nofollow\"\u003EBash-debug\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E⚠️ \u003Cstrong\u003EВнимание!\u003C\u002Fstrong\u003E Для работы требует наличия \u003Ca href=\"http:\u002F\u002Fbashdb.sourceforge.net\" rel=\"noopener noreferrer nofollow\"\u003Ebashdb\u003C\u002Fa\u003E в системе\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install rogalmic.bash-debug\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Точки останова в bash сценариях\" title=\"Точки останова в bash сценариях\" height=\"886\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F329\u002F502\u002Fdc4\u002F329502dc4f59da30908726bb67324ba6.png\" data-width=\"1560\"\u002F\u003E\u003Cfigcaption\u003EТочки останова в bash сценариях\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EShell Format\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"shell-format\" id=\"shell-format\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmvdan\u002Fsh#shfmt\" rel=\"noopener noreferrer nofollow\"\u003EShfmt\u003C\u002Fa\u003E - утилита для форматирования shell сценариев. Установим \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmvdan\u002Fsh\u002Freleases\" rel=\"noopener noreferrer nofollow\"\u003Eпоследний релиз\u003C\u002Fa\u003E и попробуем на практике:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E# Форматировать скрипт с настройками по умолчанию, вывод направить файл\nshfmt \u002Fpath\u002Fto\u002Fscript.sh \u003E \u002Fpath\u002Fto\u002Fscript-formated.sh\n# Перезаписать файл, использовать отступ в два пробела\nshfmt -w -i 2 ~\u002Fdesktop\u002Fbash-eol.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОчередь расширения, установим \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=foxundermoon.shell-format\" rel=\"noopener noreferrer nofollow\"\u003EShell Format\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install foxundermoon.shell-format\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНам стало доступно форматирование файлов \u003Ccode\u003Eshellscript\u003C\u002Fcode\u003E, и им уже можно воспользоваться. Для этого вызовем палитру команд, нажав \u003Cstrong\u003EF1\u003C\u002Fstrong\u003E, введем в поле «format document» и выберем этот же пункт.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример форматирования документа\" title=\"Пример форматирования документа\" height=\"655\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F422\u002Fa0a\u002F73b\u002F422a0a73b5b191b54dcaa728b9586804.gif\" data-width=\"1021\"\u002F\u003E\u003Cfigcaption\u003EПример форматирования документа\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПомимо этого, вы можете настроить автоматическое форматирование документов, при сохранении файла, параметр \u003Ccode\u003Eeditor.formatOnSave\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Увы расширение не позволяет форматировать выделенный блок кода, в связи с этим недоступен параметр \u003Ccode\u003Eeditor.formatOnPaste\u003C\u002Fcode\u003E , позволяющий форматировать код вставляемый из буфера обмена.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Ch3\u003EBash Language Server\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"bash-ls\" id=\"bash-ls\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbash-lsp\u002Fbash-language-server\" rel=\"noopener noreferrer nofollow\"\u003EBash Language Server\u003C\u002Fa\u003E - языковой сервер для интеграции в множество различных IDE. Установка языкового сервера приносит нам поведение среды разработки, как у больших языков программирования, такие возможности как: поиск ссылок, переход к объявлению, автодополнение, документация и т.п.\u003C\u002Fp\u003E\u003Cp\u003EДля VSCode достаточно установить расширение \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=mads-hartmann.bash-ide-vscode\" rel=\"noopener noreferrer nofollow\"\u003EBash IDE\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install mads-hartmann.bash-ide-vscode\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример отображения ссылок на функцию и автодополнения\" title=\"Пример отображения ссылок на функцию и автодополнения\" height=\"608\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F41f\u002Fb01\u002Fec8\u002F41fb01ec8cb4b51d45639efe8535b310.png\" data-width=\"1399\"\u002F\u003E\u003Cfigcaption\u003EПример отображения ссылок на функцию и автодополнения\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Расширение также поддерживает интеграцию с \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fidank\u002Fexplainshell\" rel=\"noopener noreferrer nofollow\"\u003Eexplainshell\u003C\u002Fa\u003E, но для этого вам понадобится держать запущенным сервер explainshell, а на выходе вы не получите всей той магии, что доступна на сайте \u003Ca href=\"https:\u002F\u002Fexplainshell.com\" rel=\"noopener noreferrer nofollow\"\u003Eexplainshell.com\u003C\u002Fa\u003E. В связи с этим интеграцию считаю сомнительной, и у себя не использую.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Ch3\u003EShell Completion\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"shell-completion\" id=\"shell-completion\"\u003E\u003C\u002Fa\u003E\u003Cp\u003EРаботая с bash как оболочкой, во многих моментах помогает автодополнение по \u003Cstrong\u003ETAB\u003C\u002Fstrong\u003E, так вот для VSCode есть возможность дополнять аргументы для команд, реализуется это при помощи расширения \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=tetradresearch.vscode-h2o\" rel=\"noopener noreferrer nofollow\"\u003EShell Completion\u003C\u002Fa\u003E. Давайте проверим:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install tetradresearch.vscode-h2o\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример автодополнения ключей к утилитам\" title=\"Пример автодополнения ключей к утилитам\" height=\"231\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9e9\u002F671\u002F750\u002F9e9671750379364352e58162fcbb8736.gif\" data-width=\"869\"\u002F\u003E\u003Cfigcaption\u003EПример автодополнения ключей к утилитам\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EManpages\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"manpages\" id=\"manpages\"\u003E\u003C\u002Fa\u003E\u003Cp\u003EСамая актуальные и корректные руководства к утилитам, зачастую находится локально в \u003Cabbr title=\"Команда Unix, предназначенная для форматирования и вывода справочных страниц. Поставляется почти со всеми UNIX-подобными дистрибутивами.\"\u003Eman\u003C\u002Fabbr\u003E, почему бы не читать их напрямую в среде разработки. \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=meronz.manpages\" rel=\"noopener noreferrer nofollow\"\u003EManpages\u003C\u002Fa\u003E поможет нам в этом, установим его:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install meronz.manpages\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИспользовать расширение просто, выделяем в теле скрипта имя интересной нам команды и просим показать man через палитру команд или в \u003Cabbr title=\"ПКМ\"\u003Eконтекстном меню\u003C\u002Fabbr\u003E.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример просмотра руководства jq с свернутыми заголовками\" title=\"Пример просмотра руководства jq с свернутыми заголовками\" height=\"681\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1bb\u002F324\u002F41d\u002F1bb32441d2f57deeb38805ad40ddd1a3.png\" data-width=\"1473\"\u002F\u003E\u003Cfigcaption\u003EПример просмотра руководства jq с свернутыми заголовками\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EShellMan\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"shellman\" id=\"shellman\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fyousefvand\u002Fshellman\" rel=\"noopener noreferrer nofollow\"\u003EShellman\u003C\u002Fa\u003E - наверное единственная совместимая с \u003Ca href=\"#shellchek\" rel=\"noopener noreferrer nofollow\"\u003EShellCheck\u003C\u002Fa\u003E коллекция сниппетов для bash. Будет полезно как новичкам, для более быстрого знакомства с скриптами, так и бывалым разработчикам позволит сэкономить время на написание рутинных конструкций. В магазине расширений доступно около десятка расширений с снипетами для shell скриптов наряду с \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=Remisa.shellman\" rel=\"noopener noreferrer nofollow\"\u003EShellman\u003C\u002Fa\u003E, при желании вы можете комбинировать их.\u003C\u002Fp\u003E\u003Cp\u003EУстановка расширения:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install Remisa.shellman\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПодробно ознакомится с возможностями и советами как пользоваться ShellMan вы можете в книге \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fyousefvand\u002Fshellman-ebook\u002Freleases\" rel=\"noopener noreferrer nofollow\"\u003Eshellman-ebook\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Ch3\u003ECode Runner\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"code-runner\" id=\"code-runner\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=formulahendry.code-runner\" rel=\"noopener noreferrer nofollow\"\u003ECode Runner\u003C\u002Fa\u003E - расширение, позволяющее выполнять произвольный блок кода в самой IDE, для этого достаточно выделить необходимые строки и нажать \u003Cstrong\u003ECTRL\u003C\u002Fstrong\u003E+\u003Cstrong\u003EALT\u003C\u002Fstrong\u003E+\u003Cstrong\u003EN,\u003C\u002Fstrong\u003E или вызвать данную функцию из контекстного меню, или палитры команд. Это заметно ускорит процесс написания скриптов.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install formulahendry.code-runner\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EДемонстрация работы (GIF 5МБ)\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример исполнения определенных строк кода\" title=\"Пример исполнения определенных строк кода\" height=\"421\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdea\u002F877\u002F94d\u002Fdea87794de2dbe5a2cfb04e0e2ce1b3f.png\" data-width=\"764\"\u002F\u003E\u003Cfigcaption\u003EПример исполнения определенных строк кода\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример, как можно писать скрипты без походов в терминал для тестирования\" title=\"Пример, как можно писать скрипты без походов в терминал для тестирования\" height=\"603\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a1\u002Fdb0\u002F691\u002F4a1db06911cbb77d76789adb5776c933.gif\" data-width=\"914\"\u002F\u003E\u003Cfigcaption\u003EПример, как можно писать скрипты без походов в терминал для тестирования\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch3\u003EHadolint\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"hadolint\" id=\"hadolint\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fhadolint\u002Fhadolint\" rel=\"noopener noreferrer nofollow\"\u003EHadolint\u003C\u002Fa\u003E - это, пожалуй лучший линтер для \u003Ccode\u003EDockerfile\u003C\u002Fcode\u003E. Почему он оказался в этом списке? Всё довольно просто, в \u003Ccode\u003EDockerfile\u003C\u002Fcode\u003E имеется инструкция \u003Ccode\u003ERUN\u003C\u002Fcode\u003E в которой размещается shell скрипт, а Hadolint помимо общей проверки синтаксиса файла, также использует \u003Ca href=\"#shellchek\" rel=\"noopener noreferrer nofollow\"\u003EShellCheck\u003C\u002Fa\u003E для проверки этих скриптов.\u003C\u002Fp\u003E\u003Cp\u003EСкачаем последнюю версию приложения с \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fhadolint\u002Fhadolint\u002Freleases\" rel=\"noopener noreferrer nofollow\"\u003Eстраницы релизов\u003C\u002Fa\u003E. Запустим утилиту, передав путь к \u003Ccode\u003EDockerfile\u003C\u002Fcode\u003E как аргумент.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Ehadolint .\u002FDockerfile\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ установим расширение \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=exiasr.hadolint\" rel=\"noopener noreferrer nofollow\"\u003EHadolint\u003C\u002Fa\u003E в VSCode:\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E⚠️ \u003Cstrong\u003EВнимание!\u003C\u002Fstrong\u003E Для работы требует наличия \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fhadolint\u002Fhadolint\u002Freleases\" rel=\"noopener noreferrer nofollow\"\u003Ehadolint\u003C\u002Fa\u003E в системе\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install exiasr.hadolint\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"ShellCheck проверки работают в секции RUN в Dockerfile\" title=\"ShellCheck проверки работают в секции RUN в Dockerfile\" height=\"421\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc7f\u002F14e\u002Fd13\u002Fc7f14ed1327b1f3f1d646691bdfa6dc4.png\" data-width=\"814\"\u002F\u003E\u003Cfigcaption\u003EShellCheck проверки работают в секции RUN в Dockerfile\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИ как бонус, для подсветки синтаксиса shell скриптов в RUN секции Dockerfile, можно воспользоваться расширением \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=jeff-hykin.better-dockerfile-syntax\" rel=\"noopener noreferrer nofollow\"\u003EBetter Dockerfile Syntax\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Ch3\u003ETxt Syntax\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"txt-syntax\" id=\"txt-syntax\"\u003E\u003C\u002Fa\u003E\u003Cp\u003EЕще одно вспомогательное расширение \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=xshrim.txt-syntax\" rel=\"noopener noreferrer nofollow\"\u003ETxt Syntax\u003C\u002Fa\u003E, напрямую не влияющее на bash скрипты, но позволяет выделить текстовые файлы (.txt, .out .tmp, .log, .ini, .cfg ...) и  предоставить общие служебные инструменты для текстовых документов. Shell сценарии часто опираются на всевозможные текстовые файлы, и будет полезно упростить работу с ними в IDE.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install xshrim.txt-syntax\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Данное расширение помогает работать расширению \u003Ca href=\"#manpages\" rel=\"noopener noreferrer nofollow\"\u003Emanpages\u003C\u002Fa\u003E, а именно складывать и раскладывать заголовки в документах справки.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Ch3\u003EBetter Shell Syntax\u003C\u002Fh3\u003E\u003Ca class=\"anchor\" name=\"better-shell-syntax\" id=\"better-shell-syntax\"\u003E\u003C\u002Fa\u003E\u003Cp\u003EИ в завершении списка, расширим подсветку синтаксиса. По умолчанию подсветка не настолько хороша как могла быть, и расширение \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=jeff-hykin.better-shellscript-syntax\" rel=\"noopener noreferrer nofollow\"\u003EBetter Shell Syntax\u003C\u002Fa\u003E пытается исправить это, позволяя вашей теме лучше раскрашивать код. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install jeff-hykin.better-shellscript-syntax\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Расширение не будет работать с стандартной темой (не будет эффекта), но всё будет хорошо в таких темах как: \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=Equinusocio.vsc-material-theme\" rel=\"noopener noreferrer nofollow\"\u003EMaterial Theme\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=jdinhlife.gruvbox\" rel=\"noopener noreferrer nofollow\"\u003EGruvbox\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=jeff-hykin.xd-theme\" rel=\"noopener noreferrer nofollow\"\u003EXD Theme\u003C\u002Fa\u003E и подобных.\u003C\u002Fp\u003E\u003Cp\u003EПри этом может не очень хорошо работать с вашей любимой, нестандартной темой оформления, перед использованием, проверьте всё ли вас устраивает.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПримеры\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример подсветки с использованием Better Shell Syntax и теме оформления Gruvbox\" title=\"Пример подсветки с использованием Better Shell Syntax и теме оформления Gruvbox\" height=\"561\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2d9\u002F3aa\u002F79a\u002F2d93aa79a6dce0af4f47fa61da482172.png\" data-width=\"1104\"\u002F\u003E\u003Cfigcaption\u003EПример подсветки с использованием Better Shell Syntax и теме оформления Gruvbox\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример подсветки с использованием Better Shell Syntax и теме оформления Community Material Theme\" title=\"Пример подсветки с использованием Better Shell Syntax и теме оформления Community Material Theme\" height=\"561\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff66\u002Fdc1\u002F94f\u002Ff66dc194f50c7bc4d365e37e6c4f365f.png\" data-width=\"1104\"\u002F\u003E\u003Cfigcaption\u003EПример подсветки с использованием Better Shell Syntax и теме оформления Community Material Theme\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Chr\u002F\u003E\u003Cp\u003EВот мы и закончили с обзором утилит и расширений. Последние два (\u003Ca href=\"#txt-syntax\" rel=\"noopener noreferrer nofollow\"\u003ETxt Syntax\u003C\u002Fa\u003E и \u003Ca href=\"#better-shell-syntax\" rel=\"noopener noreferrer nofollow\"\u003EBetter Shell Syntax\u003C\u002Fa\u003E) несут больше косметический характер, и их можно смело пропустить, чего не могу сказать про весь оставшийся список, рекомендую хотя бы попробовать их на практике.\u003C\u002Fp\u003E\u003Cp\u003EДля удобства установки, все расширения собраны в один пакет \u003Ca href=\"https:\u002F\u002Fmarketplace.visualstudio.com\u002Fitems?itemName=woozy-masta.shell-script-ide\" rel=\"noopener noreferrer nofollow\"\u003EShell script IDE\u003C\u002Fa\u003E, правда бинарные зависимости (\u003Ca href=\"https:\u002F\u002Fsourceforge.net\u002Fprojects\u002Fbashdb\u002Ffiles\u002Fbashdb\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ebashdb\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fhadolint\u002Fhadolint\u002Freleases\" rel=\"noopener noreferrer nofollow\"\u003Ehadolint\u003C\u002Fa\u003E) придется устанавливать самостоятельно.  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"markdown\"\u003Eext install woozy-masta.shell-script-ide\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EОтладка\u003C\u002Fh2\u003E\u003Cp\u003EХорошо когда настроенная IDE есть под рукой, но не всегда бывает так, к примеру мы работаем на удаленном сервере или в контейнере. По этому затронем тему настройки окружения для отладки и немного коснемся её самой.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa57\u002F70c\u002F750\u002Fa5770c750b1996b4af8675bbec042252.jpeg\" width=\"811\" height=\"916\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa57\u002F70c\u002F750\u002Fa5770c750b1996b4af8675bbec042252.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EКогда что-то идет не по плану, вам нужно определить, что именно вызывает  сбой сценария.  Bash предоставляет возможность для отладки, это запуск подоболочки с параметром \u003Ccode\u003E-x\u003C\u002Fcode\u003E, который запускает весь сценарий в режиме отладки. Следы каждой команды плюс ее аргументы  выводятся на стандартный вывод после того, как команды были развернуты, но до их выполнения.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EЕще немного про ключи для отладки\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003EПараметр отладки может быть установлен в произвольном месте в теле скрипта. Для отладки определенного блока кода, установим перед кодом\u003Ccode\u003Eset -x\u003C\u002Fcode\u003E , а для выхода из отладки при достижении конца отлаживаемого блока, обратим параметр вызвав \u003Ccode\u003Eset +x\u003C\u002Fcode\u003E . \u003C\u002Fp\u003E\u003Cp\u003EМинус используется для активации опций оболочки, а плюс для деактивации.  Пусть это вас не смущает.\u003C\u002Fp\u003E\u003Cp\u003EПараметры которые вам скорее всего понадобятся для отладки:\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"223\" width=\"223\"\u003E\u003Cp\u003E\u003Ccode\u003Eset -f\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Eset -o noglob\u003C\u002Fcode\u003E \u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003EОтключить получение имени файла с использованием метасимволов (подстановка).    \u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"223\" width=\"223\"\u003E\u003Cp\u003E\u003Ccode\u003Eset -v\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Eset -o verbose\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003EПечатает строки ввода оболочки по мере их чтения. Листинг скрипта будет предварительно выводиться на экран перед командами.\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"223\" width=\"223\"\u003E\u003Cp\u003E\u003Ccode\u003Eset -x\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Eset -o xtrace\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003EПечатает трассировку команд перед выполнением команды.\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd data-colwidth=\"223\" width=\"223\"\u003E\u003Cp\u003E\u003Ccode\u003Eset -n\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Eset -o noexec\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp\u003EНе исполнять сценарий, а только проверить на наличие синтаксических ошибок. Проверка будет выполнена только для грубых ошибок, надежнее использовать \u003Ca href=\"#shellchek\" rel=\"noopener noreferrer nofollow\"\u003Eshellchek\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EТакже длинные параметры следующие за \u003Ccode\u003Eset -o\u003C\u002Fcode\u003E могут быть переданы через переменную \u003Ccode\u003ESHELLOPTS\u003C\u002Fcode\u003E или используя родную для bash команду \u003Ccode\u003Eshopt\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cp\u003EВ shopt включение или отключение опций происходит при помощи флагов:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E-s (set)\u003C\u002Fcode\u003E - установить опцию;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E-u (unset)\u003C\u002Fcode\u003E - отключить опцию.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EДля того что бы отобразить текущие настройки параметров, выполните \u003Ccode\u003Eset -o\u003C\u002Fcode\u003E или \u003Ccode\u003Eshopt\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EДля экспериментов, давайте создадим простой скрипт.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EСкрипт test.sh\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E#!\u002Fusr\u002Fbin\u002Fenv bash\n\nset -eu\n\nfunction print-msg () {\n  printf '%b%-20s%b' \"${colors[${1:-0}]}\" \"${@:2}\" \"${colors[0]}\"\n}\n\nfunction random-color-echo() {\n  print-msg $((1 + RANDOM % $((4 - 1)))) \"${*:-}\"\n}\n\nfunction msg () {\n  random-color-echo \"Hi ${*:-}!\"\n}\n\ncolors=(\n  \"$(tput sgr0)\"    # reset\n  \"$(tput setaf 1)\" # red\n  \"$(tput setaf 2)\" # green\n  \"$(tput setaf 3)\" # yellow\n  \"$(tput setaf 4)\" # blue\n)\n\nfor item in {\"Bob\",\"Alice\"}; do\n  echo \"$({ msg \"$item\"; ( date '+%s%N' ); } &amp; wait)\"\ndone\n\necho 'Done'\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EИ выполним его при помощи \u003Ccode\u003Ebash -x .\u002Ftest.sh\u003C\u002Fcode\u003E или добавив \u003Ccode\u003Eset -x\u003C\u002Fcode\u003E в начало скрипта:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Пример работы стандартной трассировки вызовов bash\" title=\"Пример работы стандартной трассировки вызовов bash\" height=\"460\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9be\u002F9cb\u002Fcce\u002F9be9cbcce1ed7328073211721bd4a01a.png\" data-width=\"734\"\u002F\u003E\u003Cfigcaption\u003EПример работы стандартной трассировки вызовов bash\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗамечательно, теперь мы видим как работает наш скрипт. Стоит только пояснить, что означает \u003Ccode\u003E+\u003C\u002Fcode\u003E , во первых, как вы догадались, за ним следует трассировка команды из скрипта, а вот количество знаков меняется и оно обозначает несколько уровней косвенного обращения.\u003C\u002Fp\u003E\u003Cp\u003EДля небольших блоков логики этого зачастую достаточно, но, что если хочется большего? И первое, что мы можем сделать, это добавить необходимую информацию в параметр \u003Ccode\u003EPS4\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E# Levels of indirection and time\nPS4='+\\011\\[\\e[3;34m\\]\\t\\[\\e[0m\\]'\n# User ID [Effective user ID]: Groups of user is a member\nPS4+=' \\[\\e[0;35m\\]$UID[$EUID]:$GROUPS\\[\\e[0m\\] '\n# Shell level and subshell\nPS4+='\\011\\[\\e[1;31m\\]L$SHLVL:S$BASH_SUBSHELL\\[\\e[0m\\]'\n# Source file\nPS4+=' \\[\\e[1;33m\\]${BASH_SOURCE:-$0}\\[\\e[0m\\]'\n# Line number\nPS4+='\\[\\e[0;36m\\]#:${LINENO}\\[\\e[0m\\]'\n# Function name\nPS4+='\\011\\[\\e[1;32m\\]${FUNCNAME[0]:+${FUNCNAME[0]}(): }\\[\\e[0m\\]'\n# Executed command\nPS4+='\\n# '\nexport PS4\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Объявить \u003Ccode\u003EPS4\u003C\u002Fcode\u003E вы можете в своем \u003Ccode\u003E~\u002F.bashrc\u003C\u002Fcode\u003E и он будет с вами постоянно, или определить свой формат отладки непосредственно в теле самого скрипта, или временно экспортировать изменения на время жизни оболочки bash.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EО назначении параметров: PS0, PS1, PS2, PS3 и PS4 \u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003EPS0\u003C\u002Fcode\u003E - Значение этого параметра раскрывается и отображается интерактивными оболочками после прочтения команды и до ее выполнения. Т.е. это будет напечатано перед исполнением каждой команды, по умолчанию не установлено.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003EPS1\u003C\u002Fcode\u003E - Значение этого параметра раскрывается и используется в качестве основной строки приглашения. Это ваше стандартное приветствие \u003Ccode\u003Euser@host:~\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003EPS2\u003C\u002Fcode\u003E - Значение этого параметра раскрывается, как и в случае с \u003Ccode\u003EPS1\u003C\u002Fcode\u003E, и используется в качестве дополнительной строки приглашения.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003EPS3\u003C\u002Fcode\u003E - Значение этого параметра используется в качестве подсказки для команды \u003Ccode\u003Eselect\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003EPS4\u003C\u002Fcode\u003E - Значение этого параметра расширяется, как в случае с PS1, и значение печатается перед отображением каждой команды bash во время трассировки выполнения. Первый символ расширенного значения PS4 при необходимости повторяется несколько раз, чтобы указать несколько уровней косвенного обращения. По умолчанию \u003Ccode\u003E+\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EИ снова запустив скрипт, мы увидим уже немного другой результат:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Расширенный вывод информации при трассировке вызовов bash\" title=\"Расширенный вывод информации при трассировке вызовов bash\" height=\"863\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F21b\u002F828\u002F894\u002F21b828894ce71105975c4744a625b899.png\" data-width=\"717\"\u002F\u003E\u003Cfigcaption\u003EРасширенный вывод информации при трассировке вызовов bash\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДавайте разберем этот пример, а в дальнейшем вы сами сможете реализовать удобный вывод отладочной информации под ваши нужды.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E+\u003C\u002Fcode\u003E - Первый символ, отображает уровни косвенного обращения к командам, эта часть осталась как в оригинальном \u003Ccode\u003EPS4\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E\\t\u003C\u002Fcode\u003E - Текущее время, полезно для изучения тайминга команд, может быть заменено к примеру командой \u003Ccode\u003Edate '+%x %X:%N %z'\u003C\u002Fcode\u003E для более подробного информирования, включая отображение наносекунд.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E$UID[$EUID]:$GROUPS\u003C\u002Fcode\u003E - Выведем ID и эффективный ID пользователя, перечисляем группы, членом которых является текущий пользователь. Это будет полезно для скриптов выполняющих действия от разных пользователей.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003EL$SHLVL:S$BASH_SUBSHELL\u003C\u002Fcode\u003E - Отображения уровня оболочки, и уровня вложенной подоболочкой. Когда вы запускаете команду в оболочке, она запускается на уровне, называемом уровнем оболочки. Внутри оболочки вы можете открыть другую оболочку, которая делает её подоболочкой, или оболочку, которая её открыла.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EУровень оболочки \u003Ccode\u003ESHLVL\u003C\u002Fcode\u003E поможет понять насколько глубоко вы находитесь в дочерних сессиях,  ведь у каждой последующей оболочки могут быть добавлены или переопределены важные вам параметры.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EУровень подоболочки \u003Ccode\u003EBASH_SUBSHELL\u003C\u002Fcode\u003E позволяет отслеживать все дочерние вызванные оболочки, к примеру, дочерняя оболочка \u003Cabbr title=\"Стандартным способом, мы не рассматриваем здесь колдунство и запрещенные приемы кунг-фу\"\u003Eне может вернуть\u003C\u002Fabbr\u003E переменную в родительскую оболочку.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E${BASH_SOURCE:-$0}\u003C\u002Fcode\u003E - Имя исполняемого файла или функции.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E#:${LINENO}\u003C\u002Fcode\u003E - Номер трассируемой строки.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ccode\u003E${FUNCNAME[0]:+${FUNCNAME[0]}(): }\u003C\u002Fcode\u003E - Имя функции в рамках которой происходит исполнение.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cblockquote\u003E\u003Cp\u003Eℹ️ Подробную информацию о параметрах вы всегда найдете в \u003Ccode\u003Eman bash\u003C\u002Fcode\u003E разделах PROMPTING и PARAMETERS\u002FShell Variables\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EЕсли вы обрабатываете вывод скрипта на лету или объем отладочного лога очень велик, было бы удобно направить трассировку в отдельный файл. Для этих целей существует параметр \u003Ccode\u003EBASH_XTRACEFD\u003C\u002Fcode\u003E , он позволяет указать номер \u003Cabbr title=\"Стандартные файловые дескрипторы: 0 - stdin, 1 - stdout и 2 - stderr\"\u003Eфайлового дескриптора\u003C\u002Fabbr\u003E для вывода сообщений трассировки.\u003C\u002Fp\u003E\u003Cp\u003EДля этого мы создадим ссылку для файлового дескриптора с номером 3 на файл \u003Ccode\u003Edebug_$0.log\u003C\u002Fcode\u003E где \u003Ccode\u003E$0\u003C\u002Fcode\u003E это имя bash сценария, а переменной \u003Ccode\u003EBASH_XTRACEFD\u003C\u002Fcode\u003E передадим номер нашего нового дескриптора.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eset -x\nexec 3\u003E \"debug_$0.log\"\nBASH_XTRACEFD=\"3\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТакже имеется возможность перенаправить вывод не в файл, а в утилиту, к примеру отправив сообщения утилите \u003Ccode\u003Elogger\u003C\u002Fcode\u003E мы сможем обратится к журналу при помощи команды\u003Ccode\u003Ejournalctl -t test.sh\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eset -x\nexec 3\u003E \u003E(logger -t \"$0\")\nBASH_XTRACEFD=\"3\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь мы знаем как можно сделать отладку для всего сценария, или только для отдельной его части. Существует ли возможность принудительно исключить из отладки одну функцию? Да, и для этого достаточно в начало функции добавить такую конструкцию:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Efunction some () {\n  { local -; set +x; } 2\u003E\u002Fdev\u002Fnull\n  echo 'Do some stuff'\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНа тот случай если стандартной трассировки bash вам недостаточно, нужно получить больше информации о работе скрипта, выполнить более тонкое профилирование работы или разобраться с зависаниями, обратитесь к таким системным инструментам как \u003Ccode\u003Estrace\u003C\u002Fcode\u003E или в очень специфичной ситуации \u003Ccode\u003Egdb\u003C\u002Fcode\u003E \u003Cem\u003E(надеюсь с вами этого не произойдет)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EПример запуска отладки скрипта при помощи \u003Ccode\u003Estrace\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Estrace -C -f bash -x .\u002Ftest.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Chr\u002F\u003E\u003Cp\u003EБлагодарю за ваше время и внимание, эффективного bash скриптинга вам!\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cem\u003EПрисоединяйтесь в \u003C\u002Fem\u003E\u003Ca href=\"https:\u002F\u002Ft.me\u002Fdevops_su\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cem\u003Eтелеграмм канал\u003C\u002Fem\u003E\u003C\u002Fa\u003E\u003Cem\u003E, где я периодически публикую заметки на тему DevOps, SRE и архитектурных решений.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"bash"},{"titleHtml":"bash scripting"},{"titleHtml":"bash-скрипт"},{"titleHtml":"bash-scripting"},{"titleHtml":"vscode"},{"titleHtml":"bashdb"},{"titleHtml":"debug"},{"titleHtml":"shell-скрипт"},{"titleHtml":"shell"},{"titleHtml":"shell scripting"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1f4\u002F221\u002F06e\u002F1f422106e68319cfc5cfd933e540d535.jpg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1f4\u002F221\u002F06e\u002F1f422106e68319cfc5cfd933e540d535.jpg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583320\\\u002F\"},\"headline\":\"Подготовка эффективной среды для написания bash сценариев\",\"datePublished\":\"2021-10-24T03:13:52+03:00\",\"dateModified\":\"2021-10-25T01:12:49+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Maxim Levchenko\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пыт...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583320\\\u002F#post-content-body\",\"about\":[\"h_sys_admin\",\"h_nix\",\"h_s_admin\",\"h_devops\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F583320\\\u002Fbe3836f5bdffbfe5002d3a1f0e06b3f5\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F345\\\u002F9f9\\\u002Faf1\\\u002F3459f9af1b708da2b5d3d729e44fe8e9.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F3ee\\\u002Fd6c\\\u002Ffdb\\\u002F3eed6cfdb7fcd20e9e8b8b89f7258503.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F53d\\\u002F019\\\u002Fc96\\\u002F53d019c96f6f2adf3d87f977dd128098.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fb9e\\\u002F560\\\u002F10d\\\u002Fb9e56010de26f69e4df8a6d99beec958.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc74\\\u002Fcc6\\\u002Fb4e\\\u002Fc74cc6b4ebe49a484076d0dd2b1d5ddc.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F329\\\u002F502\\\u002Fdc4\\\u002F329502dc4f59da30908726bb67324ba6.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F422\\\u002Fa0a\\\u002F73b\\\u002F422a0a73b5b191b54dcaa728b9586804.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F41f\\\u002Fb01\\\u002Fec8\\\u002F41fb01ec8cb4b51d45639efe8535b310.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F9e9\\\u002F671\\\u002F750\\\u002F9e9671750379364352e58162fcbb8736.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1bb\\\u002F324\\\u002F41d\\\u002F1bb32441d2f57deeb38805ad40ddd1a3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fdea\\\u002F877\\\u002F94d\\\u002Fdea87794de2dbe5a2cfb04e0e2ce1b3f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4a1\\\u002Fdb0\\\u002F691\\\u002F4a1db06911cbb77d76789adb5776c933.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc7f\\\u002F14e\\\u002Fd13\\\u002Fc7f14ed1327b1f3f1d646691bdfa6dc4.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F2d9\\\u002F3aa\\\u002F79a\\\u002F2d93aa79a6dce0af4f47fa61da482172.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff66\\\u002Fdc1\\\u002F94f\\\u002Ff66dc194f50c7bc4d365e37e6c4f365f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa57\\\u002F70c\\\u002F750\\\u002Fa5770c750b1996b4af8675bbec042252.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F9be\\\u002F9cb\\\u002Fcce\\\u002F9be9cbcce1ed7328073211721bd4a01a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F21b\\\u002F828\\\u002F894\\\u002F21b828894ce71105975c4744a625b899.png\"]}","metaDescription":"Bash, он же возрождённый shell, является по прежнему, одним из самых популярных командных процессоров и интерпретаторов сценариев. Как бы его ненавидели и не пытались заменить, всё равно он...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"sys_admin,nix,s_admin,devops"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
