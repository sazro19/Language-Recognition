<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Оценка событий JDK Flight Recorder с помощью JfrUnit / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/582632\/"},"headline":"Оценка событий JDK Flight Recorder с помощью JfrUnit","datePublished":"2021-10-12T11:09:45+03:00","dateModified":"2021-10-12T11:34:19+03:00","author":{"@type":"Person","name":"val6852"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&nbsp;представил&nbsp;JfrUnit, новую утилиту тестирования, которую можно использов...","url":"https:\/\/habr.com\/ru\/post\/582632\/#post-content-body","about":["h_java","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/582632\/e091949084fd38a3726ebfad47fa1948\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Оценка событий JDK Flight Recorder с помощью JfrUnit" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Оценка событий JDK Flight Recorder с помощью JfrUnit" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Оценка событий JDK Flight Recorder с помощью JfrUnit" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&amp;nbsp;представил&amp;nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&amp;nbsp;представил&amp;nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&amp;nbsp;представил&amp;nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&amp;nbsp;представил&amp;nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&amp;nbsp;представил&amp;nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/582632/e091949084fd38a3726ebfad47fa1948/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/582632/e091949084fd38a3726ebfad47fa1948/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/582632/e091949084fd38a3726ebfad47fa1948/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/582632/e091949084fd38a3726ebfad47fa1948/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/582632/e091949084fd38a3726ebfad47fa1948/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="582632" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-12T08:09:45.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/582632/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/582632/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/582632/e091949084fd38a3726ebfad47fa1948/" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/582632/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/val6852/" title="val6852" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/val6852/" class="tm-user-info__username">
      val6852
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-12T08:09:45.000Z" title="2021-10-12, 11:09">12  октября   в 11:09</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Оценка событий JDK Flight Recorder с помощью JfrUnit</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/java/" class="tm-article-snippet__hubs-item-link"><span>Java</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://www.infoq.com/news/2021/09/jfrunit-flight-recorder-events/" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Johan Janssen
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p><a href="https://twitter.com/gunnarmorling" rel="noopener noreferrer nofollow"><u>Гуннар Морлинг</u></a>, разработчик программного обеспечения с открытым исходным кодом в Red Hat, <a href="https://www.morling.dev/blog/introducing-jfrunit-1-0-0-alpha1/" rel="noopener noreferrer nofollow"><u>представил</u></a> JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения производительности с <a href="https://junit.org/" rel="noopener noreferrer nofollow"><u>JUnit</u></a> или <a href="https://spockframework.org/" rel="noopener noreferrer nofollow"><u>Spock Framework</u></a>. Интерпретация результатов тестирования производительности, таких как время отклика, может быть затруднена, поскольку могут быть регрессии, вызванные другими факторами, такими как другие процессы или сеть, а не самим приложением. <a href="https://github.com/moditect/jfrunit/blob/main/README.md" rel="noopener noreferrer nofollow"><u>JfrUnit</u></a> может использоваться для тестирования производительности приложения путем измерения распределения памяти, операций ввода-вывода, запросов к базе данных или других элементов, зависящих от приложения.</p><p><a href="https://en.wikipedia.org/wiki/JDK_Flight_Recorder" rel="noopener noreferrer nofollow"><u>JDK Flight Recorder</u></a> (JFR) собирает события из запущенного приложения, которые могут использоваться для диагностики или профилирования приложения. Эти события могут быть практически любыми, от выделения памяти до сборки мусора. </p><p>Инструмент можно использовать непосредственно из командной строки, но он часто используется вместе с <a href="https://en.wikipedia.org/wiki/JDK_Mission_Control" rel="noopener noreferrer nofollow"><u>JDK Mission Control,</u></a> предоставляющим графический интерфейс и различные плагины, которые можно использовать вместе с JFR. JfrUnit позволяет создавать утверждения, проверяющие события JFR из приложения.</p><p>JfrUnit поддерживает <a href="https://openjdk.java.net/projects/jdk/16/" rel="noopener noreferrer nofollow"><u>OpenJDK 16,</u></a> и зависимость доступна в Maven Central:</p><pre><code class="xml">&lt;dependency>
  &lt;groupId>org.moditect.jfrunit&lt;/groupId>
  &lt;artifactId>jfrunit&lt;/artifactId>
  &lt;version>1.0.0.Alpha1&lt;/version>
  &lt;scope>test&lt;/scope>
&lt;/dependency></code></pre><p>Реализация теста JUnit начинается с добавления аннотации <code>@JfrEventTest</code> к классу unit теста, если тест не отмечен аннотацией <code>@QuarkusTest</code>, поскольку среда тестирования Quarkus автоматически взаимодействует с записью JFR. Тесты используют аннотацию <code>@EnableEvent</code> для сбора определенных событий, например, событий сборки мусора. После выполнения логики программы метод <code>jfrEvents.awaitEvents() </code>ожидает любых событий JFR от JVM или приложения, прежде чем утверждения будут использоваться для проверки того, что событие произошло:</p><pre><code class="java">@JfrEventTest
public class GarbageCollectionTest {
    public JfrEvents jfrEvents = new JfrEvents();

    @Test
    @EnableEvent("jdk.GarbageCollection")
    public void testGarbageCollectionEvent() throws Exception {
        System.gc();

        jfrEvents.awaitEvents();

        assertThat(jfrEvents).contains(event("jdk.GarbageCollection"));
    }
}</code></pre><p>В качестве альтернативы можно использовать фреймворк Spock для написания того же теста:</p><pre><code class="java">class GarbageCollectionSpec extends Specification {
JfrEvents jfrEvents &lt;span style="margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(166, 127, 89); background: rgba(255, 255, 255, 0.5);" class="token operator">=&lt;/span> &lt;span style="margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(0, 119, 170);" class="token keyword">new&lt;/span> &lt;span style="margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top;" class="token class-name">JfrEvents&lt;/span>&lt;span style="margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(153, 153, 153);" class="token punctuation">(&lt;/span>&lt;span style="margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(153, 153, 153);" class="token punctuation">)&lt;/span>&lt;font style="margin: 0px; box-sizing: border-box;">&lt;/font>


    @EnableEvent('jdk.GarbageCollection')
    def 'Contains a garbage collection Jfr event'() {
        when:
        System.gc()

        then:
        jfrEvents['jdk.GarbageCollection']
    }
}</code></pre><p>Помимо проверки того, произошло ли событие, также можно проверить детали события, такие как продолжительность выполнения метода <code>Thread.sleep()</code>:</p><pre><code class="java">@Test
@EnableEvent("jdk.ThreadSleep")
public void testThreadSleepEvent() throws Exception {
    Thread.sleep(42);

    jfrEvents.awaitEvents();

    assertThat(jfrEvents)
            .contains(event("jdk.ThreadSleep")
            .with("time", Duration.ofMillis(42)));
}</code></pre><p>JfrUnit позволяет создавать и более сложные сценарии. Рассмотрим следующий пример, который собирает события выделения памяти и суммирует их данные, прежде чем утверждать, что выделение памяти находится между определенными значениями:</p><pre><code class="java">@Test
@EnableEvent("jdk.ObjectAllocationInNewTLAB")
@EnableEvent("jdk.ObjectAllocationOutsideTLAB")
public void testAllocationEvent() throws Exception {
    String threadName = Thread.currentThread().getName();

    // Application logic which creates objects

    jfrEvents.awaitEvents();
    long sum = jfrEvents.filter(this::isObjectAllocationEvent)
            .filter(event -> event.getThread().getJavaName().equals(threadName))
            .mapToLong(this::getAllocationSize)
            .sum();

    assertThat(sum).isLessThan(43_000_000);
    assertThat(sum).isGreaterThan(42_000_000);
}

private boolean isObjectAllocationEvent(RecordedEvent re) {
    String name = re.getEventType().getName();
    return name.equals("jdk.ObjectAllocationInNewTLAB") ||
            name.equals("jdk.ObjectAllocationOutsideTLAB");
}

private long getAllocationSize(RecordedEvent recordedEvent) {
    return recordedEvent.getEventType().getName()
            .equals("jdk.ObjectAllocationInNewTLAB") ?
            recordedEvent.getLong("tlabSize") :
            recordedEvent.getLong("allocationSize");
}</code></pre><p>Включение нескольких событий также возможно с помощью символа подстановки «<em>», например, </em><code>@EnableEvent("jdk.ObjectAllocation") </code>может использоваться для активации всех событий ObjectAllocation.</p><p>Чтобы сбросить собранные события, можно использовать метод <code>jfrEvents.reset()</code>, чтобы гарантировать, что собираются только события после выполнения метода <code>reset()</code>. Например, при запуске нескольких итераций и утверждении результатов на каждой итерации:</p><pre><code class="java">for (int i = 0; i &lt; ITERATIONS; i++) {
    // Application logic

    jfrEvents.awaitEvents();


    // Assertions

    jfrEvents.reset();
}</code></pre><p>Такие фреймворки, как Hibernate, сами по себе не генерируют события, но в этих случаях <a href="https://developers.redhat.com/blog/2020/10/29/collect-jdk-flight-recorder-events-at-runtime-with-jmc-agent#overview_of_the_jdk_flight_recorder_toolchain" rel="noopener noreferrer nofollow"><u>агент JMC</u></a> может использоваться для создания событий. С помощью агента JMC могут быть сгенерированы события SQL-запроса, которые затем могут быть использованы для оценки (количества) SQL-запросов, поступающих в базу данных. Это продемонстрировано на сессии DevNation Tech Talk <a href="https://developers.redhat.com/devnation/tech-talks/jfrunit" rel="noopener noreferrer nofollow"><u>Continuous performance regression testing with JfrUnit,</u></a> а пример доступен на GitHub: <a href="https://github.com/moditect/jfrunit-examples" rel="noopener noreferrer nofollow"><u>Examples for JfrUnit</u></a>.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjdk%5D" class="tm-tags-list__link">jdk</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bflight%20recorder%5D" class="tm-tags-list__link">flight recorder</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bassertion%5D" class="tm-tags-list__link">assertion</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bperformance%20optimization%5D" class="tm-tags-list__link">performance optimization</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/java/" class="tm-hubs-list__link">
    Java
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 1: ↑1 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 1: ↑1 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+1</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">686</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    14
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/val6852/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 102 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    58
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">30</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/val6852/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @val6852
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/582632/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/582632/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/582632/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"582632":{"id":"582632","timePublished":"2021-10-12T08:09:45+00:00","isCorporative":false,"lang":"ru","titleHtml":"Оценка событий JDK Flight Recorder с помощью JfrUnit","leadData":{"textHtml":"\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Fgunnarmorling\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EГуннар Морлинг\u003C\u002Fu\u003E\u003C\u002Fa\u003E, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&nbsp;\u003Ca href=\"https:\u002F\u002Fwww.morling.dev\u002Fblog\u002Fintroducing-jfrunit-1-0-0-alpha1\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003Eпредставил\u003C\u002Fu\u003E\u003C\u002Fa\u003E&nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения производительности с \u003Ca href=\"https:\u002F\u002Fjunit.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJUnit\u003C\u002Fu\u003E\u003C\u002Fa\u003E&nbsp;или&nbsp;\u003Ca href=\"https:\u002F\u002Fspockframework.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003ESpock Framework\u003C\u002Fu\u003E\u003C\u002Fa\u003E.&nbsp;Интерпретация результатов тестирования производительности, таких как время отклика, может быть затруднена, поскольку могут быть регрессии, вызванные другими факторами, такими как другие процессы или сеть, а не самим приложением.&nbsp;\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmoditect\u002Fjfrunit\u002Fblob\u002Fmain\u002FREADME.md\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJfrUnit\u003C\u002Fu\u003E\u003C\u002Fa\u003E&nbsp;может использоваться для тестирования производительности приложения путем измерения распределения памяти, операций ввода-вывода, запросов к базе данных или других элементов, зависящих от приложения.\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FJDK_Flight_Recorder\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJDK Flight Recorder\u003C\u002Fu\u003E\u003C\u002Fa\u003E&nbsp;(JFR) собирает события из запущенного приложения, которые могут использоваться для диагностики или профилирования приложения.&nbsp;Эти события могут быть практически любыми, от выделения памяти до сборки мусора.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003EИнструмент можно использовать непосредственно из командной строки, но он часто используется вместе с&nbsp;\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FJDK_Mission_Control\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJDK Mission Control,\u003C\u002Fu\u003E\u003C\u002Fa\u003E&nbsp;предоставляющим графический интерфейс и различные плагины, которые можно использовать вместе с JFR.&nbsp;JfrUnit позволяет создавать утверждения, проверяющие события JFR из приложения.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Johan Janssen","originalUrl":"https:\u002F\u002Fwww.infoq.com\u002Fnews\u002F2021\u002F09\u002Fjfrunit-flight-recorder-events\u002F"}},{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":58,"votesCount":102},"rating":30,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2187018","alias":"val6852","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":0,"favoritesCount":14,"readingCount":686,"score":1,"votesCount":1},"hubs":[{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Fgunnarmorling\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EГуннар Морлинг\u003C\u002Fu\u003E\u003C\u002Fa\u003E, разработчик программного обеспечения с открытым исходным кодом в Red Hat, \u003Ca href=\"https:\u002F\u002Fwww.morling.dev\u002Fblog\u002Fintroducing-jfrunit-1-0-0-alpha1\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003Eпредставил\u003C\u002Fu\u003E\u003C\u002Fa\u003E JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения производительности с \u003Ca href=\"https:\u002F\u002Fjunit.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJUnit\u003C\u002Fu\u003E\u003C\u002Fa\u003E или \u003Ca href=\"https:\u002F\u002Fspockframework.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003ESpock Framework\u003C\u002Fu\u003E\u003C\u002Fa\u003E. Интерпретация результатов тестирования производительности, таких как время отклика, может быть затруднена, поскольку могут быть регрессии, вызванные другими факторами, такими как другие процессы или сеть, а не самим приложением. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmoditect\u002Fjfrunit\u002Fblob\u002Fmain\u002FREADME.md\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJfrUnit\u003C\u002Fu\u003E\u003C\u002Fa\u003E может использоваться для тестирования производительности приложения путем измерения распределения памяти, операций ввода-вывода, запросов к базе данных или других элементов, зависящих от приложения.\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FJDK_Flight_Recorder\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJDK Flight Recorder\u003C\u002Fu\u003E\u003C\u002Fa\u003E (JFR) собирает события из запущенного приложения, которые могут использоваться для диагностики или профилирования приложения. Эти события могут быть практически любыми, от выделения памяти до сборки мусора. \u003C\u002Fp\u003E\u003Cp\u003EИнструмент можно использовать непосредственно из командной строки, но он часто используется вместе с \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FJDK_Mission_Control\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EJDK Mission Control,\u003C\u002Fu\u003E\u003C\u002Fa\u003E предоставляющим графический интерфейс и различные плагины, которые можно использовать вместе с JFR. JfrUnit позволяет создавать утверждения, проверяющие события JFR из приложения.\u003C\u002Fp\u003E\u003Cp\u003EJfrUnit поддерживает \u003Ca href=\"https:\u002F\u002Fopenjdk.java.net\u002Fprojects\u002Fjdk\u002F16\u002F\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EOpenJDK 16,\u003C\u002Fu\u003E\u003C\u002Fa\u003E и зависимость доступна в Maven Central:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;dependency\u003E\n  &lt;groupId\u003Eorg.moditect.jfrunit&lt;\u002FgroupId\u003E\n  &lt;artifactId\u003Ejfrunit&lt;\u002FartifactId\u003E\n  &lt;version\u003E1.0.0.Alpha1&lt;\u002Fversion\u003E\n  &lt;scope\u003Etest&lt;\u002Fscope\u003E\n&lt;\u002Fdependency\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EРеализация теста JUnit начинается с добавления аннотации \u003Ccode\u003E@JfrEventTest\u003C\u002Fcode\u003E к классу unit теста, если тест не отмечен аннотацией \u003Ccode\u003E@QuarkusTest\u003C\u002Fcode\u003E, поскольку среда тестирования Quarkus автоматически взаимодействует с записью JFR. Тесты используют аннотацию \u003Ccode\u003E@EnableEvent\u003C\u002Fcode\u003E для сбора определенных событий, например, событий сборки мусора. После выполнения логики программы метод \u003Ccode\u003EjfrEvents.awaitEvents() \u003C\u002Fcode\u003Eожидает любых событий JFR от JVM или приложения, прежде чем утверждения будут использоваться для проверки того, что событие произошло:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E@JfrEventTest\npublic class GarbageCollectionTest {\n    public JfrEvents jfrEvents = new JfrEvents();\n\n    @Test\n    @EnableEvent(\"jdk.GarbageCollection\")\n    public void testGarbageCollectionEvent() throws Exception {\n        System.gc();\n\n        jfrEvents.awaitEvents();\n\n        assertThat(jfrEvents).contains(event(\"jdk.GarbageCollection\"));\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ качестве альтернативы можно использовать фреймворк Spock для написания того же теста:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eclass GarbageCollectionSpec extends Specification {\nJfrEvents jfrEvents &lt;span style=\"margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(166, 127, 89); background: rgba(255, 255, 255, 0.5);\" class=\"token operator\"\u003E=&lt;\u002Fspan\u003E &lt;span style=\"margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(0, 119, 170);\" class=\"token keyword\"\u003Enew&lt;\u002Fspan\u003E &lt;span style=\"margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top;\" class=\"token class-name\"\u003EJfrEvents&lt;\u002Fspan\u003E&lt;span style=\"margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(153, 153, 153);\" class=\"token punctuation\"\u003E(&lt;\u002Fspan\u003E&lt;span style=\"margin: 0px; box-sizing: border-box; display: inline; -webkit-box-orient: horizontal; -webkit-box-direction: normal; flex-flow: row wrap; vertical-align: top; color: rgb(153, 153, 153);\" class=\"token punctuation\"\u003E)&lt;\u002Fspan\u003E&lt;font style=\"margin: 0px; box-sizing: border-box;\"\u003E&lt;\u002Ffont\u003E\n\n\n    @EnableEvent('jdk.GarbageCollection')\n    def 'Contains a garbage collection Jfr event'() {\n        when:\n        System.gc()\n\n        then:\n        jfrEvents['jdk.GarbageCollection']\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПомимо проверки того, произошло ли событие, также можно проверить детали события, такие как продолжительность выполнения метода \u003Ccode\u003EThread.sleep()\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E@Test\n@EnableEvent(\"jdk.ThreadSleep\")\npublic void testThreadSleepEvent() throws Exception {\n    Thread.sleep(42);\n\n    jfrEvents.awaitEvents();\n\n    assertThat(jfrEvents)\n            .contains(event(\"jdk.ThreadSleep\")\n            .with(\"time\", Duration.ofMillis(42)));\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EJfrUnit позволяет создавать и более сложные сценарии. Рассмотрим следующий пример, который собирает события выделения памяти и суммирует их данные, прежде чем утверждать, что выделение памяти находится между определенными значениями:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E@Test\n@EnableEvent(\"jdk.ObjectAllocationInNewTLAB\")\n@EnableEvent(\"jdk.ObjectAllocationOutsideTLAB\")\npublic void testAllocationEvent() throws Exception {\n    String threadName = Thread.currentThread().getName();\n\n    \u002F\u002F Application logic which creates objects\n\n    jfrEvents.awaitEvents();\n    long sum = jfrEvents.filter(this::isObjectAllocationEvent)\n            .filter(event -\u003E event.getThread().getJavaName().equals(threadName))\n            .mapToLong(this::getAllocationSize)\n            .sum();\n\n    assertThat(sum).isLessThan(43_000_000);\n    assertThat(sum).isGreaterThan(42_000_000);\n}\n\nprivate boolean isObjectAllocationEvent(RecordedEvent re) {\n    String name = re.getEventType().getName();\n    return name.equals(\"jdk.ObjectAllocationInNewTLAB\") ||\n            name.equals(\"jdk.ObjectAllocationOutsideTLAB\");\n}\n\nprivate long getAllocationSize(RecordedEvent recordedEvent) {\n    return recordedEvent.getEventType().getName()\n            .equals(\"jdk.ObjectAllocationInNewTLAB\") ?\n            recordedEvent.getLong(\"tlabSize\") :\n            recordedEvent.getLong(\"allocationSize\");\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВключение нескольких событий также возможно с помощью символа подстановки «\u003Cem\u003E», например, \u003C\u002Fem\u003E\u003Ccode\u003E@EnableEvent(\"jdk.ObjectAllocation\") \u003C\u002Fcode\u003Eможет использоваться для активации всех событий ObjectAllocation.\u003C\u002Fp\u003E\u003Cp\u003EЧтобы сбросить собранные события, можно использовать метод \u003Ccode\u003EjfrEvents.reset()\u003C\u002Fcode\u003E, чтобы гарантировать, что собираются только события после выполнения метода \u003Ccode\u003Ereset()\u003C\u002Fcode\u003E. Например, при запуске нескольких итераций и утверждении результатов на каждой итерации:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Efor (int i = 0; i &lt; ITERATIONS; i++) {\n    \u002F\u002F Application logic\n\n    jfrEvents.awaitEvents();\n\n\n    \u002F\u002F Assertions\n\n    jfrEvents.reset();\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТакие фреймворки, как Hibernate, сами по себе не генерируют события, но в этих случаях \u003Ca href=\"https:\u002F\u002Fdevelopers.redhat.com\u002Fblog\u002F2020\u002F10\u002F29\u002Fcollect-jdk-flight-recorder-events-at-runtime-with-jmc-agent#overview_of_the_jdk_flight_recorder_toolchain\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003Eагент JMC\u003C\u002Fu\u003E\u003C\u002Fa\u003E может использоваться для создания событий. С помощью агента JMC могут быть сгенерированы события SQL-запроса, которые затем могут быть использованы для оценки (количества) SQL-запросов, поступающих в базу данных. Это продемонстрировано на сессии DevNation Tech Talk \u003Ca href=\"https:\u002F\u002Fdevelopers.redhat.com\u002Fdevnation\u002Ftech-talks\u002Fjfrunit\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EContinuous performance regression testing with JfrUnit,\u003C\u002Fu\u003E\u003C\u002Fa\u003E а пример доступен на GitHub: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmoditect\u002Fjfrunit-examples\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003EExamples for JfrUnit\u003C\u002Fu\u003E\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"jdk"},{"titleHtml":"flight recorder"},{"titleHtml":"assertion"},{"titleHtml":"performance optimization"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F582632\u002Fe091949084fd38a3726ebfad47fa1948\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F582632\u002Fe091949084fd38a3726ebfad47fa1948\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582632\\\u002F\"},\"headline\":\"Оценка событий JDK Flight Recorder с помощью JfrUnit\",\"datePublished\":\"2021-10-12T11:09:45+03:00\",\"dateModified\":\"2021-10-12T11:34:19+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"val6852\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&nbsp;представил&nbsp;JfrUnit, новую утилиту тестирования, которую можно использов...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582632\\\u002F#post-content-body\",\"about\":[\"h_java\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F582632\\\u002Fe091949084fd38a3726ebfad47fa1948\\\u002F\"]}","metaDescription":"Гуннар Морлинг, разработчик программного обеспечения с открытым исходным кодом в Red Hat,&nbsp;представил&nbsp;JfrUnit, новую утилиту тестирования, которую можно использовать для обнаружения снижения...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"java"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
