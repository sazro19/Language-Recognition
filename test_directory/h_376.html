<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Обзор возможностей TypeScript Native (AOT) Compiler / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/583862\/"},"headline":"Обзор возможностей TypeScript Native (AOT) Compiler","datePublished":"2021-10-18T11:00:02+03:00","dateModified":"2021-10-18T14:04:32+03:00","author":{"@type":"Person","name":"AlexD_77"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https:\/\/habr.com\/ru\/post\/581308\/. В данной статье мне...","url":"https:\/\/habr.com\/ru\/post\/583862\/#post-content-body","about":["h_compilers","h_typescript","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/583862\/92a2ab64a29ac2771de166026085db80\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/11d\/be2\/7d5\/11dbe27d50b78cc8878084837268e92f.gif"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Обзор возможностей TypeScript Native (AOT) Compiler" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Обзор возможностей TypeScript Native (AOT) Compiler" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Обзор возможностей TypeScript Native (AOT) Compiler" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https://habr.com/ru/post/581308/. В данной статье мне хотелось бы остановиться на обзоре..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https://habr.com/ru/post/581308/. В данной статье мне хотелось бы остановиться на обзоре..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https://habr.com/ru/post/581308/. В данной статье мне хотелось бы остановиться на обзоре..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https://habr.com/ru/post/581308/. В данной статье мне хотелось бы остановиться на обзоре..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https://habr.com/ru/post/581308/. В данной статье мне хотелось бы остановиться на обзоре..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="583862" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-18T08:00:02.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/583862/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/583862/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/583862/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/AlexD_77/" title="AlexD_77" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/AlexD_77/" class="tm-user-info__username">
      AlexD_77
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-18T08:00:02.000Z" title="2021-10-18, 11:00">18  октября   в 11:00</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Обзор возможностей TypeScript Native (AOT) Compiler</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/compilers/" class="tm-article-snippet__hubs-item-link"><span>Компиляторы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/typescript/" class="tm-article-snippet__hubs-item-link"><span>TypeScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="/img/image-loader.svg" height="392" data-src="https://habrastorage.org/getpro/habr/upload_files/11d/be2/7d5/11dbe27d50b78cc8878084837268e92f.gif" data-width="846"/><figcaption></figcaption></figure><h3>Абстракт</h3><p>Данная статья является продолжением предыдущей статьи о <strong>TypeScript Native (AOT) Compiler</strong>(далее <strong>tsc</strong>) <a href="https://habr.com/ru/post/581308/" rel="noopener noreferrer nofollow">https://habr.com/ru/post/581308/</a>. В данной статье мне хотелось бы остановиться на обзоре возможностей компилятора, а также использование компилятора из command line(коммандной строки). При написании примеров я буду подразумевать что у читателя есть минимальное понимание как пользоваться компиляторами в командной строке и наличие некоторого опыта работы с LLVM</p><h3>Использование tsc</h3><p>Для получения краткой справки об опциях программы нужно выполнить следующую команду</p><pre><code>QC:\dev>tsc.exe --help  </code></pre><p>Основана опция, которая нам потребуется это "<strong>--emit=&lt;value></strong>". Эта опция важна для генерировал файлов в разных форматах вывода, таких как "obj", LLVM IR и т.д.</p><h2>Генерирование OBJ (объектный файл)</h2><p>Предположим, у нас есть файл <strong>example1.ts</strong> который содержит простую программу</p><pre><code class="javascript">function main()
{
  print("Hello World!");
}</code></pre><p>и мы хотим получить obj. файл, то достаточно выполнить следующую команду</p><pre><code>C:\dev>tsc.exe --emit=jit -nogc -dump-object-file -object-filename=out.o example.ts</code></pre><p>Данная команда скомпилирует файл <strong>example.ts </strong>и сохранит OBJ в <strong>out.o</strong>. Далее сгенерированный файл можно использовать для получения исполняемого файла. Например, используя <strong>lld </strong></p><h2>Генерирование EXE (выполняемого файла)</h2><p>Берем <strong>out.o</strong> из предыдущего примера и выполняем следующую команду</p><pre><code>c:\LLVM\lld.exe -flavor link out.o /libpath:%LIBPATH% /libpath:%SDKPATH% /libpath:%UCRTPATH% msvcrt.lib ucrt.lib kernel32.lib user32.lib.lib</code></pre><h2>Альтернативный путь генерирования EXE(выполняемого файла)</h2><pre><code>C:\dev>tsc.exe --emit=llvm example1.ts 2>example1.ll
C:\LLVM\llc.exe --filetype=obj -o=out.o example1.ll
C:\LLVM\lld.exe -flavor link out.o</code></pre><p>когда будете выполнять последний шаг то может понадобиться указать нужные библиотеки для C чтобы скомпилировать в .Exe файл (в конце статьи я приведу свои batch файлы для более детальной информации по компиляции)</p><h2>Выполнение TypeScript кода без компиляции</h2><p>Если нам нужно только посмотреть результат работы программы, то достаточно ввести следующую команду</p><pre><code>C:\dev>tsc.exe --jit example1.ts</code></pre><h2>Шаги компилятора для генерирования исполняемого кода</h2><p>После того как мы ознакомились с базовыми командами программы для командной строки, предлагаю посмотреть, как <strong>tsc </strong>компилирует программу example1.ts</p><pre><code>C:\dev>tsc.exe --emit=mlir example1.ts</code></pre><p>После чего мы получим вывод в MLIR (больше о MLIR тут <a href="https://mlir.llvm.org/" rel="noopener noreferrer nofollow">https://mlir.llvm.org/</a>)</p><pre><code>module @"1.ts"  {
  ts.Func @main () -> ()  {
    "ts.Entry"() : () -> ()
    %0 = ts.UnresolvedSymbolRef {identifier = @print} : none
    %1 = ts.Constant {value = "Hello World!"} : !ts.string
    ts.Print(%1) : !ts.string
    "ts.Exit"() : () -> ()
  }
}</code></pre><p>TypeScript файл будет преобразован в псевдоязык, который описывает логику программы. Этот промежуточный шаг позволяет компилятору проводить анализ кода и выполнять некоторую оптимизацию на данном этапе. </p><p>Что бы получить обработанной код нужно ввести следующую команду</p><pre><code>C:\dev>tsc.exe --emit=mlir-affine example1.ts</code></pre><p>Мы получим следующий листинг. </p><pre><code>module @"example1.ts"  {
  ts.Func @main () -> ()  {
    %0 = ts.Constant {value = "Hello World!"} : !ts.string
    ts.Print(%0) : !ts.string
    ts.ReturnInternal
  }
}</code></pre><p>Что нам говорит следующий псевдокод, что есть программа "<strong>example1.ts</strong>" которая имеет функцию "@main" которая в свою очередь загружает константу в параметр псевдокоманды "Print" и выходит из функции. Как не трудно догадаться, что при выполнении данной программы, мы увидим нашу строку вывода "Hello World!".</p><p>Дальнейшим шагом хотелось бы посмотреть выполняемый код близкий к машинному коду. Для этого мы выполним следующую команду </p><pre><code>C:\dev>tsc.exe --emit=mlir-llvm example1.ts</code></pre><p>И получаем результат выполнения</p><pre><code>module @"1.ts"  {
  llvm.func @puts(!llvm.ptr&lt;i8>) -> i32
  llvm.mlir.global internal constant @s_10092224619179044402("Hello World!\00")
  llvm.func @main() {
    %0 = llvm.mlir.addressof @s_10092224619179044402 : !llvm.ptr&lt;array&lt;13 x i8>>
    %1 = llvm.mlir.constant(0 : i64) : i64
    %2 = llvm.getelementptr %0[%1, %1] : (!llvm.ptr&lt;array&lt;13 x i8>>, i64, i64) -> !llvm.ptr&lt;i8>
    %3 = llvm.call @puts(%2) : (!llvm.ptr&lt;i8>) -> i32
    llvm.return
  }
}
</code></pre><p>Но этого еще мало, чтобы получить файл, который мы может "скормить" <strong>llс </strong>для получения <strong>obj-файла</strong> нам нужно выполнить команду </p><pre><code>C:\dev>tsc.exe --emit=llvm example1.ts</code></pre><p>Получаем вывод</p><pre><code>; ModuleID = 'LLVMDialectModule'
source_filename = "LLVMDialectModule"
target datalayout = "e-m:w-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-pc-windows-msvc"

@s_10092224619179044402 = internal constant [13 x i8] c"Hello World!\00"

declare i32 @puts(i8*)

define void @main() {
  %1 = call i32 @puts(i8* getelementptr inbounds ([13 x i8], [13 x i8]* @s_10092224619179044402, i64 0, i64 0)), !d
  ret void
}

</code></pre><p>Только что мы прошлись по основным этапам компиляции программы. Хотелось бы добавить, что шаги по оптимизации обычно выполняются на этапе, когда мы выполнили команду с параметром "--emit=mlir-affine"</p><p>Далее давайте посмотрим какой код может компилировать программа (я выбрал только более-менее интересные примеры)</p><h2>Параметры функций по умолчанию</h2><p>В следующем куске кода мы посмотрим, как можно использовать параметры по умолчанию</p><pre><code class="javascript">function defaultArgs(x: number, y = 3, z = 7) {
    return x + y + z;
}</code></pre><p>И вариант, когда значение по умолчанию указывать не нужно</p><pre><code class="javascript">function optargs(x: number, y?: number, z?: number) {
    if (y == undefined) y = 0;
    return x + y;
}</code></pre><p>В первом варианте<strong> </strong>параметры "<strong>y" </strong>и<strong> "z" </strong>указаны как параметры со значением, а во втором параметры "<strong>y" </strong>и<strong> "z" </strong>указаны как опциональные параметры. Заметьте, что в первом случае мы не указывает тип параметра т.к. тип параметра определяется из значения по умолчанию.</p><p>Вызов данных функций будет выглядеть следующим образом</p><pre><code class="javascript">defaultArgs(1);
defaultArgs(1, 4);
defaultArgs(1, 4, 8);

optargs(1);
optargs(1, 2);
optargs(1, 2, 3);</code></pre><p>Полный пример кода (обратите внимание что декларировать функции можно в любом порядке)</p><pre><code class="javascript">function defaultArgs(x: number, y = 3, z = 7) {
    return x + y + z;
}

function main() {
    defaultArgs(1);
    defaultArgs(1, 4);
    defaultArgs(1, 4, 8);

    optargs(1);
    optargs(1, 2);
    optargs(1, 2, 3);
}

function optargs(x: number, y?: number, z?: number) {
    if (y == undefined) y = 0;
    return x + y;
}
</code></pre><p>И получаемый псевдокод, из которого будет сгенерирован выполняемый файл (для этого нужно выполнить команду <strong>tsc --emit=mlir example1.ts</strong>)</p><pre><code>module @"C:\\temp\\1.ts"  {
  ts.Func @defaultArgs (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number {sym_visibility = "private"}  {
  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;i32>, %arg2: !ts.optional&lt;i32>):  // no predecessors
    %0 = "ts.Entry"() : () -> !ts.ref&lt;!ts.number>
    %1 = "ts.Param"(%arg0) : (!ts.number) -> !ts.ref&lt;!ts.number>
    %2 = "ts.ParamOpt"(%arg1) ( {
      %11 = ts.Constant {value = 3 : i32} : i32
      ts.DefaultValue %11 : i32
    }) : (!ts.optional&lt;i32>) -> !ts.ref&lt;i32>
    %3 = "ts.ParamOpt"(%arg2) ( {
      %11 = ts.Constant {value = 7 : i32} : i32
      ts.DefaultValue %11 : i32
    }) : (!ts.optional&lt;i32>) -> !ts.ref&lt;i32>
    %4 = ts.Load(%1) : !ts.ref&lt;!ts.number> -> !ts.number
    %5 = ts.Load(%2) : !ts.ref&lt;i32> -> i32
    %6 = ts.Cast %5 : i32 to !ts.number
    %7 = ts.ArithmeticBinary %4(39) %6 : !ts.number, !ts.number -> !ts.number
    %8 = ts.Load(%3) : !ts.ref&lt;i32> -> i32
    %9 = ts.Cast %8 : i32 to !ts.number
    %10 = ts.ArithmeticBinary %7(39) %9 : !ts.number, !ts.number -> !ts.number
    "ts.ReturnVal"(%10, %0) : (!ts.number, !ts.ref&lt;!ts.number>) -> ()
    "ts.Exit"() : () -> ()
  }
  ts.Func @main () -> ()  {
    "ts.Entry"() : () -> ()
    %0 = ts.SymbolRef {identifier = @defaultArgs} : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %1 = ts.Constant {value = 1 : i32} : i32
    %2 = ts.Cast %1 : i32 to !ts.number
    %3 = ts.Undef : !ts.optional&lt;i32>
    %4 = ts.Undef : !ts.optional&lt;i32>
    %5 = ts.CallIndirect %0(%2, %3, %4) : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %6 = ts.SymbolRef {identifier = @defaultArgs} : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %7 = ts.Constant {value = 1 : i32} : i32
    %8 = ts.Cast %7 : i32 to !ts.number
    %9 = ts.Constant {value = 4 : i32} : i32
    %10 = ts.Cast %9 : i32 to !ts.optional&lt;i32>
    %11 = ts.Undef : !ts.optional&lt;i32>
    %12 = ts.CallIndirect %6(%8, %10, %11) : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %13 = ts.SymbolRef {identifier = @defaultArgs} : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %14 = ts.Constant {value = 1 : i32} : i32
    %15 = ts.Cast %14 : i32 to !ts.number
    %16 = ts.Constant {value = 4 : i32} : i32
    %17 = ts.Cast %16 : i32 to !ts.optional&lt;i32>
    %18 = ts.Constant {value = 8 : i32} : i32
    %19 = ts.Cast %18 : i32 to !ts.optional&lt;i32>
    %20 = ts.CallIndirect %13(%15, %17, %19) : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %21 = ts.SymbolRef {identifier = @optargs} : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %22 = ts.Constant {value = 1 : i32} : i32
    %23 = ts.Cast %22 : i32 to !ts.number
    %24 = ts.Undef : !ts.optional&lt;!ts.number>
    %25 = ts.Undef : !ts.optional&lt;!ts.number>
    %26 = ts.CallIndirect %21(%23, %24, %25) : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %27 = ts.SymbolRef {identifier = @optargs} : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %28 = ts.Constant {value = 1 : i32} : i32
    %29 = ts.Cast %28 : i32 to !ts.number
    %30 = ts.Constant {value = 2 : i32} : i32
    %31 = ts.Cast %30 : i32 to !ts.optional&lt;!ts.number>
    %32 = ts.Undef : !ts.optional&lt;!ts.number>
    %33 = ts.CallIndirect %27(%29, %31, %32) : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %34 = ts.SymbolRef {identifier = @optargs} : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %35 = ts.Constant {value = 1 : i32} : i32
    %36 = ts.Cast %35 : i32 to !ts.number
    %37 = ts.Constant {value = 2 : i32} : i32
    %38 = ts.Cast %37 : i32 to !ts.optional&lt;!ts.number>
    %39 = ts.Constant {value = 3 : i32} : i32
    %40 = ts.Cast %39 : i32 to !ts.optional&lt;!ts.number>
    %41 = ts.CallIndirect %34(%36, %38, %40) : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    "ts.Exit"() : () -> ()
  }
  ts.Func @optargs (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number {sym_visibility = "private"}  {
  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;!ts.number>, %arg2: !ts.optional&lt;!ts.number>):  // no predecessors
    %0 = "ts.Entry"() : () -> !ts.ref&lt;!ts.number>
    %1 = "ts.Param"(%arg0) : (!ts.number) -> !ts.ref&lt;!ts.number>
    %2 = "ts.Param"(%arg1) : (!ts.optional&lt;!ts.number>) -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    %3 = "ts.Param"(%arg2) : (!ts.optional&lt;!ts.number>) -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    %4 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    %5 = ts.Undef : !ts.optional&lt;!ts.undef_ph>
    %6 = ts.LogicalBinary %4(34) %5 : !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.undef_ph> -> !ts.boolean
    "ts.If"(%6) ( {
      %11 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
      %12 = ts.Constant {value = 0 : i32} : i32
      %13 = ts.Cast %12 : i32 to !ts.optional&lt;!ts.number>
      ts.Store %13, %2 : !ts.optional&lt;!ts.number> -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
      "ts.Result"() : () -> ()
    },  {
    }) : (!ts.boolean) -> ()
    %7 = ts.Load(%1) : !ts.ref&lt;!ts.number> -> !ts.number
    %8 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    %9 = ts.Cast %8 : !ts.optional&lt;!ts.number> to !ts.number
    %10 = ts.ArithmeticBinary %7(39) %9 : !ts.number, !ts.number -> !ts.number
    "ts.ReturnVal"(%10, %0) : (!ts.number, !ts.ref&lt;!ts.number>) -> ()
    "ts.Exit"() : () -> ()
  }
}</code></pre><p>Данный код содержит части, которые могут быть упрощены на стадии оптимизации. Давайте посмотрим, что получиться на стадии оптимизации (для этого нам нужно выполнить команду <strong>tsc --emit=mlir-affine example1.ts</strong>)</p><pre><code>module @"C:\\temp\\1.ts"  {
  ts.Func @defaultArgs (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number {sym_visibility = "private"}  {
  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;i32>, %arg2: !ts.optional&lt;i32>):  // no predecessors
    %c7_i32 = constant 7 : i32
    %c3_i32 = constant 3 : i32
    %0 = ts.Variable() {false} :  -> !ts.ref&lt;!ts.number>
    %1 = ts.Variable(%arg0) {false} : !ts.number -> !ts.ref&lt;!ts.number>
    %2 = "ts.HasValue"(%arg1) : (!ts.optional&lt;i32>) -> !ts.boolean
    %3 = ts.Cast %2 : !ts.boolean to i1
    cond_br %3, ^bb1, ^bb2(%c3_i32 : i32)
  ^bb1:  // pred: ^bb0
    %4 = "ts.Value"(%arg1) : (!ts.optional&lt;i32>) -> i32
    br ^bb2(%4 : i32)
  ^bb2(%5: i32):  // 2 preds: ^bb0, ^bb1
    %6 = ts.Variable(%5) {false} : i32 -> !ts.ref&lt;i32>
    %7 = "ts.HasValue"(%arg2) : (!ts.optional&lt;i32>) -> !ts.boolean
    %8 = ts.Cast %7 : !ts.boolean to i1
    cond_br %8, ^bb3, ^bb4(%c7_i32 : i32)
  ^bb3:  // pred: ^bb2
    %9 = "ts.Value"(%arg2) : (!ts.optional&lt;i32>) -> i32
    br ^bb4(%9 : i32)
  ^bb4(%10: i32):  // 2 preds: ^bb2, ^bb3
    %11 = ts.Variable(%10) {false} : i32 -> !ts.ref&lt;i32>
    %12 = ts.Load(%1) : !ts.ref&lt;!ts.number> -> !ts.number
    %13 = ts.Load(%6) : !ts.ref&lt;i32> -> i32
    %14 = ts.Cast %13 : i32 to !ts.number
    %15 = ts.ArithmeticBinary %12(39) %14 : !ts.number, !ts.number -> !ts.number
    %16 = ts.Load(%11) : !ts.ref&lt;i32> -> i32
    %17 = ts.Cast %16 : i32 to !ts.number
    %18 = ts.ArithmeticBinary %15(39) %17 : !ts.number, !ts.number -> !ts.number
    ts.Store %18, %0 : !ts.number -> !ts.ref&lt;!ts.number>
    %19 = ts.Load(%0) : !ts.ref&lt;!ts.number> -> !ts.number
    ts.ReturnInternal %19 : !ts.number
  }
  ts.Func @main () -> ()  {
    %c3_i32 = constant 3 : i32
    %c2_i32 = constant 2 : i32
    %c8_i32 = constant 8 : i32
    %c4_i32 = constant 4 : i32
    %c1_i32 = constant 1 : i32
    %0 = ts.Cast %c1_i32 : i32 to !ts.number
    %1 = ts.Undef : !ts.optional&lt;i32>
    %2 = ts.Undef : !ts.optional&lt;i32>
    %3 = ts.CallInternal @defaultArgs(%0, %1, %2) : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %4 = ts.Cast %c4_i32 : i32 to !ts.optional&lt;i32>
    %5 = ts.Undef : !ts.optional&lt;i32>
    %6 = ts.CallInternal @defaultArgs(%0, %4, %5) : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %7 = ts.Cast %c8_i32 : i32 to !ts.optional&lt;i32>
    %8 = ts.CallInternal @defaultArgs(%0, %4, %7) : (!ts.number, !ts.optional&lt;i32>, !ts.optional&lt;i32>) -> !ts.number
    %9 = ts.Undef : !ts.optional&lt;!ts.number>
    %10 = ts.Undef : !ts.optional&lt;!ts.number>
    %11 = ts.CallInternal @optargs(%0, %9, %10) : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %12 = ts.Cast %c2_i32 : i32 to !ts.optional&lt;!ts.number>
    %13 = ts.Undef : !ts.optional&lt;!ts.number>
    %14 = ts.CallInternal @optargs(%0, %12, %13) : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    %15 = ts.Cast %c3_i32 : i32 to !ts.optional&lt;!ts.number>
    %16 = ts.CallInternal @optargs(%0, %12, %15) : (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number
    ts.ReturnInternal
  }
  ts.Func @optargs (!ts.number, !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.number>) -> !ts.number {sym_visibility = "private"}  {
  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;!ts.number>, %arg2: !ts.optional&lt;!ts.number>):  // no predecessors
    %c0_i32 = constant 0 : i32
    %0 = ts.Variable() {false} :  -> !ts.ref&lt;!ts.number>
    %1 = ts.Variable(%arg0) {false} : !ts.number -> !ts.ref&lt;!ts.number>
    %2 = ts.Variable(%arg1) {false} : !ts.optional&lt;!ts.number> -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    %3 = ts.Variable(%arg2) {false} : !ts.optional&lt;!ts.number> -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    %4 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    %5 = ts.Undef : !ts.optional&lt;!ts.undef_ph>
    %6 = ts.LogicalBinary %4(34) %5 : !ts.optional&lt;!ts.number>, !ts.optional&lt;!ts.undef_ph> -> !ts.boolean
    %7 = ts.Cast %6 : !ts.boolean to i1
    cond_br %7, ^bb1, ^bb2
  ^bb1:  // pred: ^bb0
    %8 = ts.Cast %c0_i32 : i32 to !ts.optional&lt;!ts.number>
    ts.Store %8, %2 : !ts.optional&lt;!ts.number> -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    br ^bb2
  ^bb2:  // 2 preds: ^bb0, ^bb1
    %9 = ts.Load(%1) : !ts.ref&lt;!ts.number> -> !ts.number
    %10 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    %11 = ts.Cast %10 : !ts.optional&lt;!ts.number> to !ts.number
    %12 = ts.ArithmeticBinary %9(39) %11 : !ts.number, !ts.number -> !ts.number
    ts.Store %12, %0 : !ts.number -> !ts.ref&lt;!ts.number>
    %13 = ts.Load(%0) : !ts.ref&lt;!ts.number> -> !ts.number
    ts.ReturnInternal %13 : !ts.number
  }
}
</code></pre><p>И наконец, чтобы посмотреть, как работает данный код нужно запустить команду <strong>tsc --emit=jit -nogc example1.ts</strong></p><p>В дальнейшем все листинги приводить буду по минимуму из-за большого их объёма. </p><h2>Итерация массивов</h2><p>В следующем коде посмотрим, как компилятор может генерировать код для обхода массивов</p><pre><code class="javascript">function main() {
    const trees = [[1], [2, 3], [4, 5, 6]];

    for (const a of trees) {
        print("array");
        for (const b of a) {
            print(b);
        }
    }

    print("done.");
}</code></pre><p>Результат работы (<strong>tsc --emit=jit -nogc example1.ts</strong>)</p><pre><code>C:\>tsc.exe --emit=jit -nogc example1.ts  
array
1
array
2
3
array
4
5
6
done.</code></pre><p>Давайте посмотрим на сгенерированный псевдокод (<strong>tsc --emit=mlir example1.ts</strong>)</p><pre><code>module @"C:\\temp\\1.ts"  {
  ts.Func @main () -> ()  {
    "ts.Entry"() : () -> ()
    %0 = ts.Constant {value = 1 : i32} : i32
    %1 = ts.Constant {value = [1 : i32]} : !ts.const_array&lt;i32,1>
    %2 = ts.Constant {value = 2 : i32} : i32
    %3 = ts.Constant {value = 3 : i32} : i32
    %4 = ts.Constant {value = [2 : i32, 3 : i32]} : !ts.const_array&lt;i32,2>
    %5 = ts.Constant {value = 4 : i32} : i32
    %6 = ts.Constant {value = 5 : i32} : i32
    %7 = ts.Constant {value = 6 : i32} : i32
    %8 = ts.Constant {value = [4 : i32, 5 : i32, 6 : i32]} : !ts.const_array&lt;i32,3>
    %9 = ts.Constant {value = [[1 : i32], [2 : i32, 3 : i32], [4 : i32, 5 : i32, 6 : i32]]} : !ts.const_array&lt;!ts.array&lt;i32>,3>
    %10 = ts.Constant {value = 0 : i32} : i32
    %11 = ts.Variable(%10) {false} : i32 -> !ts.ref&lt;i32>
    ts.For :  -> ( {
      %14 = ts.Load(%11) : !ts.ref&lt;i32> -> i32
      %15 = ts.Constant {value = 3 : i32} : i32
      %16 = ts.LogicalBinary %14(29) %15 : i32, i32 -> !ts.boolean
      ts.Condition(%16) : 
    },  {
      %14 = ts.Load(%11) : !ts.ref&lt;i32> -> i32
      %15 = ts.PrefixUnary %14(45) : i32 -> i32
      "ts.Result"() : () -> ()
    })  {
      %14 = ts.Load(%11) : !ts.ref&lt;i32> -> i32
      %15 = ts.ElementRef %9[%14] : !ts.const_array&lt;!ts.array&lt;i32>,3>[i32] -> !ts.ref&lt;!ts.array&lt;i32>>
      %16 = ts.Load(%15) : !ts.ref&lt;!ts.array&lt;i32>> -> !ts.array&lt;i32>
      %17 = ts.UnresolvedSymbolRef {identifier = @print} : none
      %18 = ts.Constant {value = "array"} : !ts.string
      ts.Print(%18) : !ts.string
      %19 = ts.Constant {value = 0 : i32} : i32
      %20 = ts.Variable(%19) {false} : i32 -> !ts.ref&lt;i32>
      ts.For :  -> ( {
        %21 = ts.Load(%20) : !ts.ref&lt;i32> -> i32
        %22 = ts.Load(%15) : !ts.ref&lt;!ts.array&lt;i32>> -> !ts.array&lt;i32>
        %23 = "ts.LengthOf"(%22) : (!ts.array&lt;i32>) -> i32
        %24 = ts.LogicalBinary %21(29) %23 : i32, i32 -> !ts.boolean
        ts.Condition(%24) : 
      },  {
        %21 = ts.Load(%20) : !ts.ref&lt;i32> -> i32
        %22 = ts.PrefixUnary %21(45) : i32 -> i32
        "ts.Result"() : () -> ()
      })  {
        %21 = ts.Load(%20) : !ts.ref&lt;i32> -> i32
        %22 = ts.Load(%15) : !ts.ref&lt;!ts.array&lt;i32>> -> !ts.array&lt;i32>
        %23 = ts.ElementRef %22[%21] : !ts.array&lt;i32>[i32] -> !ts.ref&lt;i32>
        %24 = ts.Load(%23) : !ts.ref&lt;i32> -> i32
        %25 = ts.UnresolvedSymbolRef {identifier = @print} : none
        ts.Print(%24) : i32
        "ts.Result"() : () -> ()
      }
      "ts.Result"() : () -> ()
    }
    %12 = ts.UnresolvedSymbolRef {identifier = @print} : none
    %13 = ts.Constant {value = "done."} : !ts.string
    ts.Print(%13) : !ts.string
    "ts.Exit"() : () -> ()
  }
}</code></pre><h2>Захват переменных функциями</h2><pre><code class="javascript">function func_in_object(a: number | undefined) {
    const s = {
        f() {
            assert(a == 11);
            print(a);
        },
    };

    s.f();
}

function main() {
    func_in_object(11);
    print("done.");
}</code></pre><p>Результат работы:</p><pre><code>C:\temp>C:\tsc.exe --emit=jit -nogc example1.ts  
11
done.
</code></pre><p>В данном примере, передается параметр "<strong>a</strong>" с типом "<strong>number | undefined</strong>". Это значит, что, "<strong>а"</strong> может быть опциональный т.е. аналог "<strong>a?: number</strong>". Далее этот параметр будет захвачен в функции "<strong>f()</strong>" которая будет принадлежать абстрактному объекту "<strong>s</strong>"</p><p>И давайте посмотрим какой псевдокод будет сгенерирован в данном примере</p><pre><code>module @"C:\\temp\\1.ts"  {
  ts.Func @__uf14725333033948923702 (!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> () {arg_attrs = [{ts.nest}, {}], sym_visibility = "private", ts.nest}  {
  ^bb0(%arg0: !ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, %arg1: !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>):  // no predecessors
    "ts.Entry"() : () -> ()
    %0 = "ts.Param"(%arg1) : (!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> !ts.ref&lt;!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>>
    %1 = ts.PropertyRef %arg0&lt;0> : !ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>> -> !ts.ref&lt;!ts.ref&lt;!ts.optional&lt;!ts.number>>>
    %2 = ts.Load(%1) : !ts.ref&lt;!ts.ref&lt;!ts.optional&lt;!ts.number>>> -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    %3 = ts.UnresolvedSymbolRef {identifier = @assert} : none
    %4 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    %5 = ts.Constant {value = 11 : i32} : i32
    %6 = ts.Cast %4 : !ts.optional&lt;!ts.number> to i32
    %7 = ts.LogicalBinary %6(34) %5 : i32, i32 -> !ts.boolean
    ts.Assert %7, "assert"
    %8 = ts.UnresolvedSymbolRef {identifier = @print} : none
    %9 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    ts.Print(%9) : !ts.optional&lt;!ts.number>
    "ts.Exit"() : () -> ()
  }
  ts.Func @func_in_object (!ts.optional&lt;!ts.number>) -> () {sym_visibility = "private"}  {
  ^bb0(%arg0: !ts.optional&lt;!ts.number>):  // no predecessors
    "ts.Entry"() : () -> ()
    %0 = "ts.Param"(%arg0) : (!ts.optional&lt;!ts.number>) -> !ts.ref&lt;!ts.optional&lt;!ts.number>>
    %1 = ts.SymbolRef {identifier = @__uf14725333033948923702} : (!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()
    %2 = ts.Load(%0) : !ts.ref&lt;!ts.optional&lt;!ts.number>> -> !ts.optional&lt;!ts.number>
    %3 = "ts.Capture"(%0) : (!ts.ref&lt;!ts.optional&lt;!ts.number>>) -> !ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>
    %4 = "ts.Trampoline"(%1, %3) {allocInHeap = false} : ((!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> (), !ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>) -> ((!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ())
    %5 = ts.Constant {value = [unit]} : !ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}>
    %6 = ts.Variable(%5) {false} : !ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}> -> !ts.ref&lt;!ts.tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}>>
    %7 = ts.PropertyRef %6&lt;0> : !ts.ref&lt;!ts.tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}>> -> !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()>
    %8 = ts.Load(%7) : !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()> -> !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>,!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()>
    %9 = ts.Cast %4 : (!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> () to (!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()
    ts.Store %9, %7 : (!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> () -> !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()>
    %10 = ts.Load(%6) : !ts.ref&lt;!ts.tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}>> -> !ts.tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}>
    %11 = ts.PropertyRef %6&lt;0> : !ts.ref&lt;!ts.tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()}>> -> !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()>
    %12 = ts.Load(%11) : !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()> -> !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>,!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()>
    %13 = ts.GetThis %12 : !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>,!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()> -> !ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>
    %14 = ts.GetMethod %12 : !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>,!ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()> -> (!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()
    %15 = ts.Undef : !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>
    ts.CallIndirect %14(%13, %15) : (!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.object&lt;!ts.const_tuple&lt;{"f",(!ts.ref&lt;!ts.tuple&lt;{"a",!ts.ref&lt;!ts.optional&lt;!ts.number>>}>>, !ts.opaque) -> ()}>>) -> ()
    "ts.Exit"() : () -> ()
  }
  ts.Func @main () -> ()  {
    "ts.Entry"() : () -> ()
    %0 = ts.SymbolRef {identifier = @func_in_object} : (!ts.optional&lt;!ts.number>) -> ()
    %1 = ts.Constant {value = 11 : i32} : i32
    %2 = ts.Cast %1 : i32 to !ts.optional&lt;!ts.number>
    ts.CallIndirect %0(%2) : (!ts.optional&lt;!ts.number>) -> ()
    %3 = ts.UnresolvedSymbolRef {identifier = @print} : none
    %4 = ts.Constant {value = "done."} : !ts.string
    ts.Print(%4) : !ts.string
    "ts.Exit"() : () -> ()
  }
}
</code></pre><p>Интересующие строки, где псевдокоманды, которые нас интересуют, имеют имена "<strong>ts.Capture</strong>" и "<strong>ts.Trampoline</strong>". Первая команда захватывает ссылку на объект или значение, а вторая команда создает виртуальную функцию, которая будет получать объект, содержащий ссылку на переменную "<strong>а</strong>"</p><h2>Интерфейсы по требованию</h2><p>В этом параграфе мы рассмотрим пример, который покажет, как можно создавать интерфейсы из классов, которые не задекларированы на уровне класса</p><pre><code class="javascript">class S {
// нам не нужно указывать наличие интерфейса в декларации
// class S implements IPrn
    print() {
        print("Hello World");
    }
}

interface IPrn {
    print();
}

function run(iface: IPrn) {
    iface.print();
}

function main() {
    const s = new S();
    let iface = &lt;IPrn>s;
    iface.print();
    run(s);

    print("done.");
}</code></pre><p>В этом коде мы создаем экземпляр интерфейса "<strong>IPrn</strong>" который не объявлен в классе "<strong>S</strong>" как это обычно требуется в С++</p><h2>Использование yield в генераторах</h2><p>Пример использования "<strong>yield</strong>".</p><pre><code class="javascript">function* foo() {
    let i = 1;
    while (i &lt; 3) {
        yield ++i;
    }
}

function main() {
    for (const o of foo3()) {
        print(o);
    }
}</code></pre><p>Результат выполнения кода</p><pre><code>C:\>tsc.exe --emit=jit -nogc example1.ts  
2
3</code></pre><h2>Примеры с использованием async/await</h2><p>В этом параграфе я покажу два примера с <strong>async/await</strong> и <strong>for await</strong></p><pre><code>async function f(a = 1) {
    return a;
}

function main() {
    const v = await f(2);
    print(v);
    print("done.");
}
</code></pre><p>Давайте посмотрим на сгенерированный псевдокод </p><pre><code>module @"C:\\temp\\1.ts"  {
  ts.Func @f (!ts.optional&lt;i32>) -> i32 {sym_visibility = "private"}  {
  ^bb0(%arg0: !ts.optional&lt;i32>):  // no predecessors
    %0 = "ts.Entry"() : () -> !ts.ref&lt;i32>
    %1 = "ts.ParamOpt"(%arg0) ( {
      %3 = ts.Constant {value = 1 : i32} : i32
      ts.DefaultValue %3 : i32
    }) : (!ts.optional&lt;i32>) -> !ts.ref&lt;i32>
    %2 = ts.Load(%1) : !ts.ref&lt;i32> -> i32
    "ts.ReturnVal"(%2, %0) : (i32, !ts.ref&lt;i32>) -> ()
    "ts.Exit"() : () -> ()
  }
  ts.Func @main () -> ()  {
    "ts.Entry"() : () -> ()
    %token, %results = async.execute -> !async.value&lt;i32> {
      %4 = ts.SymbolRef {identifier = @f} : (!ts.optional&lt;i32>) -> i32
      %5 = ts.Constant {value = 2 : i32} : i32
      %6 = ts.Cast %5 : i32 to !ts.optional&lt;i32>
      %7 = ts.CallIndirect %4(%6) : (!ts.optional&lt;i32>) -> i32
      async.yield %7 : i32
    }
    %0 = async.await %results : !async.value&lt;i32>
    %1 = ts.UnresolvedSymbolRef {identifier = @print} : none
    ts.Print(%0) : i32
    %2 = ts.UnresolvedSymbolRef {identifier = @print} : none
    %3 = ts.Constant {value = "done."} : !ts.string
    ts.Print(%3) : !ts.string
    "ts.Exit"() : () -> ()
  }
}
</code></pre><p>И второй пример с <strong>for/await</strong></p><pre><code class="javascript">function main() {
    for await (const v of [1, 2, 3, 4, 5]) {
        print(v);
    }
}</code></pre><p>сгенерированный псевдокод</p><pre><code>module @"C:\\temp\\1.ts"  {
  ts.Func @main () -> ()  {
    "ts.Entry"() : () -> ()
    %0 = ts.Constant {value = 1 : i32} : i32
    %1 = ts.Constant {value = 2 : i32} : i32
    %2 = ts.Constant {value = 3 : i32} : i32
    %3 = ts.Constant {value = 4 : i32} : i32
    %4 = ts.Constant {value = 5 : i32} : i32
    %5 = ts.Constant {value = [1 : i32, 2 : i32, 3 : i32, 4 : i32, 5 : i32]} : !ts.const_array&lt;i32,5>
    %6 = ts.Constant {value = 0 : i32} : i32
    %7 = ts.Variable(%6) {false} : i32 -> !ts.ref&lt;i32>
    %8 = async.create_group
    ts.For :  -> ( {
      %9 = ts.Load(%7) : !ts.ref&lt;i32> -> i32
      %10 = ts.Constant {value = 5 : i32} : i32
      %11 = ts.LogicalBinary %9(29) %10 : i32, i32 -> !ts.boolean
      ts.Condition(%11) : 
    },  {
      %9 = ts.Load(%7) : !ts.ref&lt;i32> -> i32
      %10 = ts.PrefixUnary %9(45) : i32 -> i32
      "ts.Result"() : () -> ()
    })  {
      %9 = ts.Load(%7) : !ts.ref&lt;i32> -> i32
      %token = async.execute {
        %11 = ts.ElementRef %5[%9] : !ts.const_array&lt;i32,5>[i32] -> !ts.ref&lt;i32>
        %12 = ts.Load(%11) : !ts.ref&lt;i32> -> i32
        %13 = ts.UnresolvedSymbolRef {identifier = @print} : none
        ts.Print(%12) : i32
        async.yield
      }
      %10 = async.add_to_group %token, %8 : !async.token
      "ts.Result"() : () -> ()
    }
    async.await_all %8
    "ts.Exit"() : () -> ()
  }
}
</code></pre><p>Интересующие нас команды в этом коде это "<strong>async.execute</strong>" которые берут всю ответственность за выполнение кода асинхронно на себя</p><p>Хочется добавить, что чтобы запустить данный код нам нужна поддержка "<strong>runtime</strong>". </p><pre><code>C:\>tsc.exe --emit=jit --shared-libs=TypeScriptRuntime.dll example1.ts  
1
2
3
4
5</code></pre><p>Как мы видим из исполняемой строки что бы активировать "<strong>runtime</strong>" нужно указать параметр "--shared-libs=TypeScriptRuntime.dll". Для компиляции в LLVM IR данный параметр не нужен, но если мы хотим получить <strong>obj-файл</strong> с использованием --emit=jit тогда "runtime" нужно указывать. Также "<strong>runtime</strong>" нужно указывать при использовании "<strong>Garbage Collector</strong>" (сборщика мусора)</p><h2>Примеры Batch-файлов для компиляции Exe-файлов</h2><p>Компиляция, когда не нужна поддержка GC, async и захвата переменных.</p><pre><code>set FILENAME=%1
set LLVMPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\bin
set TSCPATH=C:\dev\TypeScriptCompiler\__build\tsc\bin
set LIBPATH="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\lib\x64"
set SDKPATH="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\um\x64"
set UCRTPATH="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\ucrt\x64"
set LLVMLIBPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\lib
%TSCPATH%\tsc.exe --emit=llvm -nogc C:\temp\%FILENAME%.ts 2>%FILENAME%.ll
%LLVMPATH%\llc.exe --filetype=obj -o=%FILENAME%.o %FILENAME%.ll
%LLVMPATH%\lld.exe -flavor link %FILENAME%.o /libpath:%LIBPATH% /libpath:%SDKPATH% /libpath:%UCRTPATH% /defaultlib:libcmt.lib libvcruntime.lib
del %FILENAME%.o

echo "RUN:..."
%FILENAME%.exe
</code></pre><p>Компиляция, когда нужна поддержка захвата переменных</p><pre><code>set FILENAME=%1
set LLVMPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\bin
set TSCPATH=C:\dev\TypeScriptCompiler\__build\tsc\bin
set LIBPATH="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\lib\x64"
set SDKPATH="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\um\x64"
set UCRTPATH="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\ucrt\x64"
set CLANGLIBPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\lib\clang\13.0.0\lib\windows
%TSCPATH%\tsc.exe --emit=llvm -nogc C:\temp\%FILENAME%.ts 2>%FILENAME%.ll
%LLVMPATH%\llc.exe --filetype=obj -o=%FILENAME%.o %FILENAME%.ll
%LLVMPATH%\lld.exe -flavor link %FILENAME%.o /libpath:%LIBPATH% /libpath:%SDKPATH% /libpath:%UCRTPATH% /libpath:%CLANGLIBPATH% /defaultlib:libcmt.lib libvcruntime.lib clang_rt.builtins-x86_64.lib
del %FILENAME%.o

echo "RUN:..."
%FILENAME%.exe
</code></pre><p>Компиляция если нужна поддержка <strong>GC</strong></p><pre><code>set FILENAME=%1
set LLVMPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\bin
set TSCPATH=C:\dev\TypeScriptCompiler\__build\tsc\bin
set LIBPATH="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\lib\x64"
set SDKPATH="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\um\x64"
set UCRTPATH="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\ucrt\x64"
set LLVMLIBPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\lib
set GCLIBPATH=C:\dev\TypeScriptCompiler\3rdParty\gc\Release
%TSCPATH%\tsc.exe --emit=llvm C:\temp\%FILENAME%.ts 2>%FILENAME%.ll
%LLVMPATH%\llc.exe --filetype=obj -o=%FILENAME%.o %FILENAME%.ll
%LLVMPATH%\lld.exe -flavor link %FILENAME%.o /libpath:%LIBPATH% /libpath:%SDKPATH% /libpath:%UCRTPATH% /libpath:%GCLIBPATH% msvcrt.lib ucrt.lib kernel32.lib user32.lib gcmt-lib.lib
del %FILENAME%.o

echo "RUN:..."
%FILENAME%.exe
</code></pre><p>Пример компиляции на <strong>Ubuntu</strong></p><pre><code class="bash">#/bin/sh
./tsc --emit=mlir-llvm -nogc /mnt/c/temp/1.ts -debug-only=llvm 2>1d.mlir
./tsc --emit=llvm -nogc /mnt/c/temp/1.ts 2>1.ll
llc --filetype=obj --relocation-model=pic -o=1.o 1.ll</code></pre><p>И если нужна поддержка  <strong>try/catch/finally</strong></p><pre><code class="bash">#/bin/sh
./tsc --emit=llvm -nogc /mnt/c/temp/1.ts 2>1.ll
llc --filetype=obj --relocation-model=pic -o=1.o 1.ll
gcc -o 1.out 1.o -frtti -fexceptions -lstdc++</code></pre><p>Пример компиляции для <strong>WASM</strong></p><pre><code>set FILENAME=%1
set LLVMPATH=C:\dev\TypeScriptCompiler\3rdParty\llvm\release\bin
set TSCPATH=C:\dev\TypeScriptCompiler\__build\tsc\bin
%TSCPATH%\tsc.exe --emit=llvm C:\temp\%FILENAME%.ts 2>%FILENAME%.ll
%LLVMPATH%\llc.exe -mtriple=wasm32-unknown-unknown -O3 --filetype=obj -o=%FILENAME%.o %FILENAME%.ll
%LLVMPATH%\wasm-ld.exe %FILENAME%.o -o %FILENAME%.wasm --no-entry --export-all --allow-undefined
del *.o
</code></pre><p>Больше примеров batch-файлов можно посмотреть тут <a href="https://github.com/ASDAlexander77/TypeScriptCompiler/tree/main/docs/how" rel="noopener noreferrer nofollow">TypeScriptCompiler/docs/how at main · ASDAlexander77/TypeScriptCompiler (github.com)</a></p><h2>Заключение</h2><p>Я рекомендую заглянуть в репозиторий проекта в папку test что бы посмотреть примеры кодов, которые могут быть скомпилированы <strong>tsc.</strong></p><p><a href="https://github.com/ASDAlexander77/TypeScriptCompiler/tree/main/tsc/test/tester/tests" rel="noopener noreferrer nofollow">TypeScriptCompiler/tsc/test/tester/tests at main · ASDAlexander77/TypeScriptCompiler (github.com)</a></p><p>Если Вам понравился данный проект, то дайте мне знать какую информацию Вы бы хотели еще узнать.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%82%D0%BE%D1%80%D1%8B%5D" class="tm-tags-list__link">компиляторы</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Btypescript%5D" class="tm-tags-list__link">typescript</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bnative%20code%5D" class="tm-tags-list__link">native code</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/compilers/" class="tm-hubs-list__link">
    Компиляторы
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/typescript/" class="tm-hubs-list__link">
    TypeScript
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 6: ↑6 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 6: ↑6 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+6</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    14
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/AlexD_77/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 15 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    11
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">11.1</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/AlexD_77/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @AlexD_77
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/583862/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 3 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/583862/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/583862/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"583862":{"id":"583862","timePublished":"2021-10-18T08:00:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Обзор возможностей TypeScript Native (AOT) Compiler","leadData":{"textHtml":"\u003Cp\u003Eпродолжение \u003Cstrong\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F581308\u002F\" rel=\"noopener noreferrer nofollow\"\u003ETypeScript Native (AOT) Compiler\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F11d\u002Fbe2\u002F7d5\u002F11dbe27d50b78cc8878084837268e92f.gif","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F11d\u002Fbe2\u002F7d5\u002F11dbe27d50b78cc8878084837268e92f.gif","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":11,"votesCount":15},"rating":11.1,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2744645","alias":"AlexD_77","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":3,"favoritesCount":14,"readingCount":2049,"score":6,"votesCount":6},"hubs":[{"relatedData":null,"id":"17188","alias":"compilers","type":"collective","title":"Компиляторы","titleHtml":"Компиляторы","isProfiled":true},{"relatedData":null,"id":"21370","alias":"typescript","type":"collective","title":"TypeScript","titleHtml":"TypeScript","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"392\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F11d\u002Fbe2\u002F7d5\u002F11dbe27d50b78cc8878084837268e92f.gif\" data-width=\"846\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EАбстракт\u003C\u002Fh3\u003E\u003Cp\u003EДанная статья является продолжением предыдущей статьи о \u003Cstrong\u003ETypeScript Native (AOT) Compiler\u003C\u002Fstrong\u003E(далее \u003Cstrong\u003Etsc\u003C\u002Fstrong\u003E) \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F581308\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F581308\u002F\u003C\u002Fa\u003E. В данной статье мне хотелось бы остановиться на обзоре возможностей компилятора, а также использование компилятора из command line(коммандной строки). При написании примеров я буду подразумевать что у читателя есть минимальное понимание как пользоваться компиляторами в командной строке и наличие некоторого опыта работы с LLVM\u003C\u002Fp\u003E\u003Ch3\u003EИспользование tsc\u003C\u002Fh3\u003E\u003Cp\u003EДля получения краткой справки об опциях программы нужно выполнить следующую команду\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EQC:\\dev\u003Etsc.exe --help  \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОснована опция, которая нам потребуется это \"\u003Cstrong\u003E--emit=&lt;value\u003E\u003C\u002Fstrong\u003E\". Эта опция важна для генерировал файлов в разных форматах вывода, таких как \"obj\", LLVM IR и т.д.\u003C\u002Fp\u003E\u003Ch2\u003EГенерирование OBJ (объектный файл)\u003C\u002Fh2\u003E\u003Cp\u003EПредположим, у нас есть файл \u003Cstrong\u003Eexample1.ts\u003C\u002Fstrong\u003E который содержит простую программу\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction main()\n{\n  print(\"Hello World!\");\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eи мы хотим получить obj. файл, то достаточно выполнить следующую команду\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --emit=jit -nogc -dump-object-file -object-filename=out.o example.ts\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДанная команда скомпилирует файл \u003Cstrong\u003Eexample.ts \u003C\u002Fstrong\u003Eи сохранит OBJ в \u003Cstrong\u003Eout.o\u003C\u002Fstrong\u003E. Далее сгенерированный файл можно использовать для получения исполняемого файла. Например, используя \u003Cstrong\u003Elld \u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Ch2\u003EГенерирование EXE (выполняемого файла)\u003C\u002Fh2\u003E\u003Cp\u003EБерем \u003Cstrong\u003Eout.o\u003C\u002Fstrong\u003E из предыдущего примера и выполняем следующую команду\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Ec:\\LLVM\\lld.exe -flavor link out.o \u002Flibpath:%LIBPATH% \u002Flibpath:%SDKPATH% \u002Flibpath:%UCRTPATH% msvcrt.lib ucrt.lib kernel32.lib user32.lib.lib\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EАльтернативный путь генерирования EXE(выполняемого файла)\u003C\u002Fh2\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --emit=llvm example1.ts 2\u003Eexample1.ll\nC:\\LLVM\\llc.exe --filetype=obj -o=out.o example1.ll\nC:\\LLVM\\lld.exe -flavor link out.o\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eкогда будете выполнять последний шаг то может понадобиться указать нужные библиотеки для C чтобы скомпилировать в .Exe файл (в конце статьи я приведу свои batch файлы для более детальной информации по компиляции)\u003C\u002Fp\u003E\u003Ch2\u003EВыполнение TypeScript кода без компиляции\u003C\u002Fh2\u003E\u003Cp\u003EЕсли нам нужно только посмотреть результат работы программы, то достаточно ввести следующую команду\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --jit example1.ts\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EШаги компилятора для генерирования исполняемого кода\u003C\u002Fh2\u003E\u003Cp\u003EПосле того как мы ознакомились с базовыми командами программы для командной строки, предлагаю посмотреть, как \u003Cstrong\u003Etsc \u003C\u002Fstrong\u003Eкомпилирует программу example1.ts\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --emit=mlir example1.ts\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПосле чего мы получим вывод в MLIR (больше о MLIR тут \u003Ca href=\"https:\u002F\u002Fmlir.llvm.org\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fmlir.llvm.org\u002F\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"1.ts\"  {\n  ts.Func @main () -\u003E ()  {\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = ts.UnresolvedSymbolRef {identifier = @print} : none\n    %1 = ts.Constant {value = \"Hello World!\"} : !ts.string\n    ts.Print(%1) : !ts.string\n    \"ts.Exit\"() : () -\u003E ()\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ETypeScript файл будет преобразован в псевдоязык, который описывает логику программы. Этот промежуточный шаг позволяет компилятору проводить анализ кода и выполнять некоторую оптимизацию на данном этапе. \u003C\u002Fp\u003E\u003Cp\u003EЧто бы получить обработанной код нужно ввести следующую команду\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --emit=mlir-affine example1.ts\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EМы получим следующий листинг. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"example1.ts\"  {\n  ts.Func @main () -\u003E ()  {\n    %0 = ts.Constant {value = \"Hello World!\"} : !ts.string\n    ts.Print(%0) : !ts.string\n    ts.ReturnInternal\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЧто нам говорит следующий псевдокод, что есть программа \"\u003Cstrong\u003Eexample1.ts\u003C\u002Fstrong\u003E\" которая имеет функцию \"@main\" которая в свою очередь загружает константу в параметр псевдокоманды \"Print\" и выходит из функции. Как не трудно догадаться, что при выполнении данной программы, мы увидим нашу строку вывода \"Hello World!\".\u003C\u002Fp\u003E\u003Cp\u003EДальнейшим шагом хотелось бы посмотреть выполняемый код близкий к машинному коду. Для этого мы выполним следующую команду \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --emit=mlir-llvm example1.ts\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ получаем результат выполнения\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"1.ts\"  {\n  llvm.func @puts(!llvm.ptr&lt;i8\u003E) -\u003E i32\n  llvm.mlir.global internal constant @s_10092224619179044402(\"Hello World!\\00\")\n  llvm.func @main() {\n    %0 = llvm.mlir.addressof @s_10092224619179044402 : !llvm.ptr&lt;array&lt;13 x i8\u003E\u003E\n    %1 = llvm.mlir.constant(0 : i64) : i64\n    %2 = llvm.getelementptr %0[%1, %1] : (!llvm.ptr&lt;array&lt;13 x i8\u003E\u003E, i64, i64) -\u003E !llvm.ptr&lt;i8\u003E\n    %3 = llvm.call @puts(%2) : (!llvm.ptr&lt;i8\u003E) -\u003E i32\n    llvm.return\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНо этого еще мало, чтобы получить файл, который мы может \"скормить\" \u003Cstrong\u003Ellс \u003C\u002Fstrong\u003Eдля получения \u003Cstrong\u003Eobj-файла\u003C\u002Fstrong\u003E нам нужно выполнить команду \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\dev\u003Etsc.exe --emit=llvm example1.ts\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПолучаем вывод\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E; ModuleID = 'LLVMDialectModule'\nsource_filename = \"LLVMDialectModule\"\ntarget datalayout = \"e-m:w-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-pc-windows-msvc\"\n\n@s_10092224619179044402 = internal constant [13 x i8] c\"Hello World!\\00\"\n\ndeclare i32 @puts(i8*)\n\ndefine void @main() {\n  %1 = call i32 @puts(i8* getelementptr inbounds ([13 x i8], [13 x i8]* @s_10092224619179044402, i64 0, i64 0)), !d\n  ret void\n}\n\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТолько что мы прошлись по основным этапам компиляции программы. Хотелось бы добавить, что шаги по оптимизации обычно выполняются на этапе, когда мы выполнили команду с параметром \"--emit=mlir-affine\"\u003C\u002Fp\u003E\u003Cp\u003EДалее давайте посмотрим какой код может компилировать программа (я выбрал только более-менее интересные примеры)\u003C\u002Fp\u003E\u003Ch2\u003EПараметры функций по умолчанию\u003C\u002Fh2\u003E\u003Cp\u003EВ следующем куске кода мы посмотрим, как можно использовать параметры по умолчанию\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction defaultArgs(x: number, y = 3, z = 7) {\n    return x + y + z;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ вариант, когда значение по умолчанию указывать не нужно\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction optargs(x: number, y?: number, z?: number) {\n    if (y == undefined) y = 0;\n    return x + y;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ первом варианте\u003Cstrong\u003E \u003C\u002Fstrong\u003Eпараметры \"\u003Cstrong\u003Ey\" \u003C\u002Fstrong\u003Eи\u003Cstrong\u003E \"z\" \u003C\u002Fstrong\u003Eуказаны как параметры со значением, а во втором параметры \"\u003Cstrong\u003Ey\" \u003C\u002Fstrong\u003Eи\u003Cstrong\u003E \"z\" \u003C\u002Fstrong\u003Eуказаны как опциональные параметры. Заметьте, что в первом случае мы не указывает тип параметра т.к. тип параметра определяется из значения по умолчанию.\u003C\u002Fp\u003E\u003Cp\u003EВызов данных функций будет выглядеть следующим образом\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003EdefaultArgs(1);\ndefaultArgs(1, 4);\ndefaultArgs(1, 4, 8);\n\noptargs(1);\noptargs(1, 2);\noptargs(1, 2, 3);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПолный пример кода (обратите внимание что декларировать функции можно в любом порядке)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction defaultArgs(x: number, y = 3, z = 7) {\n    return x + y + z;\n}\n\nfunction main() {\n    defaultArgs(1);\n    defaultArgs(1, 4);\n    defaultArgs(1, 4, 8);\n\n    optargs(1);\n    optargs(1, 2);\n    optargs(1, 2, 3);\n}\n\nfunction optargs(x: number, y?: number, z?: number) {\n    if (y == undefined) y = 0;\n    return x + y;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ получаемый псевдокод, из которого будет сгенерирован выполняемый файл (для этого нужно выполнить команду \u003Cstrong\u003Etsc --emit=mlir example1.ts\u003C\u002Fstrong\u003E)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"C:\\\\temp\\\\1.ts\"  {\n  ts.Func @defaultArgs (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number {sym_visibility = \"private\"}  {\n  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;i32\u003E, %arg2: !ts.optional&lt;i32\u003E):  \u002F\u002F no predecessors\n    %0 = \"ts.Entry\"() : () -\u003E !ts.ref&lt;!ts.number\u003E\n    %1 = \"ts.Param\"(%arg0) : (!ts.number) -\u003E !ts.ref&lt;!ts.number\u003E\n    %2 = \"ts.ParamOpt\"(%arg1) ( {\n      %11 = ts.Constant {value = 3 : i32} : i32\n      ts.DefaultValue %11 : i32\n    }) : (!ts.optional&lt;i32\u003E) -\u003E !ts.ref&lt;i32\u003E\n    %3 = \"ts.ParamOpt\"(%arg2) ( {\n      %11 = ts.Constant {value = 7 : i32} : i32\n      ts.DefaultValue %11 : i32\n    }) : (!ts.optional&lt;i32\u003E) -\u003E !ts.ref&lt;i32\u003E\n    %4 = ts.Load(%1) : !ts.ref&lt;!ts.number\u003E -\u003E !ts.number\n    %5 = ts.Load(%2) : !ts.ref&lt;i32\u003E -\u003E i32\n    %6 = ts.Cast %5 : i32 to !ts.number\n    %7 = ts.ArithmeticBinary %4(39) %6 : !ts.number, !ts.number -\u003E !ts.number\n    %8 = ts.Load(%3) : !ts.ref&lt;i32\u003E -\u003E i32\n    %9 = ts.Cast %8 : i32 to !ts.number\n    %10 = ts.ArithmeticBinary %7(39) %9 : !ts.number, !ts.number -\u003E !ts.number\n    \"ts.ReturnVal\"(%10, %0) : (!ts.number, !ts.ref&lt;!ts.number\u003E) -\u003E ()\n    \"ts.Exit\"() : () -\u003E ()\n  }\n  ts.Func @main () -\u003E ()  {\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = ts.SymbolRef {identifier = @defaultArgs} : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %1 = ts.Constant {value = 1 : i32} : i32\n    %2 = ts.Cast %1 : i32 to !ts.number\n    %3 = ts.Undef : !ts.optional&lt;i32\u003E\n    %4 = ts.Undef : !ts.optional&lt;i32\u003E\n    %5 = ts.CallIndirect %0(%2, %3, %4) : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %6 = ts.SymbolRef {identifier = @defaultArgs} : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %7 = ts.Constant {value = 1 : i32} : i32\n    %8 = ts.Cast %7 : i32 to !ts.number\n    %9 = ts.Constant {value = 4 : i32} : i32\n    %10 = ts.Cast %9 : i32 to !ts.optional&lt;i32\u003E\n    %11 = ts.Undef : !ts.optional&lt;i32\u003E\n    %12 = ts.CallIndirect %6(%8, %10, %11) : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %13 = ts.SymbolRef {identifier = @defaultArgs} : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %14 = ts.Constant {value = 1 : i32} : i32\n    %15 = ts.Cast %14 : i32 to !ts.number\n    %16 = ts.Constant {value = 4 : i32} : i32\n    %17 = ts.Cast %16 : i32 to !ts.optional&lt;i32\u003E\n    %18 = ts.Constant {value = 8 : i32} : i32\n    %19 = ts.Cast %18 : i32 to !ts.optional&lt;i32\u003E\n    %20 = ts.CallIndirect %13(%15, %17, %19) : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %21 = ts.SymbolRef {identifier = @optargs} : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %22 = ts.Constant {value = 1 : i32} : i32\n    %23 = ts.Cast %22 : i32 to !ts.number\n    %24 = ts.Undef : !ts.optional&lt;!ts.number\u003E\n    %25 = ts.Undef : !ts.optional&lt;!ts.number\u003E\n    %26 = ts.CallIndirect %21(%23, %24, %25) : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %27 = ts.SymbolRef {identifier = @optargs} : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %28 = ts.Constant {value = 1 : i32} : i32\n    %29 = ts.Cast %28 : i32 to !ts.number\n    %30 = ts.Constant {value = 2 : i32} : i32\n    %31 = ts.Cast %30 : i32 to !ts.optional&lt;!ts.number\u003E\n    %32 = ts.Undef : !ts.optional&lt;!ts.number\u003E\n    %33 = ts.CallIndirect %27(%29, %31, %32) : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %34 = ts.SymbolRef {identifier = @optargs} : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %35 = ts.Constant {value = 1 : i32} : i32\n    %36 = ts.Cast %35 : i32 to !ts.number\n    %37 = ts.Constant {value = 2 : i32} : i32\n    %38 = ts.Cast %37 : i32 to !ts.optional&lt;!ts.number\u003E\n    %39 = ts.Constant {value = 3 : i32} : i32\n    %40 = ts.Cast %39 : i32 to !ts.optional&lt;!ts.number\u003E\n    %41 = ts.CallIndirect %34(%36, %38, %40) : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    \"ts.Exit\"() : () -\u003E ()\n  }\n  ts.Func @optargs (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number {sym_visibility = \"private\"}  {\n  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;!ts.number\u003E, %arg2: !ts.optional&lt;!ts.number\u003E):  \u002F\u002F no predecessors\n    %0 = \"ts.Entry\"() : () -\u003E !ts.ref&lt;!ts.number\u003E\n    %1 = \"ts.Param\"(%arg0) : (!ts.number) -\u003E !ts.ref&lt;!ts.number\u003E\n    %2 = \"ts.Param\"(%arg1) : (!ts.optional&lt;!ts.number\u003E) -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    %3 = \"ts.Param\"(%arg2) : (!ts.optional&lt;!ts.number\u003E) -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    %4 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    %5 = ts.Undef : !ts.optional&lt;!ts.undef_ph\u003E\n    %6 = ts.LogicalBinary %4(34) %5 : !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.undef_ph\u003E -\u003E !ts.boolean\n    \"ts.If\"(%6) ( {\n      %11 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n      %12 = ts.Constant {value = 0 : i32} : i32\n      %13 = ts.Cast %12 : i32 to !ts.optional&lt;!ts.number\u003E\n      ts.Store %13, %2 : !ts.optional&lt;!ts.number\u003E -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n      \"ts.Result\"() : () -\u003E ()\n    },  {\n    }) : (!ts.boolean) -\u003E ()\n    %7 = ts.Load(%1) : !ts.ref&lt;!ts.number\u003E -\u003E !ts.number\n    %8 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    %9 = ts.Cast %8 : !ts.optional&lt;!ts.number\u003E to !ts.number\n    %10 = ts.ArithmeticBinary %7(39) %9 : !ts.number, !ts.number -\u003E !ts.number\n    \"ts.ReturnVal\"(%10, %0) : (!ts.number, !ts.ref&lt;!ts.number\u003E) -\u003E ()\n    \"ts.Exit\"() : () -\u003E ()\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДанный код содержит части, которые могут быть упрощены на стадии оптимизации. Давайте посмотрим, что получиться на стадии оптимизации (для этого нам нужно выполнить команду \u003Cstrong\u003Etsc --emit=mlir-affine example1.ts\u003C\u002Fstrong\u003E)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"C:\\\\temp\\\\1.ts\"  {\n  ts.Func @defaultArgs (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number {sym_visibility = \"private\"}  {\n  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;i32\u003E, %arg2: !ts.optional&lt;i32\u003E):  \u002F\u002F no predecessors\n    %c7_i32 = constant 7 : i32\n    %c3_i32 = constant 3 : i32\n    %0 = ts.Variable() {false} :  -\u003E !ts.ref&lt;!ts.number\u003E\n    %1 = ts.Variable(%arg0) {false} : !ts.number -\u003E !ts.ref&lt;!ts.number\u003E\n    %2 = \"ts.HasValue\"(%arg1) : (!ts.optional&lt;i32\u003E) -\u003E !ts.boolean\n    %3 = ts.Cast %2 : !ts.boolean to i1\n    cond_br %3, ^bb1, ^bb2(%c3_i32 : i32)\n  ^bb1:  \u002F\u002F pred: ^bb0\n    %4 = \"ts.Value\"(%arg1) : (!ts.optional&lt;i32\u003E) -\u003E i32\n    br ^bb2(%4 : i32)\n  ^bb2(%5: i32):  \u002F\u002F 2 preds: ^bb0, ^bb1\n    %6 = ts.Variable(%5) {false} : i32 -\u003E !ts.ref&lt;i32\u003E\n    %7 = \"ts.HasValue\"(%arg2) : (!ts.optional&lt;i32\u003E) -\u003E !ts.boolean\n    %8 = ts.Cast %7 : !ts.boolean to i1\n    cond_br %8, ^bb3, ^bb4(%c7_i32 : i32)\n  ^bb3:  \u002F\u002F pred: ^bb2\n    %9 = \"ts.Value\"(%arg2) : (!ts.optional&lt;i32\u003E) -\u003E i32\n    br ^bb4(%9 : i32)\n  ^bb4(%10: i32):  \u002F\u002F 2 preds: ^bb2, ^bb3\n    %11 = ts.Variable(%10) {false} : i32 -\u003E !ts.ref&lt;i32\u003E\n    %12 = ts.Load(%1) : !ts.ref&lt;!ts.number\u003E -\u003E !ts.number\n    %13 = ts.Load(%6) : !ts.ref&lt;i32\u003E -\u003E i32\n    %14 = ts.Cast %13 : i32 to !ts.number\n    %15 = ts.ArithmeticBinary %12(39) %14 : !ts.number, !ts.number -\u003E !ts.number\n    %16 = ts.Load(%11) : !ts.ref&lt;i32\u003E -\u003E i32\n    %17 = ts.Cast %16 : i32 to !ts.number\n    %18 = ts.ArithmeticBinary %15(39) %17 : !ts.number, !ts.number -\u003E !ts.number\n    ts.Store %18, %0 : !ts.number -\u003E !ts.ref&lt;!ts.number\u003E\n    %19 = ts.Load(%0) : !ts.ref&lt;!ts.number\u003E -\u003E !ts.number\n    ts.ReturnInternal %19 : !ts.number\n  }\n  ts.Func @main () -\u003E ()  {\n    %c3_i32 = constant 3 : i32\n    %c2_i32 = constant 2 : i32\n    %c8_i32 = constant 8 : i32\n    %c4_i32 = constant 4 : i32\n    %c1_i32 = constant 1 : i32\n    %0 = ts.Cast %c1_i32 : i32 to !ts.number\n    %1 = ts.Undef : !ts.optional&lt;i32\u003E\n    %2 = ts.Undef : !ts.optional&lt;i32\u003E\n    %3 = ts.CallInternal @defaultArgs(%0, %1, %2) : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %4 = ts.Cast %c4_i32 : i32 to !ts.optional&lt;i32\u003E\n    %5 = ts.Undef : !ts.optional&lt;i32\u003E\n    %6 = ts.CallInternal @defaultArgs(%0, %4, %5) : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %7 = ts.Cast %c8_i32 : i32 to !ts.optional&lt;i32\u003E\n    %8 = ts.CallInternal @defaultArgs(%0, %4, %7) : (!ts.number, !ts.optional&lt;i32\u003E, !ts.optional&lt;i32\u003E) -\u003E !ts.number\n    %9 = ts.Undef : !ts.optional&lt;!ts.number\u003E\n    %10 = ts.Undef : !ts.optional&lt;!ts.number\u003E\n    %11 = ts.CallInternal @optargs(%0, %9, %10) : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %12 = ts.Cast %c2_i32 : i32 to !ts.optional&lt;!ts.number\u003E\n    %13 = ts.Undef : !ts.optional&lt;!ts.number\u003E\n    %14 = ts.CallInternal @optargs(%0, %12, %13) : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    %15 = ts.Cast %c3_i32 : i32 to !ts.optional&lt;!ts.number\u003E\n    %16 = ts.CallInternal @optargs(%0, %12, %15) : (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number\n    ts.ReturnInternal\n  }\n  ts.Func @optargs (!ts.number, !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.number\u003E) -\u003E !ts.number {sym_visibility = \"private\"}  {\n  ^bb0(%arg0: !ts.number, %arg1: !ts.optional&lt;!ts.number\u003E, %arg2: !ts.optional&lt;!ts.number\u003E):  \u002F\u002F no predecessors\n    %c0_i32 = constant 0 : i32\n    %0 = ts.Variable() {false} :  -\u003E !ts.ref&lt;!ts.number\u003E\n    %1 = ts.Variable(%arg0) {false} : !ts.number -\u003E !ts.ref&lt;!ts.number\u003E\n    %2 = ts.Variable(%arg1) {false} : !ts.optional&lt;!ts.number\u003E -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    %3 = ts.Variable(%arg2) {false} : !ts.optional&lt;!ts.number\u003E -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    %4 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    %5 = ts.Undef : !ts.optional&lt;!ts.undef_ph\u003E\n    %6 = ts.LogicalBinary %4(34) %5 : !ts.optional&lt;!ts.number\u003E, !ts.optional&lt;!ts.undef_ph\u003E -\u003E !ts.boolean\n    %7 = ts.Cast %6 : !ts.boolean to i1\n    cond_br %7, ^bb1, ^bb2\n  ^bb1:  \u002F\u002F pred: ^bb0\n    %8 = ts.Cast %c0_i32 : i32 to !ts.optional&lt;!ts.number\u003E\n    ts.Store %8, %2 : !ts.optional&lt;!ts.number\u003E -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    br ^bb2\n  ^bb2:  \u002F\u002F 2 preds: ^bb0, ^bb1\n    %9 = ts.Load(%1) : !ts.ref&lt;!ts.number\u003E -\u003E !ts.number\n    %10 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    %11 = ts.Cast %10 : !ts.optional&lt;!ts.number\u003E to !ts.number\n    %12 = ts.ArithmeticBinary %9(39) %11 : !ts.number, !ts.number -\u003E !ts.number\n    ts.Store %12, %0 : !ts.number -\u003E !ts.ref&lt;!ts.number\u003E\n    %13 = ts.Load(%0) : !ts.ref&lt;!ts.number\u003E -\u003E !ts.number\n    ts.ReturnInternal %13 : !ts.number\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ наконец, чтобы посмотреть, как работает данный код нужно запустить команду \u003Cstrong\u003Etsc --emit=jit -nogc example1.ts\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EВ дальнейшем все листинги приводить буду по минимуму из-за большого их объёма. \u003C\u002Fp\u003E\u003Ch2\u003EИтерация массивов\u003C\u002Fh2\u003E\u003Cp\u003EВ следующем коде посмотрим, как компилятор может генерировать код для обхода массивов\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction main() {\n    const trees = [[1], [2, 3], [4, 5, 6]];\n\n    for (const a of trees) {\n        print(\"array\");\n        for (const b of a) {\n            print(b);\n        }\n    }\n\n    print(\"done.\");\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EРезультат работы (\u003Cstrong\u003Etsc --emit=jit -nogc example1.ts\u003C\u002Fstrong\u003E)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\\u003Etsc.exe --emit=jit -nogc example1.ts  \narray\n1\narray\n2\n3\narray\n4\n5\n6\ndone.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДавайте посмотрим на сгенерированный псевдокод (\u003Cstrong\u003Etsc --emit=mlir example1.ts\u003C\u002Fstrong\u003E)\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"C:\\\\temp\\\\1.ts\"  {\n  ts.Func @main () -\u003E ()  {\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = ts.Constant {value = 1 : i32} : i32\n    %1 = ts.Constant {value = [1 : i32]} : !ts.const_array&lt;i32,1\u003E\n    %2 = ts.Constant {value = 2 : i32} : i32\n    %3 = ts.Constant {value = 3 : i32} : i32\n    %4 = ts.Constant {value = [2 : i32, 3 : i32]} : !ts.const_array&lt;i32,2\u003E\n    %5 = ts.Constant {value = 4 : i32} : i32\n    %6 = ts.Constant {value = 5 : i32} : i32\n    %7 = ts.Constant {value = 6 : i32} : i32\n    %8 = ts.Constant {value = [4 : i32, 5 : i32, 6 : i32]} : !ts.const_array&lt;i32,3\u003E\n    %9 = ts.Constant {value = [[1 : i32], [2 : i32, 3 : i32], [4 : i32, 5 : i32, 6 : i32]]} : !ts.const_array&lt;!ts.array&lt;i32\u003E,3\u003E\n    %10 = ts.Constant {value = 0 : i32} : i32\n    %11 = ts.Variable(%10) {false} : i32 -\u003E !ts.ref&lt;i32\u003E\n    ts.For :  -\u003E ( {\n      %14 = ts.Load(%11) : !ts.ref&lt;i32\u003E -\u003E i32\n      %15 = ts.Constant {value = 3 : i32} : i32\n      %16 = ts.LogicalBinary %14(29) %15 : i32, i32 -\u003E !ts.boolean\n      ts.Condition(%16) : \n    },  {\n      %14 = ts.Load(%11) : !ts.ref&lt;i32\u003E -\u003E i32\n      %15 = ts.PrefixUnary %14(45) : i32 -\u003E i32\n      \"ts.Result\"() : () -\u003E ()\n    })  {\n      %14 = ts.Load(%11) : !ts.ref&lt;i32\u003E -\u003E i32\n      %15 = ts.ElementRef %9[%14] : !ts.const_array&lt;!ts.array&lt;i32\u003E,3\u003E[i32] -\u003E !ts.ref&lt;!ts.array&lt;i32\u003E\u003E\n      %16 = ts.Load(%15) : !ts.ref&lt;!ts.array&lt;i32\u003E\u003E -\u003E !ts.array&lt;i32\u003E\n      %17 = ts.UnresolvedSymbolRef {identifier = @print} : none\n      %18 = ts.Constant {value = \"array\"} : !ts.string\n      ts.Print(%18) : !ts.string\n      %19 = ts.Constant {value = 0 : i32} : i32\n      %20 = ts.Variable(%19) {false} : i32 -\u003E !ts.ref&lt;i32\u003E\n      ts.For :  -\u003E ( {\n        %21 = ts.Load(%20) : !ts.ref&lt;i32\u003E -\u003E i32\n        %22 = ts.Load(%15) : !ts.ref&lt;!ts.array&lt;i32\u003E\u003E -\u003E !ts.array&lt;i32\u003E\n        %23 = \"ts.LengthOf\"(%22) : (!ts.array&lt;i32\u003E) -\u003E i32\n        %24 = ts.LogicalBinary %21(29) %23 : i32, i32 -\u003E !ts.boolean\n        ts.Condition(%24) : \n      },  {\n        %21 = ts.Load(%20) : !ts.ref&lt;i32\u003E -\u003E i32\n        %22 = ts.PrefixUnary %21(45) : i32 -\u003E i32\n        \"ts.Result\"() : () -\u003E ()\n      })  {\n        %21 = ts.Load(%20) : !ts.ref&lt;i32\u003E -\u003E i32\n        %22 = ts.Load(%15) : !ts.ref&lt;!ts.array&lt;i32\u003E\u003E -\u003E !ts.array&lt;i32\u003E\n        %23 = ts.ElementRef %22[%21] : !ts.array&lt;i32\u003E[i32] -\u003E !ts.ref&lt;i32\u003E\n        %24 = ts.Load(%23) : !ts.ref&lt;i32\u003E -\u003E i32\n        %25 = ts.UnresolvedSymbolRef {identifier = @print} : none\n        ts.Print(%24) : i32\n        \"ts.Result\"() : () -\u003E ()\n      }\n      \"ts.Result\"() : () -\u003E ()\n    }\n    %12 = ts.UnresolvedSymbolRef {identifier = @print} : none\n    %13 = ts.Constant {value = \"done.\"} : !ts.string\n    ts.Print(%13) : !ts.string\n    \"ts.Exit\"() : () -\u003E ()\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EЗахват переменных функциями\u003C\u002Fh2\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction func_in_object(a: number | undefined) {\n    const s = {\n        f() {\n            assert(a == 11);\n            print(a);\n        },\n    };\n\n    s.f();\n}\n\nfunction main() {\n    func_in_object(11);\n    print(\"done.\");\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EРезультат работы:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\temp\u003EC:\\tsc.exe --emit=jit -nogc example1.ts  \n11\ndone.\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ данном примере, передается параметр \"\u003Cstrong\u003Ea\u003C\u002Fstrong\u003E\" с типом \"\u003Cstrong\u003Enumber | undefined\u003C\u002Fstrong\u003E\". Это значит, что, \"\u003Cstrong\u003Eа\"\u003C\u002Fstrong\u003E может быть опциональный т.е. аналог \"\u003Cstrong\u003Ea?: number\u003C\u002Fstrong\u003E\". Далее этот параметр будет захвачен в функции \"\u003Cstrong\u003Ef()\u003C\u002Fstrong\u003E\" которая будет принадлежать абстрактному объекту \"\u003Cstrong\u003Es\u003C\u002Fstrong\u003E\"\u003C\u002Fp\u003E\u003Cp\u003EИ давайте посмотрим какой псевдокод будет сгенерирован в данном примере\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"C:\\\\temp\\\\1.ts\"  {\n  ts.Func @__uf14725333033948923702 (!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E () {arg_attrs = [{ts.nest}, {}], sym_visibility = \"private\", ts.nest}  {\n  ^bb0(%arg0: !ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, %arg1: !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E):  \u002F\u002F no predecessors\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = \"ts.Param\"(%arg1) : (!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E !ts.ref&lt;!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E\u003E\n    %1 = ts.PropertyRef %arg0&lt;0\u003E : !ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E -\u003E !ts.ref&lt;!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\u003E\n    %2 = ts.Load(%1) : !ts.ref&lt;!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\u003E -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    %3 = ts.UnresolvedSymbolRef {identifier = @assert} : none\n    %4 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    %5 = ts.Constant {value = 11 : i32} : i32\n    %6 = ts.Cast %4 : !ts.optional&lt;!ts.number\u003E to i32\n    %7 = ts.LogicalBinary %6(34) %5 : i32, i32 -\u003E !ts.boolean\n    ts.Assert %7, \"assert\"\n    %8 = ts.UnresolvedSymbolRef {identifier = @print} : none\n    %9 = ts.Load(%2) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    ts.Print(%9) : !ts.optional&lt;!ts.number\u003E\n    \"ts.Exit\"() : () -\u003E ()\n  }\n  ts.Func @func_in_object (!ts.optional&lt;!ts.number\u003E) -\u003E () {sym_visibility = \"private\"}  {\n  ^bb0(%arg0: !ts.optional&lt;!ts.number\u003E):  \u002F\u002F no predecessors\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = \"ts.Param\"(%arg0) : (!ts.optional&lt;!ts.number\u003E) -\u003E !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E\n    %1 = ts.SymbolRef {identifier = @__uf14725333033948923702} : (!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\n    %2 = ts.Load(%0) : !ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E -\u003E !ts.optional&lt;!ts.number\u003E\n    %3 = \"ts.Capture\"(%0) : (!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E) -\u003E !ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E\n    %4 = \"ts.Trampoline\"(%1, %3) {allocInHeap = false} : ((!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E (), !ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E) -\u003E ((!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ())\n    %5 = ts.Constant {value = [unit]} : !ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E\n    %6 = ts.Variable(%5) {false} : !ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E -\u003E !ts.ref&lt;!ts.tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E\u003E\n    %7 = ts.PropertyRef %6&lt;0\u003E : !ts.ref&lt;!ts.tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E\u003E -\u003E !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E\n    %8 = ts.Load(%7) : !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E -\u003E !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E,!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E\n    %9 = ts.Cast %4 : (!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E () to (!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\n    ts.Store %9, %7 : (!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E () -\u003E !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E\n    %10 = ts.Load(%6) : !ts.ref&lt;!ts.tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E\u003E -\u003E !ts.tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E\n    %11 = ts.PropertyRef %6&lt;0\u003E : !ts.ref&lt;!ts.tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()}\u003E\u003E -\u003E !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E\n    %12 = ts.Load(%11) : !ts.bound_ref&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E -\u003E !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E,!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E\n    %13 = ts.GetThis %12 : !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E,!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E -\u003E !ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E\n    %14 = ts.GetMethod %12 : !ts.this_func&lt;(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E,!ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\u003E -\u003E (!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\n    %15 = ts.Undef : !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E\n    ts.CallIndirect %14(%13, %15) : (!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.object&lt;!ts.const_tuple&lt;{\"f\",(!ts.ref&lt;!ts.tuple&lt;{\"a\",!ts.ref&lt;!ts.optional&lt;!ts.number\u003E\u003E}\u003E\u003E, !ts.opaque) -\u003E ()}\u003E\u003E) -\u003E ()\n    \"ts.Exit\"() : () -\u003E ()\n  }\n  ts.Func @main () -\u003E ()  {\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = ts.SymbolRef {identifier = @func_in_object} : (!ts.optional&lt;!ts.number\u003E) -\u003E ()\n    %1 = ts.Constant {value = 11 : i32} : i32\n    %2 = ts.Cast %1 : i32 to !ts.optional&lt;!ts.number\u003E\n    ts.CallIndirect %0(%2) : (!ts.optional&lt;!ts.number\u003E) -\u003E ()\n    %3 = ts.UnresolvedSymbolRef {identifier = @print} : none\n    %4 = ts.Constant {value = \"done.\"} : !ts.string\n    ts.Print(%4) : !ts.string\n    \"ts.Exit\"() : () -\u003E ()\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИнтересующие строки, где псевдокоманды, которые нас интересуют, имеют имена \"\u003Cstrong\u003Ets.Capture\u003C\u002Fstrong\u003E\" и \"\u003Cstrong\u003Ets.Trampoline\u003C\u002Fstrong\u003E\". Первая команда захватывает ссылку на объект или значение, а вторая команда создает виртуальную функцию, которая будет получать объект, содержащий ссылку на переменную \"\u003Cstrong\u003Eа\u003C\u002Fstrong\u003E\"\u003C\u002Fp\u003E\u003Ch2\u003EИнтерфейсы по требованию\u003C\u002Fh2\u003E\u003Cp\u003EВ этом параграфе мы рассмотрим пример, который покажет, как можно создавать интерфейсы из классов, которые не задекларированы на уровне класса\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eclass S {\n\u002F\u002F нам не нужно указывать наличие интерфейса в декларации\n\u002F\u002F class S implements IPrn\n    print() {\n        print(\"Hello World\");\n    }\n}\n\ninterface IPrn {\n    print();\n}\n\nfunction run(iface: IPrn) {\n    iface.print();\n}\n\nfunction main() {\n    const s = new S();\n    let iface = &lt;IPrn\u003Es;\n    iface.print();\n    run(s);\n\n    print(\"done.\");\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ этом коде мы создаем экземпляр интерфейса \"\u003Cstrong\u003EIPrn\u003C\u002Fstrong\u003E\" который не объявлен в классе \"\u003Cstrong\u003ES\u003C\u002Fstrong\u003E\" как это обычно требуется в С++\u003C\u002Fp\u003E\u003Ch2\u003EИспользование yield в генераторах\u003C\u002Fh2\u003E\u003Cp\u003EПример использования \"\u003Cstrong\u003Eyield\u003C\u002Fstrong\u003E\".\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction* foo() {\n    let i = 1;\n    while (i &lt; 3) {\n        yield ++i;\n    }\n}\n\nfunction main() {\n    for (const o of foo3()) {\n        print(o);\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EРезультат выполнения кода\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\\u003Etsc.exe --emit=jit -nogc example1.ts  \n2\n3\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EПримеры с использованием async\u002Fawait\u003C\u002Fh2\u003E\u003Cp\u003EВ этом параграфе я покажу два примера с \u003Cstrong\u003Easync\u002Fawait\u003C\u002Fstrong\u003E и \u003Cstrong\u003Efor await\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Easync function f(a = 1) {\n    return a;\n}\n\nfunction main() {\n    const v = await f(2);\n    print(v);\n    print(\"done.\");\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДавайте посмотрим на сгенерированный псевдокод \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"C:\\\\temp\\\\1.ts\"  {\n  ts.Func @f (!ts.optional&lt;i32\u003E) -\u003E i32 {sym_visibility = \"private\"}  {\n  ^bb0(%arg0: !ts.optional&lt;i32\u003E):  \u002F\u002F no predecessors\n    %0 = \"ts.Entry\"() : () -\u003E !ts.ref&lt;i32\u003E\n    %1 = \"ts.ParamOpt\"(%arg0) ( {\n      %3 = ts.Constant {value = 1 : i32} : i32\n      ts.DefaultValue %3 : i32\n    }) : (!ts.optional&lt;i32\u003E) -\u003E !ts.ref&lt;i32\u003E\n    %2 = ts.Load(%1) : !ts.ref&lt;i32\u003E -\u003E i32\n    \"ts.ReturnVal\"(%2, %0) : (i32, !ts.ref&lt;i32\u003E) -\u003E ()\n    \"ts.Exit\"() : () -\u003E ()\n  }\n  ts.Func @main () -\u003E ()  {\n    \"ts.Entry\"() : () -\u003E ()\n    %token, %results = async.execute -\u003E !async.value&lt;i32\u003E {\n      %4 = ts.SymbolRef {identifier = @f} : (!ts.optional&lt;i32\u003E) -\u003E i32\n      %5 = ts.Constant {value = 2 : i32} : i32\n      %6 = ts.Cast %5 : i32 to !ts.optional&lt;i32\u003E\n      %7 = ts.CallIndirect %4(%6) : (!ts.optional&lt;i32\u003E) -\u003E i32\n      async.yield %7 : i32\n    }\n    %0 = async.await %results : !async.value&lt;i32\u003E\n    %1 = ts.UnresolvedSymbolRef {identifier = @print} : none\n    ts.Print(%0) : i32\n    %2 = ts.UnresolvedSymbolRef {identifier = @print} : none\n    %3 = ts.Constant {value = \"done.\"} : !ts.string\n    ts.Print(%3) : !ts.string\n    \"ts.Exit\"() : () -\u003E ()\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ второй пример с \u003Cstrong\u003Efor\u002Fawait\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Efunction main() {\n    for await (const v of [1, 2, 3, 4, 5]) {\n        print(v);\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eсгенерированный псевдокод\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Emodule @\"C:\\\\temp\\\\1.ts\"  {\n  ts.Func @main () -\u003E ()  {\n    \"ts.Entry\"() : () -\u003E ()\n    %0 = ts.Constant {value = 1 : i32} : i32\n    %1 = ts.Constant {value = 2 : i32} : i32\n    %2 = ts.Constant {value = 3 : i32} : i32\n    %3 = ts.Constant {value = 4 : i32} : i32\n    %4 = ts.Constant {value = 5 : i32} : i32\n    %5 = ts.Constant {value = [1 : i32, 2 : i32, 3 : i32, 4 : i32, 5 : i32]} : !ts.const_array&lt;i32,5\u003E\n    %6 = ts.Constant {value = 0 : i32} : i32\n    %7 = ts.Variable(%6) {false} : i32 -\u003E !ts.ref&lt;i32\u003E\n    %8 = async.create_group\n    ts.For :  -\u003E ( {\n      %9 = ts.Load(%7) : !ts.ref&lt;i32\u003E -\u003E i32\n      %10 = ts.Constant {value = 5 : i32} : i32\n      %11 = ts.LogicalBinary %9(29) %10 : i32, i32 -\u003E !ts.boolean\n      ts.Condition(%11) : \n    },  {\n      %9 = ts.Load(%7) : !ts.ref&lt;i32\u003E -\u003E i32\n      %10 = ts.PrefixUnary %9(45) : i32 -\u003E i32\n      \"ts.Result\"() : () -\u003E ()\n    })  {\n      %9 = ts.Load(%7) : !ts.ref&lt;i32\u003E -\u003E i32\n      %token = async.execute {\n        %11 = ts.ElementRef %5[%9] : !ts.const_array&lt;i32,5\u003E[i32] -\u003E !ts.ref&lt;i32\u003E\n        %12 = ts.Load(%11) : !ts.ref&lt;i32\u003E -\u003E i32\n        %13 = ts.UnresolvedSymbolRef {identifier = @print} : none\n        ts.Print(%12) : i32\n        async.yield\n      }\n      %10 = async.add_to_group %token, %8 : !async.token\n      \"ts.Result\"() : () -\u003E ()\n    }\n    async.await_all %8\n    \"ts.Exit\"() : () -\u003E ()\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИнтересующие нас команды в этом коде это \"\u003Cstrong\u003Easync.execute\u003C\u002Fstrong\u003E\" которые берут всю ответственность за выполнение кода асинхронно на себя\u003C\u002Fp\u003E\u003Cp\u003EХочется добавить, что чтобы запустить данный код нам нужна поддержка \"\u003Cstrong\u003Eruntime\u003C\u002Fstrong\u003E\". \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EC:\\\u003Etsc.exe --emit=jit --shared-libs=TypeScriptRuntime.dll example1.ts  \n1\n2\n3\n4\n5\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКак мы видим из исполняемой строки что бы активировать \"\u003Cstrong\u003Eruntime\u003C\u002Fstrong\u003E\" нужно указать параметр \"--shared-libs=TypeScriptRuntime.dll\". Для компиляции в LLVM IR данный параметр не нужен, но если мы хотим получить \u003Cstrong\u003Eobj-файл\u003C\u002Fstrong\u003E с использованием --emit=jit тогда \"runtime\" нужно указывать. Также \"\u003Cstrong\u003Eruntime\u003C\u002Fstrong\u003E\" нужно указывать при использовании \"\u003Cstrong\u003EGarbage Collector\u003C\u002Fstrong\u003E\" (сборщика мусора)\u003C\u002Fp\u003E\u003Ch2\u003EПримеры Batch-файлов для компиляции Exe-файлов\u003C\u002Fh2\u003E\u003Cp\u003EКомпиляция, когда не нужна поддержка GC, async и захвата переменных.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eset FILENAME=%1\nset LLVMPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\bin\nset TSCPATH=C:\\dev\\TypeScriptCompiler\\__build\\tsc\\bin\nset LIBPATH=\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.29.30133\\lib\\x64\"\nset SDKPATH=\"C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\um\\x64\"\nset UCRTPATH=\"C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\ucrt\\x64\"\nset LLVMLIBPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\lib\n%TSCPATH%\\tsc.exe --emit=llvm -nogc C:\\temp\\%FILENAME%.ts 2\u003E%FILENAME%.ll\n%LLVMPATH%\\llc.exe --filetype=obj -o=%FILENAME%.o %FILENAME%.ll\n%LLVMPATH%\\lld.exe -flavor link %FILENAME%.o \u002Flibpath:%LIBPATH% \u002Flibpath:%SDKPATH% \u002Flibpath:%UCRTPATH% \u002Fdefaultlib:libcmt.lib libvcruntime.lib\ndel %FILENAME%.o\n\necho \"RUN:...\"\n%FILENAME%.exe\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКомпиляция, когда нужна поддержка захвата переменных\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eset FILENAME=%1\nset LLVMPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\bin\nset TSCPATH=C:\\dev\\TypeScriptCompiler\\__build\\tsc\\bin\nset LIBPATH=\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.29.30133\\lib\\x64\"\nset SDKPATH=\"C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\um\\x64\"\nset UCRTPATH=\"C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\ucrt\\x64\"\nset CLANGLIBPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\lib\\clang\\13.0.0\\lib\\windows\n%TSCPATH%\\tsc.exe --emit=llvm -nogc C:\\temp\\%FILENAME%.ts 2\u003E%FILENAME%.ll\n%LLVMPATH%\\llc.exe --filetype=obj -o=%FILENAME%.o %FILENAME%.ll\n%LLVMPATH%\\lld.exe -flavor link %FILENAME%.o \u002Flibpath:%LIBPATH% \u002Flibpath:%SDKPATH% \u002Flibpath:%UCRTPATH% \u002Flibpath:%CLANGLIBPATH% \u002Fdefaultlib:libcmt.lib libvcruntime.lib clang_rt.builtins-x86_64.lib\ndel %FILENAME%.o\n\necho \"RUN:...\"\n%FILENAME%.exe\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКомпиляция если нужна поддержка \u003Cstrong\u003EGC\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eset FILENAME=%1\nset LLVMPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\bin\nset TSCPATH=C:\\dev\\TypeScriptCompiler\\__build\\tsc\\bin\nset LIBPATH=\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.29.30133\\lib\\x64\"\nset SDKPATH=\"C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\um\\x64\"\nset UCRTPATH=\"C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\ucrt\\x64\"\nset LLVMLIBPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\lib\nset GCLIBPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\gc\\Release\n%TSCPATH%\\tsc.exe --emit=llvm C:\\temp\\%FILENAME%.ts 2\u003E%FILENAME%.ll\n%LLVMPATH%\\llc.exe --filetype=obj -o=%FILENAME%.o %FILENAME%.ll\n%LLVMPATH%\\lld.exe -flavor link %FILENAME%.o \u002Flibpath:%LIBPATH% \u002Flibpath:%SDKPATH% \u002Flibpath:%UCRTPATH% \u002Flibpath:%GCLIBPATH% msvcrt.lib ucrt.lib kernel32.lib user32.lib gcmt-lib.lib\ndel %FILENAME%.o\n\necho \"RUN:...\"\n%FILENAME%.exe\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПример компиляции на \u003Cstrong\u003EUbuntu\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E#\u002Fbin\u002Fsh\n.\u002Ftsc --emit=mlir-llvm -nogc \u002Fmnt\u002Fc\u002Ftemp\u002F1.ts -debug-only=llvm 2\u003E1d.mlir\n.\u002Ftsc --emit=llvm -nogc \u002Fmnt\u002Fc\u002Ftemp\u002F1.ts 2\u003E1.ll\nllc --filetype=obj --relocation-model=pic -o=1.o 1.ll\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ если нужна поддержка  \u003Cstrong\u003Etry\u002Fcatch\u002Ffinally\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E#\u002Fbin\u002Fsh\n.\u002Ftsc --emit=llvm -nogc \u002Fmnt\u002Fc\u002Ftemp\u002F1.ts 2\u003E1.ll\nllc --filetype=obj --relocation-model=pic -o=1.o 1.ll\ngcc -o 1.out 1.o -frtti -fexceptions -lstdc++\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПример компиляции для \u003Cstrong\u003EWASM\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Eset FILENAME=%1\nset LLVMPATH=C:\\dev\\TypeScriptCompiler\\3rdParty\\llvm\\release\\bin\nset TSCPATH=C:\\dev\\TypeScriptCompiler\\__build\\tsc\\bin\n%TSCPATH%\\tsc.exe --emit=llvm C:\\temp\\%FILENAME%.ts 2\u003E%FILENAME%.ll\n%LLVMPATH%\\llc.exe -mtriple=wasm32-unknown-unknown -O3 --filetype=obj -o=%FILENAME%.o %FILENAME%.ll\n%LLVMPATH%\\wasm-ld.exe %FILENAME%.o -o %FILENAME%.wasm --no-entry --export-all --allow-undefined\ndel *.o\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EБольше примеров batch-файлов можно посмотреть тут \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FASDAlexander77\u002FTypeScriptCompiler\u002Ftree\u002Fmain\u002Fdocs\u002Fhow\" rel=\"noopener noreferrer nofollow\"\u003ETypeScriptCompiler\u002Fdocs\u002Fhow at main · ASDAlexander77\u002FTypeScriptCompiler (github.com)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Ch2\u003EЗаключение\u003C\u002Fh2\u003E\u003Cp\u003EЯ рекомендую заглянуть в репозиторий проекта в папку test что бы посмотреть примеры кодов, которые могут быть скомпилированы \u003Cstrong\u003Etsc.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FASDAlexander77\u002FTypeScriptCompiler\u002Ftree\u002Fmain\u002Ftsc\u002Ftest\u002Ftester\u002Ftests\" rel=\"noopener noreferrer nofollow\"\u003ETypeScriptCompiler\u002Ftsc\u002Ftest\u002Ftester\u002Ftests at main · ASDAlexander77\u002FTypeScriptCompiler (github.com)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003EЕсли Вам понравился данный проект, то дайте мне знать какую информацию Вы бы хотели еще узнать.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"компиляторы"},{"titleHtml":"typescript"},{"titleHtml":"native code"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F11d\u002Fbe2\u002F7d5\u002F11dbe27d50b78cc8878084837268e92f.gif","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F11d\u002Fbe2\u002F7d5\u002F11dbe27d50b78cc8878084837268e92f.gif","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583862\\\u002F\"},\"headline\":\"Обзор возможностей TypeScript Native (AOT) Compiler\",\"datePublished\":\"2021-10-18T11:00:02+03:00\",\"dateModified\":\"2021-10-18T14:04:32+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"AlexD_77\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F581308\\\u002F. В данной статье мне...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F583862\\\u002F#post-content-body\",\"about\":[\"h_compilers\",\"h_typescript\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F583862\\\u002F92a2ab64a29ac2771de166026085db80\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F11d\\\u002Fbe2\\\u002F7d5\\\u002F11dbe27d50b78cc8878084837268e92f.gif\"]}","metaDescription":"АбстрактДанная статья является продолжением предыдущей статьи о TypeScript Native (AOT) Compiler(далее tsc) https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F581308\u002F. В данной статье мне хотелось бы остановиться на обзоре...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"compilers,typescript"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
