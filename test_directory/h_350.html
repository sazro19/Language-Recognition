<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Погода бот на python / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/584134\/"},"headline":"Погода бот на python","datePublished":"2021-10-18T16:42:48+03:00","dateModified":"2021-10-21T10:08:09+03:00","author":{"@type":"Person","name":"Gerel_Dan"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь на...","url":"https:\/\/habr.com\/ru\/post\/584134\/#post-content-body","about":["h_python","h_api","f_develop"],"image":["https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/eb7\/21d\/49e\/eb721d49eda1e0725d7e26973206ec8b.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/0c0\/309\/07c\/0c030907cc39bcb2021997513d4a7534.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/674\/026\/0ad\/6740260ad0ed2e648857b22201e713e8.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6b7\/8c0\/9aa\/6b78c09aa1a652ca857105d5d1e83706.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4a6\/090\/147\/4a6090147d255687d201060c0496aff3.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/7dd\/901\/d2f\/7dd901d2faa9e6d4e31936a979412cfb.jpg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Погода бот на python" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Погода бот на python" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Погода бот на python" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь нам нужна среда разработки для меня это..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь нам нужна среда разработки для меня это..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь нам нужна среда разработки для меня это..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь нам нужна среда разработки для меня это..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь нам нужна среда разработки для меня это..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/584134/e5ff35ea34ed288c8223b4759c2c41f0/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/584134/e5ff35ea34ed288c8223b4759c2c41f0/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/584134/e5ff35ea34ed288c8223b4759c2c41f0/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/584134/e5ff35ea34ed288c8223b4759c2c41f0/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/584134/e5ff35ea34ed288c8223b4759c2c41f0/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="584134" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-18T13:42:48.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/584134/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/584134/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/584134/e5ff35ea34ed288c8223b4759c2c41f0/" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/584134/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Gerel_Dan/" title="Gerel_Dan" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/Gerel_Dan/" class="tm-user-info__username">
      Gerel_Dan
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-18T13:42:48.000Z" title="2021-10-18, 16:42">18  октября   в 16:42</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Погода бот на python</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/python/" class="tm-article-snippet__hubs-item-link"><span>Python</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/api/" class="tm-article-snippet__hubs-item-link"><span>API</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Из песочницы
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.</p><p>В первую очередь нам нужна среда разработки для меня это Pycharm от нашей питерской компании. Установка проста как три рубля поэтому на ней останавливаться не буду.</p><p>Пока устанавливается Pycharm, нужно получить токены:</p><ol><li><p>для бота от телеграмма, </p></li><li><p>для доступа к api accuweather</p></li><li><p>для доступа к api yandex.weather</p></li></ol><p>Итак, для получения токена от телеграмма Вам необходимо написать @BotFather и следовать инструкции (инструкций по созданию телеграмм-бота полно в интернете).</p><p> По accuweather необходимо зарегистрироваться как разработчику на сайте <a href="https://developer.accuweather.com/" rel="noopener noreferrer nofollow">https://developer.accuweather.com/</a> во вкладке <strong>My Apps</strong> добавить новое приложение, <strong>App Name</strong> это соответственно имя, далее выбираем <strong>Limited Trial</strong>, <strong>Where will the API be used</strong>? Выбираем Other, <strong>What will you be creating with this API</strong>? Выбираем Internal App и Weather App, <strong>What programming language is your APP written in?</strong> – Python, <strong>Is this for Business to Business or Business to Consumer use?</strong> - Business to Consumer, <strong>Is this Worldwide or Country specific use?</strong> – Worldwide, или выбираем Russia или та страна в которой планируется использовать, и последний вопрос <strong>What is the public launch date?</strong> Тут все просто дата с которой планируется запустить приложение. И нажимаем <strong>Create App</strong>. После этого вы снова попадете во вкладку My Apps щелкнув по названию своего приложения вы увидите API Key он то Вам и нужен!</p><p>Далее нам нужен токен от яндекса. Если у Вас нет почты от яндекса, то создаем, а потом переходим на сайт <a href="https://developer.tech.yandex.ru/services/" rel="noopener noreferrer nofollow">https://developer.tech.yandex.ru/services/</a> нажимаем подключить API. Выбираем API Яндекс.Погоды там будет всплывающее окно с вводом фамилии имени, название компании, номер телефона, город и нужно выбрать бесплатный тариф погода на вашем. Нажимаем перейти к API, там будет KEY #1 вот он то Вам и нужен.</p><p>Все токены поместим в переменные среды, об этом в конце статьи.</p><p>Запускаем pycharm создаем новый проект.</p><p>Переходим в Main.py и в первую очередь устанавливаем дополнительные библиотеки: </p><p>В нижнем ряду окна нажимаем кнопку Python Packages,  в поиске вводим requests и нажимаем install, тоже повторяем для pyTelegramBotAPI и geopy.</p><p>Затем в main.py импортируем библиотеки и токены:</p><pre><code class="python">import json
import telebot
import requests as req
from geopy import geocoders
from os import environ


token = environ['token_bot']
token_accu = environ['token_accu']
token_yandex = environ['token_yandex']</code></pre><p>Все вся подготовка сделана, теперь переходим к написанию самого бота</p><p>Для того чтобы получить прогноз от accuweather нужен уникальный код города, чтобы его получить нужны его координаты, так же координаты города нам понадобятся при запросе к яндексу, поэтому в первую очередь пишем функцию получения координат через библиотеку geopy:</p><pre><code class="python">def geo_pos(city: str):
    geolocator = geocoders.Nominatim(user_agent="telebot")
    latitude = str(geolocator.geocode(city).latitude)
    longitude = str(geolocator.geocode(city).longitude)
    return latitude, longitude</code></pre><p>Теперь получаем код города:</p><pre><code class="python">def code_location(latitude: str, longitude: str, token_accu: str):
    url_location_key = f'http://dataservice.accuweather.com/locations/v1/cities/geoposition/search?apikey={token_accu}&amp;q={latitude},{longitude}&amp;language=ru'
    resp_loc = req.get(url_location_key, headers={"APIKey": token_accu})
    json_data = json.loads(resp_loc.text)
    code = json_data['Key']
    return code</code></pre><p>На вход функции даем координаты и токен, префикс “f” перед строкой дает нам вставлять значения переменных в нужные места вместо текста. Далее мы отправляем запрос по указанному url и с нужным заголовком. Хоть resp_loc.text и выглядит как стандартный словарь python на самом деле это json-объект, его нужно переделать в словарь, по ключу ‘Key’ получаем код города.</p><p>После этого можно написать уже код получения непосредственно прогноза:</p><pre><code class="python">def weather(cod_loc: str, token_accu: str):
    url_weather = f'http://dataservice.accuweather.com/forecasts/v1/hourly/12hour/{cod_loc}?apikey={token_accu}&amp;language=ru&amp;metric=True'
    response = req.get(url_weather, headers={"APIKey": token_accu})
    json_data = json.loads(response.text)
    dict_weather = dict()
    dict_weather['link'] = json_data[0]['MobileLink']
    dict_weather['сейчас'] = {'temp': json_data[0]['Temperature']['Value'], 'sky': json_data[0]['IconPhrase']}
    for i in range(len(json_data):1:):
        time = 'через' + str(i) + 'ч'
        dict_weather[time] = {'temp': json_data[i]['Temperature']['Value'], 'sky': json_data[i]['IconPhrase']}
return dict_weather</code></pre><p>По ключу ‘link’ сохраним ссылку на полный прогноз, сохраним погоду сейчас, далее нам понадобится в цикле перебрать оставшиеся часы и так же сохранить их в словаре.</p><p>Далее нам нужно получить погоду от яндекса:</p><pre><code class="python">def yandex_weather(latitude, longitude, token_yandex: str):
    url_yandex = f'https://api.weather.yandex.ru/v2/informers/?lat={latitude}&amp;lon={longitude}&amp;[lang=ru_RU]'
    yandex_req = req.get(url_yandex, headers={'X-Yandex-API-Key': token_yandex}, verify=False)
    conditions = {'clear': 'ясно', 'partly-cloudy': 'малооблачно', 'cloudy': 'облачно с прояснениями',
                  'overcast': 'пасмурно', 'drizzle': 'морось', 'light-rain': 'небольшой дождь',
                  'rain': 'дождь', 'moderate-rain': 'умеренно сильный', 'heavy-rain': 'сильный дождь',
                  'continuous-heavy-rain': 'длительный сильный дождь', 'showers': 'ливень',
                  'wet-snow': 'дождь со снегом', 'light-snow': 'небольшой снег', 'snow': 'снег',
                  'snow-showers': 'снегопад', 'hail': 'град', 'thunderstorm': 'гроза',
                  'thunderstorm-with-rain': 'дождь с грозой', 'thunderstorm-with-hail': 'гроза с градом'
                  }
    wind_dir = {'nw': 'северо-западное', 'n': 'северное', 'ne': 'северо-восточное', 'e': 'восточное',
                'se': 'юго-восточное', 's': 'южное', 'sw': 'юго-западное', 'w': 'западное', 'с': 'штиль'}

    yandex_json = json.loads(yandex_req.text)
    yandex_json['fact']['condition'] = conditions[yandex_json['fact']['condition']]
    yandex_json['fact']['wind_dir'] = wind_dir[yandex_json['fact']['wind_dir']]
    for parts in yandex_json['forecast']['parts']:
        parts['condition'] = conditions[parts['condition']]
        parts['wind_dir'] = wind_dir[parts['wind_dir']]

    pogoda = dict()
    params = ['condition', 'wind_dir', 'pressure_mm', 'humidity']
    for parts in yandex_json['forecast']['parts']:
        pogoda[parts['part_name']] = dict()
        pogoda[parts['part_name']]['temp'] = parts['temp_avg']
        for param in params:
            pogoda[parts['part_name']][param] = parts[param]

    pogoda['fact'] = dict()
    pogoda['fact']['temp'] = yandex_json['fact']['temp']
    for param in params:
        pogoda['fact'][param] = yandex_json['fact'][param]

    pogoda['link'] = yandex_json['info']['url']
    return pogoda</code></pre><p>Начинаем стандартно, но есть нюанс направление ветра и состояние неба в ответе от яндекса пишется на английском языке, делаем словари conditions и wind_dir для перевода. В ответе только фактическая погода и прогноз на следующих два периода (можно сделать и более подробно, но в бесплатном варианте только так).  Сразу в словаре меняем направление ветра и состояние неба. Далее создаем новый словарь и забираем только то что нам нужно из всего ответа. При отладке кода стоит отметить, что в бесплатной версии api яндекса допускается только 50 запросов в сутки.</p><p>Далее нам стоит написать функции которые будут отправлять ответом прогнозы. Начнем с аккувезер:</p><pre><code class="python">def print_weather(dict_weather, message):
    bot.send_message(message.from_user.id, f'Разрешите доложить, Ваше сиятельство!'
                                           f' Температура сейчас {dict_weather["сейчас"]["temp"]}!'
                                           f' А на небе {dict_weather["сейчас"]["sky"]}.'
                                           f' Температура через три часа {dict_weather["через3ч"]["temp"]}!'
                                           f' А на небе {dict_weather["через3ч"]["sky"]}.'
                                           f' Температура через шесть часов {dict_weather["через6ч"]["temp"]}!'
                                           f' А на небе {dict_weather["через6ч"]["sky"]}.'
                                           f' Температура через девять часов {dict_weather["через9ч"]["temp"]}!'
                                           f' А на небе {dict_weather["через9ч"]["sky"]}.')
    bot.send_message(message.from_user.id, f' А здесь ссылка на подробности '
                                           f'{dict_weather["link"]}')</code></pre><p>В эту функцию мы должны погрузить вывод функции weather и сообщение на которое мы отвечаем. В самой функции мы отправляем сообщение с текстом и ссылками на тот словарь из функции weather.  В конце отправляем сообщение со ссылкой на полный прогноз.</p><p>Далее делаем сообщение с погодой от яндекса:</p><pre><code class="python">def print_yandex_weather(dict_weather_yandex, message):
    day = {'night': 'ночью', 'morning': 'утром', 'day': 'днем', 'evening': 'вечером', 'fact': 'сейчас'}
    bot.send_message(message.from_user.id, f'А яндекс говорит:')
    for i in dict_weather_yandex.keys():
        if i != 'link':
            time_day = day[i]
            bot.send_message(message.from_user.id, f'Температура {time_day} {dict_weather_yandex[i]["temp"]}'
                                                   f', на небе {dict_weather_yandex[i]["condition"]}')

    bot.send_message(message.from_user.id, f' А здесь ссылка на подробности '
                                           f'{dict_weather_yandex["link"]}')</code></pre><p>здесь так же скармливаем функции выход функции yandex_weather и сообщение на которое отвечаем. Здесь создаем словарь с переводом времени дня, затем отправляем сообщение, далее задаем цикл по ключам словаря из выхода функции yandex_weather если ключ не link то отправляем сообщение: температура {время дня}, на небе {состояние неба}. В конце отправляем ссылку на яндекс (это требование яндекса).</p><p>И наконец обобщающая функция:</p><pre><code class="python">def big_weather(message, city):
    latitude, longitude = geo_pos(city)
    cod_loc = code_location(latitude, longitude, token_accu)
    you_weather = weather(cod_loc, token_accu)
    print_weather(you_weather, message)
    yandex_weather_x = yandex_weather(latitude, longitude, token_yandex)
    print_yandex_weather(yandex_weather_x, message)</code></pre><p>В нее мы погружаем сообщение и город. Определяем координаты, запрашиваем accuweather и пишем сообщение на основе данных от него, потом тоже самое от яндекса.</p><p>Нужна ещё функция сохранения городов:</p><pre><code class="python">def add_city(message):
    try:
        latitude, longitude = geo_pos(message.text.lower().split('город ')[1])
        global cities
        cities[message.from_user.id] = message.text.lower().split('город ')[1]
        with open('cities.json', 'w') as f:
            f.write(json.dumps(cities))
        return cities, 0
    except Exception as err:
        return cities, 1</code></pre><p>Сперва проверяем существование такого города если все ок то все что после слова город сохраняем в словарь cities под ключом id пользователя. Можно было бы использовать имя, но это только если Вы уверены, что сервисом будут пользоваться люди с разными именами.</p><p>Так все вспомогательные функции мы описали теперь функции ответа на сообщения:</p><pre><code class="python">@bot.message_handler(command=['start', 'help'])
def send_welcome(message):
    bot.reply_to(message, f'Я погодабот, приятно познакомитсья, {message.from_user.first_name}')</code></pre><p>Здесь мы просто представляемся при первом посещении.</p><p>А вот и самая большая функция:</p><pre><code class="python">bot.message_handler(content_types=['text'])
def get_text_messages(message):
    global cities
    if message.text.lower() == 'привет' or message.text.lower() == 'здорова':
        bot.send_message(message.from_user.id,
                         f'О великий и могучий {message.from_user.first_name}! Позвольте Я доложу '
                         f' Вам о погоде! Напишите  слово "погода" и я напишу погоду в Вашем'
                         f' "стандартном" городе или напишите название города в котором Вы сейчас')
    elif message.text.lower() == 'погода':
        if message.from_user.id in cities.keys():
            city = cities[message.from_user.id]
            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'
                                                   f' Твой город {city}')
            big_weather(message, city)

        else:
            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'
                                                   f' Я не знаю Ваш город! Просто напиши:'
                                                   f'"Мой город *****" и я запомню твой стандартный город!')
    elif message.text.lower()[:9] == 'мой город':
        cities, flag = add_city(message)
        if flag == 0:
            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'
                                                   f' Теперь я знаю Ваш город! это'
                                                   f' {cities[str(message.from_user.id)]}')
        else:
            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'
                                                   f' Что то пошло не так :(')
    else:
        try:
            city = message.text
            bot.send_message(message.from_user.id, f'Привет {message.from_user.first_name}! Твой город {city}')
            big_weather(message, city)
            except AttributeError as err:
            bot.send_message(message.from_user.id, f'{message.from_user.first_name}! Не вели казнить,'
                                                   f' вели слово молвить! Я не нашел такого города!'
                                                   f'И получил ошибку {err}, попробуй другой город')
</code></pre><p>В первой части если автор сообщения сказал «привет» или «здарова» мы просто здороваемся и напоминаем, то что мы ждем от автора сообщения.</p><p> Если написал «погода» то уточняемся есть ли он в нашем списке и если есть, то сообщаем название города и выполняем функцию big_weather.</p><p>Если пользователя нет, то предлагаем ему задать его стандартный город.</p><p>Если пользователь написал «Мой город *****», то пользователя. И сообщаем что город записан, если что-то пошло не так, то сообщаем об этом.</p><p>Во всех остальных случаях мы сообщение воспринимаем как название города. Если города такого не находится то сообщаем об этом.</p><p>ну и собственно нам нужно записать всю программу (это наверное самое короткое):</p><pre><code class="python">bot = telebot.TeleBot(token)

with open('cities.json', encoding='utf-8') as f:
    cities = json.load(f)
    
bot.polling(none_stop=True)</code></pre><p>Здесь мы создаем объект bot, потом открываем json файл с архивом городов и id пользователей. И наконец запускаем в бесконечном цикле бота. </p><p>На этом можно закончить, но в целом функционал можно расширять, можно было бы добавить гисметео или rp5, но у этих товарищей нет бесплатных версий прогноза L.</p><p><a href="https://github.com/gerelDan/tele_karamaz_weather" rel="noopener noreferrer nofollow">Вот ссылка на gitHub</a>.</p><p>И теперь нам нужно все это запустить на сервере.</p><p>Для этого нам нужен собственно сам сервер я например арендовал на джино, это не реклама просто констатация факта. это обходится 3,19 рублей в день.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/eb7/21d/49e/eb721d49eda1e0725d7e26973206ec8b.jpg" width="1098" height="385" data-src="https://habrastorage.org/getpro/habr/upload_files/eb7/21d/49e/eb721d49eda1e0725d7e26973206ec8b.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Для создания своего аккаунта достаточно иметь аккаунт в google. Для целей телеграмм бота достаточно самого дешевого сервера.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/0c0/309/07c/0c030907cc39bcb2021997513d4a7534.jpg" width="1098" height="546" data-src="https://habrastorage.org/getpro/habr/upload_files/0c0/309/07c/0c030907cc39bcb2021997513d4a7534.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Выберем ось</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/674/026/0ad/6740260ad0ed2e648857b22201e713e8.jpg" width="1119" height="124" data-src="https://habrastorage.org/getpro/habr/upload_files/674/026/0ad/6740260ad0ed2e648857b22201e713e8.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>И нажимаем создать сервер.</p><p>После выделения Вам сервера можно будет попасть в его меню.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/6b7/8c0/9aa/6b78c09aa1a652ca857105d5d1e83706.jpg" width="1119" height="629" data-src="https://habrastorage.org/getpro/habr/upload_files/6b7/8c0/9aa/6b78c09aa1a652ca857105d5d1e83706.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Здесь можно посмотреть обзор сервера его загруженность и самое главное параметры для ssh соединения и задать пароль для root (это нужно сделать обязательно).</p><figure class=""><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/4a6/090/147/4a6090147d255687d201060c0496aff3.jpg" width="482" height="291" data-src="https://habrastorage.org/getpro/habr/upload_files/4a6/090/147/4a6090147d255687d201060c0496aff3.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Для подключения по SSH нам нужна программа putty она бесплатная. Устанавливаем, запускаем и видим окно:</p><figure class=""><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/7dd/901/d2f/7dd901d2faa9e6d4e31936a979412cfb.jpg" width="453" height="442" data-src="https://habrastorage.org/getpro/habr/upload_files/7dd/901/d2f/7dd901d2faa9e6d4e31936a979412cfb.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>В host-name вписываем хост из данных от джино и подключаемся, появляется командная строка вводим логин root нажимаем enter после чего вводим пароль который мы задали ранее.</p><p>Так теперь нам нужно установить python для этого в командной строке пишем</p><p><code>sudo apt install python3</code></p><p>и обновляем pip</p><p><code>sudo apt install python3-pip</code></p><p> Далее устанавливаем все библиотеки которые устанавливали в начале:</p><p><code>pip install requests</code></p><p><code>pip install geopy</code></p><p><code>pip install pyTelegramBotAPI</code></p><p>Переходим в каталог <code>cd /usr/bin/</code></p><p>Создаем каталог <code>mkdir telegrambot/</code></p><p>Открываем командную строку в виндовс </p><p><code>pscp -P (здесь указываем порт джино) C:\(путь к проекту)\ root@"указываем имя сервера":/usr/bin/telegrambot/</code></p><p>Он попросит ввести пароль, вводим пароль от root.</p><p>после копирования переходим на окно putty проверяем что все скопировалось командной ls.</p><p>В начале статьи я писал что токены сохраним в переменные среды. Мне проще было сделать так:</p><ol><li><p>В командной строке винды пишем: <code>pscp -P (здесь указываем порт джино) root@"указываем имя сервера":/etc/environment</code> <code>C:\(путь к проекту)\environment</code></p></li><li><p>открываем блокнотом скачанный файл и вписываем наши перменные каждую на отдельной строке:</p><p>token_bot=ваш токен для бота </p><p>token_accu=ваш токен для accuweather</p><p>token_yandex=ваш токен для яндекса</p></li><li><p>Сохраняем</p></li><li><p>Отправляем этот файл обратно:  <code>pscp -P (здесь указываем порт джино) C:\(путь к проекту)\environment root@"указываем имя сервера":/etc/environment</code></p></li></ol><p>Закрываем putty и открываем его снова. Входим как и ранее. для проверки добавления переменных среды в консоли вводим команду export. Должны отобразиться все переменные среды, включая Ваши.</p><p>После чего запускаем python3 <code>/usr/bin/telegrambot/</code>main.py</p><p>Все, телеграм бот работает.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D0%BC-%D0%B1%D0%BE%D1%82%5D" class="tm-tags-list__link">телеграм-бот</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BE%D0%B3%D0%BE%D0%B4%D0%B0-%D0%B1%D0%BE%D1%82%5D" class="tm-tags-list__link">погода-бот</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpython%5D" class="tm-tags-list__link">python</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/python/" class="tm-hubs-list__link">
    Python
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/api/" class="tm-hubs-list__link">
    API
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 11: ↑3 и ↓8</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 11: ↑3 и ↓8" class="tm-votes-meter__value tm-votes-meter__value_negative tm-votes-meter__value_medium">-5</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5.7K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    39
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Gerel_Dan/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 6 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    2
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">-5</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/Gerel_Dan/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Gerel_Dan
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/584134/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 26 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/584134/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/584134/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"584134":{"id":"584134","timePublished":"2021-10-18T13:42:48+00:00","isCorporative":false,"lang":"ru","titleHtml":"Погода бот на python","leadData":{"textHtml":"\u003Cp\u003EНа тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.\u003C\u002Fp\u003E\u003Cp\u003EВ первую очередь нам нужна среда разработки для меня это Pycharm от нашей питерской компании. Установка проста как три рубля поэтому на ней останавливаться не буду.\u003C\u002Fp\u003E\u003Cp\u003EПока устанавливается Pycharm, нужно получить токены:\u003C\u002Fp\u003E\u003Cp\u003E1.&nbsp;для бота от телеграмма, \u003C\u002Fp\u003E\u003Cp\u003E2.&nbsp;для доступа к api accuweather\u003C\u002Fp\u003E\u003Cp\u003E3.&nbsp;для доступа к api yandex.weather\u003C\u002Fp\u003E\u003Cp\u003EИтак, для получения токена от телеграмма Вам необходимо написать @BotFather и следовать инструкции (инструкций по созданию телеграмм-бота полно в интернете).\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"scoreStats":{"score":2,"votesCount":6},"rating":-5,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2775307","alias":"Gerel_Dan","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":26,"favoritesCount":39,"readingCount":5720,"score":-5,"votesCount":11},"hubs":[{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true},{"relatedData":null,"id":"17690","alias":"api","type":"collective","title":"API","titleHtml":"API","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНа тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.\u003C\u002Fp\u003E\u003Cp\u003EВ первую очередь нам нужна среда разработки для меня это Pycharm от нашей питерской компании. Установка проста как три рубля поэтому на ней останавливаться не буду.\u003C\u002Fp\u003E\u003Cp\u003EПока устанавливается Pycharm, нужно получить токены:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003Eдля бота от телеграмма, \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eдля доступа к api accuweather\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eдля доступа к api yandex.weather\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EИтак, для получения токена от телеграмма Вам необходимо написать @BotFather и следовать инструкции (инструкций по созданию телеграмм-бота полно в интернете).\u003C\u002Fp\u003E\u003Cp\u003E По accuweather необходимо зарегистрироваться как разработчику на сайте \u003Ca href=\"https:\u002F\u002Fdeveloper.accuweather.com\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fdeveloper.accuweather.com\u002F\u003C\u002Fa\u003E во вкладке \u003Cstrong\u003EMy Apps\u003C\u002Fstrong\u003E добавить новое приложение, \u003Cstrong\u003EApp Name\u003C\u002Fstrong\u003E это соответственно имя, далее выбираем \u003Cstrong\u003ELimited Trial\u003C\u002Fstrong\u003E, \u003Cstrong\u003EWhere will the API be used\u003C\u002Fstrong\u003E? Выбираем Other, \u003Cstrong\u003EWhat will you be creating with this API\u003C\u002Fstrong\u003E? Выбираем Internal App и Weather App, \u003Cstrong\u003EWhat programming language is your APP written in?\u003C\u002Fstrong\u003E – Python, \u003Cstrong\u003EIs this for Business to Business or Business to Consumer use?\u003C\u002Fstrong\u003E - Business to Consumer, \u003Cstrong\u003EIs this Worldwide or Country specific use?\u003C\u002Fstrong\u003E – Worldwide, или выбираем Russia или та страна в которой планируется использовать, и последний вопрос \u003Cstrong\u003EWhat is the public launch date?\u003C\u002Fstrong\u003E Тут все просто дата с которой планируется запустить приложение. И нажимаем \u003Cstrong\u003ECreate App\u003C\u002Fstrong\u003E. После этого вы снова попадете во вкладку My Apps щелкнув по названию своего приложения вы увидите API Key он то Вам и нужен!\u003C\u002Fp\u003E\u003Cp\u003EДалее нам нужен токен от яндекса. Если у Вас нет почты от яндекса, то создаем, а потом переходим на сайт \u003Ca href=\"https:\u002F\u002Fdeveloper.tech.yandex.ru\u002Fservices\u002F\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fdeveloper.tech.yandex.ru\u002Fservices\u002F\u003C\u002Fa\u003E нажимаем подключить API. Выбираем API Яндекс.Погоды там будет всплывающее окно с вводом фамилии имени, название компании, номер телефона, город и нужно выбрать бесплатный тариф погода на вашем. Нажимаем перейти к API, там будет KEY #1 вот он то Вам и нужен.\u003C\u002Fp\u003E\u003Cp\u003EВсе токены поместим в переменные среды, об этом в конце статьи.\u003C\u002Fp\u003E\u003Cp\u003EЗапускаем pycharm создаем новый проект.\u003C\u002Fp\u003E\u003Cp\u003EПереходим в Main.py и в первую очередь устанавливаем дополнительные библиотеки: \u003C\u002Fp\u003E\u003Cp\u003EВ нижнем ряду окна нажимаем кнопку Python Packages,  в поиске вводим requests и нажимаем install, тоже повторяем для pyTelegramBotAPI и geopy.\u003C\u002Fp\u003E\u003Cp\u003EЗатем в main.py импортируем библиотеки и токены:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport json\nimport telebot\nimport requests as req\nfrom geopy import geocoders\nfrom os import environ\n\n\ntoken = environ['token_bot']\ntoken_accu = environ['token_accu']\ntoken_yandex = environ['token_yandex']\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВсе вся подготовка сделана, теперь переходим к написанию самого бота\u003C\u002Fp\u003E\u003Cp\u003EДля того чтобы получить прогноз от accuweather нужен уникальный код города, чтобы его получить нужны его координаты, так же координаты города нам понадобятся при запросе к яндексу, поэтому в первую очередь пишем функцию получения координат через библиотеку geopy:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef geo_pos(city: str):\n    geolocator = geocoders.Nominatim(user_agent=\"telebot\")\n    latitude = str(geolocator.geocode(city).latitude)\n    longitude = str(geolocator.geocode(city).longitude)\n    return latitude, longitude\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь получаем код города:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef code_location(latitude: str, longitude: str, token_accu: str):\n    url_location_key = f'http:\u002F\u002Fdataservice.accuweather.com\u002Flocations\u002Fv1\u002Fcities\u002Fgeoposition\u002Fsearch?apikey={token_accu}&amp;q={latitude},{longitude}&amp;language=ru'\n    resp_loc = req.get(url_location_key, headers={\"APIKey\": token_accu})\n    json_data = json.loads(resp_loc.text)\n    code = json_data['Key']\n    return code\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНа вход функции даем координаты и токен, префикс “f” перед строкой дает нам вставлять значения переменных в нужные места вместо текста. Далее мы отправляем запрос по указанному url и с нужным заголовком. Хоть resp_loc.text и выглядит как стандартный словарь python на самом деле это json-объект, его нужно переделать в словарь, по ключу ‘Key’ получаем код города.\u003C\u002Fp\u003E\u003Cp\u003EПосле этого можно написать уже код получения непосредственно прогноза:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef weather(cod_loc: str, token_accu: str):\n    url_weather = f'http:\u002F\u002Fdataservice.accuweather.com\u002Fforecasts\u002Fv1\u002Fhourly\u002F12hour\u002F{cod_loc}?apikey={token_accu}&amp;language=ru&amp;metric=True'\n    response = req.get(url_weather, headers={\"APIKey\": token_accu})\n    json_data = json.loads(response.text)\n    dict_weather = dict()\n    dict_weather['link'] = json_data[0]['MobileLink']\n    dict_weather['сейчас'] = {'temp': json_data[0]['Temperature']['Value'], 'sky': json_data[0]['IconPhrase']}\n    for i in range(len(json_data):1:):\n        time = 'через' + str(i) + 'ч'\n        dict_weather[time] = {'temp': json_data[i]['Temperature']['Value'], 'sky': json_data[i]['IconPhrase']}\nreturn dict_weather\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПо ключу ‘link’ сохраним ссылку на полный прогноз, сохраним погоду сейчас, далее нам понадобится в цикле перебрать оставшиеся часы и так же сохранить их в словаре.\u003C\u002Fp\u003E\u003Cp\u003EДалее нам нужно получить погоду от яндекса:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef yandex_weather(latitude, longitude, token_yandex: str):\n    url_yandex = f'https:\u002F\u002Fapi.weather.yandex.ru\u002Fv2\u002Finformers\u002F?lat={latitude}&amp;lon={longitude}&amp;[lang=ru_RU]'\n    yandex_req = req.get(url_yandex, headers={'X-Yandex-API-Key': token_yandex}, verify=False)\n    conditions = {'clear': 'ясно', 'partly-cloudy': 'малооблачно', 'cloudy': 'облачно с прояснениями',\n                  'overcast': 'пасмурно', 'drizzle': 'морось', 'light-rain': 'небольшой дождь',\n                  'rain': 'дождь', 'moderate-rain': 'умеренно сильный', 'heavy-rain': 'сильный дождь',\n                  'continuous-heavy-rain': 'длительный сильный дождь', 'showers': 'ливень',\n                  'wet-snow': 'дождь со снегом', 'light-snow': 'небольшой снег', 'snow': 'снег',\n                  'snow-showers': 'снегопад', 'hail': 'град', 'thunderstorm': 'гроза',\n                  'thunderstorm-with-rain': 'дождь с грозой', 'thunderstorm-with-hail': 'гроза с градом'\n                  }\n    wind_dir = {'nw': 'северо-западное', 'n': 'северное', 'ne': 'северо-восточное', 'e': 'восточное',\n                'se': 'юго-восточное', 's': 'южное', 'sw': 'юго-западное', 'w': 'западное', 'с': 'штиль'}\n\n    yandex_json = json.loads(yandex_req.text)\n    yandex_json['fact']['condition'] = conditions[yandex_json['fact']['condition']]\n    yandex_json['fact']['wind_dir'] = wind_dir[yandex_json['fact']['wind_dir']]\n    for parts in yandex_json['forecast']['parts']:\n        parts['condition'] = conditions[parts['condition']]\n        parts['wind_dir'] = wind_dir[parts['wind_dir']]\n\n    pogoda = dict()\n    params = ['condition', 'wind_dir', 'pressure_mm', 'humidity']\n    for parts in yandex_json['forecast']['parts']:\n        pogoda[parts['part_name']] = dict()\n        pogoda[parts['part_name']]['temp'] = parts['temp_avg']\n        for param in params:\n            pogoda[parts['part_name']][param] = parts[param]\n\n    pogoda['fact'] = dict()\n    pogoda['fact']['temp'] = yandex_json['fact']['temp']\n    for param in params:\n        pogoda['fact'][param] = yandex_json['fact'][param]\n\n    pogoda['link'] = yandex_json['info']['url']\n    return pogoda\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНачинаем стандартно, но есть нюанс направление ветра и состояние неба в ответе от яндекса пишется на английском языке, делаем словари conditions и wind_dir для перевода. В ответе только фактическая погода и прогноз на следующих два периода (можно сделать и более подробно, но в бесплатном варианте только так).  Сразу в словаре меняем направление ветра и состояние неба. Далее создаем новый словарь и забираем только то что нам нужно из всего ответа. При отладке кода стоит отметить, что в бесплатной версии api яндекса допускается только 50 запросов в сутки.\u003C\u002Fp\u003E\u003Cp\u003EДалее нам стоит написать функции которые будут отправлять ответом прогнозы. Начнем с аккувезер:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef print_weather(dict_weather, message):\n    bot.send_message(message.from_user.id, f'Разрешите доложить, Ваше сиятельство!'\n                                           f' Температура сейчас {dict_weather[\"сейчас\"][\"temp\"]}!'\n                                           f' А на небе {dict_weather[\"сейчас\"][\"sky\"]}.'\n                                           f' Температура через три часа {dict_weather[\"через3ч\"][\"temp\"]}!'\n                                           f' А на небе {dict_weather[\"через3ч\"][\"sky\"]}.'\n                                           f' Температура через шесть часов {dict_weather[\"через6ч\"][\"temp\"]}!'\n                                           f' А на небе {dict_weather[\"через6ч\"][\"sky\"]}.'\n                                           f' Температура через девять часов {dict_weather[\"через9ч\"][\"temp\"]}!'\n                                           f' А на небе {dict_weather[\"через9ч\"][\"sky\"]}.')\n    bot.send_message(message.from_user.id, f' А здесь ссылка на подробности '\n                                           f'{dict_weather[\"link\"]}')\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ эту функцию мы должны погрузить вывод функции weather и сообщение на которое мы отвечаем. В самой функции мы отправляем сообщение с текстом и ссылками на тот словарь из функции weather.  В конце отправляем сообщение со ссылкой на полный прогноз.\u003C\u002Fp\u003E\u003Cp\u003EДалее делаем сообщение с погодой от яндекса:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef print_yandex_weather(dict_weather_yandex, message):\n    day = {'night': 'ночью', 'morning': 'утром', 'day': 'днем', 'evening': 'вечером', 'fact': 'сейчас'}\n    bot.send_message(message.from_user.id, f'А яндекс говорит:')\n    for i in dict_weather_yandex.keys():\n        if i != 'link':\n            time_day = day[i]\n            bot.send_message(message.from_user.id, f'Температура {time_day} {dict_weather_yandex[i][\"temp\"]}'\n                                                   f', на небе {dict_weather_yandex[i][\"condition\"]}')\n\n    bot.send_message(message.from_user.id, f' А здесь ссылка на подробности '\n                                           f'{dict_weather_yandex[\"link\"]}')\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eздесь так же скармливаем функции выход функции yandex_weather и сообщение на которое отвечаем. Здесь создаем словарь с переводом времени дня, затем отправляем сообщение, далее задаем цикл по ключам словаря из выхода функции yandex_weather если ключ не link то отправляем сообщение: температура {время дня}, на небе {состояние неба}. В конце отправляем ссылку на яндекс (это требование яндекса).\u003C\u002Fp\u003E\u003Cp\u003EИ наконец обобщающая функция:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef big_weather(message, city):\n    latitude, longitude = geo_pos(city)\n    cod_loc = code_location(latitude, longitude, token_accu)\n    you_weather = weather(cod_loc, token_accu)\n    print_weather(you_weather, message)\n    yandex_weather_x = yandex_weather(latitude, longitude, token_yandex)\n    print_yandex_weather(yandex_weather_x, message)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ нее мы погружаем сообщение и город. Определяем координаты, запрашиваем accuweather и пишем сообщение на основе данных от него, потом тоже самое от яндекса.\u003C\u002Fp\u003E\u003Cp\u003EНужна ещё функция сохранения городов:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef add_city(message):\n    try:\n        latitude, longitude = geo_pos(message.text.lower().split('город ')[1])\n        global cities\n        cities[message.from_user.id] = message.text.lower().split('город ')[1]\n        with open('cities.json', 'w') as f:\n            f.write(json.dumps(cities))\n        return cities, 0\n    except Exception as err:\n        return cities, 1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EСперва проверяем существование такого города если все ок то все что после слова город сохраняем в словарь cities под ключом id пользователя. Можно было бы использовать имя, но это только если Вы уверены, что сервисом будут пользоваться люди с разными именами.\u003C\u002Fp\u003E\u003Cp\u003EТак все вспомогательные функции мы описали теперь функции ответа на сообщения:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003E@bot.message_handler(command=['start', 'help'])\ndef send_welcome(message):\n    bot.reply_to(message, f'Я погодабот, приятно познакомитсья, {message.from_user.first_name}')\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗдесь мы просто представляемся при первом посещении.\u003C\u002Fp\u003E\u003Cp\u003EА вот и самая большая функция:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Ebot.message_handler(content_types=['text'])\ndef get_text_messages(message):\n    global cities\n    if message.text.lower() == 'привет' or message.text.lower() == 'здорова':\n        bot.send_message(message.from_user.id,\n                         f'О великий и могучий {message.from_user.first_name}! Позвольте Я доложу '\n                         f' Вам о погоде! Напишите  слово \"погода\" и я напишу погоду в Вашем'\n                         f' \"стандартном\" городе или напишите название города в котором Вы сейчас')\n    elif message.text.lower() == 'погода':\n        if message.from_user.id in cities.keys():\n            city = cities[message.from_user.id]\n            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'\n                                                   f' Твой город {city}')\n            big_weather(message, city)\n\n        else:\n            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'\n                                                   f' Я не знаю Ваш город! Просто напиши:'\n                                                   f'\"Мой город *****\" и я запомню твой стандартный город!')\n    elif message.text.lower()[:9] == 'мой город':\n        cities, flag = add_city(message)\n        if flag == 0:\n            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'\n                                                   f' Теперь я знаю Ваш город! это'\n                                                   f' {cities[str(message.from_user.id)]}')\n        else:\n            bot.send_message(message.from_user.id, f'О великий и могучий {message.from_user.first_name}!'\n                                                   f' Что то пошло не так :(')\n    else:\n        try:\n            city = message.text\n            bot.send_message(message.from_user.id, f'Привет {message.from_user.first_name}! Твой город {city}')\n            big_weather(message, city)\n            except AttributeError as err:\n            bot.send_message(message.from_user.id, f'{message.from_user.first_name}! Не вели казнить,'\n                                                   f' вели слово молвить! Я не нашел такого города!'\n                                                   f'И получил ошибку {err}, попробуй другой город')\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ первой части если автор сообщения сказал «привет» или «здарова» мы просто здороваемся и напоминаем, то что мы ждем от автора сообщения.\u003C\u002Fp\u003E\u003Cp\u003E Если написал «погода» то уточняемся есть ли он в нашем списке и если есть, то сообщаем название города и выполняем функцию big_weather.\u003C\u002Fp\u003E\u003Cp\u003EЕсли пользователя нет, то предлагаем ему задать его стандартный город.\u003C\u002Fp\u003E\u003Cp\u003EЕсли пользователь написал «Мой город *****», то пользователя. И сообщаем что город записан, если что-то пошло не так, то сообщаем об этом.\u003C\u002Fp\u003E\u003Cp\u003EВо всех остальных случаях мы сообщение воспринимаем как название города. Если города такого не находится то сообщаем об этом.\u003C\u002Fp\u003E\u003Cp\u003Eну и собственно нам нужно записать всю программу (это наверное самое короткое):\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Ebot = telebot.TeleBot(token)\n\nwith open('cities.json', encoding='utf-8') as f:\n    cities = json.load(f)\n    \nbot.polling(none_stop=True)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗдесь мы создаем объект bot, потом открываем json файл с архивом городов и id пользователей. И наконец запускаем в бесконечном цикле бота. \u003C\u002Fp\u003E\u003Cp\u003EНа этом можно закончить, но в целом функционал можно расширять, можно было бы добавить гисметео или rp5, но у этих товарищей нет бесплатных версий прогноза L.\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FgerelDan\u002Ftele_karamaz_weather\" rel=\"noopener noreferrer nofollow\"\u003EВот ссылка на gitHub\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EИ теперь нам нужно все это запустить на сервере.\u003C\u002Fp\u003E\u003Cp\u003EДля этого нам нужен собственно сам сервер я например арендовал на джино, это не реклама просто констатация факта. это обходится 3,19 рублей в день.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Feb7\u002F21d\u002F49e\u002Feb721d49eda1e0725d7e26973206ec8b.jpg\" width=\"1098\" height=\"385\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Feb7\u002F21d\u002F49e\u002Feb721d49eda1e0725d7e26973206ec8b.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДля создания своего аккаунта достаточно иметь аккаунт в google. Для целей телеграмм бота достаточно самого дешевого сервера.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0c0\u002F309\u002F07c\u002F0c030907cc39bcb2021997513d4a7534.jpg\" width=\"1098\" height=\"546\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0c0\u002F309\u002F07c\u002F0c030907cc39bcb2021997513d4a7534.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВыберем ось\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F674\u002F026\u002F0ad\u002F6740260ad0ed2e648857b22201e713e8.jpg\" width=\"1119\" height=\"124\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F674\u002F026\u002F0ad\u002F6740260ad0ed2e648857b22201e713e8.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИ нажимаем создать сервер.\u003C\u002Fp\u003E\u003Cp\u003EПосле выделения Вам сервера можно будет попасть в его меню.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6b7\u002F8c0\u002F9aa\u002F6b78c09aa1a652ca857105d5d1e83706.jpg\" width=\"1119\" height=\"629\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6b7\u002F8c0\u002F9aa\u002F6b78c09aa1a652ca857105d5d1e83706.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗдесь можно посмотреть обзор сервера его загруженность и самое главное параметры для ssh соединения и задать пароль для root (это нужно сделать обязательно).\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a6\u002F090\u002F147\u002F4a6090147d255687d201060c0496aff3.jpg\" width=\"482\" height=\"291\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a6\u002F090\u002F147\u002F4a6090147d255687d201060c0496aff3.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДля подключения по SSH нам нужна программа putty она бесплатная. Устанавливаем, запускаем и видим окно:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7dd\u002F901\u002Fd2f\u002F7dd901d2faa9e6d4e31936a979412cfb.jpg\" width=\"453\" height=\"442\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7dd\u002F901\u002Fd2f\u002F7dd901d2faa9e6d4e31936a979412cfb.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ host-name вписываем хост из данных от джино и подключаемся, появляется командная строка вводим логин root нажимаем enter после чего вводим пароль который мы задали ранее.\u003C\u002Fp\u003E\u003Cp\u003EТак теперь нам нужно установить python для этого в командной строке пишем\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Esudo apt install python3\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003Eи обновляем pip\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Esudo apt install python3-pip\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E Далее устанавливаем все библиотеки которые устанавливали в начале:\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Epip install requests\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Epip install geopy\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Epip install pyTelegramBotAPI\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003EПереходим в каталог \u003Ccode\u003Ecd \u002Fusr\u002Fbin\u002F\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003EСоздаем каталог \u003Ccode\u003Emkdir telegrambot\u002F\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003EОткрываем командную строку в виндовс \u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003Epscp -P (здесь указываем порт джино) C:\\(путь к проекту)\\ root@\"указываем имя сервера\":\u002Fusr\u002Fbin\u002Ftelegrambot\u002F\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003EОн попросит ввести пароль, вводим пароль от root.\u003C\u002Fp\u003E\u003Cp\u003Eпосле копирования переходим на окно putty проверяем что все скопировалось командной ls.\u003C\u002Fp\u003E\u003Cp\u003EВ начале статьи я писал что токены сохраним в переменные среды. Мне проще было сделать так:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EВ командной строке винды пишем: \u003Ccode\u003Epscp -P (здесь указываем порт джино) root@\"указываем имя сервера\":\u002Fetc\u002Fenvironment\u003C\u002Fcode\u003E \u003Ccode\u003EC:\\(путь к проекту)\\environment\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eоткрываем блокнотом скачанный файл и вписываем наши перменные каждую на отдельной строке:\u003C\u002Fp\u003E\u003Cp\u003Etoken_bot=ваш токен для бота \u003C\u002Fp\u003E\u003Cp\u003Etoken_accu=ваш токен для accuweather\u003C\u002Fp\u003E\u003Cp\u003Etoken_yandex=ваш токен для яндекса\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСохраняем\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОтправляем этот файл обратно:  \u003Ccode\u003Epscp -P (здесь указываем порт джино) C:\\(путь к проекту)\\environment root@\"указываем имя сервера\":\u002Fetc\u002Fenvironment\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EЗакрываем putty и открываем его снова. Входим как и ранее. для проверки добавления переменных среды в консоли вводим команду export. Должны отобразиться все переменные среды, включая Ваши.\u003C\u002Fp\u003E\u003Cp\u003EПосле чего запускаем python3 \u003Ccode\u003E\u002Fusr\u002Fbin\u002Ftelegrambot\u002F\u003C\u002Fcode\u003Emain.py\u003C\u002Fp\u003E\u003Cp\u003EВсе, телеграм бот работает.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"телеграм-бот"},{"titleHtml":"погода-бот"},{"titleHtml":"python"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F584134\u002Fe5ff35ea34ed288c8223b4759c2c41f0\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F584134\u002Fe5ff35ea34ed288c8223b4759c2c41f0\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584134\\\u002F\"},\"headline\":\"Погода бот на python\",\"datePublished\":\"2021-10-18T16:42:48+03:00\",\"dateModified\":\"2021-10-21T10:08:09+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Gerel_Dan\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь на...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584134\\\u002F#post-content-body\",\"about\":[\"h_python\",\"h_api\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Feb7\\\u002F21d\\\u002F49e\\\u002Feb721d49eda1e0725d7e26973206ec8b.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F0c0\\\u002F309\\\u002F07c\\\u002F0c030907cc39bcb2021997513d4a7534.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F674\\\u002F026\\\u002F0ad\\\u002F6740260ad0ed2e648857b22201e713e8.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6b7\\\u002F8c0\\\u002F9aa\\\u002F6b78c09aa1a652ca857105d5d1e83706.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4a6\\\u002F090\\\u002F147\\\u002F4a6090147d255687d201060c0496aff3.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F7dd\\\u002F901\\\u002Fd2f\\\u002F7dd901d2faa9e6d4e31936a979412cfb.jpg\"]}","metaDescription":"На тему телеграмм ботов много материал, но погода бота я не находил и поэтому для себя и своих братьев написал свой собственный бот на Python.В первую очередь нам нужна среда разработки для меня это...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"python,api"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
