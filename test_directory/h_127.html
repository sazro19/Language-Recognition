<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Как мы Neo4j к Helidon прикручивали / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/584796\/"},"headline":"Как мы Neo4j к Helidon прикручивали","datePublished":"2021-10-22T16:15:01+03:00","dateModified":"2021-10-22T17:40:11+03:00","author":{"@type":"Person","name":"Дмитрий Александров"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j &mdash; графовая система управления базами данных с открытым исходным кодом,...","url":"https:\/\/habr.com\/ru\/post\/584796\/#post-content-body","about":["h_java","h_microservices","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/584796\/347d942a9e7bca36f130793f5746c127\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/7b0\/b2d\/29a\/7b0b2d29a30b7bdc467cbd7e24071ca9.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Как мы Neo4j к Helidon прикручивали" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Как мы Neo4j к Helidon прикручивали" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Как мы Neo4j к Helidon прикручивали" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="584796" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-22T13:15:01.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/584796/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/584796/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/584796/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/advbg/" title="advbg" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/a7c/a2d/53f/a7ca2d53f8c62a0012f99094253313b9.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/advbg/" class="tm-user-info__username">
      advbg
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-22T13:15:01.000Z" title="2021-10-22, 16:15">22  октября   в 16:15</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Как мы Neo4j к Helidon прикручивали</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/java/" class="tm-article-snippet__hubs-item-link"><span>Java</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/microservices/" class="tm-article-snippet__hubs-item-link"><span>Микросервисы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="/img/image-loader.svg" height="704" data-src="https://habrastorage.org/getpro/habr/upload_files/7b0/b2d/29a/7b0b2d29a30b7bdc467cbd7e24071ca9.png" data-width="1400"/><figcaption></figcaption></figure><p>Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. </p><blockquote><p><em>Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на 2015 год считается самой распространённой графовой СУБД. (Википедия, 21.10.2021) </em></p></blockquote><p>Neo4j написана на Java и доступна из ПО, написанного на других языках с использованием языка запросов Cypher, через HTTP endpoint или через протокол «bolt». Neo4j в настоящее время является стандартом де-факто для графовых баз данных, используемых во многих отраслях. </p><p>Вообще, в се началось с небольшого разговора с Michael Simonis, одним из авторов Spring Data Neo4j 6 и сопровождающим Neo4j-OGM. Мы спросили Михаеля, что он думает о том, как Helidon и Neo4J могут работать вместе. Менее чем через час Михаель прислал мне ссылку на этот репозиторий с полнофункциональным примером для Helidon MP и Neo4j SDN. </p><p>Когда я начал читать код, я увидел странную зависимость в файле pom.xml:</p><pre><code class="xml">&lt;dependency>
    &lt;groupId>org.springframework.data&lt;/groupId>
    &lt;artifactId>spring-data-neo4j&lt;/artifactId>
&lt;/dependency></code></pre><p>Spring? Да ладна! Почему в нашем проекте есть Spring? </p><p>Но продолжая изучать код, я был весьма удивлен, увидев расширение CDI 2.0, обрабатывающее инициализацию и подготовку драйвера. Это расширение CDI запустилось без проблем в Helidon, поскольку он полностью поддерживает контейнер CDI - шикарно! Я снова почувствовал красоту и силу стандартов. </p><p>На следующий день Михаель прислал мне другое репо. На этот раз он включил свои идеи о том, как использовать Neo4j с Helidon SE. Интеграция тоже получилась очень простой. Было легко использовать Helidon Config для переноса всей конфигурации Neo4j в единую конфигурацию. А поскольку драйвер Neo4j полностью поддерживает native image, все можно скомпилировать в native-image исполняемый файл без каких-либо дополнительных действий с точки зрения программиста. </p><p>Это породило дискуссии между командами Helidon и Neo4j о том, какой вид интеграции более подходит для Helidon. В результате мы создали официальную интеграцию! </p><p>После некоторых консультаций с представителем Neo4j и моим хорошим другом Михаелем Симонисом мы пришли к выводу, что нам нужно только прдоставлять инициализированный драйвер пользователям Helidon. Метрики и Health Checks из Neo4j должны быть проброшены в метрики Helidon / MicroProfile и должны предоставляться как отдельные модули - отдельные зависимости Maven. </p><p>Итак, как же нам написать интеграцию Neo4j с Helidon? существуют две разновидности Helidon - MP и SE. SE представляет собой набор реактивных API, реализованных на чистой Java. Абсолютно никакой «магии» вроде рефлекшана или других хитростей. Helidon MP, по сути, оборачивает SE и приводит его к стандартам MicroProfile. Это означает, что рекомендуется сначала реализовать интеграцию с Neo4j для Helidon SE, а затем обернуть ее как расширения CDI для Helidon MP.</p><h3>Давайте сделаем это! </h3><blockquote><p><em>Дисклеймер: в этой статье я продемонстрирую только основные фрагменты кода. Поскольку Helidon опенсорс проект под лицензией Apache 2.0, полный код доступен в официальном репозитории Helidon.</em> </p></blockquote><p>В Helidon мы обычно создаем так называемый support объект для реализации интеграции. Этот объект содержит всю информацию о конфигурации и инициализации. Мы следуем Builder pattern для чтения из конфигурации. Это означает, что мы создаем внутренний объект Builder, который должен читать все данные из конфигурации:</p><pre><code class="java">public Builder config(Config config) {
   config.get("authentication.username").asString().ifPresent(this::username);
   config.get("authentication.password").asString().ifPresent(this::password);
   config.get("authentication.enabled").asBoolean().ifPresent(this::authenticationEnabled);
   config.get("uri").asString().ifPresent(this::uri);
   config.get("encrypted").asBoolean().ifPresent(this::encrypted);
   //pool
   config.get("pool.metricsEnabled").asBoolean().ifPresent(this::metricsEnabled);
   config.get("pool.logLeakedSessions").asBoolean().ifPresent(this::logLeakedSessions);
   config.get("pool.maxConnectionPoolSize").asInt().ifPresent(this::maxConnectionPoolSize);
   config.get("pool.idleTimeBeforeConnectionTest").as(Duration.class).ifPresent(this::idleTimeBeforeConnectionTest);
   config.get("pool.maxConnectionLifetime").as(Duration.class).ifPresent(this::maxConnectionLifetime);
   config.get("pool.connectionAcquisitionTimeout").as(Duration.class).ifPresent(this::connectionAcquisitionTimeout);
   //trust   
   config.get("trustsettings.trustStrategy").asString().map(TrustStrategy::valueOf).ifPresent(this::trustStrategy);
   config.get("trustsettings.certificate").as(Path.class).ifPresent(this::certificate);
   config.get("trustsettings.hostnameVerificationEnabled").asBoolean().ifPresent(this::hostnameVerificationEnabled);
   return this;
} </code></pre><p>Вы можете увидеть строки с ключами, они фактически взяты из файла конфигурации. причем, либо из конфигурации SE, либо из конфигурации MicroProfile. Каждый элемент настраивается следуя шаблону Builder:</p><pre><code class="java">...
public Builder password(String password) {
   Objects.requireNonNull(password);
   this.password = password;
   return this;
}
... </code></pre><p>Когда все поля установлены, мы можем сбилдить support объект:</p><pre><code class="java">@Override
public Neo4j build() {
   if (driver == null) {
       driver = initDriver();
   }
   return new Neo4j(this);
} </code></pre><p>Таким образом мы гарантируем, что все значения не будут нулевыми. Фактическая инициализация драйвера довольно проста (некоторые методы опущены):</p><pre><code class="java">private Driver initDriver() {
   AuthToken authToken = AuthTokens.none();
   if (authenticationEnabled) {
       authToken = AuthTokens.basic(username, password);
   }
   org.neo4j.driver.Config.ConfigBuilder configBuilder = createBaseConfig();
   configureSsl(configBuilder);
   configurePoolSettings(configBuilder);
   return GraphDatabase.driver(uri, authToken, configBuilder.build());
} </code></pre><p> Support объект далее просто возвращает драйвер:</p><pre><code class="java">public Driver driver() {
   return driver;
} </code></pre><p>... и его можно использовать:</p><pre><code class="java">Neo4jMetricsSupport.builder()
       .driver(neo4j.driver())
       .build()
       .initialize();
Driver neo4jDriver = neo4j.driver(); </code></pre><p>Helidon позаботится о его инициализации из файла application.yaml:</p><pre><code class="yaml">neo4j:
 uri: bolt://localhost:7687
 authentication:
   username: neo4j
   password: secret
 pool:
   metricsEnabled: true </code></pre><p>Собственно все - можно использовать уже в своем коде:</p><pre><code class="java">public List&lt;Movie> findAll(){
   try (var session = driver.session()) {
       var query = ""
               + "match (m:Movie) "
               + "match (m) &lt;- [:DIRECTED] - (d:Person) "
               + "match (m) &lt;- [r:ACTED_IN] - (a:Person) "
               + "return m, collect(d) as directors, collect({name:a.name, roles: r.roles}) as actors";
       return session.readTransaction(tx -> tx.run(query).list(r -> {
           var movieNode = r.get("m").asNode();
           var directors = r.get("directors").asList(v -> {
               var personNode = v.asNode();
               return new Person(personNode.get("born").asInt(), personNode.get("name").asString());
           });
           var actors = r.get("actors").asList(v -> {
               return new Actor(v.get("name").asString(), v.get("roles").asList(Value::asString));
           });
           var m = new Movie(movieNode.get("title").asString(), movieNode.get("tagline").asString());
           m.setReleased(movieNode.get("released").asInt());
           m.setDirectorss(directors);
           m.setActors(actors);
           return m;
       }));
   }
} </code></pre><p>И <em>вуаля</em>! Helidon и Neo4j теперь могут работать вместе.</p><p>А как же MP? </p><p>Нам просто нужно обернуть нашу интеграцию в расширение CDI - это действительно довольно просто:</p><pre><code class="java">public class Neo4jCdiExtension implements Extension {
   private static final String NEO4J_METRIC_NAME_PREFIX = "neo4j";
   void afterBeanDiscovery(@Observes AfterBeanDiscovery addEvent) {
       addEvent.addBean()
               .types(Driver.class)
               .qualifiers(Default.Literal.INSTANCE, Any.Literal.INSTANCE)
               .scope(ApplicationScoped.class)
               .name(Driver.class.getName())
               .beanClass(Driver.class)
               .createWith(creationContext -> {
                   org.eclipse.microprofile.config.Config config = ConfigProvider.getConfig();
                   Config helidonConfig = MpConfig.toHelidonConfig(config).get(NEO4J_METRIC_NAME_PREFIX);

                   ConfigValue&lt;Neo4j> configValue = helidonConfig.as(Neo4j::create);
                   if (configValue.isPresent()) {
                       return configValue.get().driver();
                   }
                   throw new Neo4jException("There is no Neo4j driver configured in configuration under key 'neo4j");
               });
   }
} </code></pre><p>Как видите, мы можем прочитать конфигурацию с помощью функций SE:</p><pre><code class="java">Config helidonConfig = MpConfig.toHelidonConfig(config).get(NEO4J_METRIC_NAME_PREFIX); </code></pre><p>Затем просто повторно используем наш support объект Neo4j SE:</p><pre><code class="java">ConfigValue&lt;Neo4j> configValue = helidonConfig.as(Neo4j::create);</code></pre><p>… и возвращаем драйвер:</p><pre><code class="java">return configValue.get().driver();</code></pre><p>И тоже собственно все - просто инжектим драйвер:</p><pre><code class="java">@Inject
public MovieRepository(Driver driver) {
   this.driver = driver;
} </code></pre><p>Конфигурация будет взята из файла <code>microprofile-config.properties</code>:</p><pre><code class="yaml"># Neo4j settings
neo4j.uri=bolt://localhost:7687
neo4j.authentication.username=neo4j
neo4j.authentication.password: secret
neo4j.pool.metricsEnabled: true </code></pre><p>Далее можно использовать драйвер как в примере с SE.</p><p>Теперь  и Helidon MP может работать с Neo4j!</p><p>Но это еще не все!</p><h3>Метрики</h3><p>Как я уже упоминал, для надлежащей работе в облаках нам также необходимо пробросить метрики и health checks из Neo4j.</p><p>Сделаем как и раньше - сначала для SE, а потом все обернем в MP. </p><p>Начнем с метрик! Сделаем отдельный модуль для метрик Neo4j.</p><p>Как и в Helidon SE, в support объекте Neo4j мы будем следовать шаблону Builder для настройки поддержки метрик. На самом деле нам нужен только драйвер Neo4j, так как мы можем все показатели получить из него:</p><pre><code class="java">public static class Builder implements io.helidon.common.Builder&lt;Neo4jMetricsSupport> {
   private Driver driver;
   private Builder() {
   }
   public Neo4jMetricsSupport build() {
       Objects.requireNonNull(driver, "Must set driver before building");
       return new Neo4jMetricsSupport(this);
   }
   public Builder driver(Driver driver) {
       this.driver = driver;
       return this;
   }
} </code></pre><p>Затем мы должны обернуть counter–ы и gauge–ы Neo4j:</p><pre><code class="java">private static class Neo4JCounterWrapper implements Counter {
   private final Supplier&lt;Long> fn;
   private Neo4JCounterWrapper(Supplier&lt;Long> fn) {
       this.fn = fn;
   }
   @Override
   public void inc() {
       throw new UnsupportedOperationException();
   }
   @Override
   public void inc(long n) {
       throw new UnsupportedOperationException();
   }
   @Override
   public long getCount() {
       return fn.get();
   }
}

private static class Neo4JGaugeWrapper&lt;T> implements Gauge&lt;T> {
   private final Supplier&lt;T> supplier;
   private Neo4JGaugeWrapper(Supplier&lt;T> supplier) {
       this.supplier = supplier;
   }
   @Override
   public T getValue() {
       return supplier.get();
   }
} </code></pre><p>Далее нужно зарегистрировать эти счетчики в MetricsRegistry:</p><pre><code class="java">private void registerCounter(MetricRegistry metricRegistry,
                            ConnectionPoolMetrics cpm,
                            String poolPrefix,
                            String name,
                            Function&lt;ConnectionPoolMetrics, Long> fn) {
   String counterName = poolPrefix + name;
   if (metricRegistry.getCounters().get(new MetricID(counterName)) == null) {
       Metadata metadata = Metadata.builder()
               .withName(counterName)
               .withType(MetricType.COUNTER)
               .notReusable()
               .build();
       Neo4JCounterWrapper wrapper = new Neo4JCounterWrapper(() -> fn.apply(cpm));
       metricRegistry.register(metadata, wrapper);
   }
}
private void registerGauge(MetricRegistry metricRegistry,
                          ConnectionPoolMetrics cpm,
                          String poolPrefix,
                          String name,
                          Function&lt;ConnectionPoolMetrics, Integer> fn) {
   String gaugeName = poolPrefix + name;
   if (metricRegistry.getGauges().get(new MetricID(gaugeName)) == null) {
       Metadata metadata = Metadata.builder()
               .withName(poolPrefix + name)
               .withType(MetricType.GAUGE)
               .notReusable()
               .build();
       Neo4JGaugeWrapper&lt;Integer> wrapper =
               new Neo4JGaugeWrapper&lt;>(() -> fn.apply(cpm));
       metricRegistry.register(metadata, wrapper);
   }
} </code></pre><p>И мы практически готовы:</p><pre><code class="java">private void reinit() {
   Map&lt;String, Function&lt;ConnectionPoolMetrics, Long>> counters = Map.ofEntries(
           entry("acquired", ConnectionPoolMetrics::acquired),
           entry("closed", ConnectionPoolMetrics::closed),
           entry("created", ConnectionPoolMetrics::created),
           entry("failedToCreate", ConnectionPoolMetrics::failedToCreate),
           entry("timedOutToAcquire", ConnectionPoolMetrics::timedOutToAcquire),
           entry("totalAcquisitionTime", ConnectionPoolMetrics::totalAcquisitionTime),
           entry("totalConnectionTime", ConnectionPoolMetrics::totalConnectionTime),
           entry("totalInUseCount", ConnectionPoolMetrics::totalInUseCount),
           entry("totalInUseTime", ConnectionPoolMetrics::totalInUseTime));

   Map&lt;String, Function&lt;ConnectionPoolMetrics, Integer>> gauges = Map.ofEntries(
           entry("acquiring", ConnectionPoolMetrics::acquiring),
           entry("creating", ConnectionPoolMetrics::creating),
           entry("idle", ConnectionPoolMetrics::idle),
           entry("inUse", ConnectionPoolMetrics::inUse)
   );
   for (ConnectionPoolMetrics it : lastPoolMetrics.get()) {
       String poolPrefix = NEO4J_METRIC_NAME_PREFIX + "-";
       counters.forEach((name, supplier) -> registerCounter(metricRegistry.get(), it, poolPrefix, name, supplier));
       gauges.forEach((name, supplier) -> registerGauge(metricRegistry.get(), it, poolPrefix, name, supplier));
       // we only care about the first one
       metricsInitialized.set(true);
       break;
   }
} </code></pre><p>Всегда полезно обновлять вовремя метрики, и для этого у нас есть функция:</p><pre><code class="java">private void refreshMetrics(ScheduledExecutorService executor) {
   Collection&lt;ConnectionPoolMetrics> currentPoolMetrics = driver.metrics().connectionPoolMetrics();
   if (!metricsInitialized.get() &amp;&amp; currentPoolMetrics.size() >= 1) {
       lastPoolMetrics.set(currentPoolMetrics);
       reinit();
       if (metricsInitialized.get()) {
           reinitFuture.get().cancel(false);
           executor.shutdown();
       }
   }
} </code></pre><p>Нам нужно только предоставить драйвер Neo4j для предоставления нам информации о метриках в нашем файле application.yaml:</p><pre><code class="yaml">neo4j:
 pool:
   metricsEnabled: true </code></pre><p>… Или в нашем <strong>microprofile-config.properties</strong> :</p><pre><code class="java">neo4j.pool.metricsEnabled = true </code></pre><p>Теперь, если вы пойдете по «/health», вы также получите показания от Neo4j.</p><p>Для MP, нам нужно только обернуть регистрацию метрик как расширение CDI. Событие это должно произойти после того, как драйвер уже инициализирован:</p><pre><code class="java">public class Neo4jMetricsCdiExtension implements Extension {
   private void addMetrics(@Observes @Priority(PLATFORM_AFTER + 101) @Initialized(ApplicationScoped.class) Object event) {
       Instance&lt;Driver> driver = CDI.current().select(Driver.class);
       Neo4jMetricsSupport.builder()
               .driver(driver.get())
               .build()
               .initialize();
   }
} </code></pre><p>Вот и все! Метрики Neo4j теперь доступны и в Helidon MP!</p><p>И теперь, последнее, но не менее важное, проверка работоспособности!</p><h3>Health Checks</h3><p>И опять же, это должен быть отдельный модуль, чтобы все было чисто и красиво.</p><p>На этот раз мы начнем с MP:</p><pre><code class="java">@Readiness
@ApplicationScoped
public class Neo4jHealthCheck implements HealthCheck {
   private static final String CYPHER = "RETURN 1 AS result";
   private static final SessionConfig DEFAULT_SESSION_CONFIG = SessionConfig.builder()
           .withDefaultAccessMode(AccessMode.WRITE)
           .build();
   private final Driver driver;
  
   @Inject
   //will be ignored outside of CDI
   Neo4jHealthCheck(Driver driver) {
       this.driver = driver;
   }
   public static Neo4jHealthCheck create(Driver driver) {
       return new Neo4jHealthCheck(driver);
   }
   private static HealthCheckResponse buildStatusUp(ResultSummary resultSummary, HealthCheckResponseBuilder builder) {
       ServerInfo serverInfo = resultSummary.server();
       builder.withData("server", serverInfo.version() + "@" + serverInfo.address());
       String databaseName = resultSummary.database().name();
       if (!(databaseName == null || databaseName.trim().isEmpty())) {
           builder.withData("database", databaseName.trim());
       }
       return builder.build();
   }
   @Override
   public HealthCheckResponse call() {
       HealthCheckResponseBuilder builder = HealthCheckResponse.named("Neo4j connection health check").up();
       try {
           ResultSummary resultSummary;
           // Retry one time when the session has been expired
           try {
               resultSummary = runHealthCheckQuery();
           } catch (SessionExpiredException sessionExpiredException) {
               resultSummary = runHealthCheckQuery();
           }
           return buildStatusUp(resultSummary, builder);
       } catch (Exception e) {
           return builder.down().withData("reason", e.getMessage()).build();
       }
   }
   private ResultSummary runHealthCheckQuery() {
       // We use WRITE here to make sure UP is returned for a server that supports
       // all possible workloads
       if (driver != null) {
           Session session = this.driver.session(DEFAULT_SESSION_CONFIG);
           Result run = session.run(CYPHER);
           return run.consume();
       }
       return null;
   }
} </code></pre><p>Технически для health check-a, мы выполняем простой запрос на Cypher, и если он работает, значит, Neo4j жив, этого достаточно!</p><p>Нам нужно только добавить Maven зависимость в наш проект:</p><pre><code class="xml">&lt;dependency>
   &lt;groupId>io.helidon.integrations.neo4j&lt;/groupId>
   &lt;artifactId>helidon-integrations-neo4j-health&lt;/artifactId>
&lt;/dependency> </code></pre><p>И снова - <em>Вуаля, все работает</em>!</p><p>Что касается SE, поскольку это чистая Java, нам просто нужно все инициализировать:</p><pre><code class="java">Neo4j neo4j = Neo4j.create(config.get("neo4j"));
Neo4jHealthCheck healthCheck = Neo4jHealthCheck.create(neo4j.driver());
Driver neo4jDriver = neo4j.driver();
HealthSupport health = HealthSupport.builder()
     .addLiveness(HealthChecks.healthChecks())   // Adds a convenient set of checks
     .addReadiness(healthCheck)
     .build();

return Routing.builder()
        .register(health)                   // Health at "/health"
        //other services
        .build();
} </code></pre><p>Теперь наше Helidon приложение, как MP, так и SE, может работать с Neo4j, читать его метрики и выполнять health checks. </p><p>Кстати, поскольку драйвер Neo4j полностью поддерживает GraalVM native-image, приложения на Helidon MP или SE могут быть в него скомпилированы!</p><p>В этой статье было продемонстрировано, как создать интеграцию разных технологий с Helidon. Что касается Neo4j, мы уже официально сделали это за вас!</p><p>Просто нужно включить в свои Maven проект следующие зависимости:</p><pre><code class="xml">&lt;dependency>
   &lt;groupId>io.helidon.integrations.neo4j&lt;/groupId>
   &lt;artifactId>helidon-integrations-neo4j&lt;/artifactId>
&lt;/dependency>
&lt;dependency>
   &lt;groupId>io.helidon.integrations.neo4j&lt;/groupId>
   &lt;artifactId>helidon-integrations-neo4j-metrics&lt;/artifactId>
&lt;/dependency>
&lt;dependency>
   &lt;groupId>io.helidon.integrations.neo4j&lt;/groupId>
   &lt;artifactId>helidon-integrations-neo4j-health&lt;/artifactId>
&lt;/dependency> </code></pre><p>… И это все, что вам нужно для начала работы с Helidon и Neo4j!</p><h2>Заключение</h2><p>Как видите, интеграция с Helidon довольно проста. Стандартный способ сделать это - сначала написать supportобъект Helidon SE, следуя шаблону Builder для его инициализации, а затем просто обернуть его в CDI расширение, чтобы MicroProfile мог воспользоваться этой "магией"!</p><p>Вы можете поиграть с примерами Helidon ин Neo4j в нашем официальном <a href="https://github.com/oracle/helidon/tree/master/examples/integrations/neo4j" rel="noopener noreferrer nofollow"><u>репозитории интеграции Helidon Neo4j</u></a> .</p><p>Что касается Neo4j, вас также может заинтересовать <a href="https://github.com/neo4j-contrib/cypher-dsl" rel="noopener noreferrer nofollow"><u>CypherDsl</u></a> и <a href="https://github.com/neo4j-contrib/cypher-dsl" rel="noopener noreferrer nofollow"><u>пример</u></a> с ним.</p><h2>Следующие шаги</h2><p>В этой статье я хотел показать вам не только, как Neo4j работает с Helidon, но и как вы можете писать свои собственные расширения. Поскольку Helidon опенсорсный продукт, мы приглашаем вас в него контрибьютить!</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BJava%5D" class="tm-tags-list__link">Java</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BNeo4j%5D" class="tm-tags-list__link">Neo4j</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BHelidon%5D" class="tm-tags-list__link">Helidon</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D1%8B%5D" class="tm-tags-list__link">микросервисы</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/java/" class="tm-hubs-list__link">
    Java
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/microservices/" class="tm-hubs-list__link">
    Микросервисы
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 6: ↑5 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 6: ↑5 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+4</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">894</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    5
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/advbg/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/a7c/a2d/53f/a7ca2d53f8c62a0012f99094253313b9.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 18 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    16
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">4</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Дмитрий Александров</span> <a href="/ru/users/advbg/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @advbg
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/584796/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/584796/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/584796/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"584796":{"id":"584796","timePublished":"2021-10-22T13:15:01+00:00","isCorporative":false,"lang":"ru","titleHtml":"Как мы Neo4j к Helidon прикручивали","leadData":{"textHtml":"\u003Cp\u003EИдея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. \u003C\u002Fp\u003E\u003Cp\u003E\u003Cem\u003ENeo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на 2015 год считается самой распространённой графовой СУБД. (Википедия, 21.10.2021) \u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003ENeo4j написана на Java и доступна из ПО, написанного на других языках с использованием языка запросов Cypher, через транзакционную конечную точку HTTP или через двоичный протокол «bolt». Neo4j в настоящее время является стандартом де-факто для графовых баз данных, используемых во многих отраслях. \u003C\u002Fp\u003E\u003Cp\u003EВообще, в се началось с небольшого разговора с Michael Simonis, одним из авторов Spring Data Neo4j 6 и сопровождающим Neo4j-OGM. Мы спросили Михаеля, что он думает о том, как Helidon и Neo4J могут работать вместе. Менее чем через час Михаель прислал мне ссылку на этот репозиторий с полнофункциональным примером для Helidon MP и Neo4j SDN. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7b0\u002Fb2d\u002F29a\u002F7b0b2d29a30b7bdc467cbd7e24071ca9.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7b0\u002Fb2d\u002F29a\u002F7b0b2d29a30b7bdc467cbd7e24071ca9.png","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":16,"votesCount":18},"rating":4,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"185820","alias":"advbg","fullname":"Дмитрий Александров","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa7c\u002Fa2d\u002F53f\u002Fa7ca2d53f8c62a0012f99094253313b9.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":5,"readingCount":894,"score":4,"votesCount":6},"hubs":[{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true},{"relatedData":null,"id":"22115","alias":"microservices","type":"collective","title":"Микросервисы","titleHtml":"Микросервисы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"704\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7b0\u002Fb2d\u002F29a\u002F7b0b2d29a30b7bdc467cbd7e24071ca9.png\" data-width=\"1400\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИдея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. \u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cem\u003ENeo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на 2015 год считается самой распространённой графовой СУБД. (Википедия, 21.10.2021) \u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003ENeo4j написана на Java и доступна из ПО, написанного на других языках с использованием языка запросов Cypher, через HTTP endpoint или через протокол «bolt». Neo4j в настоящее время является стандартом де-факто для графовых баз данных, используемых во многих отраслях. \u003C\u002Fp\u003E\u003Cp\u003EВообще, в се началось с небольшого разговора с Michael Simonis, одним из авторов Spring Data Neo4j 6 и сопровождающим Neo4j-OGM. Мы спросили Михаеля, что он думает о том, как Helidon и Neo4J могут работать вместе. Менее чем через час Михаель прислал мне ссылку на этот репозиторий с полнофункциональным примером для Helidon MP и Neo4j SDN. \u003C\u002Fp\u003E\u003Cp\u003EКогда я начал читать код, я увидел странную зависимость в файле pom.xml:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;dependency\u003E\n    &lt;groupId\u003Eorg.springframework.data&lt;\u002FgroupId\u003E\n    &lt;artifactId\u003Espring-data-neo4j&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003ESpring? Да ладна! Почему в нашем проекте есть Spring? \u003C\u002Fp\u003E\u003Cp\u003EНо продолжая изучать код, я был весьма удивлен, увидев расширение CDI 2.0, обрабатывающее инициализацию и подготовку драйвера. Это расширение CDI запустилось без проблем в Helidon, поскольку он полностью поддерживает контейнер CDI - шикарно! Я снова почувствовал красоту и силу стандартов. \u003C\u002Fp\u003E\u003Cp\u003EНа следующий день Михаель прислал мне другое репо. На этот раз он включил свои идеи о том, как использовать Neo4j с Helidon SE. Интеграция тоже получилась очень простой. Было легко использовать Helidon Config для переноса всей конфигурации Neo4j в единую конфигурацию. А поскольку драйвер Neo4j полностью поддерживает native image, все можно скомпилировать в native-image исполняемый файл без каких-либо дополнительных действий с точки зрения программиста. \u003C\u002Fp\u003E\u003Cp\u003EЭто породило дискуссии между командами Helidon и Neo4j о том, какой вид интеграции более подходит для Helidon. В результате мы создали официальную интеграцию! \u003C\u002Fp\u003E\u003Cp\u003EПосле некоторых консультаций с представителем Neo4j и моим хорошим другом Михаелем Симонисом мы пришли к выводу, что нам нужно только прдоставлять инициализированный драйвер пользователям Helidon. Метрики и Health Checks из Neo4j должны быть проброшены в метрики Helidon \u002F MicroProfile и должны предоставляться как отдельные модули - отдельные зависимости Maven. \u003C\u002Fp\u003E\u003Cp\u003EИтак, как же нам написать интеграцию Neo4j с Helidon? существуют две разновидности Helidon - MP и SE. SE представляет собой набор реактивных API, реализованных на чистой Java. Абсолютно никакой «магии» вроде рефлекшана или других хитростей. Helidon MP, по сути, оборачивает SE и приводит его к стандартам MicroProfile. Это означает, что рекомендуется сначала реализовать интеграцию с Neo4j для Helidon SE, а затем обернуть ее как расширения CDI для Helidon MP.\u003C\u002Fp\u003E\u003Ch3\u003EДавайте сделаем это! \u003C\u002Fh3\u003E\u003Cblockquote\u003E\u003Cp\u003E\u003Cem\u003EДисклеймер: в этой статье я продемонстрирую только основные фрагменты кода. Поскольку Helidon опенсорс проект под лицензией Apache 2.0, полный код доступен в официальном репозитории Helidon.\u003C\u002Fem\u003E \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EВ Helidon мы обычно создаем так называемый support объект для реализации интеграции. Этот объект содержит всю информацию о конфигурации и инициализации. Мы следуем Builder pattern для чтения из конфигурации. Это означает, что мы создаем внутренний объект Builder, который должен читать все данные из конфигурации:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Epublic Builder config(Config config) {\n   config.get(\"authentication.username\").asString().ifPresent(this::username);\n   config.get(\"authentication.password\").asString().ifPresent(this::password);\n   config.get(\"authentication.enabled\").asBoolean().ifPresent(this::authenticationEnabled);\n   config.get(\"uri\").asString().ifPresent(this::uri);\n   config.get(\"encrypted\").asBoolean().ifPresent(this::encrypted);\n   \u002F\u002Fpool\n   config.get(\"pool.metricsEnabled\").asBoolean().ifPresent(this::metricsEnabled);\n   config.get(\"pool.logLeakedSessions\").asBoolean().ifPresent(this::logLeakedSessions);\n   config.get(\"pool.maxConnectionPoolSize\").asInt().ifPresent(this::maxConnectionPoolSize);\n   config.get(\"pool.idleTimeBeforeConnectionTest\").as(Duration.class).ifPresent(this::idleTimeBeforeConnectionTest);\n   config.get(\"pool.maxConnectionLifetime\").as(Duration.class).ifPresent(this::maxConnectionLifetime);\n   config.get(\"pool.connectionAcquisitionTimeout\").as(Duration.class).ifPresent(this::connectionAcquisitionTimeout);\n   \u002F\u002Ftrust   \n   config.get(\"trustsettings.trustStrategy\").asString().map(TrustStrategy::valueOf).ifPresent(this::trustStrategy);\n   config.get(\"trustsettings.certificate\").as(Path.class).ifPresent(this::certificate);\n   config.get(\"trustsettings.hostnameVerificationEnabled\").asBoolean().ifPresent(this::hostnameVerificationEnabled);\n   return this;\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВы можете увидеть строки с ключами, они фактически взяты из файла конфигурации. причем, либо из конфигурации SE, либо из конфигурации MicroProfile. Каждый элемент настраивается следуя шаблону Builder:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E...\npublic Builder password(String password) {\n   Objects.requireNonNull(password);\n   this.password = password;\n   return this;\n}\n... \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКогда все поля установлены, мы можем сбилдить support объект:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E@Override\npublic Neo4j build() {\n   if (driver == null) {\n       driver = initDriver();\n   }\n   return new Neo4j(this);\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТаким образом мы гарантируем, что все значения не будут нулевыми. Фактическая инициализация драйвера довольно проста (некоторые методы опущены):\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eprivate Driver initDriver() {\n   AuthToken authToken = AuthTokens.none();\n   if (authenticationEnabled) {\n       authToken = AuthTokens.basic(username, password);\n   }\n   org.neo4j.driver.Config.ConfigBuilder configBuilder = createBaseConfig();\n   configureSsl(configBuilder);\n   configurePoolSettings(configBuilder);\n   return GraphDatabase.driver(uri, authToken, configBuilder.build());\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E Support объект далее просто возвращает драйвер:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Epublic Driver driver() {\n   return driver;\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E... и его можно использовать:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003ENeo4jMetricsSupport.builder()\n       .driver(neo4j.driver())\n       .build()\n       .initialize();\nDriver neo4jDriver = neo4j.driver(); \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EHelidon позаботится о его инициализации из файла application.yaml:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003Eneo4j:\n uri: bolt:\u002F\u002Flocalhost:7687\n authentication:\n   username: neo4j\n   password: secret\n pool:\n   metricsEnabled: true \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EСобственно все - можно использовать уже в своем коде:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Epublic List&lt;Movie\u003E findAll(){\n   try (var session = driver.session()) {\n       var query = \"\"\n               + \"match (m:Movie) \"\n               + \"match (m) &lt;- [:DIRECTED] - (d:Person) \"\n               + \"match (m) &lt;- [r:ACTED_IN] - (a:Person) \"\n               + \"return m, collect(d) as directors, collect({name:a.name, roles: r.roles}) as actors\";\n       return session.readTransaction(tx -\u003E tx.run(query).list(r -\u003E {\n           var movieNode = r.get(\"m\").asNode();\n           var directors = r.get(\"directors\").asList(v -\u003E {\n               var personNode = v.asNode();\n               return new Person(personNode.get(\"born\").asInt(), personNode.get(\"name\").asString());\n           });\n           var actors = r.get(\"actors\").asList(v -\u003E {\n               return new Actor(v.get(\"name\").asString(), v.get(\"roles\").asList(Value::asString));\n           });\n           var m = new Movie(movieNode.get(\"title\").asString(), movieNode.get(\"tagline\").asString());\n           m.setReleased(movieNode.get(\"released\").asInt());\n           m.setDirectorss(directors);\n           m.setActors(actors);\n           return m;\n       }));\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ \u003Cem\u003Eвуаля\u003C\u002Fem\u003E! Helidon и Neo4j теперь могут работать вместе.\u003C\u002Fp\u003E\u003Cp\u003EА как же MP? \u003C\u002Fp\u003E\u003Cp\u003EНам просто нужно обернуть нашу интеграцию в расширение CDI - это действительно довольно просто:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Epublic class Neo4jCdiExtension implements Extension {\n   private static final String NEO4J_METRIC_NAME_PREFIX = \"neo4j\";\n   void afterBeanDiscovery(@Observes AfterBeanDiscovery addEvent) {\n       addEvent.addBean()\n               .types(Driver.class)\n               .qualifiers(Default.Literal.INSTANCE, Any.Literal.INSTANCE)\n               .scope(ApplicationScoped.class)\n               .name(Driver.class.getName())\n               .beanClass(Driver.class)\n               .createWith(creationContext -\u003E {\n                   org.eclipse.microprofile.config.Config config = ConfigProvider.getConfig();\n                   Config helidonConfig = MpConfig.toHelidonConfig(config).get(NEO4J_METRIC_NAME_PREFIX);\n\n                   ConfigValue&lt;Neo4j\u003E configValue = helidonConfig.as(Neo4j::create);\n                   if (configValue.isPresent()) {\n                       return configValue.get().driver();\n                   }\n                   throw new Neo4jException(\"There is no Neo4j driver configured in configuration under key 'neo4j\");\n               });\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКак видите, мы можем прочитать конфигурацию с помощью функций SE:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003EConfig helidonConfig = MpConfig.toHelidonConfig(config).get(NEO4J_METRIC_NAME_PREFIX); \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗатем просто повторно используем наш support объект Neo4j SE:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003EConfigValue&lt;Neo4j\u003E configValue = helidonConfig.as(Neo4j::create);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E… и возвращаем драйвер:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Ereturn configValue.get().driver();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ тоже собственно все - просто инжектим драйвер:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E@Inject\npublic MovieRepository(Driver driver) {\n   this.driver = driver;\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКонфигурация будет взята из файла \u003Ccode\u003Emicroprofile-config.properties\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003E# Neo4j settings\nneo4j.uri=bolt:\u002F\u002Flocalhost:7687\nneo4j.authentication.username=neo4j\nneo4j.authentication.password: secret\nneo4j.pool.metricsEnabled: true \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДалее можно использовать драйвер как в примере с SE.\u003C\u002Fp\u003E\u003Cp\u003EТеперь  и Helidon MP может работать с Neo4j!\u003C\u002Fp\u003E\u003Cp\u003EНо это еще не все!\u003C\u002Fp\u003E\u003Ch3\u003EМетрики\u003C\u002Fh3\u003E\u003Cp\u003EКак я уже упоминал, для надлежащей работе в облаках нам также необходимо пробросить метрики и health checks из Neo4j.\u003C\u002Fp\u003E\u003Cp\u003EСделаем как и раньше - сначала для SE, а потом все обернем в MP. \u003C\u002Fp\u003E\u003Cp\u003EНачнем с метрик! Сделаем отдельный модуль для метрик Neo4j.\u003C\u002Fp\u003E\u003Cp\u003EКак и в Helidon SE, в support объекте Neo4j мы будем следовать шаблону Builder для настройки поддержки метрик. На самом деле нам нужен только драйвер Neo4j, так как мы можем все показатели получить из него:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Epublic static class Builder implements io.helidon.common.Builder&lt;Neo4jMetricsSupport\u003E {\n   private Driver driver;\n   private Builder() {\n   }\n   public Neo4jMetricsSupport build() {\n       Objects.requireNonNull(driver, \"Must set driver before building\");\n       return new Neo4jMetricsSupport(this);\n   }\n   public Builder driver(Driver driver) {\n       this.driver = driver;\n       return this;\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗатем мы должны обернуть counter–ы и gauge–ы Neo4j:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eprivate static class Neo4JCounterWrapper implements Counter {\n   private final Supplier&lt;Long\u003E fn;\n   private Neo4JCounterWrapper(Supplier&lt;Long\u003E fn) {\n       this.fn = fn;\n   }\n   @Override\n   public void inc() {\n       throw new UnsupportedOperationException();\n   }\n   @Override\n   public void inc(long n) {\n       throw new UnsupportedOperationException();\n   }\n   @Override\n   public long getCount() {\n       return fn.get();\n   }\n}\n\nprivate static class Neo4JGaugeWrapper&lt;T\u003E implements Gauge&lt;T\u003E {\n   private final Supplier&lt;T\u003E supplier;\n   private Neo4JGaugeWrapper(Supplier&lt;T\u003E supplier) {\n       this.supplier = supplier;\n   }\n   @Override\n   public T getValue() {\n       return supplier.get();\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДалее нужно зарегистрировать эти счетчики в MetricsRegistry:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eprivate void registerCounter(MetricRegistry metricRegistry,\n                            ConnectionPoolMetrics cpm,\n                            String poolPrefix,\n                            String name,\n                            Function&lt;ConnectionPoolMetrics, Long\u003E fn) {\n   String counterName = poolPrefix + name;\n   if (metricRegistry.getCounters().get(new MetricID(counterName)) == null) {\n       Metadata metadata = Metadata.builder()\n               .withName(counterName)\n               .withType(MetricType.COUNTER)\n               .notReusable()\n               .build();\n       Neo4JCounterWrapper wrapper = new Neo4JCounterWrapper(() -\u003E fn.apply(cpm));\n       metricRegistry.register(metadata, wrapper);\n   }\n}\nprivate void registerGauge(MetricRegistry metricRegistry,\n                          ConnectionPoolMetrics cpm,\n                          String poolPrefix,\n                          String name,\n                          Function&lt;ConnectionPoolMetrics, Integer\u003E fn) {\n   String gaugeName = poolPrefix + name;\n   if (metricRegistry.getGauges().get(new MetricID(gaugeName)) == null) {\n       Metadata metadata = Metadata.builder()\n               .withName(poolPrefix + name)\n               .withType(MetricType.GAUGE)\n               .notReusable()\n               .build();\n       Neo4JGaugeWrapper&lt;Integer\u003E wrapper =\n               new Neo4JGaugeWrapper&lt;\u003E(() -\u003E fn.apply(cpm));\n       metricRegistry.register(metadata, wrapper);\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ мы практически готовы:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eprivate void reinit() {\n   Map&lt;String, Function&lt;ConnectionPoolMetrics, Long\u003E\u003E counters = Map.ofEntries(\n           entry(\"acquired\", ConnectionPoolMetrics::acquired),\n           entry(\"closed\", ConnectionPoolMetrics::closed),\n           entry(\"created\", ConnectionPoolMetrics::created),\n           entry(\"failedToCreate\", ConnectionPoolMetrics::failedToCreate),\n           entry(\"timedOutToAcquire\", ConnectionPoolMetrics::timedOutToAcquire),\n           entry(\"totalAcquisitionTime\", ConnectionPoolMetrics::totalAcquisitionTime),\n           entry(\"totalConnectionTime\", ConnectionPoolMetrics::totalConnectionTime),\n           entry(\"totalInUseCount\", ConnectionPoolMetrics::totalInUseCount),\n           entry(\"totalInUseTime\", ConnectionPoolMetrics::totalInUseTime));\n\n   Map&lt;String, Function&lt;ConnectionPoolMetrics, Integer\u003E\u003E gauges = Map.ofEntries(\n           entry(\"acquiring\", ConnectionPoolMetrics::acquiring),\n           entry(\"creating\", ConnectionPoolMetrics::creating),\n           entry(\"idle\", ConnectionPoolMetrics::idle),\n           entry(\"inUse\", ConnectionPoolMetrics::inUse)\n   );\n   for (ConnectionPoolMetrics it : lastPoolMetrics.get()) {\n       String poolPrefix = NEO4J_METRIC_NAME_PREFIX + \"-\";\n       counters.forEach((name, supplier) -\u003E registerCounter(metricRegistry.get(), it, poolPrefix, name, supplier));\n       gauges.forEach((name, supplier) -\u003E registerGauge(metricRegistry.get(), it, poolPrefix, name, supplier));\n       \u002F\u002F we only care about the first one\n       metricsInitialized.set(true);\n       break;\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВсегда полезно обновлять вовремя метрики, и для этого у нас есть функция:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eprivate void refreshMetrics(ScheduledExecutorService executor) {\n   Collection&lt;ConnectionPoolMetrics\u003E currentPoolMetrics = driver.metrics().connectionPoolMetrics();\n   if (!metricsInitialized.get() &amp;&amp; currentPoolMetrics.size() \u003E= 1) {\n       lastPoolMetrics.set(currentPoolMetrics);\n       reinit();\n       if (metricsInitialized.get()) {\n           reinitFuture.get().cancel(false);\n           executor.shutdown();\n       }\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНам нужно только предоставить драйвер Neo4j для предоставления нам информации о метриках в нашем файле application.yaml:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003Eneo4j:\n pool:\n   metricsEnabled: true \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E… Или в нашем \u003Cstrong\u003Emicroprofile-config.properties\u003C\u002Fstrong\u003E :\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Eneo4j.pool.metricsEnabled = true \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь, если вы пойдете по «\u002Fhealth», вы также получите показания от Neo4j.\u003C\u002Fp\u003E\u003Cp\u003EДля MP, нам нужно только обернуть регистрацию метрик как расширение CDI. Событие это должно произойти после того, как драйвер уже инициализирован:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003Epublic class Neo4jMetricsCdiExtension implements Extension {\n   private void addMetrics(@Observes @Priority(PLATFORM_AFTER + 101) @Initialized(ApplicationScoped.class) Object event) {\n       Instance&lt;Driver\u003E driver = CDI.current().select(Driver.class);\n       Neo4jMetricsSupport.builder()\n               .driver(driver.get())\n               .build()\n               .initialize();\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВот и все! Метрики Neo4j теперь доступны и в Helidon MP!\u003C\u002Fp\u003E\u003Cp\u003EИ теперь, последнее, но не менее важное, проверка работоспособности!\u003C\u002Fp\u003E\u003Ch3\u003EHealth Checks\u003C\u002Fh3\u003E\u003Cp\u003EИ опять же, это должен быть отдельный модуль, чтобы все было чисто и красиво.\u003C\u002Fp\u003E\u003Cp\u003EНа этот раз мы начнем с MP:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003E@Readiness\n@ApplicationScoped\npublic class Neo4jHealthCheck implements HealthCheck {\n   private static final String CYPHER = \"RETURN 1 AS result\";\n   private static final SessionConfig DEFAULT_SESSION_CONFIG = SessionConfig.builder()\n           .withDefaultAccessMode(AccessMode.WRITE)\n           .build();\n   private final Driver driver;\n  \n   @Inject\n   \u002F\u002Fwill be ignored outside of CDI\n   Neo4jHealthCheck(Driver driver) {\n       this.driver = driver;\n   }\n   public static Neo4jHealthCheck create(Driver driver) {\n       return new Neo4jHealthCheck(driver);\n   }\n   private static HealthCheckResponse buildStatusUp(ResultSummary resultSummary, HealthCheckResponseBuilder builder) {\n       ServerInfo serverInfo = resultSummary.server();\n       builder.withData(\"server\", serverInfo.version() + \"@\" + serverInfo.address());\n       String databaseName = resultSummary.database().name();\n       if (!(databaseName == null || databaseName.trim().isEmpty())) {\n           builder.withData(\"database\", databaseName.trim());\n       }\n       return builder.build();\n   }\n   @Override\n   public HealthCheckResponse call() {\n       HealthCheckResponseBuilder builder = HealthCheckResponse.named(\"Neo4j connection health check\").up();\n       try {\n           ResultSummary resultSummary;\n           \u002F\u002F Retry one time when the session has been expired\n           try {\n               resultSummary = runHealthCheckQuery();\n           } catch (SessionExpiredException sessionExpiredException) {\n               resultSummary = runHealthCheckQuery();\n           }\n           return buildStatusUp(resultSummary, builder);\n       } catch (Exception e) {\n           return builder.down().withData(\"reason\", e.getMessage()).build();\n       }\n   }\n   private ResultSummary runHealthCheckQuery() {\n       \u002F\u002F We use WRITE here to make sure UP is returned for a server that supports\n       \u002F\u002F all possible workloads\n       if (driver != null) {\n           Session session = this.driver.session(DEFAULT_SESSION_CONFIG);\n           Result run = session.run(CYPHER);\n           return run.consume();\n       }\n       return null;\n   }\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТехнически для health check-a, мы выполняем простой запрос на Cypher, и если он работает, значит, Neo4j жив, этого достаточно!\u003C\u002Fp\u003E\u003Cp\u003EНам нужно только добавить Maven зависимость в наш проект:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;dependency\u003E\n   &lt;groupId\u003Eio.helidon.integrations.neo4j&lt;\u002FgroupId\u003E\n   &lt;artifactId\u003Ehelidon-integrations-neo4j-health&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ снова - \u003Cem\u003EВуаля, все работает\u003C\u002Fem\u003E!\u003C\u002Fp\u003E\u003Cp\u003EЧто касается SE, поскольку это чистая Java, нам просто нужно все инициализировать:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"java\"\u003ENeo4j neo4j = Neo4j.create(config.get(\"neo4j\"));\nNeo4jHealthCheck healthCheck = Neo4jHealthCheck.create(neo4j.driver());\nDriver neo4jDriver = neo4j.driver();\nHealthSupport health = HealthSupport.builder()\n     .addLiveness(HealthChecks.healthChecks())   \u002F\u002F Adds a convenient set of checks\n     .addReadiness(healthCheck)\n     .build();\n\nreturn Routing.builder()\n        .register(health)                   \u002F\u002F Health at \"\u002Fhealth\"\n        \u002F\u002Fother services\n        .build();\n} \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТеперь наше Helidon приложение, как MP, так и SE, может работать с Neo4j, читать его метрики и выполнять health checks. \u003C\u002Fp\u003E\u003Cp\u003EКстати, поскольку драйвер Neo4j полностью поддерживает GraalVM native-image, приложения на Helidon MP или SE могут быть в него скомпилированы!\u003C\u002Fp\u003E\u003Cp\u003EВ этой статье было продемонстрировано, как создать интеграцию разных технологий с Helidon. Что касается Neo4j, мы уже официально сделали это за вас!\u003C\u002Fp\u003E\u003Cp\u003EПросто нужно включить в свои Maven проект следующие зависимости:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;dependency\u003E\n   &lt;groupId\u003Eio.helidon.integrations.neo4j&lt;\u002FgroupId\u003E\n   &lt;artifactId\u003Ehelidon-integrations-neo4j&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E\n&lt;dependency\u003E\n   &lt;groupId\u003Eio.helidon.integrations.neo4j&lt;\u002FgroupId\u003E\n   &lt;artifactId\u003Ehelidon-integrations-neo4j-metrics&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E\n&lt;dependency\u003E\n   &lt;groupId\u003Eio.helidon.integrations.neo4j&lt;\u002FgroupId\u003E\n   &lt;artifactId\u003Ehelidon-integrations-neo4j-health&lt;\u002FartifactId\u003E\n&lt;\u002Fdependency\u003E \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E… И это все, что вам нужно для начала работы с Helidon и Neo4j!\u003C\u002Fp\u003E\u003Ch2\u003EЗаключение\u003C\u002Fh2\u003E\u003Cp\u003EКак видите, интеграция с Helidon довольно проста. Стандартный способ сделать это - сначала написать supportобъект Helidon SE, следуя шаблону Builder для его инициализации, а затем просто обернуть его в CDI расширение, чтобы MicroProfile мог воспользоваться этой \"магией\"!\u003C\u002Fp\u003E\u003Cp\u003EВы можете поиграть с примерами Helidon ин Neo4j в нашем официальном \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Foracle\u002Fhelidon\u002Ftree\u002Fmaster\u002Fexamples\u002Fintegrations\u002Fneo4j\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003Eрепозитории интеграции Helidon Neo4j\u003C\u002Fu\u003E\u003C\u002Fa\u003E .\u003C\u002Fp\u003E\u003Cp\u003EЧто касается Neo4j, вас также может заинтересовать \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fneo4j-contrib\u002Fcypher-dsl\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003ECypherDsl\u003C\u002Fu\u003E\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fneo4j-contrib\u002Fcypher-dsl\" rel=\"noopener noreferrer nofollow\"\u003E\u003Cu\u003Eпример\u003C\u002Fu\u003E\u003C\u002Fa\u003E с ним.\u003C\u002Fp\u003E\u003Ch2\u003EСледующие шаги\u003C\u002Fh2\u003E\u003Cp\u003EВ этой статье я хотел показать вам не только, как Neo4j работает с Helidon, но и как вы можете писать свои собственные расширения. Поскольку Helidon опенсорсный продукт, мы приглашаем вас в него контрибьютить!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"Java"},{"titleHtml":"Neo4j"},{"titleHtml":"Helidon"},{"titleHtml":"микросервисы"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7b0\u002Fb2d\u002F29a\u002F7b0b2d29a30b7bdc467cbd7e24071ca9.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7b0\u002Fb2d\u002F29a\u002F7b0b2d29a30b7bdc467cbd7e24071ca9.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584796\\\u002F\"},\"headline\":\"Как мы Neo4j к Helidon прикручивали\",\"datePublished\":\"2021-10-22T16:15:01+03:00\",\"dateModified\":\"2021-10-22T17:40:11+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Дмитрий Александров\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j &mdash; графовая система управления базами данных с открытым исходным кодом,...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584796\\\u002F#post-content-body\",\"about\":[\"h_java\",\"h_microservices\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F584796\\\u002F347d942a9e7bca36f130793f5746c127\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F7b0\\\u002Fb2d\\\u002F29a\\\u002F7b0b2d29a30b7bdc467cbd7e24071ca9.png\"]}","metaDescription":"Идея поэкспериментировать с интеграцией Neo4j с Helidon возникла вполне естественно. Neo4j — графовая система управления базами данных с открытым исходным кодом, реализованная на Java. По состоянию на...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"java,microservices"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
