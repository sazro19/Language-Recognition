<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Затачиваем маршрут GPS: несколько способов отфильтровать данные / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/atisu\/blog\/584528\/"},"headline":"Затачиваем маршрут GPS: несколько способов отфильтровать данные","datePublished":"2021-10-20T14:03:31+03:00","dateModified":"2021-10-21T01:01:05+03:00","author":{"@type":"Person","name":"Симкин Сергей"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять коорди...","url":"https:\/\/habr.com\/ru\/company\/atisu\/blog\/584528\/#post-content-body","about":["c_atisu","h_algorithms","h_map_api","h_csharp","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/584528\/4dc5b5d205f3a317002fad5d70c833c4\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/88f\/8a6\/cfc\/88f8a6cfc030a095c40ce09739ae7158.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/513\/7c7\/f61\/5137c7f61a226d9a40b7201a7d49bc45.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4ea\/722\/631\/4ea722631884a3f6ee60424c341f115f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a1a\/b5c\/2f7\/a1ab5c2f728716dda2f48708621bed4a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/805\/85f\/c56\/80585fc56ecc01dceba22c2c15bfa63c.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/8c5\/2b9\/73e\/8c52b973e9c3f7c2e3d3fa850294c1a0.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f8a\/588\/ee1\/f8a588ee11a9e6a6a1fca10e6995e666.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/fd4\/6bd\/60b\/fd46bd60bd5d5054c41ba2b5f6b44372.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/109\/661\/584\/1096615841461bff60e0c04d927c97d7.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/71f\/74f\/81b\/71f74f81b4e80f24bf948eb01a8f97ca.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/243\/f15\/97a\/243f1597a553c03ddc2d0faa20a46b11.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/526\/662\/f8e\/526662f8ecd64387a8f906e69659c8c8.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Затачиваем маршрут GPS: несколько способов отфильтровать данные" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Затачиваем маршрут GPS: несколько способов отфильтровать данные" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Затачиваем маршрут GPS: несколько способов отфильтровать данные" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/7d8/59b/938/7d859b9382e43e0d8188d2da4e6ce83b.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/7d8/59b/938/7d859b9382e43e0d8188d2da4e6ce83b.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/7d8/59b/938/7d859b9382e43e0d8188d2da4e6ce83b.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/7d8/59b/938/7d859b9382e43e0d8188d2da4e6ce83b.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/7d8/59b/938/7d859b9382e43e0d8188d2da4e6ce83b.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="584528" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-20T11:03:31.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/584528/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/company/atisu/blog/584528/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/7d8/59b/938/7d859b9382e43e0d8188d2da4e6ce83b.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/584528/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="atisu" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><!----></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-card tm-company-article__company-card"><div class="tm-company-card__info"><div class="tm-company-card__header"><a href="/ru/company/atisu/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="//habrastorage.org/getpro/habr/company/9ee/701/3f9/9ee7013f931da828cac2af6192c3da1f.png" width="48" class="tm-entity-image__pic"></div></a> <!----> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">85.71</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div> <div class="tm-company-card__info"><a href="/ru/company/atisu/profile/" class="tm-company-card__name">
        ATI.SU
      </a> <div class="tm-company-card__description"></div></div></div> <div class="tm-company-card__buttons"><!----> <!----></div></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/kr0l1k/" title="kr0l1k" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/62b/117/6dd/62b1176dd237c18a7f059ee3e6388b82.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/kr0l1k/" class="tm-user-info__username">
      kr0l1k
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-20T11:03:31.000Z" title="2021-10-20, 14:03">20  октября   в 14:03</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Затачиваем маршрут GPS: несколько способов отфильтровать данные</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/company/atisu/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании ATI.SU</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/algorithms/" class="tm-article-snippet__hubs-item-link"><span>Алгоритмы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/map_api/" class="tm-article-snippet__hubs-item-link"><span>Maps API</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/csharp/" class="tm-article-snippet__hubs-item-link"><span>C#</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании <a href="http://ATI.SU">ATI.SU</a>. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и отобразить их на карте.</p><p>В разных приложениях мы каждый день видим красивые маршруты из разряда "где везут мою шаверму" или "как я пробежал по парку маршрут в виде котика", но если просто соединить линиями точки, которые приходят от телефона, то мы увидим что-то вдохновленное произведением <a href="https://www.youtube.com/watch?v=JEq10L7u3SM">Fatboy Slim - Ya Mama</a>.  Как превратить исходные данные в красивую картинку, разберемся в статье.</p><p>Первая цель, которую мы преследуем — избавиться от визуального шума.</p><p>Вторая цель - сократить количество точек, чтобы ускорить время отрисовки самой карты на фронте.</p><p>Требования:</p><ul><li><p>сократить количество точек,</p></li><li><p>свести к минимуму количество выбросов,</p></li><li><p>допустимы потери точности.</p></li></ul><p>Исходные данные — набор координат от приложения на Android</p><p>Как это выглядит сейчас:</p><figure class="full-width "><img src="/img/image-loader.svg" height="182" data-src="https://habrastorage.org/getpro/habr/upload_files/88f/8a6/cfc/88f8a6cfc030a095c40ce09739ae7158.png" data-width="668"/><figcaption></figcaption></figure><p>Что хотим получить:</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/513/7c7/f61/5137c7f61a226d9a40b7201a7d49bc45.jpg" width="1179" height="1208" data-src="https://habrastorage.org/getpro/habr/upload_files/513/7c7/f61/5137c7f61a226d9a40b7201a7d49bc45.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Я засучил рукава и кинулся изучать, что же уже реализовано, и что можно добавить.</p><p>Примерно в то же время с алиэкспресса приехал станок для заточки ножей с камнями различной зернистости. Оказалось, что у заточки ножа много общего с фильтрацией GPS-координат.</p><h3>Фильтр точности</h3><p>Что же можно сделать в начале. Заточку ножа мы начинаем на самом грубом камне. Аналогично поступим с координатами. Так как данные приходят с приложения на Android, мы вместе с координатами получаем параметр accuracy. Согласно <a href="https://developer.android.com/reference/android/location/Location#getAccuracy()">спецификации</a> параметр означает, что с вероятностью 68% точка лежит в окружности с радиусом, равном значению accuracy.</p><p>Фильтрация по точности позволяет исключить те точки, которые априори считаются выбросами. Тестовый маршрут сократился в 7 раз при значении accuracy 10.</p><p>Но все не так просто.  Такую точность может выдать далеко не каждое устройство. Поэтому важно подобрать такое значение accuracy, которое позволит отфильтровать данные с высокой погрешностью, но одновременно с этим не отбросит маршруты, полученные с менее точных устройств.</p><p>Кстати, те значения, которые отдает приложение, уже обработаны фильтром Калмана на самом устройстве.</p><figure class="full-width "><img src="/img/image-loader.svg" height="650" data-src="https://habrastorage.org/getpro/habr/upload_files/4ea/722/631/4ea722631884a3f6ee60424c341f115f.png" data-width="796"/><figcaption></figcaption></figure><p>Реализация этого фильтра тривиальна и заключается в отсеивании всех точек, точность которых нас не устраивает.</p><h3>Фильтры скорости</h3><p>После такой грубой заточки перейдем к тонким настройкам и возьмем следующие камни.</p><p>Так как есть данные о времени получения и координаты предыдущих точек, то никто не запретит использовать фильтр по скорости. Остается установить, насколько быстро может передвигаться наш протеже, а все, что выходит за рамки, помечаем как выбросы.</p><p>Узнать скорость водителя можно, использовав средства мобильной платформы, либо вычислить на основе полученных GPS данных. Формула расчета скорости известна со школьной программы. Однако, следует учесть, что работая с координатами мы имеем дело не с прямыми, а c дугами на земном сфероиде. Метод расчета расстояния между двумя координатами должен это учитывать.</p><p>Формула расчета углового расстояния между объектами для учета небольших расстояний:</p><figure class="full-width "><img src="/img/image-loader.svg" height="79" data-src="https://habrastorage.org/getpro/habr/upload_files/a1a/b5c/2f7/a1ab5c2f728716dda2f48708621bed4a.png" data-width="564"/><figcaption></figcaption></figure><p>Листинг метода расчета расстояния с переменными из формулы:</p><pre><code class="cs">double rad = 0.0174532925199433; //значение градуса в радианах
double earthRadius = 6376500.0; //усредненное значение радиуса Земли
public double GetDistanceTo(GeoCoordinate from,GeoCoordinate to)
{
  double a1 = from.Latitude * rad; //значение координаты в радианах
  double a1 = from.Longitude * rad;
  double a2 = to.Latitude * rad;
  double b2 = to.Longitude * rad;
  double d3 = Math.Pow(Math.Sin((a2 - a1) / 2.0), 2.0) + Math.Cos(a2) * Math.Cos(a1) * Math.Pow(Math.Sin((b2-b1) / 2.0), 2.0); // угловое расстояние
  return 2.0 * earthRadius * Math.Asin(d3);
}</code></pre><p>Остается установить, насколько быстро может передвигаться объект, а все, что выходит за рамки, помечаем как выбросы. Работая исключительно с грузовиками, мы исключаем участки маршрута, на которых автомобиль движется > 150 км/ч. Но этот лимит можно при желании смело уменьшить: если водитель превышает эту скорость, то, вероятнее всего, движется по прямой и при отображении карты такие точки соединятся, образуя прямую на трассе.</p><h3>Фильтр ускорения</h3><p>Зная скорость, мы можем посчитать ускорение. Напомню формулу:</p><figure class=""><img src="/img/image-loader.svg" height="150" data-src="https://habrastorage.org/getpro/habr/upload_files/805/85f/c56/80585fc56ecc01dceba22c2c15bfa63c.png" data-width="250"/><figcaption></figcaption></figure><p>Для того чтобы определиться с максимально возможным ускорением объекта, можно обратиться к статистике. В нашем случае, нам следует найти информацию о максимальном ускорении грузовика. Например, КАМАЗ Liebherr разгоняется от 0 до 100 км/ч=27,78 м/с за 10 с. Следовательно, максимально возможное ускорение =2,78  м/c^2. Это слишком большая величина, чтобы откидывать точки реальных пользователей, но для фильтрации грубых выбросов нам этого достаточно.</p><h3>Сворачивание точек</h3><p>Зачастую бывает, что в поездке водителю приходится остановиться. В этот момент продолжается сбор координат, и на нефильтрованной карте наблюдается жуткое метание вокруг одной точки.</p><p>Такие точки мы можем свернуть в одну. Эмпирическим путем мы пришли к алгоритму, в котором схлопываем все точки, находящиеся в радиусе 5 метров и разбросанные по времени не больше, чем на 60 секунд (помним, что водитель может возвращаться обратно той же дорогой, поэтому важно учитывать время, прошедшее между съемом координат).</p><p>Для примера, рассмотрим небольшой маршрут, где водитель вышел из машины и отправился куда-либо пешком.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Отображение участка оригинального маршрута" title="Отображение участка оригинального маршрута" height="975" data-src="https://habrastorage.org/getpro/habr/upload_files/8c5/2b9/73e/8c52b973e9c3f7c2e3d3fa850294c1a0.png" data-width="1047"/><figcaption>Отображение участка оригинального маршрута</figcaption></figure><p>Наш пользователь благополучно перешел проспект Ленина и некоторое время стоял на месте. Если отсеять все его точки, когда он крутился вокруг одной точки, то получим следующую картину. Из 100 точек оригинального маршрута осталось 42.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)" title="Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)" height="936" data-src="https://habrastorage.org/getpro/habr/upload_files/f8a/588/ee1/f8a588ee11a9e6a6a1fca10e6995e666.png" data-width="882"/><figcaption>Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)</figcaption></figure><p>Но открытым остается вопрос, что же его завело в прокуратуру?</p><h3>Медианный фильтр</h3><p>И вот приближаемся к финишным заточкам. Точки, которые остались после предыдущих фильтраций, сглаживаем, применив медианный фильтр.</p><p>К достоинствам медианного фильтра относится то, что он довольно прост в реализации и хорошо нивелирует единичные выбросы.</p><p>Однако не стоит забывать и о недостатках медианного фильтра. Так, резкие изменения направления движения могут оказаться сглаженными.</p><p>Принцип медианного фильтра:</p><ol><li><p>выбираем размер отрезка, который будем наполнять полученными значениями;</p></li><li><p>заполняем этот отрезок значениями широты и долготы, полученных координат;</p></li><li><p>сортируем значения для широты и долготы;</p></li><li><p>для каждого нового значения координаты мы ищем медиану по значению составляющих координаты относительно соседей;</p></li><li><p>смещаем значения в отрезке путем добавления следующей координаты.</p></li></ol><p>Возьмем часть предыдущего маршрута и применим медианный фильтр.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)" title="Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)" height="776" data-src="https://habrastorage.org/getpro/habr/upload_files/fd4/6bd/60b/fd46bd60bd5d5054c41ba2b5f6b44372.png" data-width="1132"/><figcaption>Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)</figcaption></figure><figure class="full-width "><img src="/img/image-loader.svg" alt="Отображение участка оригинального маршрута (зеленый) 
и маршрута после сворачивания точек и медианной фильтрации (красный)" title="Отображение участка оригинального маршрута (зеленый) 
и маршрута после сворачивания точек и медианной фильтрации (красный)" height="712" data-src="https://habrastorage.org/getpro/habr/upload_files/109/661/584/1096615841461bff60e0c04d927c97d7.png" data-width="1062"/><figcaption>Отображение участка оригинального маршрута (зеленый) 
и маршрута после сворачивания точек и медианной фильтрации (красный)</figcaption></figure><p>Легко заметить, то в нашем случае фильтр сглаживает полученные значения. Если провести аналогию с заточкой, то медианный фильтр — мусат, которым выправляют заточку лезвия ножа.</p><p>Теперь заметно, что в прокуратуру наблюдаемый не заходил. Можно только за него порадоваться.</p><h3>Фильтр Калмана</h3><p>Самым известным алгоритмом фильтрации координат является фильтр Калмана. Этому фильтру уже посвящен <a href="https://www.kalmanfilter.net/default.aspx">сайт</a>. Про него регулярно выходят статьи. Так что не будем вдаваться в подробности и вспомним основные принципы.</p><p>Алгоритм работает в два этапа:</p><ul><li><p>прогнозирование — просчитываются переменные состояния и неопределенности;</p></li><li><p>коррекция — полученные результаты уточняются благодаря спрогнозированным результатам.</p></li></ul><figure class="full-width "><img src="/img/image-loader.svg" height="318" data-src="https://habrastorage.org/getpro/habr/upload_files/71f/74f/81b/71f74f81b4e80f24bf948eb01a8f97ca.png" data-width="666"/><figcaption></figcaption></figure><p>В классической ситуации Калман используется, когда известно что-то о физике процесса, и все входные погрешности помещаются в ошибку измерения. Как двигается наш подопечный —  неизвестно. Поэтому приходится использовать сокращенную формулу, в которой подбираются коэффициенты. Остается только подставить координаты в формулу.</p><p>Однако на некоторых Android-устройствах координаты уже обрабатываются этим фильтром, так что применения фильтра Калмана можно заменить фильтрацией выбросов и сжатием точек простоя.</p><h3>Алгоритм Рамера — Дугласа — Пекера</h3><p>На случай если у вас уже есть завершенный маршрут и вы хотите сократить в нем количество точек, то можно воспользоваться реализацией алгоритма Рамера-Дугласа-Пекера.  Смысл его сводится к тому, что по заданной кривой мы строим прямую, аппроксимирующую данную, с меньшим количеством точек, учитывая значение точности.</p><p>Выглядит это примерно вот так:</p><figure class=""><img src="/img/image-loader.svg" height="612" data-src="https://habrastorage.org/getpro/habr/upload_files/243/f15/97a/243f1597a553c03ddc2d0faa20a46b11.png" data-width="440"/><figcaption></figcaption></figure><p>Так как конечный маршрут не известен, то в нашем случае применение данного алгоритма не целесообразно, но возможно для вашего проекта это именно то, чего вам не хватало.</p><pre><code>function DouglasPeucker(PointList[], epsilon)
        // проводим прямую между границами отрезка
        //ищем все значения перпендикуляров от точек до прямой
    dmax = 0
    index = 0
    end = length(PointList)
    for i = 2 to (end - 1) {
        d = perpendicularDistance(PointList[i], Line(PointList[1], PointList[end])) 
        if (d > dmax) {
            index = i
            dmax = d
        }
    }
    
ResultList[] = empty;
//если точка, максимально удаленная от перпендикуляра, больше значения точности
    //рекурсивно вызываем функцию на 2 образовавшихся отрезках
if (dmax &amp;gt; epsilon) {
    recResults1[] = DouglasPeucker(PointList[1...index], epsilon)
    recResults2[] = DouglasPeucker(PointList[index...end], epsilon)

    //составляем результат
    ResultList[] = {recResults1[1...length(recResults1) - 1], recResults2[1...length(recResults2)]}
} else {
    ResultList[] = {PointList[1], PointList[end]}
}
return ResultList[]

end
</code></pre><h3>Финальный этап</h3><p>Настало время проверять заточку нашего ножа. В теории он должен резать волос вдоль, как в лучших японских фильмах.</p><p>В итоге имеем фильтрованный маршрут. Количество точек сократилось с 5000 до 932.</p><p>Применив описанные методы, получили требуемый результат. Сократили количество точек маршрута, убрали выраженные шумы. Конечно мы потеряли в точности отображения маршрута, но по текущим требованиям данные допуски являются нормальными.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Отображение участка оригинального маршрута (зеленый) и маршрута после обработки (красный)" title="Отображение участка оригинального маршрута (зеленый) и маршрута после обработки (красный)" height="844" data-src="https://habrastorage.org/getpro/habr/upload_files/526/662/f8e/526662f8ecd64387a8f906e69659c8c8.png" data-width="897"/><figcaption>Отображение участка оригинального маршрута (зеленый) и маршрута после обработки (красный)</figcaption></figure><h3>Вывод</h3><p>Применив простой набор фильтров, получилось сократить количество данных для передачи и улучшить визуальное качество маршрута.</p><h3>Но все ли так хорошо?</h3><p>К сожалению, даже если вы успешно заточили один нож, то это не значит, что остальные заточатся с тем же успехом.</p><p>Описанные в статье фильтры и их параметры подходят для решения наших задач, но в иных случаях могут совсем ломать ваш маршрут или не давать ощутимых результатов. При выборе фильтра требуется понимать, что нужно получить в итоге, и подбирать параметры в зависимости от ваших задач. Кому-то достаточно картошку порезать, а кому-то нарезать дорогущего лосося.</p><p>Но если вы еще не определились с задачами, то почему бы и не начать с этих фильтров?</p><h3>Список источников.</h3><p><a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80">https://ru.wikipedia.org/wiki/Медианный_фильтр</a></p><p><a href="https://habr.com/ru/post/166693/">https://habr.com/ru/post/166693/</a></p><p><a href="https://habr.com/ru/post/140274/">https://habr.com/ru/post/140274/</a></p><p><a href="https://gist.github.com/glebov21/011f338e037124553217abfda531d1e7">https://gist.github.com/glebov21/011f338e037124553217abfda531d1e7</a></p><p><a href="https://www.researchgate.net/publication/332726900_A_Fast_Trajectory_Filtering_Method_for_Massive_GPS_Data_Based_on_Neighboring_Points">https://www.researchgate.net/publication/332726900_A_Fast_Trajectory_Filtering_Method_for_Massive_GPS_Data_Based_on_Neighboring_Points</a></p><p><a href="https://www.sciencedirect.com/science/article/pii/S1877050916304872">https://www.sciencedirect.com/science/article/pii/S1877050916304872</a></p><p><a href="https://www.kalmanfilter.net/default.aspx">https://www.kalmanfilter.net/default.aspx</a></p><p><a href="https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm">https://en.wikipedia.org/wiki/Ramer–Douglas–Peucker_algorithm</a></p><p><a href="https://www.youtube.com/watch?v=EOoSJPuD-dc">https://www.youtube.com/watch?v=EOoSJPuD-dc</a></p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F%5D" class="tm-tags-list__link">фильтрация</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgps%5D" class="tm-tags-list__link">gps</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC%D1%8B%5D" class="tm-tags-list__link">алгоритмы</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BA%D0%B0%D0%BB%D0%BC%D0%B0%D0%BD%5D" class="tm-tags-list__link">калман</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BC%D0%B5%D0%B4%D0%B8%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9%20%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%5D" class="tm-tags-list__link">медианный фильтр</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BC%D0%B5%D0%B4%D0%B8%D0%B0%D0%BD%D0%BD%D0%B0%D1%8F%20%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F%5D" class="tm-tags-list__link">медианная фильтрация</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/company/atisu/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании ATI.SU
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/algorithms/" class="tm-hubs-list__link">
    Алгоритмы
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/map_api/" class="tm-hubs-list__link">
    Maps API
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/csharp/" class="tm-hubs-list__link">
    C#
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 10: ↑9 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 10: ↑9 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+8</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    34
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/company/atisu/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/9ee/701/3f9/9ee7013f931da828cac2af6192c3da1f.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/company/atisu/profile/" class="tm-company-snippet__title">ATI.SU</a> <div class="tm-company-snippet__description">Компания</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://about.ati.su/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/kr0l1k/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/62b/117/6dd/62b1176dd237c18a7f059ee3e6388b82.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 5 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    5
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">7</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Симкин Сергей</span> <a href="/ru/users/kr0l1k/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @kr0l1k
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">backend developer</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/company/atisu/blog/584528/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 13 
    </span></a> <!----></div></div></div>  <!---->  <!----> <!----></div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><span>
      1999
    </span></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="https://about.ati.su/" target="_blank" class="tm-company-basic-info__link">
      about.ati.su
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    201–500 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2021-10-11T08:54:20.000Z" title="2021-10-11, 11:54">11  октября  </time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="/ru/users/sheissaganchi/" class="tm-company-basic-info__link">
      Галина Саганчи
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/company/atisu/blog/584528/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/company/atisu/blog/584528/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"584528":{"id":"584528","timePublished":"2021-10-20T11:03:31+00:00","isCorporative":true,"lang":"ru","titleHtml":"Затачиваем маршрут GPS: несколько способов отфильтровать данные","leadData":{"textHtml":"\u003Cp\u003EПривет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании \u003Ca href=\"http:\u002F\u002FATI.SU\"\u003EATI.SU\u003C\u002Fa\u003E. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и отобразить их на карте.\u003C\u002Fp\u003E\u003Cp\u003EВ разных приложениях мы каждый день видим красивые маршруты из разряда \"где везут мою шаверму\" или \"как я пробежал по парку маршрут в виде котика\", но если просто соединить линиями точки, которые приходят от телефона, то мы увидим что-то вдохновленное произведением \u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=JEq10L7u3SM\"\u003EFatboy Slim - Ya Mama\u003C\u002Fa\u003E.  Как превратить исходные данные в красивую картинку, разберемся в статье.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7d8\u002F59b\u002F938\u002F7d859b9382e43e0d8188d2da4e6ce83b.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7d8\u002F59b\u002F938\u002F7d859b9382e43e0d8188d2da4e6ce83b.png","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":5,"votesCount":5},"rating":7,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"161138","alias":"kr0l1k","fullname":"Симкин Сергей","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F62b\u002F117\u002F6dd\u002F62b1176dd237c18a7f059ee3e6388b82.jpg","speciality":"backend developer"},"statistics":{"commentsCount":13,"favoritesCount":34,"readingCount":2039,"score":8,"votesCount":10},"hubs":[{"relatedData":null,"id":"22822","alias":"atisu","type":"corporative","title":"Блог компании ATI.SU","titleHtml":"Блог компании ATI.SU","isProfiled":false},{"relatedData":null,"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"relatedData":null,"id":"17419","alias":"map_api","type":"collective","title":"Maps API","titleHtml":"Maps API","isProfiled":true},{"relatedData":null,"id":"17718","alias":"csharp","type":"collective","title":"C#","titleHtml":"C#","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПривет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании \u003Ca href=\"http:\u002F\u002FATI.SU\"\u003EATI.SU\u003C\u002Fa\u003E. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и отобразить их на карте.\u003C\u002Fp\u003E\u003Cp\u003EВ разных приложениях мы каждый день видим красивые маршруты из разряда \"где везут мою шаверму\" или \"как я пробежал по парку маршрут в виде котика\", но если просто соединить линиями точки, которые приходят от телефона, то мы увидим что-то вдохновленное произведением \u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=JEq10L7u3SM\"\u003EFatboy Slim - Ya Mama\u003C\u002Fa\u003E.  Как превратить исходные данные в красивую картинку, разберемся в статье.\u003C\u002Fp\u003E\u003Cp\u003EПервая цель, которую мы преследуем — избавиться от визуального шума.\u003C\u002Fp\u003E\u003Cp\u003EВторая цель - сократить количество точек, чтобы ускорить время отрисовки самой карты на фронте.\u003C\u002Fp\u003E\u003Cp\u003EТребования:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eсократить количество точек,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eсвести к минимуму количество выбросов,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eдопустимы потери точности.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EИсходные данные — набор координат от приложения на Android\u003C\u002Fp\u003E\u003Cp\u003EКак это выглядит сейчас:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"182\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F88f\u002F8a6\u002Fcfc\u002F88f8a6cfc030a095c40ce09739ae7158.png\" data-width=\"668\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЧто хотим получить:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F513\u002F7c7\u002Ff61\u002F5137c7f61a226d9a40b7201a7d49bc45.jpg\" width=\"1179\" height=\"1208\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F513\u002F7c7\u002Ff61\u002F5137c7f61a226d9a40b7201a7d49bc45.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЯ засучил рукава и кинулся изучать, что же уже реализовано, и что можно добавить.\u003C\u002Fp\u003E\u003Cp\u003EПримерно в то же время с алиэкспресса приехал станок для заточки ножей с камнями различной зернистости. Оказалось, что у заточки ножа много общего с фильтрацией GPS-координат.\u003C\u002Fp\u003E\u003Ch3\u003EФильтр точности\u003C\u002Fh3\u003E\u003Cp\u003EЧто же можно сделать в начале. Заточку ножа мы начинаем на самом грубом камне. Аналогично поступим с координатами. Так как данные приходят с приложения на Android, мы вместе с координатами получаем параметр accuracy. Согласно \u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Freference\u002Fandroid\u002Flocation\u002FLocation#getAccuracy()\"\u003Eспецификации\u003C\u002Fa\u003E параметр означает, что с вероятностью 68% точка лежит в окружности с радиусом, равном значению accuracy.\u003C\u002Fp\u003E\u003Cp\u003EФильтрация по точности позволяет исключить те точки, которые априори считаются выбросами. Тестовый маршрут сократился в 7 раз при значении accuracy 10.\u003C\u002Fp\u003E\u003Cp\u003EНо все не так просто.  Такую точность может выдать далеко не каждое устройство. Поэтому важно подобрать такое значение accuracy, которое позволит отфильтровать данные с высокой погрешностью, но одновременно с этим не отбросит маршруты, полученные с менее точных устройств.\u003C\u002Fp\u003E\u003Cp\u003EКстати, те значения, которые отдает приложение, уже обработаны фильтром Калмана на самом устройстве.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"650\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4ea\u002F722\u002F631\u002F4ea722631884a3f6ee60424c341f115f.png\" data-width=\"796\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EРеализация этого фильтра тривиальна и заключается в отсеивании всех точек, точность которых нас не устраивает.\u003C\u002Fp\u003E\u003Ch3\u003EФильтры скорости\u003C\u002Fh3\u003E\u003Cp\u003EПосле такой грубой заточки перейдем к тонким настройкам и возьмем следующие камни.\u003C\u002Fp\u003E\u003Cp\u003EТак как есть данные о времени получения и координаты предыдущих точек, то никто не запретит использовать фильтр по скорости. Остается установить, насколько быстро может передвигаться наш протеже, а все, что выходит за рамки, помечаем как выбросы.\u003C\u002Fp\u003E\u003Cp\u003EУзнать скорость водителя можно, использовав средства мобильной платформы, либо вычислить на основе полученных GPS данных. Формула расчета скорости известна со школьной программы. Однако, следует учесть, что работая с координатами мы имеем дело не с прямыми, а c дугами на земном сфероиде. Метод расчета расстояния между двумя координатами должен это учитывать.\u003C\u002Fp\u003E\u003Cp\u003EФормула расчета углового расстояния между объектами для учета небольших расстояний:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"79\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa1a\u002Fb5c\u002F2f7\u002Fa1ab5c2f728716dda2f48708621bed4a.png\" data-width=\"564\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЛистинг метода расчета расстояния с переменными из формулы:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cs\"\u003Edouble rad = 0.0174532925199433; \u002F\u002Fзначение градуса в радианах\ndouble earthRadius = 6376500.0; \u002F\u002Fусредненное значение радиуса Земли\npublic double GetDistanceTo(GeoCoordinate from,GeoCoordinate to)\n{\n  double a1 = from.Latitude * rad; \u002F\u002Fзначение координаты в радианах\n  double a1 = from.Longitude * rad;\n  double a2 = to.Latitude * rad;\n  double b2 = to.Longitude * rad;\n  double d3 = Math.Pow(Math.Sin((a2 - a1) \u002F 2.0), 2.0) + Math.Cos(a2) * Math.Cos(a1) * Math.Pow(Math.Sin((b2-b1) \u002F 2.0), 2.0); \u002F\u002F угловое расстояние\n  return 2.0 * earthRadius * Math.Asin(d3);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОстается установить, насколько быстро может передвигаться объект, а все, что выходит за рамки, помечаем как выбросы. Работая исключительно с грузовиками, мы исключаем участки маршрута, на которых автомобиль движется \u003E 150 км\u002Fч. Но этот лимит можно при желании смело уменьшить: если водитель превышает эту скорость, то, вероятнее всего, движется по прямой и при отображении карты такие точки соединятся, образуя прямую на трассе.\u003C\u002Fp\u003E\u003Ch3\u003EФильтр ускорения\u003C\u002Fh3\u003E\u003Cp\u003EЗная скорость, мы можем посчитать ускорение. Напомню формулу:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"150\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F805\u002F85f\u002Fc56\u002F80585fc56ecc01dceba22c2c15bfa63c.png\" data-width=\"250\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДля того чтобы определиться с максимально возможным ускорением объекта, можно обратиться к статистике. В нашем случае, нам следует найти информацию о максимальном ускорении грузовика. Например, КАМАЗ Liebherr разгоняется от 0 до 100 км\u002Fч=27,78 м\u002Fс за 10 с. Следовательно, максимально возможное ускорение =2,78  м\u002Fc^2. Это слишком большая величина, чтобы откидывать точки реальных пользователей, но для фильтрации грубых выбросов нам этого достаточно.\u003C\u002Fp\u003E\u003Ch3\u003EСворачивание точек\u003C\u002Fh3\u003E\u003Cp\u003EЗачастую бывает, что в поездке водителю приходится остановиться. В этот момент продолжается сбор координат, и на нефильтрованной карте наблюдается жуткое метание вокруг одной точки.\u003C\u002Fp\u003E\u003Cp\u003EТакие точки мы можем свернуть в одну. Эмпирическим путем мы пришли к алгоритму, в котором схлопываем все точки, находящиеся в радиусе 5 метров и разбросанные по времени не больше, чем на 60 секунд (помним, что водитель может возвращаться обратно той же дорогой, поэтому важно учитывать время, прошедшее между съемом координат).\u003C\u002Fp\u003E\u003Cp\u003EДля примера, рассмотрим небольшой маршрут, где водитель вышел из машины и отправился куда-либо пешком.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Отображение участка оригинального маршрута\" title=\"Отображение участка оригинального маршрута\" height=\"975\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8c5\u002F2b9\u002F73e\u002F8c52b973e9c3f7c2e3d3fa850294c1a0.png\" data-width=\"1047\"\u002F\u003E\u003Cfigcaption\u003EОтображение участка оригинального маршрута\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНаш пользователь благополучно перешел проспект Ленина и некоторое время стоял на месте. Если отсеять все его точки, когда он крутился вокруг одной точки, то получим следующую картину. Из 100 точек оригинального маршрута осталось 42.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)\" title=\"Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)\" height=\"936\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff8a\u002F588\u002Fee1\u002Ff8a588ee11a9e6a6a1fca10e6995e666.png\" data-width=\"882\"\u002F\u003E\u003Cfigcaption\u003EОтображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНо открытым остается вопрос, что же его завело в прокуратуру?\u003C\u002Fp\u003E\u003Ch3\u003EМедианный фильтр\u003C\u002Fh3\u003E\u003Cp\u003EИ вот приближаемся к финишным заточкам. Точки, которые остались после предыдущих фильтраций, сглаживаем, применив медианный фильтр.\u003C\u002Fp\u003E\u003Cp\u003EК достоинствам медианного фильтра относится то, что он довольно прост в реализации и хорошо нивелирует единичные выбросы.\u003C\u002Fp\u003E\u003Cp\u003EОднако не стоит забывать и о недостатках медианного фильтра. Так, резкие изменения направления движения могут оказаться сглаженными.\u003C\u002Fp\u003E\u003Cp\u003EПринцип медианного фильтра:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003Eвыбираем размер отрезка, который будем наполнять полученными значениями;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eзаполняем этот отрезок значениями широты и долготы, полученных координат;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eсортируем значения для широты и долготы;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eдля каждого нового значения координаты мы ищем медиану по значению составляющих координаты относительно соседей;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eсмещаем значения в отрезке путем добавления следующей координаты.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EВозьмем часть предыдущего маршрута и применим медианный фильтр.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)\" title=\"Отображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)\" height=\"776\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffd4\u002F6bd\u002F60b\u002Ffd46bd60bd5d5054c41ba2b5f6b44372.png\" data-width=\"1132\"\u002F\u003E\u003Cfigcaption\u003EОтображение участка оригинального маршрута (зеленый) и маршрута после сворачивания точек (красный)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Отображение участка оригинального маршрута (зеленый) \nи маршрута после сворачивания точек и медианной фильтрации (красный)\" title=\"Отображение участка оригинального маршрута (зеленый) \nи маршрута после сворачивания точек и медианной фильтрации (красный)\" height=\"712\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F109\u002F661\u002F584\u002F1096615841461bff60e0c04d927c97d7.png\" data-width=\"1062\"\u002F\u003E\u003Cfigcaption\u003EОтображение участка оригинального маршрута (зеленый) \nи маршрута после сворачивания точек и медианной фильтрации (красный)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЛегко заметить, то в нашем случае фильтр сглаживает полученные значения. Если провести аналогию с заточкой, то медианный фильтр — мусат, которым выправляют заточку лезвия ножа.\u003C\u002Fp\u003E\u003Cp\u003EТеперь заметно, что в прокуратуру наблюдаемый не заходил. Можно только за него порадоваться.\u003C\u002Fp\u003E\u003Ch3\u003EФильтр Калмана\u003C\u002Fh3\u003E\u003Cp\u003EСамым известным алгоритмом фильтрации координат является фильтр Калмана. Этому фильтру уже посвящен \u003Ca href=\"https:\u002F\u002Fwww.kalmanfilter.net\u002Fdefault.aspx\"\u003Eсайт\u003C\u002Fa\u003E. Про него регулярно выходят статьи. Так что не будем вдаваться в подробности и вспомним основные принципы.\u003C\u002Fp\u003E\u003Cp\u003EАлгоритм работает в два этапа:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eпрогнозирование — просчитываются переменные состояния и неопределенности;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eкоррекция — полученные результаты уточняются благодаря спрогнозированным результатам.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"318\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F71f\u002F74f\u002F81b\u002F71f74f81b4e80f24bf948eb01a8f97ca.png\" data-width=\"666\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ классической ситуации Калман используется, когда известно что-то о физике процесса, и все входные погрешности помещаются в ошибку измерения. Как двигается наш подопечный —  неизвестно. Поэтому приходится использовать сокращенную формулу, в которой подбираются коэффициенты. Остается только подставить координаты в формулу.\u003C\u002Fp\u003E\u003Cp\u003EОднако на некоторых Android-устройствах координаты уже обрабатываются этим фильтром, так что применения фильтра Калмана можно заменить фильтрацией выбросов и сжатием точек простоя.\u003C\u002Fp\u003E\u003Ch3\u003EАлгоритм Рамера — Дугласа — Пекера\u003C\u002Fh3\u003E\u003Cp\u003EНа случай если у вас уже есть завершенный маршрут и вы хотите сократить в нем количество точек, то можно воспользоваться реализацией алгоритма Рамера-Дугласа-Пекера.  Смысл его сводится к тому, что по заданной кривой мы строим прямую, аппроксимирующую данную, с меньшим количеством точек, учитывая значение точности.\u003C\u002Fp\u003E\u003Cp\u003EВыглядит это примерно вот так:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"612\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F243\u002Ff15\u002F97a\u002F243f1597a553c03ddc2d0faa20a46b11.png\" data-width=\"440\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТак как конечный маршрут не известен, то в нашем случае применение данного алгоритма не целесообразно, но возможно для вашего проекта это именно то, чего вам не хватало.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Efunction DouglasPeucker(PointList[], epsilon)\n        \u002F\u002F проводим прямую между границами отрезка\n        \u002F\u002Fищем все значения перпендикуляров от точек до прямой\n    dmax = 0\n    index = 0\n    end = length(PointList)\n    for i = 2 to (end - 1) {\n        d = perpendicularDistance(PointList[i], Line(PointList[1], PointList[end])) \n        if (d \u003E dmax) {\n            index = i\n            dmax = d\n        }\n    }\n    \nResultList[] = empty;\n\u002F\u002Fесли точка, максимально удаленная от перпендикуляра, больше значения точности\n    \u002F\u002Fрекурсивно вызываем функцию на 2 образовавшихся отрезках\nif (dmax &amp;gt; epsilon) {\n    recResults1[] = DouglasPeucker(PointList[1...index], epsilon)\n    recResults2[] = DouglasPeucker(PointList[index...end], epsilon)\n\n    \u002F\u002Fсоставляем результат\n    ResultList[] = {recResults1[1...length(recResults1) - 1], recResults2[1...length(recResults2)]}\n} else {\n    ResultList[] = {PointList[1], PointList[end]}\n}\nreturn ResultList[]\n\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3\u003EФинальный этап\u003C\u002Fh3\u003E\u003Cp\u003EНастало время проверять заточку нашего ножа. В теории он должен резать волос вдоль, как в лучших японских фильмах.\u003C\u002Fp\u003E\u003Cp\u003EВ итоге имеем фильтрованный маршрут. Количество точек сократилось с 5000 до 932.\u003C\u002Fp\u003E\u003Cp\u003EПрименив описанные методы, получили требуемый результат. Сократили количество точек маршрута, убрали выраженные шумы. Конечно мы потеряли в точности отображения маршрута, но по текущим требованиям данные допуски являются нормальными.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Отображение участка оригинального маршрута (зеленый) и маршрута после обработки (красный)\" title=\"Отображение участка оригинального маршрута (зеленый) и маршрута после обработки (красный)\" height=\"844\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F526\u002F662\u002Ff8e\u002F526662f8ecd64387a8f906e69659c8c8.png\" data-width=\"897\"\u002F\u003E\u003Cfigcaption\u003EОтображение участка оригинального маршрута (зеленый) и маршрута после обработки (красный)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EВывод\u003C\u002Fh3\u003E\u003Cp\u003EПрименив простой набор фильтров, получилось сократить количество данных для передачи и улучшить визуальное качество маршрута.\u003C\u002Fp\u003E\u003Ch3\u003EНо все ли так хорошо?\u003C\u002Fh3\u003E\u003Cp\u003EК сожалению, даже если вы успешно заточили один нож, то это не значит, что остальные заточатся с тем же успехом.\u003C\u002Fp\u003E\u003Cp\u003EОписанные в статье фильтры и их параметры подходят для решения наших задач, но в иных случаях могут совсем ломать ваш маршрут или не давать ощутимых результатов. При выборе фильтра требуется понимать, что нужно получить в итоге, и подбирать параметры в зависимости от ваших задач. Кому-то достаточно картошку порезать, а кому-то нарезать дорогущего лосося.\u003C\u002Fp\u003E\u003Cp\u003EНо если вы еще не определились с задачами, то почему бы и не начать с этих фильтров?\u003C\u002Fp\u003E\u003Ch3\u003EСписок источников.\u003C\u002Fh3\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80\"\u003Ehttps:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FМедианный_фильтр\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F166693\u002F\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F166693\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F140274\u002F\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F140274\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgist.github.com\u002Fglebov21\u002F011f338e037124553217abfda531d1e7\"\u003Ehttps:\u002F\u002Fgist.github.com\u002Fglebov21\u002F011f338e037124553217abfda531d1e7\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.researchgate.net\u002Fpublication\u002F332726900_A_Fast_Trajectory_Filtering_Method_for_Massive_GPS_Data_Based_on_Neighboring_Points\"\u003Ehttps:\u002F\u002Fwww.researchgate.net\u002Fpublication\u002F332726900_A_Fast_Trajectory_Filtering_Method_for_Massive_GPS_Data_Based_on_Neighboring_Points\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.sciencedirect.com\u002Fscience\u002Farticle\u002Fpii\u002FS1877050916304872\"\u003Ehttps:\u002F\u002Fwww.sciencedirect.com\u002Fscience\u002Farticle\u002Fpii\u002FS1877050916304872\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.kalmanfilter.net\u002Fdefault.aspx\"\u003Ehttps:\u002F\u002Fwww.kalmanfilter.net\u002Fdefault.aspx\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FRamer%E2%80%93Douglas%E2%80%93Peucker_algorithm\"\u003Ehttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FRamer–Douglas–Peucker_algorithm\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=EOoSJPuD-dc\"\u003Ehttps:\u002F\u002Fwww.youtube.com\u002Fwatch?v=EOoSJPuD-dc\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"фильтрация"},{"titleHtml":"gps"},{"titleHtml":"алгоритмы"},{"titleHtml":"калман"},{"titleHtml":"медианный фильтр"},{"titleHtml":"медианная фильтрация"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7d8\u002F59b\u002F938\u002F7d859b9382e43e0d8188d2da4e6ce83b.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7d8\u002F59b\u002F938\u002F7d859b9382e43e0d8188d2da4e6ce83b.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fatisu\\\u002Fblog\\\u002F584528\\\u002F\"},\"headline\":\"Затачиваем маршрут GPS: несколько способов отфильтровать данные\",\"datePublished\":\"2021-10-20T14:03:31+03:00\",\"dateModified\":\"2021-10-21T01:01:05+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Симкин Сергей\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять коорди...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fatisu\\\u002Fblog\\\u002F584528\\\u002F#post-content-body\",\"about\":[\"c_atisu\",\"h_algorithms\",\"h_map_api\",\"h_csharp\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F584528\\\u002F4dc5b5d205f3a317002fad5d70c833c4\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F88f\\\u002F8a6\\\u002Fcfc\\\u002F88f8a6cfc030a095c40ce09739ae7158.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F513\\\u002F7c7\\\u002Ff61\\\u002F5137c7f61a226d9a40b7201a7d49bc45.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4ea\\\u002F722\\\u002F631\\\u002F4ea722631884a3f6ee60424c341f115f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa1a\\\u002Fb5c\\\u002F2f7\\\u002Fa1ab5c2f728716dda2f48708621bed4a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F805\\\u002F85f\\\u002Fc56\\\u002F80585fc56ecc01dceba22c2c15bfa63c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F8c5\\\u002F2b9\\\u002F73e\\\u002F8c52b973e9c3f7c2e3d3fa850294c1a0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff8a\\\u002F588\\\u002Fee1\\\u002Ff8a588ee11a9e6a6a1fca10e6995e666.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ffd4\\\u002F6bd\\\u002F60b\\\u002Ffd46bd60bd5d5054c41ba2b5f6b44372.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F109\\\u002F661\\\u002F584\\\u002F1096615841461bff60e0c04d927c97d7.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F71f\\\u002F74f\\\u002F81b\\\u002F71f74f81b4e80f24bf948eb01a8f97ca.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F243\\\u002Ff15\\\u002F97a\\\u002F243f1597a553c03ddc2d0faa20a46b11.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F526\\\u002F662\\\u002Ff8e\\\u002F526662f8ecd64387a8f906e69659c8c8.png\"]}","metaDescription":"Привет, меня зовут Сергей и я разработчик в команде мобильного бэкенда в компании ATI.SU. Не так давно в мою жизнь пришла задача. В ней нужно было принять координаты от приложения на Android и...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"atisu":{"alias":"atisu","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F9ee\u002F701\u002F3f9\u002F9ee7013f931da828cac2af6192c3da1f.png","titleHtml":"ATI.SU","descriptionHtml":null,"relatedData":null,"statistics":{"postsCount":3,"newsCount":0,"vacanciesCount":0,"employeesCount":14,"careerRating":null,"subscribersCount":28,"rating":85.71,"invest":null},"foundationDate":{"year":"1999","month":"11","day":null},"location":{"city":{"id":"447733","title":"Санкт-Петербург"},"region":{"id":"1948","title":"Санкт-Петербург и область"},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Fabout.ati.su\u002F","staffNumber":"201–500 человек","registrationDate":"2021-10-11T08:54:20+00:00","representativeUser":{"alias":"sheissaganchi","fullname":"Галина Саганчи"},"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fabout.ati.su\u002F"}],"settings":{"analyticsSettings":[],"branding":null,"status":"active"},"metadata":{"titleHtml":"ATI.SU, Санкт-Петербург -  с ноябрь 1999 года","title":"ATI.SU, Санкт-Петербург -  с ноябрь 1999 года","keywords":["Тестирование IT-систем","Тестирование мобильных приложений","Программирование","Расширения для браузеров","ReactJS"],"descriptionHtml":"3 статьи от авторов компании ATI.SU","description":"3 статьи от авторов компании ATI.SU"},"aDeskSettings":null,"careerAlias":null,"maxCustomTrackerLinks":0}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
