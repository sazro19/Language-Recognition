<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Платежные технологии – просто о сложном. Часть 1 / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/582656\/"},"headline":"Платежные технологии – просто о сложном. Часть 1","datePublished":"2021-10-10T22:46:25+03:00","dateModified":"2021-10-11T13:50:47+03:00","author":{"@type":"Person","name":"Osvald_2021"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необ...","url":"https:\/\/habr.com\/ru\/post\/582656\/#post-content-body","about":["h_pay_system","h_api","h_ecommerce_development","f_develop"],"image":["https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/aea\/deb\/9e2\/aeadeb9e2239f3bb5601a5431ed79393.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Платежные технологии – просто о сложном. Часть 1" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Платежные технологии – просто о сложном. Часть 1" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Платежные технологии – просто о сложном. Часть 1" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/582656/6aa568657d9ca1a5080108136de2848b/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/582656/6aa568657d9ca1a5080108136de2848b/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/582656/6aa568657d9ca1a5080108136de2848b/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/582656/6aa568657d9ca1a5080108136de2848b/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/582656/6aa568657d9ca1a5080108136de2848b/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="582656" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-10T19:46:25.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/582656/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/582656/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/582656/6aa568657d9ca1a5080108136de2848b/" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/582656/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Osvald_2021/" title="Osvald_2021" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/Osvald_2021/" class="tm-user-info__username">
      Osvald_2021
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-10T19:46:25.000Z" title="2021-10-10, 22:46">10  октября   в 22:46</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Платежные технологии – просто о сложном. Часть 1</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/pay_system/" class="tm-article-snippet__hubs-item-link"><span>Платежные системы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/api/" class="tm-article-snippet__hubs-item-link"><span>API</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/ecommerce_development/" class="tm-article-snippet__hubs-item-link"><span>Разработка под e-commerce</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Из песочницы
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с агрегатором, магазином или платежной системой в целях вывода их услуг в своих дистанционных каналах обслуживания.   </p><p>Здесь будет представлена серия статей, которая поможет начинающим специалистам в ИТ, занимающихся платежными технологиями, ответить на вопрос: «как писать исходящий шлюз с платежной системой или агрегатором», «как решить вопрос с расхождениями при сверках», как реализовать интеграцию с международной платежной системой.  </p><p>Устраивайтесь поудобнее, будет интересно.</p><h3>Часть 1: Проведение и подтверждение платежа  </h3><p>Клиент для оплаты услуг как правило авторизуется в интернет-Банке, выпустившим его карту: Банку-Эмитенту его карты.  </p><p>Далее в интернет-Банке, выбирает услугу для оплаты: пополнение мобильного телефона, оплаты интернета или услуг ЖКУ.  </p><p>В базе поставщика услуги, например оператора сотовой связи, у клиента есть свой уникальный идентификатор – номер телефона.  </p><p>Чтобы оплатить услугу клиент вводит свой идентификатор и сумму пополнения, нажимает кнопку «подтвердить платеж». </p><p>А дальше ему отображается пред чек с идентификатором пополнения и суммой пополнения. Он подтверждает оплату и далее интернет-Банк отображает ему чек. Клиент радостный уходит. Деньги «моментально» поступают на его номер телефона.</p><p>Это для клиента так. А давайте посмотрим, как это выглядит внутри систем.   </p><p>Наш онлайн обмен сообщениями, будет состоять из нескольких участников:  </p><ul><li><p>Витрина – в данном случае, интернет-Банк клиента;      </p></li><li><p>Банк клиента – он же оператор по переводу денежных средств, он же Банк-Эмитент, выпустивший карту клиента, и он же расчетный Банк по переводам средств клиента Сервис-Провайдеру;      </p></li><li><p>Сервис-Провайдер – юридическое лицо, оказывающее услуги зачисления средств Поставщику, его часто называют «Мерчант». Сервис-Провайдер имеет прямые договора со многими поставщиками услуг, и чтобы Банку не настраивать интеграцию с каждым из них, на рынке есть компании-посредники: Сервис- Провайдеры, еще их называют агрегаторами, платежными системами. Они уже настроили интеграцию с Поставщиками услуг и предоставляют большое количество сервисов за определенный процент;</p></li><li><p>Наш оператор сотовой связи – Поставщик  услуг;</p></li></ul><p>И у Сервис-Провайдера и у Поставщика услуг есть свои расчетные Банки. В итоге, Банк Сервис-Провайдера в офлайне перечислит денежные средства на счет Поставщика услуг в целях зачисления на счет клиента. Но об этом в следующих статьях.</p><p>Я буду использовать сущности: Банк, Мерчант и Витрина для описания онлайн взаимодействия внутри систем.  </p><p>Центральной фигурой в нашем взаимодействии является Банк клиента.  </p><p>У Банка задача не только проверить наличие денежных средств у клиента, но и доставить их Сервис-Провайдеру.  Для выполнения этого условия Банк, как правило, пишет два шлюза либо использует текущие:  </p><ol><li><p>Входящий: от Витрины к Банку;      </p></li><li><p>Исходящий: от Банка к Мерчанту;      </p></li></ol><p>Оба эти шлюза могут работать как по тождественному протоколу, так и по разным.  </p><p>Мы рассмотрим самый простой вариант: витрина Банка, Банк и Мерчант работают по одному сквозному протоколу, представленному всего двумя методами: check и pay.</p><p>Описание процесса проведения и подтверждения платежа в этом случае выглядит следующим образом:<strong> </strong> </p><figure class="full-width "><img src="/img/image-loader.svg" alt="Сиквенс проведения и подтверждения платежа " title="Сиквенс проведения и подтверждения платежа " height="737" data-src="https://habrastorage.org/getpro/habr/upload_files/aea/deb/9e2/aeadeb9e2239f3bb5601a5431ed79393.png" data-width="951"/><figcaption>Сиквенс проведения и подтверждения платежа </figcaption></figure><h4>Описание процесса проведения и подтверждения платежа </h4><ol><li><p>Клиент выбирает услугу;      </p></li><li><p>Витрина Банка проверяет наличие услуги у себя в Базе данных;   </p><p> 2.1 Если услуга найдена, формирует запрос в Банк на холдирование денежных средств в Процессинге. Далее формирует запрос на возможность совершение платежа check:  </p><p>2.2 Если услуга не найдена, завершает процесс ошибкой, клиент уходит;  </p></li><li><p>Витрина инициирует check;  </p></li><li><p>В Банк поступает запрос check. Далее Банк маршрутизирует запрос Мерчанту;</p></li><li><p>Мерчант принимает запрос, выполняет проверку совершения платежа;  </p><p>5.1 Если зачисление возможно, отправляет успех, клиенту отображается пречек. Система Банка ожидает подтверждение платежа;         </p><p>5.2 Если зачисление невозможно, Банк отправляет код ошибки, витрина завершает процесс, проведение невозможно, клиент уходит;         </p></li><li><p>Клиент знакомится с пречеком, нажимает кнопку «подтвердить платеж». Витрина инициирует pay;</p></li><li><p> Банк присваивает идентификатор транзакции и сразу отправляет ответ на витрину;  </p></li><li><p>Зачисление денежных средств у Мерчанта уже выполняется в офлайне. Банк инициирует pay и, если зачисление возможно, Мерчант присваивает свой идентификатор транзакции и отправляет в Банк успешный ответ. А если зачисление невозможно – спросите Вы? Тогда Мерчант отправляет ответ в Банк с кодом ошибки, и Банк выполняет возврат денежных средств клиенту в автоматическом режиме в тот же день.  </p></li></ol><p>Теперь рассмотрит рассмотрим формат запроса и ответа для каждого из методов, за что они отвечают и для чего они нужны </p><h4>CHECK – проведение платежа  </h4><p>Метод отвечает за возможность совершения платежа. На этом шаге выполняется проверка доступности услуги на витрине, в Банке и у Мерчанта. Мерчант в свою очередь, в онлайне, может сходить к Поставщику и проверить валидность идентификатора пополнения у Поставщика, и, если, он не найден или ошибка, отклонить платеж.  </p><p>Очень часто на этом шаге закладывают минимальные требования к времени отклика ответа на запрос от Мерчанта, т.к. клиент не будет ждать, пока Витрина Банка, сам Банк и Мерчант проверят доступность услуги.</p><p>Отличительной особенностью этого шага является так же расчет комиссии. Комиссии бывают:</p><ul><li><p>Верхняя, или горячая – это комиссия с клиента сверх тела платежа (суммы зачисления);         </p></li><li><p>Нижняя или холодная, это комиссия, которую платит Банку Мерчант;      </p></li><li><p>Смешанная – в этой рубрике мы не будем о них говорить;</p></li></ul><p>В нашем примере на check рассчитывается только комиссия с клиента, нижняя и смешанная комиссии рассчитываются в отдельно. Об этом с следующих статьях.  </p><p>Структура запроса check/XML, шлюз контура Витрина – Банк:  </p><pre><code>&lt;check>  
    &lt;payment>
        &lt;Time>2021-02-08T00:16:19&lt;/Time>	
        &lt;type>CARD&lt;/type>
        &lt;type_number>505266***2025&lt;/type_number> 
        &lt;code>643&lt;/code> 
        &lt;amount>20100&lt;/amount>
        &lt;comission_amount>20241&lt;/comission_amount>
        &lt;service>123456789&lt;/service> 
    &lt;/payment> 
        &lt;account>                                                                              
            &lt;name>phone_number&lt;/name>
            &lt;value>86248541234&lt;/value>                                                                               
        &lt;/account>                                              
&lt;/check></code></pre><p>где</p><ul><li><p>Time – дата платежа;      </p></li><li><p>type – тип источника списания;      </p></li><li><p>type_number – маскированный PAN карты (примечание: PAN - номер карты) по PCI DSS;         </p></li><li><p>code – код валюты перевода, в примере рубли;         </p></li><li><p>amount – сумма зачисления или, по-другому, тело платежа      </p></li><li><p>commission_amount – сумма с учетом верхней комиссии;      </p></li><li><p>service – цифровой идентификатор услуги, который проверяет есть ли вообще такая услуга в Банке и на витрине;</p></li><li><p>account – контейнер с идентификатором пополнения, в нашем случае – номер телефона;</p></li></ul><p>Когда клиент на витрине нажимает иконку с оплачиваемой услугой, первое, что выполняет система, это проверяет доступность услуги и если она доступна, то дальше обращается в процессинг для проверки источника списания (поля Type и type_number)</p><p>Далее если денежные средства есть, проверяет возможность зачисления денежных средств на номер телефона (phone_number в значении 86248541234)</p><p>Подождите, секундочку – спросите вы. Что-то здесь не сходится. Как по маскированному PAN в поле type_number можно проверить наличие денежных средств на карте клиента?  </p><p>Все верно, внимательные читатели обратили внимание, что по маскированному PAN это сделать нельзя.  </p><p>Авторизация в процессинге выполняется перед check и это отдельный метод и отдельный процесс, посмотрите выше на диаграмму процесса. На проведении платежа мы уже работаем с маскированным PAN, т.к. на этом шаге мы проверяем возможность проведения платежа, а не наличие денежных средств на карте клиента.  </p><p>Далее мы формируем запрос Мерчанту.</p><p>Мы не указываем ни PAN, ни тип источника списания, нас интересует только возможность совершения платежа для конкретного сервиса.  </p><p>Структура запроса check/XML, шлюз контура Банк – Мерчант:  </p><pre><code>&lt;check>  
    &lt;payment>
        &lt;Time>2021-02-08T00:16:19&lt;/Time>	
        &lt;code>643&lt;/code> 
        &lt;amount>20100&lt;/amount>
        &lt;comission_amount>20241&lt;/comission_amount>
        &lt;service>123456789&lt;/service> 
    &lt;/payment> 
        &lt;account>                                                                              
           &lt;name>phone_number&lt;/name>
           &lt;value>86248541234&lt;/value>                                                                               
        &lt;/account>                                              
&lt;/check>					</code></pre><p>В ответе Мерчант возвращает все те же самые поля, но появляется дополнительный контейнер со статусом обработки операции, а также идентификатор транзакции в поле id</p><p>Структура ответа check/XML, шлюз контура Мерчант – Банк:</p><pre><code>&lt;check>         
    &lt;payment>
         &lt;Time>2021-02-08T00:16:20&lt;/Time>	
         &lt;id>123456789&lt;/id>              
         &lt;code>643&lt;/code>               
         &lt;amount>20100&lt;/amount>
         &lt;comission_amount>20241&lt;/comission_amount>  
         &lt;service>123456789&lt;/service>                                                              
         &lt;account>                                                                              
         &lt;name>phone_number&lt;/name>
         &lt;value>86248541234&lt;/value> 
         &lt;/account>
    &lt;/payment>	 
        &lt;StatusInfo>
		  &lt;status_id>Success&lt;/status_id>
		  &lt;disсriptin>Успех&lt;/disсriptin>
       &lt;errorCode>0&lt;/errorCode>            
        &lt;/StatusInfo>
&lt;/check></code></pre><p>Такой ответ будет означать, что Мерчант готов к подтверждению платежа клиентом.</p><p>В ответе мы у нас будет временный id транзакции у Мерчанта, а так же статус обработки платежа: status_id  == Success (успех) и код ошибки равный 0 (успех) в поле errorCode</p><p>Не всегда к нам приходят успешные статусы транзакций и не всегда у нас отсутствуют коды ошибок, но об этом мы поговорим в следующих статьях.  </p><p>Мы сохраняем ответ и обогащаем его необходимыми для витрины полями, присваиваем идентификатору транзакции мерчанта – идентификатор в Банке и отправляем ответ на витрину. </p><p>Структура ответа check/XML, шлюз контура Банк – Витрина</p><pre><code>&lt;check>         
    &lt;payment>
         &lt;Time>2021-02-08T00:16:20&lt;/Time>	
         &lt;type>BOUND_CARD&lt;/type>
         &lt;type_number>427684***3619&lt;/type_number>
         &lt;id>123&lt;/id>		 
         &lt;code>643&lt;/code>               
         &lt;amount>20100&lt;/amount>
         &lt;comission_amount>20241&lt;/comission_amount>  
         &lt;service>123456789&lt;/service>                                                              
         &lt;account>                                                                              
         &lt;name>phone_number&lt;/name>
         &lt;value>86248541234&lt;/value> 
         &lt;/account>
    &lt;/payment>	 
        &lt;StatusInfo>
		  &lt;status_id>Success&lt;/status_id>
		  &lt;disсriptin>Успех&lt;/disсriptin>
          &lt;errorCode>0&lt;/errorCode>            
        &lt;/StatusInfo>
&lt;/check> </code></pre><p>Клиент видит экранную форму пречека, с который каждый из нас знаком: там будет сумма платежа, дата, а так же идентификатор пополняемой услуги.</p><p>Если клиент со всем согласен, он нажимает кнопку «оплатить». Теперь отменить платеж можно только по письменному распоряжению плательщика, как правило – при личном обращении в Банк.  </p><p>В запросе витрина может передать как все поля из предыдущего ответа check, так и просто сумму платежа и идентификатор транзакции, полученной на предыдущем шаге.</p><p>Мы будем использовать первый вариант.</p><h4> PAY – подтверждение платежа  </h4><p> Структура запроса pay/XML, шлюз контура Витрина – Банк :</p><pre><code>&lt;pay>  
    &lt;payment>
        &lt;Time>2021-02-08T00:16:25&lt;/Time>	
        &lt;type>CARD&lt;/type>
        &lt;type_number>505266***2025&lt;/type_number> 
	     	&lt;id>123&lt;/id>
        &lt;code>643&lt;/code> 
        &lt;amount>20100&lt;/amount>
        &lt;comission_amount>20241&lt;/comission_amount>
        &lt;service>123456789&lt;/service> 
    &lt;/payment> 
        &lt;account>                                                                              
            &lt;name>phone_number&lt;/name>
            &lt;value>86248541234&lt;/value>                                                                               
        &lt;/account>                                              
&lt;/pay></code></pre><p>Банк регистрирует платеж, и сразу отправляет ответ с промежуточным статусом обработки операции «в проведении» в ответ витрине  </p><p>Структура ответа pay/XML, шлюз контура Банк – витрина:</p><pre><code>&lt;pay>         
    &lt;payment>
         &lt;Time>2021-02-08T00:16:20&lt;/Time>	
        &lt;type>CARD&lt;/type>
         &lt;type_number>505266***2025&lt;/type_number>
         &lt;id>123&lt;/id>              
         &lt;code>643&lt;/code>               
         &lt;amount>20100&lt;/amount>
         &lt;comission_amount>20241&lt;/comission_amount>  
         &lt;service>123456789&lt;/service>                                                              
         &lt;account>                                                                              
         &lt;name>phone_number&lt;/name>
         &lt;value>86248541234&lt;/value> 
         &lt;/account>
    &lt;/payment>	 
      &lt;StatusInfo>
		  &lt;status_id>Inprogress&lt;/status_id>
		  &lt;disсriptin>В проведении&lt;/disсriptin>
      &lt;errorCode>0&lt;/errorCode>            
      &lt;/StatusInfo>
&lt;/pay></code></pre><p>Клиенту печатается чек о приеме к исполнению платежа, с печатью Банка и он уходит.  </p><p>Подождите - спросите Вы. А что, Банк платежи в систему антифрод не отправляет? Отправляет, конечно, как раз, чтобы у клиентов не было проблем с переводами в адрес «службы безопасности из мест лишения свободы». Для этого каждый платеж отправляется на проверку системой и только после этого Мерчанту. Но этот процесс уникальный в каждой организации и общих правил нет.  </p><p>Но вы еще к Мерчанту не сходили, не подтвердили у него оплату, не зарегистрировали у него платеж, а уже отпускаете клиента – снова спросите вы?</p><p>Все верно, клиент не будет ждать, пока мы сходим и зарегистрируем платеж у Мерчанта, а он свою очередь к своим поставщикам на удаленные системы. Мы уже проверили возможность совершения платежа в онлайне на предыдущем шаге check, а теперь можем отпустить клиента с печатью Банка «в проведении» и зарегистрировать оплату у мерчанта в офлайне.</p><p>Для регистрации оплаты у мерчанта, для переданного id транзакции витрины, находим транзакцию мерчанта из предыдущего шага и с ней уже регистрируем платеж.  </p><p>Структура запроса pay/XML, шлюз контура Банк – мерчант:</p><pre><code>&lt;pay>  
    &lt;payment>
        &lt;Time>2021-02-08T00:16:25&lt;/Time>         
		    &lt;id>123456789&lt;/id>
        &lt;code>643&lt;/code> 
        &lt;amount>20100&lt;/amount>
        &lt;comission_amount>20241&lt;/comission_amount>
        &lt;service>123456789&lt;/service> 
    &lt;/payment> 
        &lt;account>                                                                              
            &lt;name>phone_number&lt;/name>
            &lt;value>86248541234&lt;/value>                                                                               
        &lt;/account>                                              
&lt;/pay></code></pre><p> Структура ответа pay/XML, шлюз контура мерчант - Банк:</p><pre><code>&lt;pay>         
    &lt;payment>
         &lt;Time>2021-02-08T:16:25&lt;/Time>	
         &lt;id>123456789&lt;/id>              
         &lt;code>643&lt;/code>               
         &lt;amount>20100&lt;/amount>
         &lt;comission_amount>20241&lt;/comission_amount>  
         &lt;service>123456789&lt;/service>                                                              
         &lt;account>                                                                              
         &lt;name>phone_number&lt;/name>
         &lt;value>86248541234&lt;/value> 
         &lt;/account>
    &lt;/payment>	 
        &lt;StatusInfo>
		  &lt;status_id>Success&lt;/status_id>
		  &lt;disсriptin>Успех&lt;/disсriptin>
          &lt;errorCode>0&lt;/errorCode>            
        &lt;/StatusInfo>
&lt;/pay></code></pre><p>В ответ мерчант сообщает статус обработки транзакции, который может принимать статус успех, в проведении или, если оплата была отклонена, ошибка.  </p><p>Два статуса финальные, а один промежуточный.  </p><p>Можно сказать, что на этих статусах обязательства и Банка и Мерчанта перед клиентом завершены.   </p><p>Подождите, подождите - резюмируете Вы. Как же обязательства завершены? Ведь клиент ушел с чеком, где написано, что Банк всего лишь принял операцию к исполнению, да и Мерчант может отклонить операцию, а клиент уже ушел, что делать?  </p><p>Да, такое бывает достаточно часто, и для решения этой задачи существует отдельный процесс по запросу финального статуса операции как на стороне витрины, так и на стороне Банка, но об этом в следующих статьях.</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BAPI%5D" class="tm-tags-list__link">API</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%BD%D0%B0%D1%8F%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0%5D" class="tm-tags-list__link">платежная система</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%B8%5D" class="tm-tags-list__link">платежи</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%B8%20%D0%BE%D0%BD%D0%BB%D0%B0%D0%B9%D0%BD%5D" class="tm-tags-list__link">платежи онлайн</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%B8%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%5D" class="tm-tags-list__link">платежи на сайте</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%B8%20%D0%B2%20%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%5D" class="tm-tags-list__link">платежи в интернет</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%B8%20%D1%81%20%D0%BC%D0%BE%D0%B1%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE%5D" class="tm-tags-list__link">платежи с мобильного</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D1%8B%20%D0%BC%D0%B5%D0%B6%D0%B4%D1%83%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8%5D" class="tm-tags-list__link">переводы между пользователями</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/pay_system/" class="tm-hubs-list__link">
    Платежные системы
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/api/" class="tm-hubs-list__link">
    API
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/ecommerce_development/" class="tm-hubs-list__link">
    Разработка под e-commerce
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 5: ↑2 и ↓3</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 5: ↑2 и ↓3" class="tm-votes-meter__value tm-votes-meter__value_negative tm-votes-meter__value_medium">-1</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.5K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    39
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Osvald_2021/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 3 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    1
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">-1</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/Osvald_2021/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Osvald_2021
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">технолог</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/582656/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 4 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/582656/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/582656/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"582656":{"id":"582656","timePublished":"2021-10-10T19:46:25+00:00","isCorporative":false,"lang":"ru","titleHtml":"Платежные технологии – просто о сложном. Часть 1","leadData":{"textHtml":"\u003Cp\u003EДавайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет - банке, сделать перевод или нам просто необходимо настроить интеграцию с агрегатором, магазином или платежной системой в целях вывода их услуг в своих дистанционных каналах обслуживания.   \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"scoreStats":{"score":1,"votesCount":3},"rating":-1,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2799641","alias":"Osvald_2021","fullname":null,"avatarUrl":null,"speciality":"технолог"},"statistics":{"commentsCount":4,"favoritesCount":39,"readingCount":4502,"score":-1,"votesCount":5},"hubs":[{"relatedData":null,"id":"233","alias":"pay_system","type":"collective","title":"Платежные системы","titleHtml":"Платежные системы","isProfiled":true},{"relatedData":null,"id":"17690","alias":"api","type":"collective","title":"API","titleHtml":"API","isProfiled":true},{"relatedData":null,"id":"18810","alias":"ecommerce_development","type":"collective","title":"Разработка под e-commerce","titleHtml":"Разработка под e-commerce","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EДавайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с агрегатором, магазином или платежной системой в целях вывода их услуг в своих дистанционных каналах обслуживания.   \u003C\u002Fp\u003E\u003Cp\u003EЗдесь будет представлена серия статей, которая поможет начинающим специалистам в ИТ, занимающихся платежными технологиями, ответить на вопрос: «как писать исходящий шлюз с платежной системой или агрегатором», «как решить вопрос с расхождениями при сверках», как реализовать интеграцию с международной платежной системой.  \u003C\u002Fp\u003E\u003Cp\u003EУстраивайтесь поудобнее, будет интересно.\u003C\u002Fp\u003E\u003Ch3\u003EЧасть 1: Проведение и подтверждение платежа  \u003C\u002Fh3\u003E\u003Cp\u003EКлиент для оплаты услуг как правило авторизуется в интернет-Банке, выпустившим его карту: Банку-Эмитенту его карты.  \u003C\u002Fp\u003E\u003Cp\u003EДалее в интернет-Банке, выбирает услугу для оплаты: пополнение мобильного телефона, оплаты интернета или услуг ЖКУ.  \u003C\u002Fp\u003E\u003Cp\u003EВ базе поставщика услуги, например оператора сотовой связи, у клиента есть свой уникальный идентификатор – номер телефона.  \u003C\u002Fp\u003E\u003Cp\u003EЧтобы оплатить услугу клиент вводит свой идентификатор и сумму пополнения, нажимает кнопку «подтвердить платеж». \u003C\u002Fp\u003E\u003Cp\u003EА дальше ему отображается пред чек с идентификатором пополнения и суммой пополнения. Он подтверждает оплату и далее интернет-Банк отображает ему чек. Клиент радостный уходит. Деньги «моментально» поступают на его номер телефона.\u003C\u002Fp\u003E\u003Cp\u003EЭто для клиента так. А давайте посмотрим, как это выглядит внутри систем.   \u003C\u002Fp\u003E\u003Cp\u003EНаш онлайн обмен сообщениями, будет состоять из нескольких участников:  \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВитрина – в данном случае, интернет-Банк клиента;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EБанк клиента – он же оператор по переводу денежных средств, он же Банк-Эмитент, выпустивший карту клиента, и он же расчетный Банк по переводам средств клиента Сервис-Провайдеру;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСервис-Провайдер – юридическое лицо, оказывающее услуги зачисления средств Поставщику, его часто называют «Мерчант». Сервис-Провайдер имеет прямые договора со многими поставщиками услуг, и чтобы Банку не настраивать интеграцию с каждым из них, на рынке есть компании-посредники: Сервис- Провайдеры, еще их называют агрегаторами, платежными системами. Они уже настроили интеграцию с Поставщиками услуг и предоставляют большое количество сервисов за определенный процент;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНаш оператор сотовой связи – Поставщик  услуг;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EИ у Сервис-Провайдера и у Поставщика услуг есть свои расчетные Банки. В итоге, Банк Сервис-Провайдера в офлайне перечислит денежные средства на счет Поставщика услуг в целях зачисления на счет клиента. Но об этом в следующих статьях.\u003C\u002Fp\u003E\u003Cp\u003EЯ буду использовать сущности: Банк, Мерчант и Витрина для описания онлайн взаимодействия внутри систем.  \u003C\u002Fp\u003E\u003Cp\u003EЦентральной фигурой в нашем взаимодействии является Банк клиента.  \u003C\u002Fp\u003E\u003Cp\u003EУ Банка задача не только проверить наличие денежных средств у клиента, но и доставить их Сервис-Провайдеру.  Для выполнения этого условия Банк, как правило, пишет два шлюза либо использует текущие:  \u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EВходящий: от Витрины к Банку;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EИсходящий: от Банка к Мерчанту;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EОба эти шлюза могут работать как по тождественному протоколу, так и по разным.  \u003C\u002Fp\u003E\u003Cp\u003EМы рассмотрим самый простой вариант: витрина Банка, Банк и Мерчант работают по одному сквозному протоколу, представленному всего двумя методами: check и pay.\u003C\u002Fp\u003E\u003Cp\u003EОписание процесса проведения и подтверждения платежа в этом случае выглядит следующим образом:\u003Cstrong\u003E \u003C\u002Fstrong\u003E \u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Сиквенс проведения и подтверждения платежа \" title=\"Сиквенс проведения и подтверждения платежа \" height=\"737\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faea\u002Fdeb\u002F9e2\u002Faeadeb9e2239f3bb5601a5431ed79393.png\" data-width=\"951\"\u002F\u003E\u003Cfigcaption\u003EСиквенс проведения и подтверждения платежа \u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch4\u003EОписание процесса проведения и подтверждения платежа \u003C\u002Fh4\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EКлиент выбирает услугу;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВитрина Банка проверяет наличие услуги у себя в Базе данных;   \u003C\u002Fp\u003E\u003Cp\u003E 2.1 Если услуга найдена, формирует запрос в Банк на холдирование денежных средств в Процессинге. Далее формирует запрос на возможность совершение платежа check:  \u003C\u002Fp\u003E\u003Cp\u003E2.2 Если услуга не найдена, завершает процесс ошибкой, клиент уходит;  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВитрина инициирует check;  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВ Банк поступает запрос check. Далее Банк маршрутизирует запрос Мерчанту;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EМерчант принимает запрос, выполняет проверку совершения платежа;  \u003C\u002Fp\u003E\u003Cp\u003E5.1 Если зачисление возможно, отправляет успех, клиенту отображается пречек. Система Банка ожидает подтверждение платежа;         \u003C\u002Fp\u003E\u003Cp\u003E5.2 Если зачисление невозможно, Банк отправляет код ошибки, витрина завершает процесс, проведение невозможно, клиент уходит;         \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКлиент знакомится с пречеком, нажимает кнопку «подтвердить платеж». Витрина инициирует pay;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E Банк присваивает идентификатор транзакции и сразу отправляет ответ на витрину;  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EЗачисление денежных средств у Мерчанта уже выполняется в офлайне. Банк инициирует pay и, если зачисление возможно, Мерчант присваивает свой идентификатор транзакции и отправляет в Банк успешный ответ. А если зачисление невозможно – спросите Вы? Тогда Мерчант отправляет ответ в Банк с кодом ошибки, и Банк выполняет возврат денежных средств клиенту в автоматическом режиме в тот же день.  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003EТеперь рассмотрит рассмотрим формат запроса и ответа для каждого из методов, за что они отвечают и для чего они нужны \u003C\u002Fp\u003E\u003Ch4\u003ECHECK – проведение платежа  \u003C\u002Fh4\u003E\u003Cp\u003EМетод отвечает за возможность совершения платежа. На этом шаге выполняется проверка доступности услуги на витрине, в Банке и у Мерчанта. Мерчант в свою очередь, в онлайне, может сходить к Поставщику и проверить валидность идентификатора пополнения у Поставщика, и, если, он не найден или ошибка, отклонить платеж.  \u003C\u002Fp\u003E\u003Cp\u003EОчень часто на этом шаге закладывают минимальные требования к времени отклика ответа на запрос от Мерчанта, т.к. клиент не будет ждать, пока Витрина Банка, сам Банк и Мерчант проверят доступность услуги.\u003C\u002Fp\u003E\u003Cp\u003EОтличительной особенностью этого шага является так же расчет комиссии. Комиссии бывают:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EВерхняя, или горячая – это комиссия с клиента сверх тела платежа (суммы зачисления);         \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EНижняя или холодная, это комиссия, которую платит Банку Мерчант;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСмешанная – в этой рубрике мы не будем о них говорить;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВ нашем примере на check рассчитывается только комиссия с клиента, нижняя и смешанная комиссии рассчитываются в отдельно. Об этом с следующих статьях.  \u003C\u002Fp\u003E\u003Cp\u003EСтруктура запроса check\u002FXML, шлюз контура Витрина – Банк:  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;check\u003E  \n    &lt;payment\u003E\n        &lt;Time\u003E2021-02-08T00:16:19&lt;\u002FTime\u003E\t\n        &lt;type\u003ECARD&lt;\u002Ftype\u003E\n        &lt;type_number\u003E505266***2025&lt;\u002Ftype_number\u003E \n        &lt;code\u003E643&lt;\u002Fcode\u003E \n        &lt;amount\u003E20100&lt;\u002Famount\u003E\n        &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E\n        &lt;service\u003E123456789&lt;\u002Fservice\u003E \n    &lt;\u002Fpayment\u003E \n        &lt;account\u003E                                                                              \n            &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n            &lt;value\u003E86248541234&lt;\u002Fvalue\u003E                                                                               \n        &lt;\u002Faccount\u003E                                              \n&lt;\u002Fcheck\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003Eгде\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003ETime – дата платежа;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Etype – тип источника списания;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Etype_number – маскированный PAN карты (примечание: PAN - номер карты) по PCI DSS;         \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Ecode – код валюты перевода, в примере рубли;         \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eamount – сумма зачисления или, по-другому, тело платежа      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Ecommission_amount – сумма с учетом верхней комиссии;      \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eservice – цифровой идентификатор услуги, который проверяет есть ли вообще такая услуга в Банке и на витрине;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eaccount – контейнер с идентификатором пополнения, в нашем случае – номер телефона;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EКогда клиент на витрине нажимает иконку с оплачиваемой услугой, первое, что выполняет система, это проверяет доступность услуги и если она доступна, то дальше обращается в процессинг для проверки источника списания (поля Type и type_number)\u003C\u002Fp\u003E\u003Cp\u003EДалее если денежные средства есть, проверяет возможность зачисления денежных средств на номер телефона (phone_number в значении 86248541234)\u003C\u002Fp\u003E\u003Cp\u003EПодождите, секундочку – спросите вы. Что-то здесь не сходится. Как по маскированному PAN в поле type_number можно проверить наличие денежных средств на карте клиента?  \u003C\u002Fp\u003E\u003Cp\u003EВсе верно, внимательные читатели обратили внимание, что по маскированному PAN это сделать нельзя.  \u003C\u002Fp\u003E\u003Cp\u003EАвторизация в процессинге выполняется перед check и это отдельный метод и отдельный процесс, посмотрите выше на диаграмму процесса. На проведении платежа мы уже работаем с маскированным PAN, т.к. на этом шаге мы проверяем возможность проведения платежа, а не наличие денежных средств на карте клиента.  \u003C\u002Fp\u003E\u003Cp\u003EДалее мы формируем запрос Мерчанту.\u003C\u002Fp\u003E\u003Cp\u003EМы не указываем ни PAN, ни тип источника списания, нас интересует только возможность совершения платежа для конкретного сервиса.  \u003C\u002Fp\u003E\u003Cp\u003EСтруктура запроса check\u002FXML, шлюз контура Банк – Мерчант:  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;check\u003E  \n    &lt;payment\u003E\n        &lt;Time\u003E2021-02-08T00:16:19&lt;\u002FTime\u003E\t\n        &lt;code\u003E643&lt;\u002Fcode\u003E \n        &lt;amount\u003E20100&lt;\u002Famount\u003E\n        &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E\n        &lt;service\u003E123456789&lt;\u002Fservice\u003E \n    &lt;\u002Fpayment\u003E \n        &lt;account\u003E                                                                              \n           &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n           &lt;value\u003E86248541234&lt;\u002Fvalue\u003E                                                                               \n        &lt;\u002Faccount\u003E                                              \n&lt;\u002Fcheck\u003E\t\t\t\t\t\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ ответе Мерчант возвращает все те же самые поля, но появляется дополнительный контейнер со статусом обработки операции, а также идентификатор транзакции в поле id\u003C\u002Fp\u003E\u003Cp\u003EСтруктура ответа check\u002FXML, шлюз контура Мерчант – Банк:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;check\u003E         \n    &lt;payment\u003E\n         &lt;Time\u003E2021-02-08T00:16:20&lt;\u002FTime\u003E\t\n         &lt;id\u003E123456789&lt;\u002Fid\u003E              \n         &lt;code\u003E643&lt;\u002Fcode\u003E               \n         &lt;amount\u003E20100&lt;\u002Famount\u003E\n         &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E  \n         &lt;service\u003E123456789&lt;\u002Fservice\u003E                                                              \n         &lt;account\u003E                                                                              \n         &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n         &lt;value\u003E86248541234&lt;\u002Fvalue\u003E \n         &lt;\u002Faccount\u003E\n    &lt;\u002Fpayment\u003E\t \n        &lt;StatusInfo\u003E\n\t\t  &lt;status_id\u003ESuccess&lt;\u002Fstatus_id\u003E\n\t\t  &lt;disсriptin\u003EУспех&lt;\u002Fdisсriptin\u003E\n       &lt;errorCode\u003E0&lt;\u002FerrorCode\u003E            \n        &lt;\u002FStatusInfo\u003E\n&lt;\u002Fcheck\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТакой ответ будет означать, что Мерчант готов к подтверждению платежа клиентом.\u003C\u002Fp\u003E\u003Cp\u003EВ ответе мы у нас будет временный id транзакции у Мерчанта, а так же статус обработки платежа: status_id  == Success (успех) и код ошибки равный 0 (успех) в поле errorCode\u003C\u002Fp\u003E\u003Cp\u003EНе всегда к нам приходят успешные статусы транзакций и не всегда у нас отсутствуют коды ошибок, но об этом мы поговорим в следующих статьях.  \u003C\u002Fp\u003E\u003Cp\u003EМы сохраняем ответ и обогащаем его необходимыми для витрины полями, присваиваем идентификатору транзакции мерчанта – идентификатор в Банке и отправляем ответ на витрину. \u003C\u002Fp\u003E\u003Cp\u003EСтруктура ответа check\u002FXML, шлюз контура Банк – Витрина\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;check\u003E         \n    &lt;payment\u003E\n         &lt;Time\u003E2021-02-08T00:16:20&lt;\u002FTime\u003E\t\n         &lt;type\u003EBOUND_CARD&lt;\u002Ftype\u003E\n         &lt;type_number\u003E427684***3619&lt;\u002Ftype_number\u003E\n         &lt;id\u003E123&lt;\u002Fid\u003E\t\t \n         &lt;code\u003E643&lt;\u002Fcode\u003E               \n         &lt;amount\u003E20100&lt;\u002Famount\u003E\n         &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E  \n         &lt;service\u003E123456789&lt;\u002Fservice\u003E                                                              \n         &lt;account\u003E                                                                              \n         &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n         &lt;value\u003E86248541234&lt;\u002Fvalue\u003E \n         &lt;\u002Faccount\u003E\n    &lt;\u002Fpayment\u003E\t \n        &lt;StatusInfo\u003E\n\t\t  &lt;status_id\u003ESuccess&lt;\u002Fstatus_id\u003E\n\t\t  &lt;disсriptin\u003EУспех&lt;\u002Fdisсriptin\u003E\n          &lt;errorCode\u003E0&lt;\u002FerrorCode\u003E            \n        &lt;\u002FStatusInfo\u003E\n&lt;\u002Fcheck\u003E \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКлиент видит экранную форму пречека, с который каждый из нас знаком: там будет сумма платежа, дата, а так же идентификатор пополняемой услуги.\u003C\u002Fp\u003E\u003Cp\u003EЕсли клиент со всем согласен, он нажимает кнопку «оплатить». Теперь отменить платеж можно только по письменному распоряжению плательщика, как правило – при личном обращении в Банк.  \u003C\u002Fp\u003E\u003Cp\u003EВ запросе витрина может передать как все поля из предыдущего ответа check, так и просто сумму платежа и идентификатор транзакции, полученной на предыдущем шаге.\u003C\u002Fp\u003E\u003Cp\u003EМы будем использовать первый вариант.\u003C\u002Fp\u003E\u003Ch4\u003E PAY – подтверждение платежа  \u003C\u002Fh4\u003E\u003Cp\u003E Структура запроса pay\u002FXML, шлюз контура Витрина – Банк :\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;pay\u003E  \n    &lt;payment\u003E\n        &lt;Time\u003E2021-02-08T00:16:25&lt;\u002FTime\u003E\t\n        &lt;type\u003ECARD&lt;\u002Ftype\u003E\n        &lt;type_number\u003E505266***2025&lt;\u002Ftype_number\u003E \n\t     \t&lt;id\u003E123&lt;\u002Fid\u003E\n        &lt;code\u003E643&lt;\u002Fcode\u003E \n        &lt;amount\u003E20100&lt;\u002Famount\u003E\n        &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E\n        &lt;service\u003E123456789&lt;\u002Fservice\u003E \n    &lt;\u002Fpayment\u003E \n        &lt;account\u003E                                                                              \n            &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n            &lt;value\u003E86248541234&lt;\u002Fvalue\u003E                                                                               \n        &lt;\u002Faccount\u003E                                              \n&lt;\u002Fpay\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EБанк регистрирует платеж, и сразу отправляет ответ с промежуточным статусом обработки операции «в проведении» в ответ витрине  \u003C\u002Fp\u003E\u003Cp\u003EСтруктура ответа pay\u002FXML, шлюз контура Банк – витрина:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;pay\u003E         \n    &lt;payment\u003E\n         &lt;Time\u003E2021-02-08T00:16:20&lt;\u002FTime\u003E\t\n        &lt;type\u003ECARD&lt;\u002Ftype\u003E\n         &lt;type_number\u003E505266***2025&lt;\u002Ftype_number\u003E\n         &lt;id\u003E123&lt;\u002Fid\u003E              \n         &lt;code\u003E643&lt;\u002Fcode\u003E               \n         &lt;amount\u003E20100&lt;\u002Famount\u003E\n         &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E  \n         &lt;service\u003E123456789&lt;\u002Fservice\u003E                                                              \n         &lt;account\u003E                                                                              \n         &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n         &lt;value\u003E86248541234&lt;\u002Fvalue\u003E \n         &lt;\u002Faccount\u003E\n    &lt;\u002Fpayment\u003E\t \n      &lt;StatusInfo\u003E\n\t\t  &lt;status_id\u003EInprogress&lt;\u002Fstatus_id\u003E\n\t\t  &lt;disсriptin\u003EВ проведении&lt;\u002Fdisсriptin\u003E\n      &lt;errorCode\u003E0&lt;\u002FerrorCode\u003E            \n      &lt;\u002FStatusInfo\u003E\n&lt;\u002Fpay\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКлиенту печатается чек о приеме к исполнению платежа, с печатью Банка и он уходит.  \u003C\u002Fp\u003E\u003Cp\u003EПодождите - спросите Вы. А что, Банк платежи в систему антифрод не отправляет? Отправляет, конечно, как раз, чтобы у клиентов не было проблем с переводами в адрес «службы безопасности из мест лишения свободы». Для этого каждый платеж отправляется на проверку системой и только после этого Мерчанту. Но этот процесс уникальный в каждой организации и общих правил нет.  \u003C\u002Fp\u003E\u003Cp\u003EНо вы еще к Мерчанту не сходили, не подтвердили у него оплату, не зарегистрировали у него платеж, а уже отпускаете клиента – снова спросите вы?\u003C\u002Fp\u003E\u003Cp\u003EВсе верно, клиент не будет ждать, пока мы сходим и зарегистрируем платеж у Мерчанта, а он свою очередь к своим поставщикам на удаленные системы. Мы уже проверили возможность совершения платежа в онлайне на предыдущем шаге check, а теперь можем отпустить клиента с печатью Банка «в проведении» и зарегистрировать оплату у мерчанта в офлайне.\u003C\u002Fp\u003E\u003Cp\u003EДля регистрации оплаты у мерчанта, для переданного id транзакции витрины, находим транзакцию мерчанта из предыдущего шага и с ней уже регистрируем платеж.  \u003C\u002Fp\u003E\u003Cp\u003EСтруктура запроса pay\u002FXML, шлюз контура Банк – мерчант:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;pay\u003E  \n    &lt;payment\u003E\n        &lt;Time\u003E2021-02-08T00:16:25&lt;\u002FTime\u003E         \n\t\t    &lt;id\u003E123456789&lt;\u002Fid\u003E\n        &lt;code\u003E643&lt;\u002Fcode\u003E \n        &lt;amount\u003E20100&lt;\u002Famount\u003E\n        &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E\n        &lt;service\u003E123456789&lt;\u002Fservice\u003E \n    &lt;\u002Fpayment\u003E \n        &lt;account\u003E                                                                              \n            &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n            &lt;value\u003E86248541234&lt;\u002Fvalue\u003E                                                                               \n        &lt;\u002Faccount\u003E                                              \n&lt;\u002Fpay\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E Структура ответа pay\u002FXML, шлюз контура мерчант - Банк:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003E&lt;pay\u003E         \n    &lt;payment\u003E\n         &lt;Time\u003E2021-02-08T:16:25&lt;\u002FTime\u003E\t\n         &lt;id\u003E123456789&lt;\u002Fid\u003E              \n         &lt;code\u003E643&lt;\u002Fcode\u003E               \n         &lt;amount\u003E20100&lt;\u002Famount\u003E\n         &lt;comission_amount\u003E20241&lt;\u002Fcomission_amount\u003E  \n         &lt;service\u003E123456789&lt;\u002Fservice\u003E                                                              \n         &lt;account\u003E                                                                              \n         &lt;name\u003Ephone_number&lt;\u002Fname\u003E\n         &lt;value\u003E86248541234&lt;\u002Fvalue\u003E \n         &lt;\u002Faccount\u003E\n    &lt;\u002Fpayment\u003E\t \n        &lt;StatusInfo\u003E\n\t\t  &lt;status_id\u003ESuccess&lt;\u002Fstatus_id\u003E\n\t\t  &lt;disсriptin\u003EУспех&lt;\u002Fdisсriptin\u003E\n          &lt;errorCode\u003E0&lt;\u002FerrorCode\u003E            \n        &lt;\u002FStatusInfo\u003E\n&lt;\u002Fpay\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ ответ мерчант сообщает статус обработки транзакции, который может принимать статус успех, в проведении или, если оплата была отклонена, ошибка.  \u003C\u002Fp\u003E\u003Cp\u003EДва статуса финальные, а один промежуточный.  \u003C\u002Fp\u003E\u003Cp\u003EМожно сказать, что на этих статусах обязательства и Банка и Мерчанта перед клиентом завершены.   \u003C\u002Fp\u003E\u003Cp\u003EПодождите, подождите - резюмируете Вы. Как же обязательства завершены? Ведь клиент ушел с чеком, где написано, что Банк всего лишь принял операцию к исполнению, да и Мерчант может отклонить операцию, а клиент уже ушел, что делать?  \u003C\u002Fp\u003E\u003Cp\u003EДа, такое бывает достаточно часто, и для решения этой задачи существует отдельный процесс по запросу финального статуса операции как на стороне витрины, так и на стороне Банка, но об этом в следующих статьях.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"API"},{"titleHtml":"платежная система"},{"titleHtml":"платежи"},{"titleHtml":"платежи онлайн"},{"titleHtml":"платежи на сайте"},{"titleHtml":"платежи в интернет"},{"titleHtml":"платежи с мобильного"},{"titleHtml":"переводы между пользователями"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F582656\u002F6aa568657d9ca1a5080108136de2848b\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F582656\u002F6aa568657d9ca1a5080108136de2848b\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582656\\\u002F\"},\"headline\":\"Платежные технологии – просто о сложном. Часть 1\",\"datePublished\":\"2021-10-10T22:46:25+03:00\",\"dateModified\":\"2021-10-11T13:50:47+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Osvald_2021\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необ...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582656\\\u002F#post-content-body\",\"about\":[\"h_pay_system\",\"h_api\",\"h_ecommerce_development\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Faea\\\u002Fdeb\\\u002F9e2\\\u002Faeadeb9e2239f3bb5601a5431ed79393.png\"]}","metaDescription":"Давайте поговорим о платежных технологиях и что происходит, когда клиент хочет оплатить услугу на сайте или в интернет-Банке, сделать перевод или нам просто необходимо настроить интеграцию с...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"pay_system,api,ecommerce_development"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
