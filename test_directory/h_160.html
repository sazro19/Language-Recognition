<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Одна задача с собеса / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/584924\/"},"headline":"Одна задача с собеса","datePublished":"2021-10-22T11:04:44+03:00","dateModified":"2021-10-22T12:34:57+03:00","author":{"@type":"Person","name":"EdgarAbgaryan"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовы...","url":"https:\/\/habr.com\/ru\/post\/584924\/#post-content-body","about":["h_javascript","h_reactjs","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/584924\/820a05e1c994fa0e8e237cb36124fc06\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Одна задача с собеса" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Одна задача с собеса" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Одна задача с собеса" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/785/6dd/f36/7856ddf3604fc11f7e9295c5c5140a1c.jpg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/785/6dd/f36/7856ddf3604fc11f7e9295c5c5140a1c.jpg" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/785/6dd/f36/7856ddf3604fc11f7e9295c5c5140a1c.jpg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/785/6dd/f36/7856ddf3604fc11f7e9295c5c5140a1c.jpg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/785/6dd/f36/7856ddf3604fc11f7e9295c5c5140a1c.jpg" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="584924" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-22T08:04:44.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/584924/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/584924/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/785/6dd/f36/7856ddf3604fc11f7e9295c5c5140a1c.jpg" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/584924/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/EdgarAbgaryan/" title="EdgarAbgaryan" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/EdgarAbgaryan/" class="tm-user-info__username">
      EdgarAbgaryan
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-22T08:04:44.000Z" title="2021-10-22, 11:04">22  октября   в 11:04</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Одна задача с собеса</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/javascript/" class="tm-article-snippet__hubs-item-link"><span>JavaScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/reactjs/" class="tm-article-snippet__hubs-item-link"><span>ReactJS</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней можно сделать много интересных ошибок. Также в ней оказались неочевидные детали, которые могли бы оказаться интересны и опытным разработчикам. Я решил достаточно подробно разобрать задачу в этом посте в педагогических целях. Данный пост нацелен в первую очередь на начинающих реакт разработчиков. </p><h2>Формулировка</h2><p>Есть реализация компонента, от которого требуется 2 вещи:</p><p>1) выводить текущее значение вертикального скролла окна (window.scrollY)</p><p>2) после монтирования асинхронно получить число и вывести его</p><p>Нужно найти, объяснить и исправить как можно больше проблем в реализации</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';

// имитация запроса к серверу. просто получаем число асинхронно
const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
  const [number, setNumber] = useState();
  const [scroll, setScroll] = useState();
  
  useEffect(async () => {
    setNumber(await fetchRandomNumber());
    
    window.addEventListener('scroll', () => setScroll(window.scrollY));

    return () => window.removeEventListener('scroll', () => setScroll(window.scrollY));
  });
  
  return (
    &lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>  
  )
}</code></pre><p>Настоятельно рекомендую самостоятельно исправить всё что найдёте, прежде чем  читать дальше.</p><h2>Большие проблемы</h2><p> Первое, что все правильно замечают - отсутствие второго аргумента у <code>useEffect</code>. Там должен быть пустой массив зависимостей, потому что <em>число</em> нам нужно получить с <em>"сервера"</em> только 1 раз при монтировании. Да и неоднократно переподписываться на событие скролла  не имеет смысла. </p><pre><code class="javascript">import React, { useState, useEffect } from 'react';

const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
	const [number, setNumber] = useState();
  const [scroll, setScroll] = useState();
  
  useEffect(async () => {
    setNumber(await fetchRandomNumber());
    
    window.addEventListener('scroll', () => setScroll(window.scrollY));
    
    return () => window.removeEventListener('scroll', () => setScroll(window.scrollY));
  }, []); // добавили вторым аргументом массив зависимостей
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><p>Частой ошибкой бывает передача такого массива зависимостей: <code>[scroll]</code>. Если вы тоже совершили эту ошибку, то вернитесь к коду и убедитесь, что нам не нужно текущее значение скролла, чтобы обновлять его.</p><p>Второе, на что обычно обращают внимание, это ключевое слово <code>async</code> у колбека. Многие имели свой личный опыт писать так и знают, что так делать нельзя. Но почему? Этот вопрос ставит некоторых в тупик. Согласно документации реакта, колбек должен либо ничего не возвращать (читай возвращать <code>undefined</code>) либо возвращать функцию очистки. То есть только 2 валидных значения есть для возврата: undefined и функция. Но вы же знали, что функции объявленные <code>async</code> всегда возвращают промис? То есть в текущей реализации колбек возвращает не функцию очистки, а промис этой функции. Нужно убрать ключевое слово <code>async</code> и переделать колбек, чтобы работало. С этим тоже бывали проблемы у новичков. Самое простое - написать через промис:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';

const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
 	const [number, setNumber] = useState();
  const [scroll, setScroll] = useState();
 
  // убрали async
  useEffect(() => {
    // переписали через промис
    fetchRandomNumber().then(setNumber);
    
    window.addEventListener('scroll', () => setScroll(window.scrollY));
    
    return () => window.removeEventListener('scroll', () => setScroll(window.scrollY));
  }, []);
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><p>Если вы написали <code>fetchRandomNumber().then(num => setNumber(num))</code>, то уделите минуту, чтобы осознать, что <code>fetchRandomNumber().then(setNumber)</code>  делает то же самое, только короче и оптимальнее.</p><p>Последняя грубая ошибка в том, что очистка листенера всё равно не происходит. Я попытаюсь привести свою аналогию для объяснения ошибки. Допустим вы купили новый телефон. Вы ставите будильник на нём на 5 утра, чтобы встать для пробежки по набережной. А потом вы поняли, что бег это дичь и передумали. Но вместо того, чтобы выключить будильник на своём новом телефоне, вы идёте снова в магазин, покупаете ещё один телефон той же самой модели, открываете в нём будильники и выключаете все на 5 утра (впрочем там и выключать нечего). Оба телефона абсолютно идентичны и видимых различий практически нет, но это всё же разные телефоны. В реализованном коде написана примерно такая же бессмыслица. Каждый раз, когда мы пишем выражение <code>() => setScroll(window.scrollY)</code>, мы создаём новую функцию. Часто это проблема решалась несколько странно:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';

const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
  const [number, setNumber] = useState();
  const [scroll, setScroll] = useState();
  
  // вынесли создание функции сюда
  const handleScroll = () => setScroll(window.scrollY);
  
  useEffect(() => {
    fetchRandomNumber().then(setNumber);
    
    window.addEventListener('scroll', handleScroll);
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);
  
  return (
    &lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>    
  )
}</code></pre><p>Это работает, но проблема тут в том, что <code>handleScroll</code> создаётся на каждый рендер компонента, а используется только в колбеке <code>useEffect</code>'а. То есть только при первом рендере.  То есть выполняется лишняя работа и код более разбросан. Правильней так:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';

const fetchRandomNumber = () => Promise.resolve(Math.random());  

const NumberAndScroll = () => {      
  const [number, setNumber] = useState();   
  const [scroll, setScroll] = useState();        
  
  useEffect(() => {     
    fetchRandomNumber().then(setNumber);      
    
    // перенес создание в useEffect
    const handleScroll = () => setScroll(window.scrollY);
    
    window.addEventListener('scroll', handleScroll);   
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);  
  
  return (      
    &lt;div>       
      &lt;div> Number: { number } &lt;/div> 
      &lt;div> Scroll: { scroll } &lt;/div>    
    &lt;/div>  
)}</code></pre><h2>Менее важные проблемы</h2><p>Ещё один момент, на который я прошу обратить внимание кандидатов -  начальные значения состояний. Новички часто пишут так:</p><pre><code class="javascript">const [number, setNumber] = useState(0);
const [scroll, setScroll] = useState(0);</code></pre><p>Есть люди, которым кажется, что начальное значение всегда обязательно должно быть задано. И если это число, то наверняка <code>0</code>. Но в этой задаче мы не можем дать переменной <code>number</code> адекватного начального значения и лучше оставить его <code>undefined</code>. Для переменной <code>scroll</code> начальное значение <code>0</code> неверно, потому что наш компонент может появиться когда страничка браузера уже прокручена вниз. Ожидаемый код такой:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';

const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
 	const [number, setNumber] = useState();
  // добавил начальное значение
  const [scroll, setScroll] = useState(window.scrollY); 
  
  useEffect(() => {
    fetchRandomNumber().then(setNumber);

	  const handleScroll = () => setScroll(window.scrollY);
    
    window.addEventListener('scroll', handleScroll);
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><p>Вот уже более или менее приличный код вышел. На этом этапе я обычно перехожу к следующей задаче в собеседовании. Но если кандидат бодро справляется, я предлагаю попробовать ещё как-то улучшить код. </p><p>Плюсом идёт кандидату, если он знает что такое <a href="https://lodash.com/docs/#throttle" rel="noopener noreferrer nofollow">тротлинг</a> и правильно его применяет. Например так:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';
import throttle from 'lodash/throttle';

const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
  const [number, setNumber] = useState();
 	const [scroll, setScroll] = useState(window.scrollY);
  
  useEffect(() => {
    fetchRandomNumber().then(setNumber);
    
    // обернули в throttle
    const handleScroll = throttle(() => setScroll(window.scrollY), 37);

    window.addEventListener('scroll', handleScroll);
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><p>Ещё одна из вещей, которые я бы хотел увидеть - применение <code>Принципа единственной ответственности</code> к useEffect. Сейчас один useEffect отвечает и за логику асинхронного получения числа и за логику скролла. Результат может выглядеть так:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';
import throttle from 'lodash/throttle';

const fetchRandomNumber = () => Promise.resolve(Math.random());

const NumberAndScroll = () => {
 	const [number, setNumber] = useState();
  const [scroll, setScroll] = useState(window.scrollY);
  
  // отдельно логика получения числа
  useEffect(() => {
    fetchRandomNumber().then(setNumber);
  }, []);

  // отдельно логика скролла
  useEffect(() => {
	  const handleScroll = throttle(() => setScroll(window.scrollY), 37);
    
    window.addEventListener('scroll', handleScroll);
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><p>Такой код будет работать незаметно медленней, но его будет значительно проще читать и изменять некоторое время спустя. К тому же после этого шага уже лучше видно кастомный хук который можно вынести для тех же целей:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';
import throttle from 'lodash/throttle';

const fetchRandomNumber = () => Promise.resolve(Math.random());

// вынесли работу со скроллом в кастомный хук
const useWindowScrollY = () => {
  const [scroll, setScroll] = useState(window.scrollY);

  useEffect(() => {
	  const handleScroll = throttle(() => setScroll(window.scrollY), 37);
    
    window.addEventListener('scroll', handleScroll);
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

	return scroll;
}

const NumberAndScroll = () => {
 	const [number, setNumber] = useState();
  const scroll = useWindowScrollY();
  
  // логику получения числа, возможно, тоже стоило вынести
  // в отдельный кастомный хук
  useEffect(() => {
    fetchRandomNumber().then(setNumber);
  }, []);
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><h2>Неочевидное</h2><p>Есть в JS такая нечасто применяемая в повседневной работе штука как <a href="https://learn.javascript.ru/property-descriptors" rel="noopener noreferrer nofollow">дескрипторы</a>. Можно сделать так, что когда мы достаём из объекта свойство, будет вызвана геттер функция и возвращён результат этого вызова. Функция <code>Object.getOwnPropertyDescriptor</code> может показать нам, является ли свойство объекта обычным или хитро определено дескрипторами. И так, если вы в консоли запустите <code>Object.getOwnPropertyDescriptor(window, 'scrollY');</code>, то увидите, что у свойства <code>scrollY</code> заданы гетер и сетер. То есть когда мы пишем <code>window.scrollY</code>, мы добавляем в <a href="https://bool.dev/blog/detail/obyasnenie-event-loop-v-javascript-s-pomoshchyu-vizualizatsii" rel="noopener noreferrer nofollow">стек вызовов</a> эту гетер функцию. То есть если мы напишем <code>useState(() => window.scrollY)</code>, то на каждый рендер в стек вызовов будет на одну функцию меньше идти (если передать в <code>useState</code> функцию, то она вызовется только во время первого рендера и начальным значением будет результат этого вызова). Оптимизация! На самом деле такая оптимизация никакой практической пользы не даёт. Даже экономией на спичках не хочется её называть. Но важно тут, как мне кажется, осознание этих процессов, сознательное написание каждой строчки кода. Окончательный вариант кода будет выглядеть примерно так:</p><pre><code class="javascript">import React, { useState, useEffect } from 'react';
import throttle from 'lodash/throttle';

const fetchRandomNumber = () => Promise.resolve(Math.random());

// получение window.scrollY вынесли в функцию
const getWindowScrollY = () => window.scrollY;
const useWindowScrollY = () => {
  const [scroll, setScroll] = useState(getWindowScrollY);

  useEffect(() => {
	  const handleScroll = throttle(() => setScroll(window.scrollY), 37);
    
    window.addEventListener('scroll', handleScroll);
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

	return scroll;
}

const NumberAndScroll = () => {
 	const [number, setNumber] = useState();
  const scroll = useWindowScrollY();
  
  useEffect(() => {
    fetchRandomNumber().then(setNumber);
  }, []);
  
  return (
  	&lt;div>
      &lt;div> Number: { number } &lt;/div>
      &lt;div> Scroll: { scroll } &lt;/div>
    &lt;/div>	
  )
}</code></pre><h2>Бонус</h2><p>Тем, кто любит лишний раз пошевелить мозгами, предлагаю придумать как забенчмаркать последнюю "оптимизацию". Я сам никогда не занимался написанием таких синтетических тестов, но специально для полноты этого поста я задался такой целью и вот что вышло у меня: <a href="https://codesandbox.io/s/descriptors-perfomance-test-g34e1?file=/src/usePerfomance.js" rel="noopener noreferrer nofollow">https://codesandbox.io/s/descriptors-perfomance-test-g34e1?file=/src/usePerfomance.js</a>. 20000 рендеров компонента на моём ноутбуке выполняются за ~3500мс (для <code>useState(window.scrollY)</code>) и ~3300мс (для <code>useState(() => window.scrollY)</code>)</p><h2>Заключение</h2><p>Спасибо всем, кто дочитал</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Breact%5D" class="tm-tags-list__link">react</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B0%5D" class="tm-tags-list__link">задача</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D0%BE%D0%B1%D0%B5%D1%81%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%5D" class="tm-tags-list__link">собеседование</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BE%D0%B1%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%5D" class="tm-tags-list__link">обучение</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BA%D0%BE%D0%B4%20%D1%80%D0%B5%D0%B2%D1%8C%D1%8E%5D" class="tm-tags-list__link">код ревью</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/javascript/" class="tm-hubs-list__link">
    JavaScript
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/reactjs/" class="tm-hubs-list__link">
    ReactJS
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 17: ↑16 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 17: ↑16 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+15</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">7.7K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    45
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/EdgarAbgaryan/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 9 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    9
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">15</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/EdgarAbgaryan/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @EdgarAbgaryan
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/584924/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 25 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/584924/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/584924/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"584924":{"id":"584924","timePublished":"2021-10-22T08:04:44+00:00","isCorporative":false,"lang":"ru","titleHtml":"Одна задача с собеса","leadData":{"textHtml":"\u003Cp\u003EГод назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней можно сделать много интересных ошибок. Также в ней оказались неочевидные детали, которые могли бы оказаться интересны и опытным разработчикам. Я решил достаточно подробно разобрать задачу в этом посте в педагогических целях. Данный пост нацелен в первую очередь на начинающих реакт разработчиков. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F785\u002F6dd\u002Ff36\u002F7856ddf3604fc11f7e9295c5c5140a1c.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F785\u002F6dd\u002Ff36\u002F7856ddf3604fc11f7e9295c5c5140a1c.jpg","fit":"cover","positionY":80.681818181818,"positionX":28.589743589744}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":9,"votesCount":9},"rating":15,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2628411","alias":"EdgarAbgaryan","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":25,"favoritesCount":45,"readingCount":7717,"score":15,"votesCount":17},"hubs":[{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"19327","alias":"reactjs","type":"collective","title":"ReactJS","titleHtml":"ReactJS","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EГод назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней можно сделать много интересных ошибок. Также в ней оказались неочевидные детали, которые могли бы оказаться интересны и опытным разработчикам. Я решил достаточно подробно разобрать задачу в этом посте в педагогических целях. Данный пост нацелен в первую очередь на начинающих реакт разработчиков. \u003C\u002Fp\u003E\u003Ch2\u003EФормулировка\u003C\u002Fh2\u003E\u003Cp\u003EЕсть реализация компонента, от которого требуется 2 вещи:\u003C\u002Fp\u003E\u003Cp\u003E1) выводить текущее значение вертикального скролла окна (window.scrollY)\u003C\u002Fp\u003E\u003Cp\u003E2) после монтирования асинхронно получить число и вывести его\u003C\u002Fp\u003E\u003Cp\u003EНужно найти, объяснить и исправить как можно больше проблем в реализации\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\n\n\u002F\u002F имитация запроса к серверу. просто получаем число асинхронно\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n  const [number, setNumber] = useState();\n  const [scroll, setScroll] = useState();\n  \n  useEffect(async () =\u003E {\n    setNumber(await fetchRandomNumber());\n    \n    window.addEventListener('scroll', () =\u003E setScroll(window.scrollY));\n\n    return () =\u003E window.removeEventListener('scroll', () =\u003E setScroll(window.scrollY));\n  });\n  \n  return (\n    &lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E  \n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНастоятельно рекомендую самостоятельно исправить всё что найдёте, прежде чем  читать дальше.\u003C\u002Fp\u003E\u003Ch2\u003EБольшие проблемы\u003C\u002Fh2\u003E\u003Cp\u003E Первое, что все правильно замечают - отсутствие второго аргумента у \u003Ccode\u003EuseEffect\u003C\u002Fcode\u003E. Там должен быть пустой массив зависимостей, потому что \u003Cem\u003Eчисло\u003C\u002Fem\u003E нам нужно получить с \u003Cem\u003E\"сервера\"\u003C\u002Fem\u003E только 1 раз при монтировании. Да и неоднократно переподписываться на событие скролла  не имеет смысла. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n\tconst [number, setNumber] = useState();\n  const [scroll, setScroll] = useState();\n  \n  useEffect(async () =\u003E {\n    setNumber(await fetchRandomNumber());\n    \n    window.addEventListener('scroll', () =\u003E setScroll(window.scrollY));\n    \n    return () =\u003E window.removeEventListener('scroll', () =\u003E setScroll(window.scrollY));\n  }, []); \u002F\u002F добавили вторым аргументом массив зависимостей\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЧастой ошибкой бывает передача такого массива зависимостей: \u003Ccode\u003E[scroll]\u003C\u002Fcode\u003E. Если вы тоже совершили эту ошибку, то вернитесь к коду и убедитесь, что нам не нужно текущее значение скролла, чтобы обновлять его.\u003C\u002Fp\u003E\u003Cp\u003EВторое, на что обычно обращают внимание, это ключевое слово \u003Ccode\u003Easync\u003C\u002Fcode\u003E у колбека. Многие имели свой личный опыт писать так и знают, что так делать нельзя. Но почему? Этот вопрос ставит некоторых в тупик. Согласно документации реакта, колбек должен либо ничего не возвращать (читай возвращать \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E) либо возвращать функцию очистки. То есть только 2 валидных значения есть для возврата: undefined и функция. Но вы же знали, что функции объявленные \u003Ccode\u003Easync\u003C\u002Fcode\u003E всегда возвращают промис? То есть в текущей реализации колбек возвращает не функцию очистки, а промис этой функции. Нужно убрать ключевое слово \u003Ccode\u003Easync\u003C\u002Fcode\u003E и переделать колбек, чтобы работало. С этим тоже бывали проблемы у новичков. Самое простое - написать через промис:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n \tconst [number, setNumber] = useState();\n  const [scroll, setScroll] = useState();\n \n  \u002F\u002F убрали async\n  useEffect(() =\u003E {\n    \u002F\u002F переписали через промис\n    fetchRandomNumber().then(setNumber);\n    \n    window.addEventListener('scroll', () =\u003E setScroll(window.scrollY));\n    \n    return () =\u003E window.removeEventListener('scroll', () =\u003E setScroll(window.scrollY));\n  }, []);\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЕсли вы написали \u003Ccode\u003EfetchRandomNumber().then(num =\u003E setNumber(num))\u003C\u002Fcode\u003E, то уделите минуту, чтобы осознать, что \u003Ccode\u003EfetchRandomNumber().then(setNumber)\u003C\u002Fcode\u003E  делает то же самое, только короче и оптимальнее.\u003C\u002Fp\u003E\u003Cp\u003EПоследняя грубая ошибка в том, что очистка листенера всё равно не происходит. Я попытаюсь привести свою аналогию для объяснения ошибки. Допустим вы купили новый телефон. Вы ставите будильник на нём на 5 утра, чтобы встать для пробежки по набережной. А потом вы поняли, что бег это дичь и передумали. Но вместо того, чтобы выключить будильник на своём новом телефоне, вы идёте снова в магазин, покупаете ещё один телефон той же самой модели, открываете в нём будильники и выключаете все на 5 утра (впрочем там и выключать нечего). Оба телефона абсолютно идентичны и видимых различий практически нет, но это всё же разные телефоны. В реализованном коде написана примерно такая же бессмыслица. Каждый раз, когда мы пишем выражение \u003Ccode\u003E() =\u003E setScroll(window.scrollY)\u003C\u002Fcode\u003E, мы создаём новую функцию. Часто это проблема решалась несколько странно:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n  const [number, setNumber] = useState();\n  const [scroll, setScroll] = useState();\n  \n  \u002F\u002F вынесли создание функции сюда\n  const handleScroll = () =\u003E setScroll(window.scrollY);\n  \n  useEffect(() =\u003E {\n    fetchRandomNumber().then(setNumber);\n    \n    window.addEventListener('scroll', handleScroll);\n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);\n  \n  return (\n    &lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E    \n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЭто работает, но проблема тут в том, что \u003Ccode\u003EhandleScroll\u003C\u002Fcode\u003E создаётся на каждый рендер компонента, а используется только в колбеке \u003Ccode\u003EuseEffect\u003C\u002Fcode\u003E'а. То есть только при первом рендере.  То есть выполняется лишняя работа и код более разбросан. Правильней так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());  \n\nconst NumberAndScroll = () =\u003E {      \n  const [number, setNumber] = useState();   \n  const [scroll, setScroll] = useState();        \n  \n  useEffect(() =\u003E {     \n    fetchRandomNumber().then(setNumber);      \n    \n    \u002F\u002F перенес создание в useEffect\n    const handleScroll = () =\u003E setScroll(window.scrollY);\n    \n    window.addEventListener('scroll', handleScroll);   \n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);  \n  \n  return (      \n    &lt;div\u003E       \n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E \n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E    \n    &lt;\u002Fdiv\u003E  \n)}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EМенее важные проблемы\u003C\u002Fh2\u003E\u003Cp\u003EЕщё один момент, на который я прошу обратить внимание кандидатов -  начальные значения состояний. Новички часто пишут так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst [number, setNumber] = useState(0);\nconst [scroll, setScroll] = useState(0);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЕсть люди, которым кажется, что начальное значение всегда обязательно должно быть задано. И если это число, то наверняка \u003Ccode\u003E0\u003C\u002Fcode\u003E. Но в этой задаче мы не можем дать переменной \u003Ccode\u003Enumber\u003C\u002Fcode\u003E адекватного начального значения и лучше оставить его \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E. Для переменной \u003Ccode\u003Escroll\u003C\u002Fcode\u003E начальное значение \u003Ccode\u003E0\u003C\u002Fcode\u003E неверно, потому что наш компонент может появиться когда страничка браузера уже прокручена вниз. Ожидаемый код такой:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n \tconst [number, setNumber] = useState();\n  \u002F\u002F добавил начальное значение\n  const [scroll, setScroll] = useState(window.scrollY); \n  \n  useEffect(() =\u003E {\n    fetchRandomNumber().then(setNumber);\n\n\t  const handleScroll = () =\u003E setScroll(window.scrollY);\n    \n    window.addEventListener('scroll', handleScroll);\n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВот уже более или менее приличный код вышел. На этом этапе я обычно перехожу к следующей задаче в собеседовании. Но если кандидат бодро справляется, я предлагаю попробовать ещё как-то улучшить код. \u003C\u002Fp\u003E\u003Cp\u003EПлюсом идёт кандидату, если он знает что такое \u003Ca href=\"https:\u002F\u002Flodash.com\u002Fdocs\u002F#throttle\" rel=\"noopener noreferrer nofollow\"\u003Eтротлинг\u003C\u002Fa\u003E и правильно его применяет. Например так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\nimport throttle from 'lodash\u002Fthrottle';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n  const [number, setNumber] = useState();\n \tconst [scroll, setScroll] = useState(window.scrollY);\n  \n  useEffect(() =\u003E {\n    fetchRandomNumber().then(setNumber);\n    \n    \u002F\u002F обернули в throttle\n    const handleScroll = throttle(() =\u003E setScroll(window.scrollY), 37);\n\n    window.addEventListener('scroll', handleScroll);\n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЕщё одна из вещей, которые я бы хотел увидеть - применение \u003Ccode\u003EПринципа единственной ответственности\u003C\u002Fcode\u003E к useEffect. Сейчас один useEffect отвечает и за логику асинхронного получения числа и за логику скролла. Результат может выглядеть так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\nimport throttle from 'lodash\u002Fthrottle';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\nconst NumberAndScroll = () =\u003E {\n \tconst [number, setNumber] = useState();\n  const [scroll, setScroll] = useState(window.scrollY);\n  \n  \u002F\u002F отдельно логика получения числа\n  useEffect(() =\u003E {\n    fetchRandomNumber().then(setNumber);\n  }, []);\n\n  \u002F\u002F отдельно логика скролла\n  useEffect(() =\u003E {\n\t  const handleScroll = throttle(() =\u003E setScroll(window.scrollY), 37);\n    \n    window.addEventListener('scroll', handleScroll);\n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EТакой код будет работать незаметно медленней, но его будет значительно проще читать и изменять некоторое время спустя. К тому же после этого шага уже лучше видно кастомный хук который можно вынести для тех же целей:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\nimport throttle from 'lodash\u002Fthrottle';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\n\u002F\u002F вынесли работу со скроллом в кастомный хук\nconst useWindowScrollY = () =\u003E {\n  const [scroll, setScroll] = useState(window.scrollY);\n\n  useEffect(() =\u003E {\n\t  const handleScroll = throttle(() =\u003E setScroll(window.scrollY), 37);\n    \n    window.addEventListener('scroll', handleScroll);\n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n\treturn scroll;\n}\n\nconst NumberAndScroll = () =\u003E {\n \tconst [number, setNumber] = useState();\n  const scroll = useWindowScrollY();\n  \n  \u002F\u002F логику получения числа, возможно, тоже стоило вынести\n  \u002F\u002F в отдельный кастомный хук\n  useEffect(() =\u003E {\n    fetchRandomNumber().then(setNumber);\n  }, []);\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EНеочевидное\u003C\u002Fh2\u003E\u003Cp\u003EЕсть в JS такая нечасто применяемая в повседневной работе штука как \u003Ca href=\"https:\u002F\u002Flearn.javascript.ru\u002Fproperty-descriptors\" rel=\"noopener noreferrer nofollow\"\u003Eдескрипторы\u003C\u002Fa\u003E. Можно сделать так, что когда мы достаём из объекта свойство, будет вызвана геттер функция и возвращён результат этого вызова. Функция \u003Ccode\u003EObject.getOwnPropertyDescriptor\u003C\u002Fcode\u003E может показать нам, является ли свойство объекта обычным или хитро определено дескрипторами. И так, если вы в консоли запустите \u003Ccode\u003EObject.getOwnPropertyDescriptor(window, 'scrollY');\u003C\u002Fcode\u003E, то увидите, что у свойства \u003Ccode\u003EscrollY\u003C\u002Fcode\u003E заданы гетер и сетер. То есть когда мы пишем \u003Ccode\u003Ewindow.scrollY\u003C\u002Fcode\u003E, мы добавляем в \u003Ca href=\"https:\u002F\u002Fbool.dev\u002Fblog\u002Fdetail\u002Fobyasnenie-event-loop-v-javascript-s-pomoshchyu-vizualizatsii\" rel=\"noopener noreferrer nofollow\"\u003Eстек вызовов\u003C\u002Fa\u003E эту гетер функцию. То есть если мы напишем \u003Ccode\u003EuseState(() =\u003E window.scrollY)\u003C\u002Fcode\u003E, то на каждый рендер в стек вызовов будет на одну функцию меньше идти (если передать в \u003Ccode\u003EuseState\u003C\u002Fcode\u003E функцию, то она вызовется только во время первого рендера и начальным значением будет результат этого вызова). Оптимизация! На самом деле такая оптимизация никакой практической пользы не даёт. Даже экономией на спичках не хочется её называть. Но важно тут, как мне кажется, осознание этих процессов, сознательное написание каждой строчки кода. Окончательный вариант кода будет выглядеть примерно так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport React, { useState, useEffect } from 'react';\nimport throttle from 'lodash\u002Fthrottle';\n\nconst fetchRandomNumber = () =\u003E Promise.resolve(Math.random());\n\n\u002F\u002F получение window.scrollY вынесли в функцию\nconst getWindowScrollY = () =\u003E window.scrollY;\nconst useWindowScrollY = () =\u003E {\n  const [scroll, setScroll] = useState(getWindowScrollY);\n\n  useEffect(() =\u003E {\n\t  const handleScroll = throttle(() =\u003E setScroll(window.scrollY), 37);\n    \n    window.addEventListener('scroll', handleScroll);\n    \n    return () =\u003E window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n\treturn scroll;\n}\n\nconst NumberAndScroll = () =\u003E {\n \tconst [number, setNumber] = useState();\n  const scroll = useWindowScrollY();\n  \n  useEffect(() =\u003E {\n    fetchRandomNumber().then(setNumber);\n  }, []);\n  \n  return (\n  \t&lt;div\u003E\n      &lt;div\u003E Number: { number } &lt;\u002Fdiv\u003E\n      &lt;div\u003E Scroll: { scroll } &lt;\u002Fdiv\u003E\n    &lt;\u002Fdiv\u003E\t\n  )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2\u003EБонус\u003C\u002Fh2\u003E\u003Cp\u003EТем, кто любит лишний раз пошевелить мозгами, предлагаю придумать как забенчмаркать последнюю \"оптимизацию\". Я сам никогда не занимался написанием таких синтетических тестов, но специально для полноты этого поста я задался такой целью и вот что вышло у меня: \u003Ca href=\"https:\u002F\u002Fcodesandbox.io\u002Fs\u002Fdescriptors-perfomance-test-g34e1?file=\u002Fsrc\u002FusePerfomance.js\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fcodesandbox.io\u002Fs\u002Fdescriptors-perfomance-test-g34e1?file=\u002Fsrc\u002FusePerfomance.js\u003C\u002Fa\u003E. 20000 рендеров компонента на моём ноутбуке выполняются за ~3500мс (для \u003Ccode\u003EuseState(window.scrollY)\u003C\u002Fcode\u003E) и ~3300мс (для \u003Ccode\u003EuseState(() =\u003E window.scrollY)\u003C\u002Fcode\u003E)\u003C\u002Fp\u003E\u003Ch2\u003EЗаключение\u003C\u002Fh2\u003E\u003Cp\u003EСпасибо всем, кто дочитал\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"react"},{"titleHtml":"задача"},{"titleHtml":"собеседование"},{"titleHtml":"обучение"},{"titleHtml":"код ревью"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F785\u002F6dd\u002Ff36\u002F7856ddf3604fc11f7e9295c5c5140a1c.jpg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F785\u002F6dd\u002Ff36\u002F7856ddf3604fc11f7e9295c5c5140a1c.jpg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584924\\\u002F\"},\"headline\":\"Одна задача с собеса\",\"datePublished\":\"2021-10-22T11:04:44+03:00\",\"dateModified\":\"2021-10-22T12:34:57+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"EdgarAbgaryan\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовы...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F584924\\\u002F#post-content-body\",\"about\":[\"h_javascript\",\"h_reactjs\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F584924\\\u002F820a05e1c994fa0e8e237cb36124fc06\\\u002F\"]}","metaDescription":"Год назад моя компания впервые попросила меня провести собеседование для фронтендера. Тогда я и придумал эту задачу на свою злобу дня. Задачка простая, на базовые знания, но, как оказалось, в ней...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"javascript,reactjs"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
