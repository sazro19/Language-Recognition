<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1 / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/582180\/"},"headline":"Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1","datePublished":"2021-10-07T16:22:55+03:00","dateModified":"2021-10-21T14:47:32+03:00","author":{"@type":"Person","name":"kalirgum"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и\/или размером экрана. Году...","url":"https:\/\/habr.com\/ru\/post\/582180\/#post-content-body","about":["h_programming","h_cpp","h_qt_software","h_oop","h_win_dev","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/582180\/e1fd7950aaf492c17e8c1e316cd60ff9\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a74\/fc6\/745\/a74fc67456d4789b36ef4efca39a806d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5a8\/d53\/9b0\/5a8d539b0e4cc7698b3580f7af6b7061.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/62d\/ae6\/eb4\/62dae6eb4be7b7411bdf8eacdbc0a55e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/0ab\/a6d\/009\/0aba6d009b1dad3f19c10e5ede19cdc0.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/84f\/5a9\/6f7\/84f5a96f7616e647a859a86bb8965418.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/544\/a50\/30f\/544a5030fef7b5f4daf8a267b4f9a2e2.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/890\/f8f\/1f2\/890f8f1f256d65e93c3a75cd86187c43.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1b6\/29c\/81d\/1b629c81d264490169b259e8bc0d6301.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5ac\/669\/8ee\/5ac6698ee22a16adee107125331861bf.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/2ba\/24a\/1d7\/2ba24a1d7782430fa20fbbee0ae84abd.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f50\/543\/3de\/f505433de705a223b1e5b369254ffa16.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/88a\/768\/add\/88a768add737a89fde4d97e66ec1ffc1.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/61a\/319\/6ce\/61a3196ce789146c2c54569a426cd04c.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/881\/e64\/491\/881e64491cb9226856a13091398b5b92.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/7e9\/aae\/c1b\/7e9aaec1be2eca38d9111d526521fd00.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a98\/2c8\/a18\/a982c8a183a7c1707e55bdf03e04192c.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и/или размером экрана. Году в 2010 стандартным монитором можно..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и/или размером экрана. Году в 2010 стандартным монитором можно..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и/или размером экрана. Году в 2010 стандартным монитором можно..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и/или размером экрана. Году в 2010 стандартным монитором можно..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и/или размером экрана. Году в 2010 стандартным монитором можно..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="582180" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-07T13:22:55.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/582180/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/582180/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/582180/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/kalirgum/" title="kalirgum" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/kalirgum/" class="tm-user-info__username">
      kalirgum
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-07T13:22:55.000Z" title="2021-10-07, 16:22">7  октября   в 16:22</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/programming/" class="tm-article-snippet__hubs-item-link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/cpp/" class="tm-article-snippet__hubs-item-link"><span>C++</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/qt_software/" class="tm-article-snippet__hubs-item-link"><span>Qt</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/oop/" class="tm-article-snippet__hubs-item-link"><span>ООП</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/win_dev/" class="tm-article-snippet__hubs-item-link"><span>Разработка под Windows</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p><strong>Введение</strong></p><p>В связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и/или размером экрана. Году в 2010 стандартным монитором можно было считать экземпляр 19’’ c разрешением WXGA++ (1600*900) и фактической плотностью пикселей 97 DPI (dots per inch). Сейчас (2021 год) стандартным монитором, думаю, можно признать экземпляр 24’’ c разрешением <a href="https://ru.wikipedia.org/wiki/Full_HD" rel="noopener noreferrer nofollow">Full HD</a> (1920*1080) и плотностью пикселей 92 DPI. Под «стандартным» я понимаю тот монитор, который стоит на рабочем месте у большинства работающего люда: инженеры, бухгалтеры, переводчики и т.д. (при этом, конечно, «стандартность» — это субъективная и приблизительная оценка). Относительно новые и отчасти нишевые модели (для фотографов, видеографов, геймеров) имеют характеристики: 4<u>K UHD (3840*2160) и 28’’ (157 DPI)</u> или <u>UWQHD (3440x1440) и 34" (109 DPI)</u> или <u>QHD (2560x1440) и 27" (109 DPI)</u> или <u>UWHD (2560x1080) и 29" (96 DPI)</u>. Таким образом, наблюдается рост в связанных группах признаков: <u>разрешение+размер экрана</u>, или <u>разрешение+плотность пикселей</u>, или даже <u>разрешение+плотность пикселей+размер экрана</u>. На рынке ноутбуков в плане экранов похожая ситуация – растет <u>разрешение+плотность пикселей</u>.</p><p>К сожалению, не всегда программное обеспечение поспевает за ростом характеристик мониторов. Нередко оно выглядит немного коряво и неухоженно, что расстраивает пользователя. Действительно, на дворе 21 век, а зачастую приходится видеть размытые шрифты, а иногда и микроскопические иконки. </p><p>Что касается высокой чёткости (большой плотности пикселей), то в ОС Windows давно есть такие настройки, как масштабирование шрифта и изображений (масштаб экрана), которые применяются для увеличения слишком малых элементов GUI на мониторах с высокой чёткостью (High DPI). Также есть поддержка в платформе Qt (с нюансами, об этом далее). Однако способно ли Ваше, конкретное ПО их адекватно учитывать, применять?</p><figure class="full-width "><img src="/img/image-loader.svg" height="459" data-src="https://habrastorage.org/getpro/habr/upload_files/a74/fc6/745/a74fc67456d4789b36ef4efca39a806d.png" data-width="734"/><figcaption></figcaption></figure><p>Если пока ещё нет, то в этой статье мы собрали рецепты по адаптации Вашего ПО, написанного на платформе Qt, к современным мониторам высокой четкости. Мы искали и открывали эти рецепты в процессе адаптации одного из наших продуктов. Общий размер кодовой базы GUI – около 200 тысяч строк кода (С++) и 100+ виджетов, код писался разными людьми и в разное время (в том числе и в эпоху 16-пиксельных картинок, которые, как нетрудно догадаться, не очень выгодно выглядят на современных мониторах). В нашей кодовой базе мы нашли целую библиотеку примеров, которые выглядят проблемно на мониторах высокой четкости, и мы постарались эту библиотеку систематизировать, обобщить, упростить и создать на ее базе готовые и легкие для понимания рецепты. В этой статье мы поделимся некоторыми из этих рецептов.</p><p>Исходный код примеров был протестирован на Qt5 и Qt6 (более точно – 5.15 и 6.2), на операционках Windows 10 и Windows 7. В основном в статье описаны реалии и будни Qt5 (поскольку именно на Qt5 проблема стоит особенно остро), но рецепты можно с успехом применять и на Qt6 – ничего от этого не поломается.</p><p><strong>Пример 1. «Студенческий».</strong></p><p>Начнем разбираться в ситуации на примере простого виджета. Будем последовательно находить проблемы, фиксировать причины и выводить из них решения, затем будем усложнять пример, снова находить проблемы, фиксировать причины и выводить из них решения, и далее по кругу.</p><p>Итак, виджет в студию!</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows 10 и Windows7, масштаб экрана 100%" title="Windows 10 и Windows7, масштаб экрана 100%" height="143" data-src="https://habrastorage.org/getpro/habr/upload_files/5a8/d53/9b0/5a8d539b0e4cc7698b3580f7af6b7061.png" data-width="557"/><figcaption>Windows 10 и Windows7, масштаб экрана 100%</figcaption></figure><details class="spoiler"><summary>А вот и исходный код:</summary><div class="spoiler__content"><pre><code class="cpp">ScaleWgt::ScaleWgt(QWidget* parent)
	: QWidget(parent)
{
	QLabel* label1 = new QLabel("Field1 long long long long name", this);
	QLabel* label2 = new QLabel("Field2 long long long name", this);
	QSpinBox* sb = new QSpinBox(this);
	sb->setMaximum(10);
	sb->setMinimum(0);
	sb->setValue(5);
	auto cb = new QComboBox(this);
	cb->addItem("Field2 value 1");
	cb->addItem("Field2 value 2");

	QPushButton* ok = new QPushButton("Ok", this);
	QPushButton* def = new QPushButton("Apply default values", this);

	label1->setGeometry(10, 10, 150, 20);
	label2->setGeometry(10, 40, 150, 20);
	sb->setGeometry(170, 10, 90, 20);
	cb->setGeometry(170, 40, 90, 20);
	ok->setGeometry(210, 70, 50, 25);
	def->setGeometry(10, 70, 130, 25);
}
int main(int argc, char *argv[])
{
	QApplication a(argc, argv);
	ScaleWgt w;
	w.show();
	return a.exec();
}
</code></pre></div></details><p>Не будем пока обсуждать, насколько хорош или плох данный код, а сосредоточимся только на том, насколько хорошо виджет выглядит на бОльших масштабах экрана, и что с этим делать. На исходном масштабе в 100% выглядит приемлемо, проблем с GUI нет. А вот при большем масштабировании начинаются проблемы.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows 10 и Windows7, масштаб экрана 150%" title="Windows 10 и Windows7, масштаб экрана 150%" height="160" data-src="https://habrastorage.org/getpro/habr/upload_files/62d/ae6/eb4/62dae6eb4be7b7411bdf8eacdbc0a55e.png" data-width="564"/><figcaption>Windows 10 и Windows7, масштаб экрана 150%</figcaption></figure><p>По заголовку видно, что системный, родной шрифт Windows вырос. При этом на Windows 10 наш, запрограммированный, шрифт на виджетах не вырос, а на Windows 7 он вырос, но не поместился по размеру в рамки виджетов. Хорошо, это на данный момент и есть наши проблемы, а как с ними бороться?</p><p><strong>Рецепт 1.  Настройте DPI Awareness Level.</strong></p><p>К счастью, <a href="https://docs.microsoft.com/en-us/windows/win32/hidpi/high-dpi-desktop-application-development-on-windows?redirectedfrom=MSDN" rel="noopener noreferrer nofollow">Windows представляет нам готовую системную настройку для работы с высокими DPI</a>. Соответствующая обертка в Qt называется Qt DPI Awareness Level (подробнее см. <a href="https://doc.qt.io/qt-5/highdpi.html" rel="noopener noreferrer nofollow">здесь</a>).</p><p>Чтобы произвести настройку, надо всего лишь рядом с выполняемым файлом (exe) приложения положить файл qt.conf со следующим содержимым:</p><p><code>[Platforms]<br/> WindowsArguments = dpiawareness=1</code></p><p>Здесь 1 = System-DPI Aware.</p><p>В результате такого нехитрого трюка все стандартные элементы управления Qt (такие, как QLabel, QComboBox, QPushButton и пр.) станут рисовать адекватный шрифт (как в Windows7, так и в Windows10), причем для всех виджетов в рамках всего приложения сразу.</p><p>Для сравнения на рисунках ниже показан наш виджет в разных вариациях параметра DPI Awareness Level.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows 7, 150%, Awareness Level = 0,1,2 (слева направо)" title="Windows 7, 150%, Awareness Level = 0,1,2 (слева направо)" height="215" data-src="https://habrastorage.org/getpro/habr/upload_files/0ab/a6d/009/0aba6d009b1dad3f19c10e5ede19cdc0.png" data-width="1014"/><figcaption>Windows 7, 150%, Awareness Level = 0,1,2 (слева направо)</figcaption></figure><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows 10, 150%, Awareness Level = 0,1,2 (слева направо)" title="Windows 10, 150%, Awareness Level = 0,1,2 (слева направо)" height="205" data-src="https://habrastorage.org/getpro/habr/upload_files/84f/5a9/6f7/84f5a96f7616e647a859a86bb8965418.png" data-width="955"/><figcaption>Windows 10, 150%, Awareness Level = 0,1,2 (слева направо)</figcaption></figure><p>Особенно важно то, что такая настройка позволяет масштабировать шрифты ровно настолько, насколько установлен масштаб экрана: 125%, 150%, 175%  и т. д. Это будет важно для последующего обсуждения, пока что просто запомним это.</p><p>Итак, мы добились того, что все шрифты теперь всегда имеют должный размер (можете проверить для других масштабов экрана), но осталась проблема того, что текст не помещается по размеру в рамки виджетов. Решить ее поможет следующий рецепт.</p><p><strong>Рецепт 2. Используйте автокомпоновку.</strong></p><p>Ранее в коде мы явным образом размещали элементы управления внутри виджета посредством вызова setGeometry. Аналогичное действие имел бы вызов функций move, resize, setFixedSize. Можно сказать, что это одного поля ягоды. Так вот, следует отказаться от этой порочной практики. Менеджеры компоновки (классы, производные от QLayout) прекрасно справляются с задачей расчета позиции и размера виджета для любых масштабов экрана. Таким образом, в нашем примере нам просто стоит заменить код на следующий:</p><details class="spoiler"><summary>Показать код</summary><div class="spoiler__content"><pre><code class="cpp">ScaleWgt::ScaleWgt(QWidget *parent)
	: QWidget(parent)
{
	auto layout = new QGridLayout();
	QLabel* label1 = new QLabel("Field1 long long long long name");
	QLabel* label2 = new QLabel("Field2 long long long name");
	QSpinBox* sb = new QSpinBox();
	sb->setMaximum(10);
	sb->setMinimum(0);
	sb->setValue(5);
	auto cb = new QComboBox();
	cb->addItem("Field2 value 1");
	cb->addItem("Field2 value 2");
	layout->addWidget(label1, 0, 0);
	layout->addWidget(label2, 1, 0);
	layout->addWidget(sb, 0, 1);
	layout->addWidget(cb, 1, 1);

	QPushButton* ok = new QPushButton("Ok");
	QPushButton* def = new QPushButton("Apply default values");
	QHBoxLayout* hbl = new QHBoxLayout();
	hbl->addWidget(def);
	hbl->addStretch();
	hbl->addWidget(ok);
	layout->addLayout(hbl, 2, 0, 1, 2);
	setLayout(layout);
}</code></pre></div></details><p>В результате получаем адекватно выглядящие виджеты при любых масштабах:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows 10 и Windows7, масштаб экрана 150%" title="Windows 10 и Windows7, масштаб экрана 150%" height="192" data-src="https://habrastorage.org/getpro/habr/upload_files/544/a50/30f/544a5030fef7b5f4daf8a267b4f9a2e2.png" data-width="834"/><figcaption>Windows 10 и Windows7, масштаб экрана 150%</figcaption></figure><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows7, масштаб экрана 100%, 125%, 150%." title="Windows7, масштаб экрана 100%, 125%, 150%." height="194" data-src="https://habrastorage.org/getpro/habr/upload_files/890/f8f/1f2/890f8f1f256d65e93c3a75cd86187c43.png" data-width="1053"/><figcaption>Windows7, масштаб экрана 100%, 125%, 150%.</figcaption></figure><p>Здесь очень важно то, что использование автокомпоновки не просто упрощает задачу создания графических интерфейсов, не просто автоматизирует некоторые действия и расчеты, а кардинальным образом меняет сам стиль работы программиста:  разработчик ПОЛНОСТЬЮ избавлен от необходимости устанавливать какие-либо фиксированные размеры и координаты, что полностью исключает артефакты отображения при больших масштабах экрана.</p><p>Однако,  усомнимся, полностью ли? Может, всё же необходимо иногда устанавливать фиксированные размеры и координаты? Может, иногда совсем-совсем без этого не обойтись? К сожалению, да, иногда. Есть некоторые, довольно редкие, классы задач, где это действительно необходимо. Последующее изложение будет посвящено как раз таким классам и способам решения.</p><p><strong>Пример 2. Анимация движения.</strong></p><p>Предположим, мы хотим реализовать анимацию появления элементов GUI на форме: пусть названия полей выплывают справа, значения – слева, а кнопки - снизу. В этом случае без задействования setGeometry не обойтись. Неважно, что эту функцию будет дергать класс QPropertyAnimation, а не наш, клиентский, код, все равно вызовы setGeometry будут. </p><details class="spoiler"><summary>Вот как будет выглядеть наш класс с анимацией:</summary><div class="spoiler__content"><pre><code class="cpp">ScaleWgt::ScaleWgt(QWidget* parent)
	: QWidget(parent)
{
	QLabel* label1 = new QLabel("Field1 long long long long name", this);
	QLabel* label2 = new QLabel("Field2 long long long name", this);
	QSpinBox* sb = new QSpinBox(this);
	sb->setMaximum(10);
	sb->setMinimum(0);
	sb->setValue(5);
	auto cb = new QComboBox(this);
	cb->addItem("Field2 value 1");
	cb->addItem("Field2 value 2");

	QPushButton* ok = new QPushButton("Ok", this);
	QPushButton* def = new QPushButton("Apply default values", this);

	QPropertyAnimation* anim1 = new QPropertyAnimation(label1, "geometry");
	anim1->setDuration(300);
	anim1->setStartValue(QRect(-150, 10, 150, 20));
	anim1->setEndValue(QRect(10, 10, 150, 20));

	QPropertyAnimation* anim2 = new QPropertyAnimation(label2, "geometry");
	anim2->setDuration(300);
	anim2->setStartValue(QRect(-150, 40, 150, 20));
	anim2->setEndValue(QRect(10, 40, 150, 20));

	QPropertyAnimation* anim3 = new QPropertyAnimation(sb, "geometry");
	anim3->setDuration(300);
	anim3->setStartValue(QRect(270, 10, 90, 20));
	anim3->setEndValue(QRect(170, 10, 90, 20));

	QPropertyAnimation* anim4 = new QPropertyAnimation(cb, "geometry");
	anim4->setDuration(300);
	anim4->setStartValue(QRect(270, 40, 90, 20));
	anim4->setEndValue(QRect(170, 40, 90, 20));

	QPropertyAnimation* anim5 = new QPropertyAnimation(def, "geometry");
	anim5->setDuration(300);
	anim5->setStartValue(QRect(10, 105, 130, 25));
	anim5->setEndValue(QRect(10, 70, 130, 25));

	QPropertyAnimation* anim6 = new QPropertyAnimation(ok, "geometry");
	anim6->setDuration(300);
	anim6->setStartValue(QRect(210, 105, 50, 25));
	anim6->setEndValue(QRect(210, 70, 50, 25));

	setFixedSize(270, 105);

	QParallelAnimationGroup* group = new QParallelAnimationGroup(this);
	group->addAnimation(anim1);
	group->addAnimation(anim2);
	group->addAnimation(anim3);
	group->addAnimation(anim4);
	group->addAnimation(anim5);
	group->addAnimation(anim6);
	group->start();
}
</code></pre></div></details><p>Нетрудно понять, что после завершения анимации мы получим те проблемы, которые уже видели: текст не будет вписываться в слишком узкие для него рамки:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows 10 и Windows7, масштаб экрана 150%" title="Windows 10 и Windows7, масштаб экрана 150%" height="160" data-src="https://habrastorage.org/getpro/habr/upload_files/1b6/29c/81d/1b629c81d264490169b259e8bc0d6301.png" data-width="564"/><figcaption>Windows 10 и Windows7, масштаб экрана 150%</figcaption></figure><p>Собственно, это произошло именно потому, что значение QRect, которое мы подаем в функцию setEndValue, то же самое, что мы подаем выше (см. пример 1) в функцию setGeometry.</p><p>Таким образом, проблема аналогична той, на которую мы вышли в конце рецепта 1, но решать ее надо без автокомпоновщика.</p><a class="anchor" name="recept3" id="recept3"></a><p><strong>Рецепт 3. Используйте метрику шрифтов при явном задании размеров.</strong></p><p>К счастью, в Qt есть возможность через QFontMetrics рассчитывать размеры (ширину, высоту) любых текстовых строк, а значит, можно из них выводить все размеры элементов и все отступы (промежутки) между ними. </p><p>Однако, в нашем примере не только текстовые элементы, а иная графика: стрелочки у QComboBox и QSpinBox. Что ж, это не сильно усложняет задачу. Их размеры тоже можно выводить из размера шрифта или явно узнавать из стиля.</p><p>Далее будем модифицировать текст примера 1 («Студенческий»), а не примера 2 с анимацией, поскольку последний более сложный, а идею можно понять и на более простом.</p><p>Итак, сначала уберем нечитаемую логику из той части кода, где логика компоновки элементов была скрыта за сплошными вызовами setGeometry для каждого отображаемого элемента. А логика там явно есть: </p><ul><li><p>мы хотим рисовать GUI в      три строки,</p></li><li><p>первые 2 строки имеют      табличное размещение (аналогично QGridLayout),</p></li><li><p>в третьей строке есть 2      кнопки, и они прижаты к левому и правому краю соответственно,</p></li><li><p>между всеми элементами      интерфейса одинаковые отступы.</p></li></ul><p> Итак, эту часть кода можно переписать следующим образом:</p><details class="spoiler"><summary>Показать код</summary><div class="spoiler__content"><pre><code class="cpp">	int offset = 10;
	int textHeight = 20;
	int buttonHeigh = 25;
	int column1Width = 150;
	int column2Width = 90;
	int okBtnWidth = 50;
	int defBtnWidth = 130;

	int line1Offset = offset;
	int line2Offset = line1Offset + textHeight + offset;
	int line3Offset = line2Offset + textHeight + offset;
	int column1Offset = offset;
	int column2Offset = column1Offset + column1Width + offset;

	int widgetWidth = column2Offset + column2Width + offset;
	int widgetHeight = line3Offset + buttonHeigh + offset;

	int okBtnOffset = widgetWidth - offset - okBtnWidth;

	label1->setGeometry(column1Offset, line1Offset, column1Width, textHeight);
	label2->setGeometry(column1Offset, line2Offset, column1Width, textHeight);
	sb->setGeometry(column2Offset, line1Offset, column2Width, textHeight);
	cb->setGeometry(column2Offset, line2Offset, column2Width, textHeight);
	ok->setGeometry(okBtnOffset, line3Offset, okBtnWidth, buttonHeigh);
	def->setGeometry(column1Offset, line3Offset, defBtnWidth, buttonHeigh);

	setFixedSize(widgetWidth, widgetHeight);
</code></pre></div></details><p>Не правда ли, складывается ощущение, что мы реализовали свою автокомпоновку, «навелосипедили»? Да, но без этого в этом примере нельзя.</p><p>Далее нам остается лишь заменить установку явных значений для offset, textHeight, buttonHeigh, column1Width, column2Width, okBtnWidth, defBtnWidth на значения, посчитанные из метрики шрифта. Размеры стрелочек для QComboBox и QSpinBox будем узнавать из стилей (хотя можно было бы тоже пытаться примерно высчитать из размера шрифта). Для точного понимания приведем весь код:</p><details class="spoiler"><summary>Показать код</summary><div class="spoiler__content"><pre><code class="cpp">ScaleWgt::ScaleWgt(QWidget* parent)
	: QWidget(parent)
{
	QString text1 = "Field1 long long long long name";
	QString text2 = "Field2 long long long name";
	QLabel* label1 = new QLabel(text1, this);
	QLabel* label2 = new QLabel(text2, this);
	QSpinBox* sb = new QSpinBox(this);
	sb->setMaximum(10);
	sb->setMinimum(0);
	sb->setValue(5);
	auto cb = new QComboBox(this);
	QString value1 = "Field2 value 1";
	QString value2 = "Field2 value 2";
	cb->addItem(value1);
	cb->addItem(value2);

	QString okText = "Ok";
	QPushButton* ok = new QPushButton(okText, this);
	QString defText = "Apply default values";
	QPushButton* def = new QPushButton(defText, this);

	QFontMetrics fm(font());

	QStyleOptionSpinBox opt;
	const int arrowWidth = sb->style()->subControlRect(
		QStyle::CC_SpinBox, &amp;opt, QStyle::SC_SpinBoxUp).width();
	const int maxTextWidth = fm.horizontalAdvance("10");
	const int sbxWidth = maxTextWidth + 2 * arrowWidth; // x2 just for more visual space

	QStyleOptionComboBox opt2;
	const int arrow2Width = cb->style()->subControlRect(
		QStyle::CC_ComboBox, &amp;opt2, QStyle::SC_ComboBoxArrow).width();
	const int cbWidth = fm.horizontalAdvance(value1) + arrow2Width + fm.averageCharWidth();

	int offset = qRound(fm.height() * 0.75);
	int textHeight = qRound(fm.height() * 1.5);
	int buttonHeight = fm.height() * 2.0;
	int column1Width = std::max&lt;int>(fm.horizontalAdvance(text1), fm.horizontalAdvance(text2));
	int column2Width = std::max&lt;int>(cbWidth, sbxWidth);
	int okBtnWidth = fm.horizontalAdvance(okText) + 8 * fm.averageCharWidth(); //x8 just for more visual space;
	int defBtnWidth = fm.horizontalAdvance(defText) + 4 * fm.averageCharWidth(); //x4 just for more visual space

	int line1Offset = offset;
	int line2Offset = line1Offset + textHeight + offset;
	int line3Offset = line2Offset + textHeight + offset;
	int column1Offset = offset;
	int column2Offset = column1Offset + column1Width + offset;

	int widgetWidth = column2Offset + column2Width + offset;
	int widgetHeight = line3Offset + buttonHeight + offset;

	int okBtnOffset = widgetWidth - offset - okBtnWidth;

	label1->setGeometry(column1Offset, line1Offset, column1Width, textHeight);
	label2->setGeometry(column1Offset, line2Offset, column1Width, textHeight);
	sb->setGeometry(column2Offset, line1Offset, column2Width, textHeight);
	cb->setGeometry(column2Offset, line2Offset, column2Width, textHeight);
	ok->setGeometry(okBtnOffset, line3Offset, okBtnWidth, buttonHeight);
	def->setGeometry(column1Offset, line3Offset, defBtnWidth, buttonHeight);

	setFixedSize(widgetWidth, widgetHeight);
}</code></pre></div></details><p>После таких манипуляций на любых масштабах экрана виджет будет адекватно выглядеть:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows7, масштаб экрана 100%, 125%, 150%." title="Windows7, масштаб экрана 100%, 125%, 150%." height="209" data-src="https://habrastorage.org/getpro/habr/upload_files/5ac/669/8ee/5ac6698ee22a16adee107125331861bf.png" data-width="1054"/><figcaption>Windows7, масштаб экрана 100%, 125%, 150%.</figcaption></figure><p>Итак, мы смогли использовать метрику шрифтов вместо явного, хардкорного задания размеров. Однако, оценив разросшийся код,  легко понять, что прибегать к этому рецепту следует только тогда, когда автокомпоновку использовать совсем никак нельзя.</p><p><strong>Рецепт 4. Не используйте атрибут Qt::AA_EnableHighDpiScaling</strong></p><p>Может показаться, что переписывание примера 1 по рецептам 2 или 3 – долгая и ненужная затея, что можно обойтись меньшей кровью. К сожалению, это не так. В Qt5 существуют быстрые и обходные пути решения проблемы  High DPI: атрибут Qt::AA_EnableHighDpiScaling, переменные окружения QT_ENABLE_HIGHDPI_SCALING, QT_AUTO_SCREEN_SCALE_FACTOR и <a href="https://doc.qt.io/qt-5/highdpi.html" rel="noopener noreferrer nofollow">прочие</a>. Все эти простые пути приводят к неслабым артефактам. На рисунке ниже приведен пример применения атрибута Qt::AA_EnableHighDpiScaling к коду из примера 1.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows7, масштаб экрана 100%, 125%, 150%." title="Windows7, масштаб экрана 100%, 125%, 150%." height="266" data-src="https://habrastorage.org/getpro/habr/upload_files/2ba/24a/1d7/2ba24a1d7782430fa20fbbee0ae84abd.png" data-width="1136"/><figcaption>Windows7, масштаб экрана 100%, 125%, 150%.</figcaption></figure><p>На всех масштабах, кроме исходного 100%, видны проблемы. На 125% увеличился текст, но не увеличились размеры виджетов, а на 150% видно (сравните с рисунками из рецептов 2 и 3), что всё увеличилось не в 1.5 раза, а ровно в 2 раза (что неприемлемо), но текст всё равно помещается не везде.</p><p>Таким образом, просто установить атрибут Qt::AA_EnableHighDpiScaling и не делать больше ничего (не применять описанные рецепты) не получится, а раз мы все равно вынуждены применять рецепты 2 и 3, то никакой необходимости в быстрых и обходных решениях, типа Qt::AA_EnableHighDpiScaling, попросту нет. Кроме того, атрибут Qt::AA_EnableHighDpiScaling отвратительно масштабирует текст на масштабах 125% (100% вместо 125%), 150% (200% вместо 150%), 175% (200% вместо 175%) и др. Собственно, именно это имелось в виду в документации Qt5 в краткой, как сестра таланта, фразе «Non-integer scale factors may cause significant scaling/painting artifacts».</p><p>Мы не будем подробно останавливаться на других уловках, типа QT_ENABLE_HIGHDPI_SCALING, QT_AUTO_SCREEN_SCALE_FACTOR (и тем более на причинах, почему они работают плохо), просто скажем, что может быть, для каких-то очень простых приложений они и подойдут, но для любого сколько-нибудь серьезного их попросту не хватит, будут вылезать многочисленные артефакты.</p><p>Хорошо, но с начала статьи мы не слова не сказали про иконки и вообще про любые картинки. Что с ними?</p><p> <strong>Пример 3. Простые иконки.</strong></p><p>Добавим в наш простой пример ситуацию, которая вполне могла бы сложиться в реальной жизни в случае, когда приложение разрабатывалось достаточно давно. А именно: приложение может содержать устаревшие, маленькие иконки 16x16 или даже 12x12. Добавим их в текст нашего примера (для случая автокомпоновки, конечно):</p><pre><code class="cpp">	ok->setIcon(QIcon(":/button_ok.png"));
	def->setIcon(QIcon(":/home.png"));</code></pre><p>На масштабе 100% они выглядят приемлемо (хотя и немного старовато), а вот при бОльших масштабах иконки выглядят слишком мелкими:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows7, масштаб экрана 100%,  200%, размер иконок 16x16." title="Windows7, масштаб экрана 100%,  200%, размер иконок 16x16." height="251" data-src="https://habrastorage.org/getpro/habr/upload_files/f50/543/3de/f505433de705a223b1e5b369254ffa16.png" data-width="842"/><figcaption>Windows7, масштаб экрана 100%,  200%, размер иконок 16x16.</figcaption></figure><p><strong><em>Рецепт 5. Увеличьте все иконки или переходите на векторный формат.</em></strong></p><p>В простых случаях, как в описанном примере, достаточно просто заменить растровые иконки размером 16x16 на аналогичные, бОльшие, например, 32x32 или даже 64x64. Также можно заменить растровые иконки на векторные(SVG). Это навсегда закроет проблему больших экранов.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows7, масштаб экрана 200%, размер иконок 32x32." title="Windows7, масштаб экрана 200%, размер иконок 32x32." height="250" data-src="https://habrastorage.org/getpro/habr/upload_files/88a/768/add/88a768add737a89fde4d97e66ec1ffc1.png" data-width="556"/><figcaption>Windows7, масштаб экрана 200%, размер иконок 32x32.</figcaption></figure><p>Однако такой простой трюк имеет ограниченную область применения. Это будет работать, когда не требуется явно задавать никакие размеры иконок, в том числе не устанавливать собственные стили. Так, для функции QAbstractButton::setIcon в документации явно сказано:</p><p><code>The icon's default size is defined by the GUI style, but can be adjusted by setting the iconSize property.</code></p><p>То есть если просто вызываем QAbstractButton::setIcon, то будет работать, а если хотим вызвать еще QAbstractButton::setIconSize, то… надо высчитывать размеры иконок, но не из метрики шрифтов (как в рецепте 3), а другим, более простым способом.</p><p><strong>Пример 4. Иконки с размерами.</strong></p><p>Немного изменим наш пример и добавим туда кнопки с иконками фиксированного размера:</p><pre><code class="cpp">	auto reloadBtn = new QToolButton();
	reloadBtn->setStyleSheet("QToolButton {"
		"icon-size: 14px 14px; "
		"background: rgb(101, 180, 93); }");
	reloadBtn->setIcon(QIcon(":/reload.svgz"));</code></pre><p>(Отметим, что совершенно неважно, каким именно способом выставляется размер иконок: через QAbstractButton::setIconSize или через задание css-стилей, как здесь. Результат будет одинаковый.)</p><p>Как и в примере 3, на масштабе 100% кнопки выглядят приемлемо, а вот при бОльших масштабах иконки выглядят слишком мелкими:</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Windows7, масштаб экрана 100%,  200%, размер иконок 14x14.
" title="Windows7, масштаб экрана 100%,  200%, размер иконок 14x14.
" height="250" data-src="https://habrastorage.org/getpro/habr/upload_files/61a/319/6ce/61a3196ce789146c2c54569a426cd04c.png" data-width="910"/><figcaption>Windows7, масштаб экрана 100%,  200%, размер иконок 14x14.
</figcaption></figure><a class="anchor" name="recept6" id="recept6"></a><p><strong>Рецепт 6. Используйте экранный масштаб при явном задании размеров.</strong></p><p>Qt позволяет нам явно узнать значение экранного масштаба, для этого есть функция <code>QScreen::logicalDotsPerInchX(),</code> которая возвращает значение плотности пикселей в так называемых «логических» координатах. Значение 96 в этой системе координат означает 100% масштаба экрана, значение 120 соответствует масштабу экрана 125%, значение 144 – 150% и т.д. Таким образом, масштаб экрана для класса <code>QWidget</code> можно узнать, например, так:</p><pre><code class="cpp">const double scale = screen()->logicalDotsPerInchX() / 96.0;</code></pre><p>Далее следует везде в коде, где встречается фиксированный размер <code>value</code>, заменить его на <code>qRound(value * scale).</code> Таким образом, код инициализации кнопки будет заменен на</p><pre><code class="cpp">	reloadBtn->setStyleSheet(QString("QToolButton {"
		"icon-size: %1px %2px; "
		"background: rgb(101, 180, 93); }")
		.arg(qRound(14 * scale)).arg(qRound(14 * scale)));
</code></pre><p>И в результате получим то, что хотели:</p><figure class="full-width "><img src="/img/image-loader.svg" height="257" data-src="https://habrastorage.org/getpro/habr/upload_files/881/e64/491/881e64491cb9226856a13091398b5b92.png" data-width="606"/><figcaption></figcaption></figure><p>Стоит отметить, что область применения этого рецепта – довольно широкая. Везде, где нелогично и неудобно применять расчет размеров через метрику шрифтов, следует применять расчет размеров через экранный масштаб. Чтобы стало более ясно, что такое «нелогично и неудобно», давайте всё же еще рассмотрим пару примеров на применение этого рецепта.</p><p><strong> Пример 5. Стили css.</strong></p><p>Предположим, что в нас проснулся Стив Джобс, и мы грезим скругленными кнопками. Модернизируем пример выше следующим образом:</p><pre><code class="cpp">	reloadBtn->setStyleSheet(QString("QToolButton {"
		"width: 19px; "
		"height: 19px;"
		"border-radius: 10px;"
		"icon-size: 14px 14px; "
		"background: rgb(101, 180, 93); }"));</code></pre><p>Опять имеем жестко заданные размеры, в том числе и радиус скругления. Чтобы адаптировать такой код, достаточно переписать его вот так:</p><pre><code class="cpp">	const int size = 19 * scale;
	const int borderRadius = size / 2 + 1;
	const int iconSize = qRound(5. / 7 * size);
	reloadBtn->setStyleSheet(QString("QToolButton {"
		"width: %1px;"
		"height: %1px;"
		"border-radius: %2px;"
		"icon-size: %3px %3px; "
		"background: rgb(101, 180, 93); }")
		.arg(size)
		.arg(borderRadius)
		.arg(iconSize));</code></pre><p>И в результате получим то, что хотели:</p><figure class="full-width "><img src="/img/image-loader.svg" height="265" data-src="https://habrastorage.org/getpro/habr/upload_files/7e9/aae/c1b/7e9aaec1be2eca38d9111d526521fd00.png" data-width="609"/><figcaption></figcaption></figure><p><strong>Пример 6. Появление HTML.</strong></p><p>Повесим на кнопку Ok слот onOkClicked, в котором будем вызываться QMessageBox с текстом html внутри:</p><pre><code class="cpp">void ScaleWgt::onOkClicked()
{
	QMessageBox msg(QMessageBox::Question, "MessageBox Title",
		QString("Are you sure?&lt;br>&lt;br> &lt;img src=':/brain.svg' width='100'>&lt;br>&lt;br>Are you sure?"));
	msg.exec();
}</code></pre><p>И снова фиксированный размер, и снова используем экранный масштаб:</p><pre><code class="cpp">void ScaleWgt::onOkClicked()
{
	const double scale = QApplication::desktop()->logicalDpiX() / 96.0;
	QMessageBox msg(QMessageBox::Question, "MessageBox Title",
		QString("Are you sure?&lt;br>&lt;br> &lt;img src=':/brain.svg' width='%1'>&lt;br>&lt;br>Are you sure?")
		.arg(qRound(100 * scale)));
	msg.exec();
}</code></pre><hr/><p>Итак, с размерами виджетов в простых случаях разобрались. Закрепим приведенные рецепты итоговым алгоритмом их применения:</p><figure class="full-width "><img src="/img/image-loader.svg" height="5280" data-src="https://habrastorage.org/getpro/habr/upload_files/a98/2c8/a18/a982c8a183a7c1707e55bdf03e04192c.png" data-width="6760"/><figcaption></figcaption></figure><p>На этом рецепты не кончаются, и в случае заинтересованности со стороны читателей могу опубликовать следующую порцию в следующей статье.</p><p>Всем не болеть!</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BQt%5D" class="tm-tags-list__link">Qt</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bqt5%5D" class="tm-tags-list__link">qt5</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bc%2B%2B%5D" class="tm-tags-list__link">c++</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgui%5D" class="tm-tags-list__link">gui</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdesktop%5D" class="tm-tags-list__link">desktop</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bwindows%5D" class="tm-tags-list__link">windows</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bhigh%20dpi%5D" class="tm-tags-list__link">high dpi</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B4k%5D" class="tm-tags-list__link">4k</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/programming/" class="tm-hubs-list__link">
    Программирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/cpp/" class="tm-hubs-list__link">
    C++
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/qt_software/" class="tm-hubs-list__link">
    Qt
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/oop/" class="tm-hubs-list__link">
    ООП
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/win_dev/" class="tm-hubs-list__link">
    Разработка под Windows
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 20: ↑20 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 20: ↑20 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+20</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    61
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/kalirgum/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 18 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    16
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">28</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/kalirgum/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @kalirgum
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/582180/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 3 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/582180/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/582180/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"582180":{"id":"582180","timePublished":"2021-10-07T13:22:55+00:00","isCorporative":false,"lang":"ru","titleHtml":"Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1","leadData":{"textHtml":"\u003Cp\u003EВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и\u002Fили размером экрана. Году в 2010 стандартным монитором можно было считать экземпляр 19’’ c разрешением WXGA++ (1600*900) и фактической плотностью пикселей 97 DPI (dots per inch). Сейчас (2021 год) стандартным монитором, думаю, можно признать экземпляр 24’’ c разрешением \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FFull_HD\" rel=\"noopener noreferrer nofollow\"\u003EFull HD\u003C\u002Fa\u003E (1920*1080) и плотностью пикселей 92 DPI. Под «стандартным» я понимаю тот монитор, который стоит на рабочем месте у большинства работающего люда: инженеры, бухгалтеры, переводчики и т.д. (при этом, конечно, «стандартность» — это субъективная и приблизительная оценка). Относительно новые и отчасти нишевые модели (для фотографов, видеографов, геймеров) имеют характеристики: 4\u003Cu\u003EK UHD (3840*2160) и 28’’ (157 DPI)\u003C\u002Fu\u003E или \u003Cu\u003EUWQHD (3440x1440) и 34\" (109 DPI)\u003C\u002Fu\u003E или \u003Cu\u003EQHD (2560x1440) и 27\" (109 DPI)\u003C\u002Fu\u003E или \u003Cu\u003EUWHD (2560x1080) и 29\" (96 DPI)\u003C\u002Fu\u003E. Таким образом, наблюдается рост в связанных группах признаков: \u003Cu\u003Eразрешение+размер экрана\u003C\u002Fu\u003E, или \u003Cu\u003Eразрешение+плотность пикселей\u003C\u002Fu\u003E, или даже \u003Cu\u003Eразрешение+плотность пикселей+размер экрана\u003C\u002Fu\u003E. На рынке ноутбуков в плане экранов похожая ситуация – растет \u003Cu\u003Eразрешение+плотность пикселей\u003C\u002Fu\u003E.\u003C\u002Fp\u003E\u003Cp\u003EК сожалению, не всегда программное обеспечение поспевает за ростом характеристик мониторов. Нередко оно выглядит немного коряво и неухоженно, что расстраивает пользователя. Действительно, на дворе 21 век, а зачастую приходится видеть размытые шрифты, а иногда и микроскопические иконки. \u003C\u002Fp\u003E\u003Cp\u003EЧто касается высокой чёткости (большой плотности пикселей), то в ОС Windows давно есть такие настройки, как масштабирование шрифта и изображений (масштаб экрана), которые применяются для увеличения слишком малых элементов GUI на мониторах с высокой чёткостью (High DPI). Также есть поддержка в платформе Qt (с нюансами, об этом далее). Однако способно ли Ваше, конкретное ПО их адекватно учитывать, применять?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa74\u002Ffc6\u002F745\u002Fa74fc67456d4789b36ef4efca39a806d.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa74\u002Ffc6\u002F745\u002Fa74fc67456d4789b36ef4efca39a806d.png","fit":"cover","positionY":100,"positionX":3.0769230769231}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":16,"votesCount":18},"rating":28,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2375071","alias":"kalirgum","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":3,"favoritesCount":61,"readingCount":4993,"score":20,"votesCount":20},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true},{"relatedData":null,"id":"7330","alias":"qt_software","type":"collective","title":"Qt","titleHtml":"Qt","isProfiled":true},{"relatedData":null,"id":"17719","alias":"oop","type":"collective","title":"ООП","titleHtml":"ООП","isProfiled":true},{"relatedData":null,"id":"21456","alias":"win_dev","type":"collective","title":"Разработка под Windows","titleHtml":"Разработка под Windows","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E\u003Cstrong\u003EВведение\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и\u002Fили размером экрана. Году в 2010 стандартным монитором можно было считать экземпляр 19’’ c разрешением WXGA++ (1600*900) и фактической плотностью пикселей 97 DPI (dots per inch). Сейчас (2021 год) стандартным монитором, думаю, можно признать экземпляр 24’’ c разрешением \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FFull_HD\" rel=\"noopener noreferrer nofollow\"\u003EFull HD\u003C\u002Fa\u003E (1920*1080) и плотностью пикселей 92 DPI. Под «стандартным» я понимаю тот монитор, который стоит на рабочем месте у большинства работающего люда: инженеры, бухгалтеры, переводчики и т.д. (при этом, конечно, «стандартность» — это субъективная и приблизительная оценка). Относительно новые и отчасти нишевые модели (для фотографов, видеографов, геймеров) имеют характеристики: 4\u003Cu\u003EK UHD (3840*2160) и 28’’ (157 DPI)\u003C\u002Fu\u003E или \u003Cu\u003EUWQHD (3440x1440) и 34\" (109 DPI)\u003C\u002Fu\u003E или \u003Cu\u003EQHD (2560x1440) и 27\" (109 DPI)\u003C\u002Fu\u003E или \u003Cu\u003EUWHD (2560x1080) и 29\" (96 DPI)\u003C\u002Fu\u003E. Таким образом, наблюдается рост в связанных группах признаков: \u003Cu\u003Eразрешение+размер экрана\u003C\u002Fu\u003E, или \u003Cu\u003Eразрешение+плотность пикселей\u003C\u002Fu\u003E, или даже \u003Cu\u003Eразрешение+плотность пикселей+размер экрана\u003C\u002Fu\u003E. На рынке ноутбуков в плане экранов похожая ситуация – растет \u003Cu\u003Eразрешение+плотность пикселей\u003C\u002Fu\u003E.\u003C\u002Fp\u003E\u003Cp\u003EК сожалению, не всегда программное обеспечение поспевает за ростом характеристик мониторов. Нередко оно выглядит немного коряво и неухоженно, что расстраивает пользователя. Действительно, на дворе 21 век, а зачастую приходится видеть размытые шрифты, а иногда и микроскопические иконки. \u003C\u002Fp\u003E\u003Cp\u003EЧто касается высокой чёткости (большой плотности пикселей), то в ОС Windows давно есть такие настройки, как масштабирование шрифта и изображений (масштаб экрана), которые применяются для увеличения слишком малых элементов GUI на мониторах с высокой чёткостью (High DPI). Также есть поддержка в платформе Qt (с нюансами, об этом далее). Однако способно ли Ваше, конкретное ПО их адекватно учитывать, применять?\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"459\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa74\u002Ffc6\u002F745\u002Fa74fc67456d4789b36ef4efca39a806d.png\" data-width=\"734\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЕсли пока ещё нет, то в этой статье мы собрали рецепты по адаптации Вашего ПО, написанного на платформе Qt, к современным мониторам высокой четкости. Мы искали и открывали эти рецепты в процессе адаптации одного из наших продуктов. Общий размер кодовой базы GUI – около 200 тысяч строк кода (С++) и 100+ виджетов, код писался разными людьми и в разное время (в том числе и в эпоху 16-пиксельных картинок, которые, как нетрудно догадаться, не очень выгодно выглядят на современных мониторах). В нашей кодовой базе мы нашли целую библиотеку примеров, которые выглядят проблемно на мониторах высокой четкости, и мы постарались эту библиотеку систематизировать, обобщить, упростить и создать на ее базе готовые и легкие для понимания рецепты. В этой статье мы поделимся некоторыми из этих рецептов.\u003C\u002Fp\u003E\u003Cp\u003EИсходный код примеров был протестирован на Qt5 и Qt6 (более точно – 5.15 и 6.2), на операционках Windows 10 и Windows 7. В основном в статье описаны реалии и будни Qt5 (поскольку именно на Qt5 проблема стоит особенно остро), но рецепты можно с успехом применять и на Qt6 – ничего от этого не поломается.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EПример 1. «Студенческий».\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EНачнем разбираться в ситуации на примере простого виджета. Будем последовательно находить проблемы, фиксировать причины и выводить из них решения, затем будем усложнять пример, снова находить проблемы, фиксировать причины и выводить из них решения, и далее по кругу.\u003C\u002Fp\u003E\u003Cp\u003EИтак, виджет в студию!\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows 10 и Windows7, масштаб экрана 100%\" title=\"Windows 10 и Windows7, масштаб экрана 100%\" height=\"143\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5a8\u002Fd53\u002F9b0\u002F5a8d539b0e4cc7698b3580f7af6b7061.png\" data-width=\"557\"\u002F\u003E\u003Cfigcaption\u003EWindows 10 и Windows7, масштаб экрана 100%\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EА вот и исходный код:\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EScaleWgt::ScaleWgt(QWidget* parent)\n\t: QWidget(parent)\n{\n\tQLabel* label1 = new QLabel(\"Field1 long long long long name\", this);\n\tQLabel* label2 = new QLabel(\"Field2 long long long name\", this);\n\tQSpinBox* sb = new QSpinBox(this);\n\tsb-\u003EsetMaximum(10);\n\tsb-\u003EsetMinimum(0);\n\tsb-\u003EsetValue(5);\n\tauto cb = new QComboBox(this);\n\tcb-\u003EaddItem(\"Field2 value 1\");\n\tcb-\u003EaddItem(\"Field2 value 2\");\n\n\tQPushButton* ok = new QPushButton(\"Ok\", this);\n\tQPushButton* def = new QPushButton(\"Apply default values\", this);\n\n\tlabel1-\u003EsetGeometry(10, 10, 150, 20);\n\tlabel2-\u003EsetGeometry(10, 40, 150, 20);\n\tsb-\u003EsetGeometry(170, 10, 90, 20);\n\tcb-\u003EsetGeometry(170, 40, 90, 20);\n\tok-\u003EsetGeometry(210, 70, 50, 25);\n\tdef-\u003EsetGeometry(10, 70, 130, 25);\n}\nint main(int argc, char *argv[])\n{\n\tQApplication a(argc, argv);\n\tScaleWgt w;\n\tw.show();\n\treturn a.exec();\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНе будем пока обсуждать, насколько хорош или плох данный код, а сосредоточимся только на том, насколько хорошо виджет выглядит на бОльших масштабах экрана, и что с этим делать. На исходном масштабе в 100% выглядит приемлемо, проблем с GUI нет. А вот при большем масштабировании начинаются проблемы.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows 10 и Windows7, масштаб экрана 150%\" title=\"Windows 10 и Windows7, масштаб экрана 150%\" height=\"160\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F62d\u002Fae6\u002Feb4\u002F62dae6eb4be7b7411bdf8eacdbc0a55e.png\" data-width=\"564\"\u002F\u003E\u003Cfigcaption\u003EWindows 10 и Windows7, масштаб экрана 150%\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПо заголовку видно, что системный, родной шрифт Windows вырос. При этом на Windows 10 наш, запрограммированный, шрифт на виджетах не вырос, а на Windows 7 он вырос, но не поместился по размеру в рамки виджетов. Хорошо, это на данный момент и есть наши проблемы, а как с ними бороться?\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EРецепт 1.  Настройте DPI Awareness Level.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EК счастью, \u003Ca href=\"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fhidpi\u002Fhigh-dpi-desktop-application-development-on-windows?redirectedfrom=MSDN\" rel=\"noopener noreferrer nofollow\"\u003EWindows представляет нам готовую системную настройку для работы с высокими DPI\u003C\u002Fa\u003E. Соответствующая обертка в Qt называется Qt DPI Awareness Level (подробнее см. \u003Ca href=\"https:\u002F\u002Fdoc.qt.io\u002Fqt-5\u002Fhighdpi.html\" rel=\"noopener noreferrer nofollow\"\u003Eздесь\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\u003Cp\u003EЧтобы произвести настройку, надо всего лишь рядом с выполняемым файлом (exe) приложения положить файл qt.conf со следующим содержимым:\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003E[Platforms]\u003Cbr\u002F\u003E WindowsArguments = dpiawareness=1\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003EЗдесь 1 = System-DPI Aware.\u003C\u002Fp\u003E\u003Cp\u003EВ результате такого нехитрого трюка все стандартные элементы управления Qt (такие, как QLabel, QComboBox, QPushButton и пр.) станут рисовать адекватный шрифт (как в Windows7, так и в Windows10), причем для всех виджетов в рамках всего приложения сразу.\u003C\u002Fp\u003E\u003Cp\u003EДля сравнения на рисунках ниже показан наш виджет в разных вариациях параметра DPI Awareness Level.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows 7, 150%, Awareness Level = 0,1,2 (слева направо)\" title=\"Windows 7, 150%, Awareness Level = 0,1,2 (слева направо)\" height=\"215\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ab\u002Fa6d\u002F009\u002F0aba6d009b1dad3f19c10e5ede19cdc0.png\" data-width=\"1014\"\u002F\u003E\u003Cfigcaption\u003EWindows 7, 150%, Awareness Level = 0,1,2 (слева направо)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows 10, 150%, Awareness Level = 0,1,2 (слева направо)\" title=\"Windows 10, 150%, Awareness Level = 0,1,2 (слева направо)\" height=\"205\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F84f\u002F5a9\u002F6f7\u002F84f5a96f7616e647a859a86bb8965418.png\" data-width=\"955\"\u002F\u003E\u003Cfigcaption\u003EWindows 10, 150%, Awareness Level = 0,1,2 (слева направо)\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EОсобенно важно то, что такая настройка позволяет масштабировать шрифты ровно настолько, насколько установлен масштаб экрана: 125%, 150%, 175%  и т. д. Это будет важно для последующего обсуждения, пока что просто запомним это.\u003C\u002Fp\u003E\u003Cp\u003EИтак, мы добились того, что все шрифты теперь всегда имеют должный размер (можете проверить для других масштабов экрана), но осталась проблема того, что текст не помещается по размеру в рамки виджетов. Решить ее поможет следующий рецепт.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EРецепт 2. Используйте автокомпоновку.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EРанее в коде мы явным образом размещали элементы управления внутри виджета посредством вызова setGeometry. Аналогичное действие имел бы вызов функций move, resize, setFixedSize. Можно сказать, что это одного поля ягоды. Так вот, следует отказаться от этой порочной практики. Менеджеры компоновки (классы, производные от QLayout) прекрасно справляются с задачей расчета позиции и размера виджета для любых масштабов экрана. Таким образом, в нашем примере нам просто стоит заменить код на следующий:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПоказать код\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EScaleWgt::ScaleWgt(QWidget *parent)\n\t: QWidget(parent)\n{\n\tauto layout = new QGridLayout();\n\tQLabel* label1 = new QLabel(\"Field1 long long long long name\");\n\tQLabel* label2 = new QLabel(\"Field2 long long long name\");\n\tQSpinBox* sb = new QSpinBox();\n\tsb-\u003EsetMaximum(10);\n\tsb-\u003EsetMinimum(0);\n\tsb-\u003EsetValue(5);\n\tauto cb = new QComboBox();\n\tcb-\u003EaddItem(\"Field2 value 1\");\n\tcb-\u003EaddItem(\"Field2 value 2\");\n\tlayout-\u003EaddWidget(label1, 0, 0);\n\tlayout-\u003EaddWidget(label2, 1, 0);\n\tlayout-\u003EaddWidget(sb, 0, 1);\n\tlayout-\u003EaddWidget(cb, 1, 1);\n\n\tQPushButton* ok = new QPushButton(\"Ok\");\n\tQPushButton* def = new QPushButton(\"Apply default values\");\n\tQHBoxLayout* hbl = new QHBoxLayout();\n\thbl-\u003EaddWidget(def);\n\thbl-\u003EaddStretch();\n\thbl-\u003EaddWidget(ok);\n\tlayout-\u003EaddLayout(hbl, 2, 0, 1, 2);\n\tsetLayout(layout);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EВ результате получаем адекватно выглядящие виджеты при любых масштабах:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows 10 и Windows7, масштаб экрана 150%\" title=\"Windows 10 и Windows7, масштаб экрана 150%\" height=\"192\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F544\u002Fa50\u002F30f\u002F544a5030fef7b5f4daf8a267b4f9a2e2.png\" data-width=\"834\"\u002F\u003E\u003Cfigcaption\u003EWindows 10 и Windows7, масштаб экрана 150%\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows7, масштаб экрана 100%, 125%, 150%.\" title=\"Windows7, масштаб экрана 100%, 125%, 150%.\" height=\"194\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F890\u002Ff8f\u002F1f2\u002F890f8f1f256d65e93c3a75cd86187c43.png\" data-width=\"1053\"\u002F\u003E\u003Cfigcaption\u003EWindows7, масштаб экрана 100%, 125%, 150%.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗдесь очень важно то, что использование автокомпоновки не просто упрощает задачу создания графических интерфейсов, не просто автоматизирует некоторые действия и расчеты, а кардинальным образом меняет сам стиль работы программиста:  разработчик ПОЛНОСТЬЮ избавлен от необходимости устанавливать какие-либо фиксированные размеры и координаты, что полностью исключает артефакты отображения при больших масштабах экрана.\u003C\u002Fp\u003E\u003Cp\u003EОднако,  усомнимся, полностью ли? Может, всё же необходимо иногда устанавливать фиксированные размеры и координаты? Может, иногда совсем-совсем без этого не обойтись? К сожалению, да, иногда. Есть некоторые, довольно редкие, классы задач, где это действительно необходимо. Последующее изложение будет посвящено как раз таким классам и способам решения.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EПример 2. Анимация движения.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EПредположим, мы хотим реализовать анимацию появления элементов GUI на форме: пусть названия полей выплывают справа, значения – слева, а кнопки - снизу. В этом случае без задействования setGeometry не обойтись. Неважно, что эту функцию будет дергать класс QPropertyAnimation, а не наш, клиентский, код, все равно вызовы setGeometry будут. \u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EВот как будет выглядеть наш класс с анимацией:\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EScaleWgt::ScaleWgt(QWidget* parent)\n\t: QWidget(parent)\n{\n\tQLabel* label1 = new QLabel(\"Field1 long long long long name\", this);\n\tQLabel* label2 = new QLabel(\"Field2 long long long name\", this);\n\tQSpinBox* sb = new QSpinBox(this);\n\tsb-\u003EsetMaximum(10);\n\tsb-\u003EsetMinimum(0);\n\tsb-\u003EsetValue(5);\n\tauto cb = new QComboBox(this);\n\tcb-\u003EaddItem(\"Field2 value 1\");\n\tcb-\u003EaddItem(\"Field2 value 2\");\n\n\tQPushButton* ok = new QPushButton(\"Ok\", this);\n\tQPushButton* def = new QPushButton(\"Apply default values\", this);\n\n\tQPropertyAnimation* anim1 = new QPropertyAnimation(label1, \"geometry\");\n\tanim1-\u003EsetDuration(300);\n\tanim1-\u003EsetStartValue(QRect(-150, 10, 150, 20));\n\tanim1-\u003EsetEndValue(QRect(10, 10, 150, 20));\n\n\tQPropertyAnimation* anim2 = new QPropertyAnimation(label2, \"geometry\");\n\tanim2-\u003EsetDuration(300);\n\tanim2-\u003EsetStartValue(QRect(-150, 40, 150, 20));\n\tanim2-\u003EsetEndValue(QRect(10, 40, 150, 20));\n\n\tQPropertyAnimation* anim3 = new QPropertyAnimation(sb, \"geometry\");\n\tanim3-\u003EsetDuration(300);\n\tanim3-\u003EsetStartValue(QRect(270, 10, 90, 20));\n\tanim3-\u003EsetEndValue(QRect(170, 10, 90, 20));\n\n\tQPropertyAnimation* anim4 = new QPropertyAnimation(cb, \"geometry\");\n\tanim4-\u003EsetDuration(300);\n\tanim4-\u003EsetStartValue(QRect(270, 40, 90, 20));\n\tanim4-\u003EsetEndValue(QRect(170, 40, 90, 20));\n\n\tQPropertyAnimation* anim5 = new QPropertyAnimation(def, \"geometry\");\n\tanim5-\u003EsetDuration(300);\n\tanim5-\u003EsetStartValue(QRect(10, 105, 130, 25));\n\tanim5-\u003EsetEndValue(QRect(10, 70, 130, 25));\n\n\tQPropertyAnimation* anim6 = new QPropertyAnimation(ok, \"geometry\");\n\tanim6-\u003EsetDuration(300);\n\tanim6-\u003EsetStartValue(QRect(210, 105, 50, 25));\n\tanim6-\u003EsetEndValue(QRect(210, 70, 50, 25));\n\n\tsetFixedSize(270, 105);\n\n\tQParallelAnimationGroup* group = new QParallelAnimationGroup(this);\n\tgroup-\u003EaddAnimation(anim1);\n\tgroup-\u003EaddAnimation(anim2);\n\tgroup-\u003EaddAnimation(anim3);\n\tgroup-\u003EaddAnimation(anim4);\n\tgroup-\u003EaddAnimation(anim5);\n\tgroup-\u003EaddAnimation(anim6);\n\tgroup-\u003Estart();\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНетрудно понять, что после завершения анимации мы получим те проблемы, которые уже видели: текст не будет вписываться в слишком узкие для него рамки:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows 10 и Windows7, масштаб экрана 150%\" title=\"Windows 10 и Windows7, масштаб экрана 150%\" height=\"160\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b6\u002F29c\u002F81d\u002F1b629c81d264490169b259e8bc0d6301.png\" data-width=\"564\"\u002F\u003E\u003Cfigcaption\u003EWindows 10 и Windows7, масштаб экрана 150%\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСобственно, это произошло именно потому, что значение QRect, которое мы подаем в функцию setEndValue, то же самое, что мы подаем выше (см. пример 1) в функцию setGeometry.\u003C\u002Fp\u003E\u003Cp\u003EТаким образом, проблема аналогична той, на которую мы вышли в конце рецепта 1, но решать ее надо без автокомпоновщика.\u003C\u002Fp\u003E\u003Ca class=\"anchor\" name=\"recept3\" id=\"recept3\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Cstrong\u003EРецепт 3. Используйте метрику шрифтов при явном задании размеров.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EК счастью, в Qt есть возможность через QFontMetrics рассчитывать размеры (ширину, высоту) любых текстовых строк, а значит, можно из них выводить все размеры элементов и все отступы (промежутки) между ними. \u003C\u002Fp\u003E\u003Cp\u003EОднако, в нашем примере не только текстовые элементы, а иная графика: стрелочки у QComboBox и QSpinBox. Что ж, это не сильно усложняет задачу. Их размеры тоже можно выводить из размера шрифта или явно узнавать из стиля.\u003C\u002Fp\u003E\u003Cp\u003EДалее будем модифицировать текст примера 1 («Студенческий»), а не примера 2 с анимацией, поскольку последний более сложный, а идею можно понять и на более простом.\u003C\u002Fp\u003E\u003Cp\u003EИтак, сначала уберем нечитаемую логику из той части кода, где логика компоновки элементов была скрыта за сплошными вызовами setGeometry для каждого отображаемого элемента. А логика там явно есть: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eмы хотим рисовать GUI в      три строки,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eпервые 2 строки имеют      табличное размещение (аналогично QGridLayout),\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eв третьей строке есть 2      кнопки, и они прижаты к левому и правому краю соответственно,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eмежду всеми элементами      интерфейса одинаковые отступы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E Итак, эту часть кода можно переписать следующим образом:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПоказать код\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\tint offset = 10;\n\tint textHeight = 20;\n\tint buttonHeigh = 25;\n\tint column1Width = 150;\n\tint column2Width = 90;\n\tint okBtnWidth = 50;\n\tint defBtnWidth = 130;\n\n\tint line1Offset = offset;\n\tint line2Offset = line1Offset + textHeight + offset;\n\tint line3Offset = line2Offset + textHeight + offset;\n\tint column1Offset = offset;\n\tint column2Offset = column1Offset + column1Width + offset;\n\n\tint widgetWidth = column2Offset + column2Width + offset;\n\tint widgetHeight = line3Offset + buttonHeigh + offset;\n\n\tint okBtnOffset = widgetWidth - offset - okBtnWidth;\n\n\tlabel1-\u003EsetGeometry(column1Offset, line1Offset, column1Width, textHeight);\n\tlabel2-\u003EsetGeometry(column1Offset, line2Offset, column1Width, textHeight);\n\tsb-\u003EsetGeometry(column2Offset, line1Offset, column2Width, textHeight);\n\tcb-\u003EsetGeometry(column2Offset, line2Offset, column2Width, textHeight);\n\tok-\u003EsetGeometry(okBtnOffset, line3Offset, okBtnWidth, buttonHeigh);\n\tdef-\u003EsetGeometry(column1Offset, line3Offset, defBtnWidth, buttonHeigh);\n\n\tsetFixedSize(widgetWidth, widgetHeight);\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНе правда ли, складывается ощущение, что мы реализовали свою автокомпоновку, «навелосипедили»? Да, но без этого в этом примере нельзя.\u003C\u002Fp\u003E\u003Cp\u003EДалее нам остается лишь заменить установку явных значений для offset, textHeight, buttonHeigh, column1Width, column2Width, okBtnWidth, defBtnWidth на значения, посчитанные из метрики шрифта. Размеры стрелочек для QComboBox и QSpinBox будем узнавать из стилей (хотя можно было бы тоже пытаться примерно высчитать из размера шрифта). Для точного понимания приведем весь код:\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПоказать код\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EScaleWgt::ScaleWgt(QWidget* parent)\n\t: QWidget(parent)\n{\n\tQString text1 = \"Field1 long long long long name\";\n\tQString text2 = \"Field2 long long long name\";\n\tQLabel* label1 = new QLabel(text1, this);\n\tQLabel* label2 = new QLabel(text2, this);\n\tQSpinBox* sb = new QSpinBox(this);\n\tsb-\u003EsetMaximum(10);\n\tsb-\u003EsetMinimum(0);\n\tsb-\u003EsetValue(5);\n\tauto cb = new QComboBox(this);\n\tQString value1 = \"Field2 value 1\";\n\tQString value2 = \"Field2 value 2\";\n\tcb-\u003EaddItem(value1);\n\tcb-\u003EaddItem(value2);\n\n\tQString okText = \"Ok\";\n\tQPushButton* ok = new QPushButton(okText, this);\n\tQString defText = \"Apply default values\";\n\tQPushButton* def = new QPushButton(defText, this);\n\n\tQFontMetrics fm(font());\n\n\tQStyleOptionSpinBox opt;\n\tconst int arrowWidth = sb-\u003Estyle()-\u003EsubControlRect(\n\t\tQStyle::CC_SpinBox, &amp;opt, QStyle::SC_SpinBoxUp).width();\n\tconst int maxTextWidth = fm.horizontalAdvance(\"10\");\n\tconst int sbxWidth = maxTextWidth + 2 * arrowWidth; \u002F\u002F x2 just for more visual space\n\n\tQStyleOptionComboBox opt2;\n\tconst int arrow2Width = cb-\u003Estyle()-\u003EsubControlRect(\n\t\tQStyle::CC_ComboBox, &amp;opt2, QStyle::SC_ComboBoxArrow).width();\n\tconst int cbWidth = fm.horizontalAdvance(value1) + arrow2Width + fm.averageCharWidth();\n\n\tint offset = qRound(fm.height() * 0.75);\n\tint textHeight = qRound(fm.height() * 1.5);\n\tint buttonHeight = fm.height() * 2.0;\n\tint column1Width = std::max&lt;int\u003E(fm.horizontalAdvance(text1), fm.horizontalAdvance(text2));\n\tint column2Width = std::max&lt;int\u003E(cbWidth, sbxWidth);\n\tint okBtnWidth = fm.horizontalAdvance(okText) + 8 * fm.averageCharWidth(); \u002F\u002Fx8 just for more visual space;\n\tint defBtnWidth = fm.horizontalAdvance(defText) + 4 * fm.averageCharWidth(); \u002F\u002Fx4 just for more visual space\n\n\tint line1Offset = offset;\n\tint line2Offset = line1Offset + textHeight + offset;\n\tint line3Offset = line2Offset + textHeight + offset;\n\tint column1Offset = offset;\n\tint column2Offset = column1Offset + column1Width + offset;\n\n\tint widgetWidth = column2Offset + column2Width + offset;\n\tint widgetHeight = line3Offset + buttonHeight + offset;\n\n\tint okBtnOffset = widgetWidth - offset - okBtnWidth;\n\n\tlabel1-\u003EsetGeometry(column1Offset, line1Offset, column1Width, textHeight);\n\tlabel2-\u003EsetGeometry(column1Offset, line2Offset, column1Width, textHeight);\n\tsb-\u003EsetGeometry(column2Offset, line1Offset, column2Width, textHeight);\n\tcb-\u003EsetGeometry(column2Offset, line2Offset, column2Width, textHeight);\n\tok-\u003EsetGeometry(okBtnOffset, line3Offset, okBtnWidth, buttonHeight);\n\tdef-\u003EsetGeometry(column1Offset, line3Offset, defBtnWidth, buttonHeight);\n\n\tsetFixedSize(widgetWidth, widgetHeight);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EПосле таких манипуляций на любых масштабах экрана виджет будет адекватно выглядеть:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows7, масштаб экрана 100%, 125%, 150%.\" title=\"Windows7, масштаб экрана 100%, 125%, 150%.\" height=\"209\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5ac\u002F669\u002F8ee\u002F5ac6698ee22a16adee107125331861bf.png\" data-width=\"1054\"\u002F\u003E\u003Cfigcaption\u003EWindows7, масштаб экрана 100%, 125%, 150%.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИтак, мы смогли использовать метрику шрифтов вместо явного, хардкорного задания размеров. Однако, оценив разросшийся код,  легко понять, что прибегать к этому рецепту следует только тогда, когда автокомпоновку использовать совсем никак нельзя.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EРецепт 4. Не используйте атрибут Qt::AA_EnableHighDpiScaling\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EМожет показаться, что переписывание примера 1 по рецептам 2 или 3 – долгая и ненужная затея, что можно обойтись меньшей кровью. К сожалению, это не так. В Qt5 существуют быстрые и обходные пути решения проблемы  High DPI: атрибут Qt::AA_EnableHighDpiScaling, переменные окружения QT_ENABLE_HIGHDPI_SCALING, QT_AUTO_SCREEN_SCALE_FACTOR и \u003Ca href=\"https:\u002F\u002Fdoc.qt.io\u002Fqt-5\u002Fhighdpi.html\" rel=\"noopener noreferrer nofollow\"\u003Eпрочие\u003C\u002Fa\u003E. Все эти простые пути приводят к неслабым артефактам. На рисунке ниже приведен пример применения атрибута Qt::AA_EnableHighDpiScaling к коду из примера 1.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows7, масштаб экрана 100%, 125%, 150%.\" title=\"Windows7, масштаб экрана 100%, 125%, 150%.\" height=\"266\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2ba\u002F24a\u002F1d7\u002F2ba24a1d7782430fa20fbbee0ae84abd.png\" data-width=\"1136\"\u002F\u003E\u003Cfigcaption\u003EWindows7, масштаб экрана 100%, 125%, 150%.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНа всех масштабах, кроме исходного 100%, видны проблемы. На 125% увеличился текст, но не увеличились размеры виджетов, а на 150% видно (сравните с рисунками из рецептов 2 и 3), что всё увеличилось не в 1.5 раза, а ровно в 2 раза (что неприемлемо), но текст всё равно помещается не везде.\u003C\u002Fp\u003E\u003Cp\u003EТаким образом, просто установить атрибут Qt::AA_EnableHighDpiScaling и не делать больше ничего (не применять описанные рецепты) не получится, а раз мы все равно вынуждены применять рецепты 2 и 3, то никакой необходимости в быстрых и обходных решениях, типа Qt::AA_EnableHighDpiScaling, попросту нет. Кроме того, атрибут Qt::AA_EnableHighDpiScaling отвратительно масштабирует текст на масштабах 125% (100% вместо 125%), 150% (200% вместо 150%), 175% (200% вместо 175%) и др. Собственно, именно это имелось в виду в документации Qt5 в краткой, как сестра таланта, фразе «Non-integer scale factors may cause significant scaling\u002Fpainting artifacts».\u003C\u002Fp\u003E\u003Cp\u003EМы не будем подробно останавливаться на других уловках, типа QT_ENABLE_HIGHDPI_SCALING, QT_AUTO_SCREEN_SCALE_FACTOR (и тем более на причинах, почему они работают плохо), просто скажем, что может быть, для каких-то очень простых приложений они и подойдут, но для любого сколько-нибудь серьезного их попросту не хватит, будут вылезать многочисленные артефакты.\u003C\u002Fp\u003E\u003Cp\u003EХорошо, но с начала статьи мы не слова не сказали про иконки и вообще про любые картинки. Что с ними?\u003C\u002Fp\u003E\u003Cp\u003E \u003Cstrong\u003EПример 3. Простые иконки.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EДобавим в наш простой пример ситуацию, которая вполне могла бы сложиться в реальной жизни в случае, когда приложение разрабатывалось достаточно давно. А именно: приложение может содержать устаревшие, маленькие иконки 16x16 или даже 12x12. Добавим их в текст нашего примера (для случая автокомпоновки, конечно):\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\tok-\u003EsetIcon(QIcon(\":\u002Fbutton_ok.png\"));\n\tdef-\u003EsetIcon(QIcon(\":\u002Fhome.png\"));\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EНа масштабе 100% они выглядят приемлемо (хотя и немного старовато), а вот при бОльших масштабах иконки выглядят слишком мелкими:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows7, масштаб экрана 100%,  200%, размер иконок 16x16.\" title=\"Windows7, масштаб экрана 100%,  200%, размер иконок 16x16.\" height=\"251\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff50\u002F543\u002F3de\u002Ff505433de705a223b1e5b369254ffa16.png\" data-width=\"842\"\u002F\u003E\u003Cfigcaption\u003EWindows7, масштаб экрана 100%,  200%, размер иконок 16x16.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cstrong\u003E\u003Cem\u003EРецепт 5. Увеличьте все иконки или переходите на векторный формат.\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EВ простых случаях, как в описанном примере, достаточно просто заменить растровые иконки размером 16x16 на аналогичные, бОльшие, например, 32x32 или даже 64x64. Также можно заменить растровые иконки на векторные(SVG). Это навсегда закроет проблему больших экранов.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows7, масштаб экрана 200%, размер иконок 32x32.\" title=\"Windows7, масштаб экрана 200%, размер иконок 32x32.\" height=\"250\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F88a\u002F768\u002Fadd\u002F88a768add737a89fde4d97e66ec1ffc1.png\" data-width=\"556\"\u002F\u003E\u003Cfigcaption\u003EWindows7, масштаб экрана 200%, размер иконок 32x32.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EОднако такой простой трюк имеет ограниченную область применения. Это будет работать, когда не требуется явно задавать никакие размеры иконок, в том числе не устанавливать собственные стили. Так, для функции QAbstractButton::setIcon в документации явно сказано:\u003C\u002Fp\u003E\u003Cp\u003E\u003Ccode\u003EThe icon's default size is defined by the GUI style, but can be adjusted by setting the iconSize property.\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cp\u003EТо есть если просто вызываем QAbstractButton::setIcon, то будет работать, а если хотим вызвать еще QAbstractButton::setIconSize, то… надо высчитывать размеры иконок, но не из метрики шрифтов (как в рецепте 3), а другим, более простым способом.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EПример 4. Иконки с размерами.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EНемного изменим наш пример и добавим туда кнопки с иконками фиксированного размера:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\tauto reloadBtn = new QToolButton();\n\treloadBtn-\u003EsetStyleSheet(\"QToolButton {\"\n\t\t\"icon-size: 14px 14px; \"\n\t\t\"background: rgb(101, 180, 93); }\");\n\treloadBtn-\u003EsetIcon(QIcon(\":\u002Freload.svgz\"));\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E(Отметим, что совершенно неважно, каким именно способом выставляется размер иконок: через QAbstractButton::setIconSize или через задание css-стилей, как здесь. Результат будет одинаковый.)\u003C\u002Fp\u003E\u003Cp\u003EКак и в примере 3, на масштабе 100% кнопки выглядят приемлемо, а вот при бОльших масштабах иконки выглядят слишком мелкими:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Windows7, масштаб экрана 100%,  200%, размер иконок 14x14.\n\" title=\"Windows7, масштаб экрана 100%,  200%, размер иконок 14x14.\n\" height=\"250\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F61a\u002F319\u002F6ce\u002F61a3196ce789146c2c54569a426cd04c.png\" data-width=\"910\"\u002F\u003E\u003Cfigcaption\u003EWindows7, масштаб экрана 100%,  200%, размер иконок 14x14.\n\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ca class=\"anchor\" name=\"recept6\" id=\"recept6\"\u003E\u003C\u002Fa\u003E\u003Cp\u003E\u003Cstrong\u003EРецепт 6. Используйте экранный масштаб при явном задании размеров.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EQt позволяет нам явно узнать значение экранного масштаба, для этого есть функция \u003Ccode\u003EQScreen::logicalDotsPerInchX(),\u003C\u002Fcode\u003E которая возвращает значение плотности пикселей в так называемых «логических» координатах. Значение 96 в этой системе координат означает 100% масштаба экрана, значение 120 соответствует масштабу экрана 125%, значение 144 – 150% и т.д. Таким образом, масштаб экрана для класса \u003Ccode\u003EQWidget\u003C\u002Fcode\u003E можно узнать, например, так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Econst double scale = screen()-\u003ElogicalDotsPerInchX() \u002F 96.0;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДалее следует везде в коде, где встречается фиксированный размер \u003Ccode\u003Evalue\u003C\u002Fcode\u003E, заменить его на \u003Ccode\u003EqRound(value * scale).\u003C\u002Fcode\u003E Таким образом, код инициализации кнопки будет заменен на\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\treloadBtn-\u003EsetStyleSheet(QString(\"QToolButton {\"\n\t\t\"icon-size: %1px %2px; \"\n\t\t\"background: rgb(101, 180, 93); }\")\n\t\t.arg(qRound(14 * scale)).arg(qRound(14 * scale)));\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ в результате получим то, что хотели:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"257\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F881\u002Fe64\u002F491\u002F881e64491cb9226856a13091398b5b92.png\" data-width=\"606\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСтоит отметить, что область применения этого рецепта – довольно широкая. Везде, где нелогично и неудобно применять расчет размеров через метрику шрифтов, следует применять расчет размеров через экранный масштаб. Чтобы стало более ясно, что такое «нелогично и неудобно», давайте всё же еще рассмотрим пару примеров на применение этого рецепта.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003E Пример 5. Стили css.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EПредположим, что в нас проснулся Стив Джобс, и мы грезим скругленными кнопками. Модернизируем пример выше следующим образом:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\treloadBtn-\u003EsetStyleSheet(QString(\"QToolButton {\"\n\t\t\"width: 19px; \"\n\t\t\"height: 19px;\"\n\t\t\"border-radius: 10px;\"\n\t\t\"icon-size: 14px 14px; \"\n\t\t\"background: rgb(101, 180, 93); }\"));\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EОпять имеем жестко заданные размеры, в том числе и радиус скругления. Чтобы адаптировать такой код, достаточно переписать его вот так:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E\tconst int size = 19 * scale;\n\tconst int borderRadius = size \u002F 2 + 1;\n\tconst int iconSize = qRound(5. \u002F 7 * size);\n\treloadBtn-\u003EsetStyleSheet(QString(\"QToolButton {\"\n\t\t\"width: %1px;\"\n\t\t\"height: %1px;\"\n\t\t\"border-radius: %2px;\"\n\t\t\"icon-size: %3px %3px; \"\n\t\t\"background: rgb(101, 180, 93); }\")\n\t\t.arg(size)\n\t\t.arg(borderRadius)\n\t\t.arg(iconSize));\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ в результате получим то, что хотели:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"265\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7e9\u002Faae\u002Fc1b\u002F7e9aaec1be2eca38d9111d526521fd00.png\" data-width=\"609\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cstrong\u003EПример 6. Появление HTML.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EПовесим на кнопку Ok слот onOkClicked, в котором будем вызываться QMessageBox с текстом html внутри:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Evoid ScaleWgt::onOkClicked()\n{\n\tQMessageBox msg(QMessageBox::Question, \"MessageBox Title\",\n\t\tQString(\"Are you sure?&lt;br\u003E&lt;br\u003E &lt;img src=':\u002Fbrain.svg' width='100'\u003E&lt;br\u003E&lt;br\u003EAre you sure?\"));\n\tmsg.exec();\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EИ снова фиксированный размер, и снова используем экранный масштаб:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Evoid ScaleWgt::onOkClicked()\n{\n\tconst double scale = QApplication::desktop()-\u003ElogicalDpiX() \u002F 96.0;\n\tQMessageBox msg(QMessageBox::Question, \"MessageBox Title\",\n\t\tQString(\"Are you sure?&lt;br\u003E&lt;br\u003E &lt;img src=':\u002Fbrain.svg' width='%1'\u003E&lt;br\u003E&lt;br\u003EAre you sure?\")\n\t\t.arg(qRound(100 * scale)));\n\tmsg.exec();\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Chr\u002F\u003E\u003Cp\u003EИтак, с размерами виджетов в простых случаях разобрались. Закрепим приведенные рецепты итоговым алгоритмом их применения:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"5280\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa98\u002F2c8\u002Fa18\u002Fa982c8a183a7c1707e55bdf03e04192c.png\" data-width=\"6760\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНа этом рецепты не кончаются, и в случае заинтересованности со стороны читателей могу опубликовать следующую порцию в следующей статье.\u003C\u002Fp\u003E\u003Cp\u003EВсем не болеть!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"Qt"},{"titleHtml":"qt5"},{"titleHtml":"c++"},{"titleHtml":"gui"},{"titleHtml":"desktop"},{"titleHtml":"windows"},{"titleHtml":"high dpi"},{"titleHtml":"4k"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa74\u002Ffc6\u002F745\u002Fa74fc67456d4789b36ef4efca39a806d.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa74\u002Ffc6\u002F745\u002Fa74fc67456d4789b36ef4efca39a806d.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582180\\\u002F\"},\"headline\":\"Адаптация Qt-приложений под мониторы высокой чёткости. Часть 1\",\"datePublished\":\"2021-10-07T16:22:55+03:00\",\"dateModified\":\"2021-10-21T14:47:32+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"kalirgum\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и\\\u002Fили размером экрана. Году...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F582180\\\u002F#post-content-body\",\"about\":[\"h_programming\",\"h_cpp\",\"h_qt_software\",\"h_oop\",\"h_win_dev\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F582180\\\u002Fe1fd7950aaf492c17e8c1e316cd60ff9\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa74\\\u002Ffc6\\\u002F745\\\u002Fa74fc67456d4789b36ef4efca39a806d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5a8\\\u002Fd53\\\u002F9b0\\\u002F5a8d539b0e4cc7698b3580f7af6b7061.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F62d\\\u002Fae6\\\u002Feb4\\\u002F62dae6eb4be7b7411bdf8eacdbc0a55e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F0ab\\\u002Fa6d\\\u002F009\\\u002F0aba6d009b1dad3f19c10e5ede19cdc0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F84f\\\u002F5a9\\\u002F6f7\\\u002F84f5a96f7616e647a859a86bb8965418.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F544\\\u002Fa50\\\u002F30f\\\u002F544a5030fef7b5f4daf8a267b4f9a2e2.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F890\\\u002Ff8f\\\u002F1f2\\\u002F890f8f1f256d65e93c3a75cd86187c43.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1b6\\\u002F29c\\\u002F81d\\\u002F1b629c81d264490169b259e8bc0d6301.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5ac\\\u002F669\\\u002F8ee\\\u002F5ac6698ee22a16adee107125331861bf.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F2ba\\\u002F24a\\\u002F1d7\\\u002F2ba24a1d7782430fa20fbbee0ae84abd.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff50\\\u002F543\\\u002F3de\\\u002Ff505433de705a223b1e5b369254ffa16.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F88a\\\u002F768\\\u002Fadd\\\u002F88a768add737a89fde4d97e66ec1ffc1.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F61a\\\u002F319\\\u002F6ce\\\u002F61a3196ce789146c2c54569a426cd04c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F881\\\u002Fe64\\\u002F491\\\u002F881e64491cb9226856a13091398b5b92.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F7e9\\\u002Faae\\\u002Fc1b\\\u002F7e9aaec1be2eca38d9111d526521fd00.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa98\\\u002F2c8\\\u002Fa18\\\u002Fa982c8a183a7c1707e55bdf03e04192c.png\"]}","metaDescription":"ВведениеВ связи с техническим прогрессом рынок мониторов постоянно обновляется моделями с повышенным разрешением, плотностью пикселей и\u002Fили размером экрана. Году в 2010 стандартным монитором можно...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"programming,cpp,qt_software,oop,win_dev"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
