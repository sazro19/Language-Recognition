<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Как написать генератор изображений, который вас понимает / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/skillfactory\/blog\/581794\/"},"headline":"Как написать генератор изображений, который вас понимает","datePublished":"2021-10-07T22:33:04+03:00","dateModified":"2021-10-08T00:47:20+03:00","author":{"@type":"Person","name":"KD637"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Автор статьи рассказывает, как за неделю создал Text2Art.com &mdash; генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изо...","url":"https:\/\/habr.com\/ru\/company\/skillfactory\/blog\/581794\/#post-content-body","about":["c_skillfactory","h_webdev","h_python","h_programming","h_machine_learning","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/581794\/7fd6258ed793acfcbd2951cfc2d8ae89\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e50\/ece\/e02\/e50ecee023d0fc0e65f2526f438b032c.jpg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/2d6\/c01\/1c4\/2d6c011c4b6a62824d546e3615d4742e.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a44\/704\/034\/a4470403409fc60ab0f714a3af85e8a6.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/793\/83c\/14a\/79383c14a586d70b37771580c849e0b3.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/488\/ff1\/fb8\/488ff1fb884211de07658b24f28b38d7.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/599\/411\/ece\/599411ece96236163a842ecce2241625.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a7d\/c2a\/e02\/a7dc2ae02ea7b767111a1041bc8287c8.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f47\/b0b\/94b\/f47b0b94b1a6139791f2f08bdc3e1664.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/aae\/0df\/ca8\/aae0dfca84a68efa1eb3c65fd4ea5f20.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/39f\/231\/441\/39f231441510f9b03da12206df44437d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/175\/d56\/f21\/175d56f21f0ae9f5f89834decc07f356.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/fd5\/e9f\/ed1\/fd5e9fed1f52a259d2a67252c5850ce4.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/122\/217\/87d\/12221787d7d7f4b0e983e72f44a909c5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a93\/027\/cd7\/a93027cd76d9ac1bd1be5dba0a94a8b9.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/da9\/3ee\/a05\/da93eea05ceb55206d33649f49411f05.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f3a\/9f9\/bfa\/f3a9f9bfaa3e615a3bf801b17ce3599b.jpeg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/583\/edd\/b97\/583eddb97423a0f94f8d39e5ef2a829a.jpeg","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ef3\/ea1\/425\/ef3ea1425477a84644272b78a798589a.gif","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a89\/e28\/038\/a89e280384ce65bf050b2823e29ce488.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ad1\/616\/948\/ad16169487ff6c5a37cd0d8b51deabbb.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/358\/ea4\/b9c\/358ea4b9cfe9f658b3af3ea4fd362fda.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/535\/d00\/ed8\/535d00ed850802bb16f7077ffd522c63.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/be8\/d8d\/f0c\/be8d8df0cf912659f654bcf4e5d262ca.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1b3\/1bc\/af3\/1b31bcaf366fab3d098e1dffc5a066f5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/3c2\/80b\/599\/3c280b5993e8b243c5d3f9561fc572c7.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Как написать генератор изображений, который вас понимает" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Как написать генератор изображений, который вас понимает" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Как написать генератор изображений, который вас понимает" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/7f7/0a6/a95/7f70a6a9554f753bf33b6106489c3a87.jpg" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/7f7/0a6/a95/7f70a6a9554f753bf33b6106489c3a87.jpg" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/7f7/0a6/a95/7f70a6a9554f753bf33b6106489c3a87.jpg" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/7f7/0a6/a95/7f70a6a9554f753bf33b6106489c3a87.jpg" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/7f7/0a6/a95/7f70a6a9554f753bf33b6106489c3a87.jpg" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="581794" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2021-10-07T19:33:04.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/581794/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/company/skillfactory/blog/581794/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/getpro/habr/upload_files/7f7/0a6/a95/7f70a6a9554f753bf33b6106489c3a87.jpg" data-vmid="image:href"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/581794/">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="skillfactory" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><!----></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-card tm-company-article__company-card"><div class="tm-company-card__info"><div class="tm-company-card__header"><a href="/ru/company/skillfactory/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="//habrastorage.org/getpro/habr/company/9bb/5f7/d50/9bb5f7d50871bf0981f64b1970f22fe1.png" width="48" class="tm-entity-image__pic"></div></a> <!----> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">146.01</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div> <div class="tm-company-card__info"><a href="/ru/company/skillfactory/profile/" class="tm-company-card__name">
        SkillFactory
      </a> <div class="tm-company-card__description">Школа Computer Science. Скидка 45% по коду HABR</div></div></div> <div class="tm-company-card__buttons"><!----> <!----></div></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/KD637/" title="KD637" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/KD637/" class="tm-user-info__username">
      KD637
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2021-10-07T19:33:04.000Z" title="2021-10-07, 22:33">7  октября   в 22:33</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Как написать генератор изображений, который вас понимает</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/company/skillfactory/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании SkillFactory</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/webdev/" class="tm-article-snippet__hubs-item-link"><span>Разработка веб-сайтов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/python/" class="tm-article-snippet__hubs-item-link"><span>Python</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/programming/" class="tm-article-snippet__hubs-item-link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/machine_learning/" class="tm-article-snippet__hubs-item-link"><span>Машинное обучение</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://towardsdatascience.com/how-i-built-an-ai-text-to-art-generator-a0c0f6d6f59f" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Fathy Rashad
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/e50/ece/e02/e50ecee023d0fc0e65f2526f438b032c.jpg" width="780" height="440" data-src="https://habrastorage.org/getpro/habr/upload_files/e50/ece/e02/e50ecee023d0fc0e65f2526f438b032c.jpg" data-blurred="true"/><figcaption></figcaption></figure><p>Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом поле. </p><p>Для интерфейса используется Gradio, модель работает на сервере FastAPI, а системой очереди сообщений служит Firebase. Подробностями делимся к старту <a href="https://skillfactory.ru/machine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=lead">курса по ML и DL</a>.</p><hr/><figure class=""><img src="/img/image-loader.svg" alt="Галерея Text2Art" title="Галерея Text2Art" height="313" data-src="https://habrastorage.org/getpro/habr/upload_files/2d6/c01/1c4/2d6c011c4b6a62824d546e3615d4742e.gif" data-width="505"/><figcaption>Галерея Text2Art</figcaption></figure><p>Если вам понравился проект, вы можете проголосовать за него <a href="https://devpost.com/software/gancreate">здесь</a>.</p><div class="tm-iframe_temp" data-src="https://embedd.srv.habr.com/iframe/615cab744615593b75e24676" data-style="" id="615cab744615593b75e24676" width=""></div><h2>Введение</h2><p>Не так давно генеративные картины и NFT штурмом захватили мир. Это стало возможным после значительного прогресса OpenAI в генерации изображения из текста. Ранее в этом году OpenAI анонсировал DALL-E, мощный генератор изображений из текстов. </p><p>Чтобы проиллюстрировать, насколько хорошо работает DALL-E, посмотрите рисунки, сгенерированные DALL-E по запросу "a professional high quality illustration of a giraffe dragon chimera, "a giraffe imitating a dragon", "a giraffe made of dragon".</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Изображения по запросу &quot;a professional high quality illustration of a giraffe dragon chimera, &quot;a giraffe imitating a dragon&quot;, &quot;a giraffe made of dragon&quot;." title="Изображения по запросу &quot;a professional high quality illustration of a giraffe dragon chimera, &quot;a giraffe imitating a dragon&quot;, &quot;a giraffe made of dragon&quot;." height="871" data-src="https://habrastorage.org/getpro/habr/upload_files/a44/704/034/a4470403409fc60ab0f714a3af85e8a6.png" data-width="725"/><figcaption>Изображения по запросу "a professional high quality illustration of a giraffe dragon chimera, "a giraffe imitating a dragon", "a giraffe made of dragon".</figcaption></figure><p>К сожалению, DALL-E не был выпущен в массы. Вместо него была опубликована модель, которая творит магию DALL-E, — CLIP. CLIP или Contrastive Image-Language Pretraining — это мультимодальная сеть, объединяющая текст и изображения. </p><blockquote><p>Одним словом, CLIP способен оценить, насколько хорошо изображение соответствует надписи или наоборот. </p></blockquote><p>Это крайне полезно в управлении генератором, чтобы создать изображение, точно соответствующее введённому тексту. В фильме "DALL-E"  CLIP используется, чтобы ранжировать сгенерированные изображения и входные изображения с наивысшим баллом (самые похожие на тектовый запрос).</p><figure class="full-width "><img src="/img/image-loader.svg" height="396" data-src="https://habrastorage.org/getpro/habr/upload_files/793/83c/14a/79383c14a586d70b37771580c849e0b3.png" data-width="590"/><figcaption></figcaption></figure><p>Через несколько месяцев после анонса фильма DALL-E был опубликован новый генератор изображений-трансформеров под названием VQGAN (Vector Quantized GAN). Сочетание VQGAN с CLIP даёт качество, аналогичное DALL-E. С момента обнародования предварительно обученной модели VQGAN сообщество создало множество удивительных картин.</p><p>Вот примеры:</p><figure class="bordered "><img src="/img/image-loader.svg" alt="" title="" height="224" data-src="https://habrastorage.org/getpro/habr/upload_files/488/ff1/fb8/488ff1fb884211de07658b24f28b38d7.png" data-width="400"/><figcaption></figcaption></figure><figure class=""><img src="/img/image-loader.svg" alt="" title="" height="272" data-src="https://habrastorage.org/getpro/habr/upload_files/599/411/ece/599411ece96236163a842ecce2241625.png" data-width="496"/><figcaption></figcaption></figure><p>Я был поражён результатами и захотел поделиться ими со своими друзьями. Но, поскольку не так много людей готовы погрузиться в код ради генерации картин, я решил сделать Text2Art.com — сайт, где любой может просто ввести подсказку и сгенерировать нужное изображение, не сталкиваясь с кодом воочию.</p><h2>Как это работает</h2><p>Итак, как работает VQGAN+CLIP? VQGAN генерирует изображение, а CLIP измеряет, насколько оно соответствует запросу. Затем генератор использует обратную связь от модели CLIP, чтобы сгенерировать более точные изображения. Процедура повторяется, пока оценка CLIP не станет достаточно высокой.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="VQGAN генерирует изображения, пока CLIP направляет процесс. Чем больше итераций, тем точнее изображение [источник: иллюстрированный VQGAN от LJ Miranda]" title="VQGAN генерирует изображения, пока CLIP направляет процесс. Чем больше итераций, тем точнее изображение [источник: иллюстрированный VQGAN от LJ Miranda]" height="1485" data-src="https://habrastorage.org/getpro/habr/upload_files/a7d/c2a/e02/a7dc2ae02ea7b767111a1041bc8287c8.png" data-width="1400"/><figcaption>VQGAN генерирует изображения, пока CLIP направляет процесс. Чем больше итераций, тем точнее изображение [источник: иллюстрированный VQGAN от LJ Miranda]</figcaption></figure><p>Я не буду рассказывать о внутренней работе VQGAN или CLIP. Но, если вы хотите получить более глубокие объяснения VQGAN, CLIP или DALL-E, обратитесь к этим удивительным ресурсам, которые я нашёл:</p><ul><li><p><a href="https://ljvmiranda921.github.io/notebook/2021/08/08/clip-vqgan/">Иллюстрированный VQGAN</a>;</p></li><li><p><a href="https://ml.berkeley.edu/blog/posts/vq-vae/">Объяснение DALL-E</a>;</p></li><li><p><a href="https://youtu.be/T9XSU0pKX2E">Объяснение научной работы о CLIP на видео</a>.</p></li></ul><h3>X + CLIP</h3><p>VQGAN+CLIP — это только пример того, на что способно объединение генератора изображений с CLIP. Однако вы можете заменить VQGAN на любой генератор. Появилось много вариантов X + CLIP, таких как <a href="https://github.com/orpatashnik/StyleCLIP">StyleCLIP</a> (StyleGAN + CLIP), <a href="https://arxiv.org/abs/2106.14843">CLIPDraw</a> (векторный генератор), BigGAN + CLIP и многие другие, даже <a href="https://github.com/AndreyGuzhov/AudioCLIP">AudioCLIP</a>, который работает со звуком, а не изображениями.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Редактирование изображений при помощи StyleCLIP [работа о StyleCLIP]" title="Редактирование изображений при помощи StyleCLIP [работа о StyleCLIP]" height="507" data-src="https://habrastorage.org/getpro/habr/upload_files/f47/b0b/94b/f47b0b94b1a6139791f2f08bdc3e1664.png" data-width="1400"/><figcaption>Редактирование изображений при помощи StyleCLIP [работа о StyleCLIP]</figcaption></figure><h2>Код</h2><p>Я воспользуюсь кодом из репозитория <a href="https://github.com/dribnet/clipit">clipit</a> от dribnet, этот код генерирует изображения при помощи VQGAN+CLIP в несколько простых строк (обновление: <a href="https://github.com/dribnet/clipit">clipit</a> мигрировал на <a href="https://github.com/dribnet/pixray">pixray</a>). Его рекомендуется запускать на Google Colab: VQGAN+CLIP требует много памяти GPU. Вот блокнот <a href="https://colab.research.google.com/github/mfrashad/text2art/blob/main/text2art.ipynb">Colab</a>. </p><p>Прежде всего, если вы работаете на Colab, убедитесь, что вы изменили тип рантайма на GPU, вот так:</p><figure class=""><img src="/img/image-loader.svg" height="385" data-src="https://habrastorage.org/getpro/habr/upload_files/aae/0df/ca8/aae0dfca84a68efa1eb3c65fd4ea5f20.png" data-width="511"/><figcaption></figcaption></figure><figure class=""><img src="/img/image-loader.svg" alt="
" title="
" height="290" data-src="https://habrastorage.org/getpro/habr/upload_files/39f/231/441/39f231441510f9b03da12206df44437d.png" data-width="398"/><figcaption>
</figcaption></figure><p>Установим кодовую базу и зависимости:</p><pre><code class="python">from IPython.utils import io
with io.capture_output() as captured:
  !git clone https://github.com/openai/CLIP
  # !pip install taming-transformers
  !git clone https://github.com/CompVis/taming-transformers.git
  !rm -Rf clipit
  !git clone https://github.com/mfrashad/clipit.git
  !pip install ftfy regex tqdm omegaconf pytorch-lightning
  !pip install kornia
  !pip install imageio-ffmpeg   
  !pip install einops
  !pip install torch-optimizer
  !pip install easydict
  !pip install braceexpand
  !pip install git+https://github.com/pvigier/perlin-numpy

  # ClipDraw deps
  !pip install svgwrite
  !pip install svgpathtools
  !pip install cssutils
  !pip install numba
  !pip install torch-tools
  !pip install visdom

  !pip install gradio

  !git clone https://github.com/BachiLi/diffvg
  %cd diffvg
  # !ls
  !git submodule update --init --recursive
  !python setup.py install
  %cd ..
  
  !mkdir -p steps
  !mkdir -p models</code></pre><blockquote><p>"!" — это специальная команда в Google Colab, которая означает, что команда будет запущена в bash, а не в python.</p></blockquote><p>После установки библиотек мы можем просто импортировать clipit и запустить эти несколько строк кода для генерации картины с помощью VQGAN+CLIP. </p><p>Просто замените текстовую подсказку на любую другую. Кроме того, вы можете задать clipit такие параметры, как количество итераций, ширина, высота, модель генератора, хотите ли вы генерировать видео или нет, и многие другие. Чтобы больше узнать об опциях, вы можете <a href="https://github.com/mfrashad/clipit/blob/master/clipit.py">посмотреть </a>исходный код.</p><p>Вот код генерации:</p><pre><code class="python">import sys
sys.path.append("clipit")
import clipit

# To reset settings to default
clipit.reset_settings()

# You can use "|" to separate multiple prompts
prompts = "underwater city"

# You can trade off speed for quality: draft, normal, better, best
quality = "normal"

# Aspect ratio: widescreen, square
aspect = "widescreen"

# Add settings
clipit.add_settings(prompts=prompts, quality=quality, aspect=aspect)

# Apply these settings and run
settings = clipit.apply_settings()
clipit.do_init(settings)
cliptit.do_run(settings)</code></pre><p>Когда вы запустите код, он сгенерирует изображение. На каждой итерации сгенерированное изображение будет приближаться к тексту, который вы ввели.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Итерации по заросу “underwater city”" title="Итерации по заросу “underwater city”" height="304" data-src="https://habrastorage.org/getpro/habr/upload_files/175/d56/f21/175d56f21f0ae9f5f89834decc07f356.png" data-width="714"/><figcaption>Итерации по заросу “underwater city”</figcaption></figure><h3>Количество итераций</h3><p>Вот так можно установить количество итераций, им управляет <code>iterations</code>:</p><pre><code class="python">clipit.add_settings(iterations=500)</code></pre><h3>Генерация видео</h3><p>В любом случае нужно генерировать изображение для каждой итерации, поэтому можно сохранить эти изображения и создать анимацию самой генерации. Для этого добавьте <code>make_video=True</code> перед применением настроек.</p><pre><code class="python">clipit.add_settings(make_video=True)</code></pre><p>Получится этот ролик:</p><figure class=""><img src="/img/image-loader.svg" alt="Сгенерированный подводный город, запрос “Underwater City”" title="Сгенерированный подводный город, запрос “Underwater City”" height="224" data-src="https://habrastorage.org/getpro/habr/upload_files/fd5/e9f/ed1/fd5e9fed1f52a259d2a67252c5850ce4.gif" data-width="400"/><figcaption>Сгенерированный подводный город, запрос “Underwater City”</figcaption></figure><h3>Управление размером изображений</h3><p>Размер изображения устанавливается опцией <code>size=(width, height)</code>. Сенерируем баннерное изображение с разрешением 800x200. Обратите внимание, что более высокое разрешение требует большего объёма памяти GPU.</p><pre><code class="python">clipit.add_settings(size=(800, 200))</code></pre><figure class="full-width "><img src="/img/image-loader.svg" alt="Баннер 800x200 по запросу “Fantasy Kingdom #artstation”" title="Баннер 800x200 по запросу “Fantasy Kingdom #artstation”" height="192" data-src="https://habrastorage.org/getpro/habr/upload_files/122/217/87d/12221787d7d7f4b0e983e72f44a909c5.png" data-width="800"/><figcaption>Баннер 800x200 по запросу “Fantasy Kingdom #artstation”</figcaption></figure><h3>Генерация пиксель-арта</h3><p>Можно генерировать и пиксель-арт. Для этого используется рендерер CLIPDraw за сценой с некоторыми инженерными решениями, такими как ограничение цветов палитры, пикселизация и т.д. Просто включите опцию <code>use_pixeldraw=True</code>.</p><pre><code class="python">clipit.add_settings(use_pixeldraw=True)</code></pre><figure class=""><img src="/img/image-loader.svg" alt="Изображение по запросу “Knight in armor #pixelart”" title="Изображение по запросу “Knight in armor #pixelart”" height="280" data-src="https://habrastorage.org/getpro/habr/upload_files/a93/027/cd7/a93027cd76d9ac1bd1be5dba0a94a8b9.png" data-width="500"/><figcaption>Изображение по запросу “Knight in armor #pixelart”</figcaption></figure><figure class=""><img src="/img/image-loader.svg" alt="Изображение по запросу “A world of chinese fantasy video game #pixelart”" title="Изображение по запросу “A world of chinese fantasy video game #pixelart”" height="225" data-src="https://habrastorage.org/getpro/habr/upload_files/da9/3ee/a05/da93eea05ceb55206d33649f49411f05.png" data-width="400"/><figcaption>Изображение по запросу “A world of chinese fantasy video game #pixelart”</figcaption></figure><h3>VQGAN+CLIP модификатор ключевых слов</h3><p>Из-за смещения в CLIP добавление определённых ключевых слов к подсказке может придать определённый эффект генерируемому изображению. Например, добавление слова "unreal engine"  к текстовой подсказке, как правило, создаёт реалистичное изображение или HD стиль. Добавление определённых названий сайтов, таких как "deviantart", "artstation"  или "flickr", обычно делает результаты более эстетичными. Мне больше всего нравится использовать ключевое слово "artstation”, так как я считаю, что помогает создать лучшие картины.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/f3a/9f9/bfa/f3a9f9bfaa3e615a3bf801b17ce3599b.jpeg" alt="Сравнение ключевых слов" title="Сравнение ключевых слов" width="744" height="1111" data-src="https://habrastorage.org/getpro/habr/upload_files/f3a/9f9/bfa/f3a9f9bfaa3e615a3bf801b17ce3599b.jpeg" data-blurred="true"/><figcaption>Сравнение ключевых слов</figcaption></figure><p>Кроме того, вы можете использовать ключевые слова, чтобы обусловить художественный стиль: "pencil sketch”, "low poly" или даже имя художника — "Thomas Kinkade" или "James Gurney”.</p><figure class="full-width "><img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/583/edd/b97/583eddb97423a0f94f8d39e5ef2a829a.jpeg" alt="Ключевые слова стиля — сравнение" title="Ключевые слова стиля — сравнение" width="751" height="1077" data-src="https://habrastorage.org/getpro/habr/upload_files/583/edd/b97/583eddb97423a0f94f8d39e5ef2a829a.jpeg" data-blurred="true"/><figcaption>Ключевые слова стиля — сравнение</figcaption></figure><p>Чтобы узнать больше о влиянии различных ключевых слов, вы можете ознакомиться с <a href="https://imgur.com/a/SALxbQm">изображением</a>, которое показывает более 200 слов на 4 темы.</p><h2>UI на Gradio</h2><p><a href="https://gradio.app/">Gradio</a> — это библиотека Python, которая упрощает построение демонстраций ML до нескольких строк кода. Демоверсия требует меньше 10 минут работы. Кроме того, вы можете запустить Gradio в Colab, и он сгенерирует ссылку для совместного использования на домене Gradio. Ссылкой можно поделиться.</p><p>Gradio имеет некоторые ограничения, но я считаю, что это самая подходящая библиотека, когда вы просто хотите продемонстрировать одну функцию.</p><figure class="full-width "><img src="/img/image-loader.svg" height="325" data-src="https://habrastorage.org/getpro/habr/upload_files/ef3/ea1/425/ef3ea1425477a84644272b78a798589a.gif" data-width="783"/><figcaption></figcaption></figure><p>Ниже код простого пользовательского интерфейса для приложения Text2Art. Думаю, что он достаточно понятен, но, если вам нужно больше объяснений, смотрите <a href="https://gradio.app/docs">документацию </a>Gradio.</p><pre><code class="python">import gradio as gr
import torch
import clipit

# Define the main function
def generate(prompt, quality, style, aspect):
    torch.cuda.empty_cache()
    clipit.reset_settings()
    
    use_pixeldraw = (style == 'pixel art')
    use_clipdraw = (style == 'painting')
    clipit.add_settings(prompts=prompt,
                        aspect=aspect,
                        quality=quality,
                        use_pixeldraw=use_pixeldraw,
                        use_clipdraw=use_clipdraw,
                        make_video=True)
  
    settings = clipit.apply_settings()
    clipit.do_init(settings)
    clipit.do_run(settings)

    return 'output.png', 'output.mp4'

# Create the UI
prompt = gr.inputs.Textbox(default="Underwater city", label="Text Prompt")
quality = gr.inputs.Radio(choices=['draft', 'normal', 'better'], label="Quality")
style = gr.inputs.Radio(choices=['image', 'painting','pixel art'], label="Type")
aspect = gr.inputs.Radio(choices=['square', 'widescreen','portrait'], label="Size")

# Launch the demo
iface = gr.Interface(generate, inputs=[prompt, quality, style, aspect], outputs=['image', 'video'], enable_queue=True, live=False)
iface.launch(debug=True)</code></pre><p>Как только вы запустите эту программу в Google Colab или локально, она создаст ссылку, которой можно поделиться, демонстрация будет общедоступной. Не нужно использовать туннелирование SSH вроде ngrok. Кроме того, Gradio также предлагает хостинг за 7 долларов в месяц.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Ссылка в демо, которой можно поделиться." title="Ссылка в демо, которой можно поделиться." height="269" data-src="https://habrastorage.org/getpro/habr/upload_files/a89/e28/038/a89e280384ce65bf050b2823e29ce488.png" data-width="1083"/><figcaption>Ссылка в демо, которой можно поделиться.</figcaption></figure><p>Однако Gradio хорошо подходит только для демонстрации одной функции. Создание кастомного сайта с дополнительными функциями, такими как галерея, вход в систему или даже просто пользовательский CSS, довольно ограничено или вообще невозможно.</p><p>Одно быстрое решение — создать демонстрационный сайт отдельно от пользовательского интерфейса Gradio, затем — встроить интерфейс Gradio через iframe.</p><p>Я попробовал этот метод, но осознал один важный недостаток: я не могу персонализировать части, которые должны взаимодействовать с самим приложением ML: валидацию ввода, пользовательский прогресс-бар и т. д., невозможны с iframe. И я решил создать API.</p><h2>FastAPI для модели</h2><p>Чтобы сделать API быстрее, вместо Flask я воспользовался FastAPI. Кода меньше, а ещё он автоматически генерирует документацию со Swagger UI, что позволяет тестировать API с помощью простого пользовательского интерфейса. </p><p>Кроме того, FastAPI поддерживает асинхронные функции и, как утверждается, он <a href="https://fastapi.tiangolo.com/benchmarks/">быстрее, чем Flask</a>.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Добавляем /docs/ в URL, чтобы увидеть Swagger" title="Добавляем /docs/ в URL, чтобы увидеть Swagger" height="548" data-src="https://habrastorage.org/getpro/habr/upload_files/ad1/616/948/ad16169487ff6c5a37cd0d8b51deabbb.png" data-width="828"/><figcaption>Добавляем /docs/ в URL, чтобы увидеть Swagger</figcaption></figure><figure class=""><img src="/img/image-loader.svg" alt="Тестируем API в UI Swagger" title="Тестируем API в UI Swagger" height="488" data-src="https://habrastorage.org/getpro/habr/upload_files/358/ea4/b9c/358ea4b9cfe9f658b3af3ea4fd362fda.png" data-width="488"/><figcaption>Тестируем API в UI Swagger</figcaption></figure><p>Вот код, который я написал для выполнения функции ML на сервере FastAPI:</p><pre><code class="python">import clipit
import torch
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi import FastAPI, File, UploadFile, Form, BackgroundTasks
from fastapi.responses import FileResponse

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=['*'],
    allow_credentials=True,
    allow_methods=['*'],
    allow_headers=['*'],
)

@app.get('/')
async def root():
    return {'hello': 'world'}

@app.post("/generate")
async def generate(
        seed: int = Form(None),
        iterations: int = Form(None),
        prompts: str = Form("Underwater City"),
        quality: str = Form("draft"),
        aspect: str = Form("square"),
        scale: float = Form(2.5),
        style: str = Form('image'),
        make_video: bool = Form(False),      
    ):
    torch.cuda.empty_cache()
    clipit.reset_settings()

    use_pixeldraw = (style == 'Pixel Art')
    use_clipdraw = (style == 'Painting')
    clipit.add_settings(prompts=prompts,
                        seed=seed,
                        iterations=iterations,
                        aspect=aspect,
                        quality=quality,
                        scale=scale,
                        use_pixeldraw=use_pixeldraw,
                        use_clipdraw=use_clipdraw,
                        make_video=make_video)
    
    settings = clipit.apply_settings()
    clipit.do_init(settings)
    clipit.do_run(settings)

    return FileResponse('output.png', media_type="image/png")</code></pre><p>После определения сервера мы можем запустить его с помощью uvicorn. Кроме того, поскольку Google Colab предоставляет доступ к своему серверу только через интерфейс Colab, мы должны использовать Ngrok, чтобы сделать сервер FastAPI публичным. </p><p>Код для запуска и демонстрации сервера:</p><pre><code class="python">import nest_asyncio
from pyngrok import ngrok
import uvicorn

ngrok_tunnel = ngrok.connect(8000)
print('Public URL:', ngrok_tunnel.public_url)
print('Doc URL:', ngrok_tunnel.public_url+'/docs')
nest_asyncio.apply()
uvicorn.run(app, port=8000)</code></pre><p>Запустив сервер, мы можем перейти к Swagger UI (добавив /docs в сгенерированный ngrok URL) и протестировать API.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Генерация подводного замка при помощи FastAPI Swagger UI" title="Генерация подводного замка при помощи FastAPI Swagger UI" height="678" data-src="https://habrastorage.org/getpro/habr/upload_files/535/d00/ed8/535d00ed850802bb16f7077ffd522c63.png" data-width="675"/><figcaption>Генерация подводного замка при помощи FastAPI Swagger UI</figcaption></figure><p>При тестировании API я понял, что вывод может занять от 3 до 20 минут в зависимости от качества/итераций. Три минуты само по себе уже считается очень долгим для HTTP-запроса, и пользователи могут не захотеть ждать так долго. </p><p>Я решил, что установка вывода в качестве фоновой задачи и отправка пользователю электронного письма после получения результата лучше подходят для этой задачи.</p><p>Теперь, когда мы определились с планом, напишем функцию для отправки письма. Сначала я использовал почтовый API SendGrid, но после исчерпания квоты бесплатного использования (100 писем в день) перешёл на API Mailgun, который входит в пакет GitHub Student Developer Pack, разрешая студентам отправлять 20 000 писем в месяц. </p><p>Вот код для отправки электронного письма с вложением изображения с помощью API Mailgun:</p><pre><code class="python">import requests
def email_results_mailgun(email, prompt):
    return requests.post("https://api.mailgun.net/v3/text2art.com/messages",
        auth=("api", "YOUR_MAILGUN_API_KEY"),
        files=[("attachment",("output.png", open("output.png", "rb").read() )),
               ("attachment", ("output.mp4", open("output.mp4", "rb").read() ))],
        data={"from": "Text2Art &lt;YOUR_EMAIL>",
              "to": email,
              "subject": "Your Artwork is ready!",
              "text": f'Your generated arts using the prompt "{prompt}".',
              "html": f'Your generated arts using the prompt &lt;strong>"{prompt}"&lt;/strong>.'})</code></pre><p>Далее мы изменим код нашего сервера, чтобы использовать фоновые задачи в FastAPI и отправить результат по электронной почте в фоновом режиме.</p><details class="spoiler"><summary>Код сервера</summary><div class="spoiler__content"><pre><code class="python">#@title API Functions
import clipit
import torch
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi import FastAPI, File, UploadFile, Form, BackgroundTasks
from fastapi.responses import FileResponse

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=['*'],
    allow_credentials=True,
    allow_methods=['*'],
    allow_headers=['*'],
)

# define function to be run as background tasks
def generate(email, settings):
    clipit.do_init(settings)
    clipit.do_run(settings)

    prompt = " | ".join(settings.prompts)

    email_results_mailgun(email, prompt)

@app.get('/')
async def root():
    return {'hello': 'world'}

@app.post("/generate")
async def add_task(
        email: str,
        background_tasks: BackgroundTasks,
        seed: int = Form(None),
        iterations: int = Form(None),
        prompts: str = Form("Underwater City"),
        quality: str = Form("draft"),
        aspect: str = Form("square"),
        scale: float = Form(2.5),
        style: str = Form('image'),
        make_video: bool = Form(False),      
    ):
    torch.cuda.empty_cache()
    clipit.reset_settings()

    use_pixeldraw = (style == 'Pixel Art')
    use_clipdraw = (style == 'Painting')
    clipit.add_settings(prompts=prompts,
                        seed=seed,
                        iterations=iterations,
                        aspect=aspect,
                        quality=quality,
                        scale=scale,
                        use_pixeldraw=use_pixeldraw,
                        use_clipdraw=use_clipdraw,
                        make_video=make_video)
    
    settings = clipit.apply_settings()

    # Run function as background task
    background_tasks.add_task(generate, email, settings)

    return {"message": "Task is processed in the background"}
  </code></pre></div></details><p>С помощью приведённого выше кода сервер быстро ответит на запрос сообщением "Task is processed in the background" вместо того, чтобы ждать завершения генерации и ответа с изображением. Когда генерация завершится, сервер по электронной почте отправит пользователю результат.</p><figure class="full-width "><img src="/img/image-loader.svg" alt="Изображение и видеозапись отправляются пользователю по электронной почте" title="Изображение и видеозапись отправляются пользователю по электронной почте" height="345" data-src="https://habrastorage.org/getpro/habr/upload_files/be8/d8d/f0c/be8d8df0cf912659f654bcf4e5d262ca.png" data-width="611"/><figcaption>Изображение и видеозапись отправляются пользователю по электронной почте</figcaption></figure><p>Теперь, когда всё вроде бы заработало, я создал фронтенд и поделился сайтом со своими друзьями. Однако при тестировании с несколькими пользователями я обнаружил, что есть проблема параллелизма.</p><p>Когда второй пользователь делает запрос на сервер, в то время как первая задача всё ещё обрабатывается, вторая задача каким-то образом завершает текущий процесс, вместо того чтобы создать параллельный процесс или очередь.</p><p>Не было уверенности, что вызвало проблему, возможно, это было использование глобальных переменных в коде clipit, а возможно, нет. Я быстро понял, что мне нужно реализовать систему очереди сообщений.</p><p>По результатам поисков в Google большинство рекомендует RabbitMQ или Redis. Однако я не был уверен, можно ли установить RabbitMQ или Redis на Google Colab: для этого, похоже, требуется разрешение sudo. </p><p>В конце концов, я решил использовать Google Firebase, потому что хотел закончить проект как можно скорее, а с Firebase я знаком лучше всего.</p><p>В основном, когда пользователь пытается сгенерировать рисунок во фронтенде, он добавляет запись в queue, которая описывает задачу (введённый текст, тип изображения, размер и т. д.).</p><p>С другой стороны, мы запустим сценарий на Google Colab, который будет постоянно прослушивать новую запись в очереди и обрабатывать задания одно за другим. </p><details class="spoiler"><summary>Код бэкенда, который обрабатывает задание и постоянно прослушивает очередь</summary><div class="spoiler__content"><pre><code class="python">import torch
import clipit
import time
from datetime import datetime
import firebase_admin
from firebase_admin import credentials, firestore, storage

if not firebase_admin._apps:
    cred = credentials.Certificate("YOUR_CREDENTIAL_FILE")
    firebase_admin.initialize_app(cred, {
        'storageBucket': 'YOUR_BUCKET_URL'
    })

db = firestore.client()
bucket = storage.bucket()

def generate(doc_id, prompt, quality, style, aspect, email):
    torch.cuda.empty_cache()
    clipit.reset_settings()

    use_pixeldraw = (style == 'pixel art')
    use_clipdraw = (style == 'painting')
    clipit.add_settings(prompts=prompt,
                        seed=seed,
                        aspect=aspect,
                        quality=quality,
                        use_pixeldraw=use_pixeldraw,
                        use_clipdraw=use_clipdraw,
                        make_video=True)
    
    settings = clipit.apply_settings()
    clipit.do_init(settings)
    clipit.do_run(settings)

    data = {
        "seed": seed,
        "prompt": prompt,
        "quality": quality,
        "aspect": aspect,
        "type": style,
        "user": email,
        "created_at": datetime.now()
    }
    db.collection('generated_images').document(doc_id).set(data)
    email_results_mailgun(email, prompt)

transaction = db.transaction()

@firestore.transactional
def claim_task(transaction, queue_objects_ref):
    # query firestore
    queue_objects = queue_objects_ref.stream(transaction=transaction)

    # pull the document from the iterable
    next_item = None
    for doc in queue_objects:
        next_item = doc

    # if queue is empty return status code of 2
    if not next_item:
        return {"status": 2}

    # get information from the document 
    next_item_data = next_item.to_dict()
    next_item_data["status"] = 0
    next_item_data['id'] = next_item.id

    # delete the document and return the information
    transaction.delete(next_item.reference)
    return next_item_data

# initialize query
queue_objects_ref = (
    db.collection("queue")
    .order_by("created_at", direction="ASCENDING")
    .limit(1)
)

transaction_attempts = 0
while True:
    try:
        # apply transaction
        next_item_data = claim_task(transaction, queue_objects_ref)
        if next_item_data['status'] == 0:
            generate(next_item_data['id'],
                     next_item_data['prompt'],
                     next_item_data['quality'],
                     next_item_data['type'],
                     next_item_data['aspect'],
                     next_item_data['email'])
            print(f"Generated {next_item_data['prompt']} for {next_item_data['email']}")

    except Exception as e:
        print(f"Could not apply transaction. Error: {e}")
        time.sleep(5)
        transaction_attempts += 1
        if transaction_attempts > 20:
            db.collection("errors").add({
                "exception": f"Could not apply transaction. Error: {e}",
                "time": str(datetime.now())
            })
            exit()</code></pre></div></details><p>На фронте нужно только добавить новую задачу в очередь. Убедитесь, что правильно <span>настроили Firebase</span> на фронтенде:</p><pre><code class="python">db.collection("queue").add({
        prompt: prompt,
        email: email,
        quality: quality,
        type: type,
        aspect: aspect,
        created_at: firebase.firestore.FieldValue.serverTimestamp(),
})</code></pre><figure class="full-width "><img src="/img/image-loader.svg" height="476" data-src="https://habrastorage.org/getpro/habr/upload_files/1b3/1bc/af3/1b31bcaf366fab3d098e1dffc5a066f5.png" data-width="777"/><figcaption></figcaption></figure><p>Мы сделали это! Теперь, когда пользователь попытается создать рисунок на фронтенде, он добавит новую задачу в очередь. Затем рабочий скрипт на сервере Colab обработает задания в очереди, одно за другим. Вы можете <a href="https://github.com/mfrashad/text2art">заглянуть</a> в репозиторий GitHub, чтобы увидеть весь код.</p><p>Лучше понять нейросети и научиться решать проблемы бизнеса с их помощью вы сможете на наших курсах:</p><ul><li><p><a href="https://skillfactory.ru/machine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=conc">Курс «Machine Learning и Deep Learning» (6 месяцев)</a></p></li><li><p><a href="https://skillfactory.ru/data-scientist-pro?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_dspr_071021&amp;utm_term=conc">Профессия Data Scientist (24 месяца)</a></p></li></ul><p>Также вы можете перейти на страницы <a href="https://skillfactory.ru/catalogue?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=sf_allcourses_071021&amp;utm_term=conc">из католога</a>, чтобы увидеть, как мы готовим специалистов в других направлениях.</p><details class="spoiler"><summary>Ссылки статьи</summary><div class="spoiler__content"><p><a href="https://openai.com/blog/dall-e/">[1]</a> DALL-E</p><p><a href="https://openai.com/blog/clip/">[2]</a> CLIP</p><p><a href="https://ljvmiranda921.github.io/notebook/2021/08/08/clip-vqgan/">[3]</a> CLIP-VQGAN</p><p><a href="https://github.com/orpatashnik/StyleCLIP">[4]</a> StyleCLIP</p><p><a href="https://towardsdatascience.com/understanding-flask-vs-fastapi-web-framework-fe12bb58ee75">[5]</a> Flask против FastAPI</p></div></details><figure class="full-width "><img src="/img/image-loader.svg" height="200" data-src="https://habrastorage.org/getpro/habr/upload_files/3c2/80b/599/3c280b5993e8b243c5d3f9561fc572c7.png" data-width="1000"/><figcaption></figcaption></figure><details class="spoiler"><summary>Профессии и курсы</summary><div class="spoiler__content"><p><strong>Data Science и Machine Learning</strong></p><ul><li><p><a href="https://skillfactory.ru/data-scientist-pro?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_dspr_071021&amp;utm_term=cat">Профессия Data Scientist</a></p></li><li><p><a href="https://skillfactory.ru/data-analyst-pro?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=analytics_dapr_071021&amp;utm_term=cat">Профессия Data Analyst</a></p></li><li><p><a href="https://skillfactory.ru/matematika-dlya-data-science#syllabus?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mat_071021&amp;utm_term=cat">Курс «Математика для Data Science»</a></p></li><li><p><a href="https://skillfactory.ru/matematika-i-machine-learning-dlya-data-science?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_matml_071021&amp;utm_term=cat">Курс «Математика и Machine Learning для Data Science»</a></p></li><li><p><a href="https://skillfactory.ru/data-engineer?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_dea_071021&amp;utm_term=cat">Курс по Data Engineering</a></p></li><li><p><a href="https://skillfactory.ru/machine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=cat">Курс «Machine Learning и Deep Learning»</a></p></li><li><p><a href="https://skillfactory.ru/machine-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_ml_071021&amp;utm_term=cat">Курс по Machine Learning</a></p></li></ul><p><strong>Python, веб-разработка</strong></p><ul><li><p><a href="https://skillfactory.ru/python-fullstack-web-developer?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_fpw_071021&amp;utm_term=cat">Профессия Fullstack-разработчик на Python</a></p></li><li><p><a href="https://skillfactory.ru/python-for-web-developers?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_pws_071021&amp;utm_term=cat">Курс «Python для веб-разработки»</a></p></li><li><p><a href="https://skillfactory.ru/frontend-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_fr_071021&amp;utm_term=cat">Профессия Frontend-разработчик</a></p></li><li><p><a href="https://skillfactory.ru/webdev?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_webdev_071021&amp;utm_term=cat">Профессия Веб-разработчик</a></p></li></ul><p><strong>Мобильная разработка</strong></p><ul><li><p><a href="https://skillfactory.ru/ios-razrabotchik-s-nulya?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_ios_071021&amp;utm_term=cat">Профессия iOS-разработчик</a></p></li><li><p><a href="https://skillfactory.ru/android-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_andr_071021&amp;utm_term=cat">Профессия Android-разработчик</a></p></li></ul><p><strong>Java и C#</strong></p><ul><li><p><a href="https://skillfactory.ru/java-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_java_071021&amp;utm_term=cat">Профессия Java-разработчик</a></p></li><li><p><a href="https://skillfactory.ru/java-qa-engineer-testirovshik-po?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_qaja_071021&amp;utm_term=cat">Профессия QA-инженер на JAVA</a></p></li><li><p><a href="https://skillfactory.ru/c-sharp-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_cdev_071021&amp;utm_term=cat">Профессия C#-разработчик</a></p></li><li><p><a href="https://skillfactory.ru/game-razrabotchik-na-unity-i-c-sharp?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_gamedev_071021&amp;utm_term=cat">Профессия Разработчик игр на Unity</a></p></li></ul><p><strong>От основ — в глубину</strong></p><ul><li><p><a href="https://skillfactory.ru/algoritmy-i-struktury-dannyh?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_algo_071021&amp;utm_term=cat">Курс «Алгоритмы и структуры данных»</a></p></li><li><p><a href="https://skillfactory.ru/c-plus-plus-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_cplus_071021&amp;utm_term=cat">Профессия C++ разработчик</a></p></li><li><p><a href="https://skillfactory.ru/cyber-security-etichnij-haker?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_hacker_071021&amp;utm_term=cat">Профессия Этичный хакер</a></p></li></ul><p><strong>А также:</strong></p><ul><li><p><a href="https://skillfactory.ru/devops-ingineer?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_devops_071021&amp;utm_term=cat">Курс по DevOps</a></p></li></ul></div></details></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bskillfactory%5D" class="tm-tags-list__link">skillfactory</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgan%5D" class="tm-tags-list__link">gan</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bvqgan%5D" class="tm-tags-list__link">vqgan</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bclip%5D" class="tm-tags-list__link">clip</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpython%5D" class="tm-tags-list__link">python</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bfastapi%5D" class="tm-tags-list__link">fastapi</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bflask%5D" class="tm-tags-list__link">flask</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgithub%5D" class="tm-tags-list__link">github</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmailgun%5D" class="tm-tags-list__link">mailgun</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D0%B0%D0%BC%5D" class="tm-tags-list__link">студентам</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/company/skillfactory/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании SkillFactory
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/webdev/" class="tm-hubs-list__link">
    Разработка веб-сайтов
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/python/" class="tm-hubs-list__link">
    Python
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/programming/" class="tm-hubs-list__link">
    Программирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/machine_learning/" class="tm-hubs-list__link">
    Машинное обучение
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 16: ↑14 и ↓2</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 16: ↑14 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+12</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    73
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/company/skillfactory/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/9bb/5f7/d50/9bb5f7d50871bf0981f64b1970f22fe1.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/company/skillfactory/profile/" class="tm-company-snippet__title">SkillFactory</a> <div class="tm-company-snippet__description">Школа Computer Science. Скидка 45% по коду HABR</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="http://www.skillfactory.ru/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/KD637/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 32 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    12
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">4.8</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/KD637/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @KD637
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/company/skillfactory/blog/581794/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 21 
    </span></a> <!----></div></div></div>  <!---->  <!----> <!----></div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2012-10-31T20:00:00.000Z" title="2012-11-01, 00:00">1  ноября  2012</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="http://www.skillfactory.ru/" target="_blank" class="tm-company-basic-info__link">
      www.skillfactory.ru
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    201–500 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2012-12-14T13:25:37.000Z" title="2012-12-14, 17:25">14  декабря  2012</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="/ru/users/skillfactory_school/" class="tm-company-basic-info__link">
      Skillfactory School
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/company/skillfactory/blog/581794/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/company/skillfactory/blog/581794/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"581794":{"id":"581794","timePublished":"2021-10-07T19:33:04+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как написать генератор изображений, который вас понимает","leadData":{"textHtml":"\u003Cp\u003EАвтор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом поле. \u003C\u002Fp\u003E\u003Cp\u003EДля интерфейса используется Gradio, модель работает на сервере FastAPI, а системой очереди сообщений служит Firebase. Подробностями делимся к старту \u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmachine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=lead\"\u003Eкурса по ML и DL\u003C\u002Fa\u003E.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7f7\u002F0a6\u002Fa95\u002F7f70a6a9554f753bf33b6106489c3a87.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7f7\u002F0a6\u002Fa95\u002F7f70a6a9554f753bf33b6106489c3a87.jpg","fit":"cover","positionY":0,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Fathy Rashad","originalUrl":"https:\u002F\u002Ftowardsdatascience.com\u002Fhow-i-built-an-ai-text-to-art-generator-a0c0f6d6f59f"}},{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":12,"votesCount":32},"rating":4.8,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2534877","alias":"KD637","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":21,"favoritesCount":73,"readingCount":4116,"score":12,"votesCount":16},"hubs":[{"relatedData":null,"id":"17931","alias":"skillfactory","type":"corporative","title":"Блог компании SkillFactory","titleHtml":"Блог компании SkillFactory","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"19439","alias":"machine_learning","type":"collective","title":"Машинное обучение","titleHtml":"Машинное обучение","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe50\u002Fece\u002Fe02\u002Fe50ecee023d0fc0e65f2526f438b032c.jpg\" width=\"780\" height=\"440\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe50\u002Fece\u002Fe02\u002Fe50ecee023d0fc0e65f2526f438b032c.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EАвтор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом поле. \u003C\u002Fp\u003E\u003Cp\u003EДля интерфейса используется Gradio, модель работает на сервере FastAPI, а системой очереди сообщений служит Firebase. Подробностями делимся к старту \u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmachine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=lead\"\u003Eкурса по ML и DL\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Chr\u002F\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Галерея Text2Art\" title=\"Галерея Text2Art\" height=\"313\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2d6\u002Fc01\u002F1c4\u002F2d6c011c4b6a62824d546e3615d4742e.gif\" data-width=\"505\"\u002F\u003E\u003Cfigcaption\u003EГалерея Text2Art\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЕсли вам понравился проект, вы можете проголосовать за него \u003Ca href=\"https:\u002F\u002Fdevpost.com\u002Fsoftware\u002Fgancreate\"\u003Eздесь\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cdiv class=\"tm-iframe_temp\" data-src=\"https:\u002F\u002Fembedd.srv.habr.com\u002Fiframe\u002F615cab744615593b75e24676\" data-style=\"\" id=\"615cab744615593b75e24676\" width=\"\"\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003EВведение\u003C\u002Fh2\u003E\u003Cp\u003EНе так давно генеративные картины и NFT штурмом захватили мир. Это стало возможным после значительного прогресса OpenAI в генерации изображения из текста. Ранее в этом году OpenAI анонсировал DALL-E, мощный генератор изображений из текстов. \u003C\u002Fp\u003E\u003Cp\u003EЧтобы проиллюстрировать, насколько хорошо работает DALL-E, посмотрите рисунки, сгенерированные DALL-E по запросу \"a professional high quality illustration of a giraffe dragon chimera, \"a giraffe imitating a dragon\", \"a giraffe made of dragon\".\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Изображения по запросу &quot;a professional high quality illustration of a giraffe dragon chimera, &quot;a giraffe imitating a dragon&quot;, &quot;a giraffe made of dragon&quot;.\" title=\"Изображения по запросу &quot;a professional high quality illustration of a giraffe dragon chimera, &quot;a giraffe imitating a dragon&quot;, &quot;a giraffe made of dragon&quot;.\" height=\"871\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa44\u002F704\u002F034\u002Fa4470403409fc60ab0f714a3af85e8a6.png\" data-width=\"725\"\u002F\u003E\u003Cfigcaption\u003EИзображения по запросу \"a professional high quality illustration of a giraffe dragon chimera, \"a giraffe imitating a dragon\", \"a giraffe made of dragon\".\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EК сожалению, DALL-E не был выпущен в массы. Вместо него была опубликована модель, которая творит магию DALL-E, — CLIP. CLIP или Contrastive Image-Language Pretraining — это мультимодальная сеть, объединяющая текст и изображения. \u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003EОдним словом, CLIP способен оценить, насколько хорошо изображение соответствует надписи или наоборот. \u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EЭто крайне полезно в управлении генератором, чтобы создать изображение, точно соответствующее введённому тексту. В фильме \"DALL-E\"  CLIP используется, чтобы ранжировать сгенерированные изображения и входные изображения с наивысшим баллом (самые похожие на тектовый запрос).\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"396\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F793\u002F83c\u002F14a\u002F79383c14a586d70b37771580c849e0b3.png\" data-width=\"590\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЧерез несколько месяцев после анонса фильма DALL-E был опубликован новый генератор изображений-трансформеров под названием VQGAN (Vector Quantized GAN). Сочетание VQGAN с CLIP даёт качество, аналогичное DALL-E. С момента обнародования предварительно обученной модели VQGAN сообщество создало множество удивительных картин.\u003C\u002Fp\u003E\u003Cp\u003EВот примеры:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"\" title=\"\" height=\"224\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F488\u002Fff1\u002Ffb8\u002F488ff1fb884211de07658b24f28b38d7.png\" data-width=\"400\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"\" title=\"\" height=\"272\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F599\u002F411\u002Fece\u002F599411ece96236163a842ecce2241625.png\" data-width=\"496\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЯ был поражён результатами и захотел поделиться ими со своими друзьями. Но, поскольку не так много людей готовы погрузиться в код ради генерации картин, я решил сделать Text2Art.com — сайт, где любой может просто ввести подсказку и сгенерировать нужное изображение, не сталкиваясь с кодом воочию.\u003C\u002Fp\u003E\u003Ch2\u003EКак это работает\u003C\u002Fh2\u003E\u003Cp\u003EИтак, как работает VQGAN+CLIP? VQGAN генерирует изображение, а CLIP измеряет, насколько оно соответствует запросу. Затем генератор использует обратную связь от модели CLIP, чтобы сгенерировать более точные изображения. Процедура повторяется, пока оценка CLIP не станет достаточно высокой.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"VQGAN генерирует изображения, пока CLIP направляет процесс. Чем больше итераций, тем точнее изображение [источник: иллюстрированный VQGAN от LJ Miranda]\" title=\"VQGAN генерирует изображения, пока CLIP направляет процесс. Чем больше итераций, тем точнее изображение [источник: иллюстрированный VQGAN от LJ Miranda]\" height=\"1485\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa7d\u002Fc2a\u002Fe02\u002Fa7dc2ae02ea7b767111a1041bc8287c8.png\" data-width=\"1400\"\u002F\u003E\u003Cfigcaption\u003EVQGAN генерирует изображения, пока CLIP направляет процесс. Чем больше итераций, тем точнее изображение [источник: иллюстрированный VQGAN от LJ Miranda]\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЯ не буду рассказывать о внутренней работе VQGAN или CLIP. Но, если вы хотите получить более глубокие объяснения VQGAN, CLIP или DALL-E, обратитесь к этим удивительным ресурсам, которые я нашёл:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fljvmiranda921.github.io\u002Fnotebook\u002F2021\u002F08\u002F08\u002Fclip-vqgan\u002F\"\u003EИллюстрированный VQGAN\u003C\u002Fa\u003E;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fml.berkeley.edu\u002Fblog\u002Fposts\u002Fvq-vae\u002F\"\u003EОбъяснение DALL-E\u003C\u002Fa\u003E;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fyoutu.be\u002FT9XSU0pKX2E\"\u003EОбъяснение научной работы о CLIP на видео\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003EX + CLIP\u003C\u002Fh3\u003E\u003Cp\u003EVQGAN+CLIP — это только пример того, на что способно объединение генератора изображений с CLIP. Однако вы можете заменить VQGAN на любой генератор. Появилось много вариантов X + CLIP, таких как \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Forpatashnik\u002FStyleCLIP\"\u003EStyleCLIP\u003C\u002Fa\u003E (StyleGAN + CLIP), \u003Ca href=\"https:\u002F\u002Farxiv.org\u002Fabs\u002F2106.14843\"\u003ECLIPDraw\u003C\u002Fa\u003E (векторный генератор), BigGAN + CLIP и многие другие, даже \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAndreyGuzhov\u002FAudioCLIP\"\u003EAudioCLIP\u003C\u002Fa\u003E, который работает со звуком, а не изображениями.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Редактирование изображений при помощи StyleCLIP [работа о StyleCLIP]\" title=\"Редактирование изображений при помощи StyleCLIP [работа о StyleCLIP]\" height=\"507\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff47\u002Fb0b\u002F94b\u002Ff47b0b94b1a6139791f2f08bdc3e1664.png\" data-width=\"1400\"\u002F\u003E\u003Cfigcaption\u003EРедактирование изображений при помощи StyleCLIP [работа о StyleCLIP]\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003EКод\u003C\u002Fh2\u003E\u003Cp\u003EЯ воспользуюсь кодом из репозитория \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fdribnet\u002Fclipit\"\u003Eclipit\u003C\u002Fa\u003E от dribnet, этот код генерирует изображения при помощи VQGAN+CLIP в несколько простых строк (обновление: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fdribnet\u002Fclipit\"\u003Eclipit\u003C\u002Fa\u003E мигрировал на \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fdribnet\u002Fpixray\"\u003Epixray\u003C\u002Fa\u003E). Его рекомендуется запускать на Google Colab: VQGAN+CLIP требует много памяти GPU. Вот блокнот \u003Ca href=\"https:\u002F\u002Fcolab.research.google.com\u002Fgithub\u002Fmfrashad\u002Ftext2art\u002Fblob\u002Fmain\u002Ftext2art.ipynb\"\u003EColab\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003EПрежде всего, если вы работаете на Colab, убедитесь, что вы изменили тип рантайма на GPU, вот так:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"385\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faae\u002F0df\u002Fca8\u002Faae0dfca84a68efa1eb3c65fd4ea5f20.png\" data-width=\"511\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"\n\" title=\"\n\" height=\"290\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F39f\u002F231\u002F441\u002F39f231441510f9b03da12206df44437d.png\" data-width=\"398\"\u002F\u003E\u003Cfigcaption\u003E\n\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EУстановим кодовую базу и зависимости:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Efrom IPython.utils import io\nwith io.capture_output() as captured:\n  !git clone https:\u002F\u002Fgithub.com\u002Fopenai\u002FCLIP\n  # !pip install taming-transformers\n  !git clone https:\u002F\u002Fgithub.com\u002FCompVis\u002Ftaming-transformers.git\n  !rm -Rf clipit\n  !git clone https:\u002F\u002Fgithub.com\u002Fmfrashad\u002Fclipit.git\n  !pip install ftfy regex tqdm omegaconf pytorch-lightning\n  !pip install kornia\n  !pip install imageio-ffmpeg   \n  !pip install einops\n  !pip install torch-optimizer\n  !pip install easydict\n  !pip install braceexpand\n  !pip install git+https:\u002F\u002Fgithub.com\u002Fpvigier\u002Fperlin-numpy\n\n  # ClipDraw deps\n  !pip install svgwrite\n  !pip install svgpathtools\n  !pip install cssutils\n  !pip install numba\n  !pip install torch-tools\n  !pip install visdom\n\n  !pip install gradio\n\n  !git clone https:\u002F\u002Fgithub.com\u002FBachiLi\u002Fdiffvg\n  %cd diffvg\n  # !ls\n  !git submodule update --init --recursive\n  !python setup.py install\n  %cd ..\n  \n  !mkdir -p steps\n  !mkdir -p models\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cblockquote\u003E\u003Cp\u003E\"!\" — это специальная команда в Google Colab, которая означает, что команда будет запущена в bash, а не в python.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EПосле установки библиотек мы можем просто импортировать clipit и запустить эти несколько строк кода для генерации картины с помощью VQGAN+CLIP. \u003C\u002Fp\u003E\u003Cp\u003EПросто замените текстовую подсказку на любую другую. Кроме того, вы можете задать clipit такие параметры, как количество итераций, ширина, высота, модель генератора, хотите ли вы генерировать видео или нет, и многие другие. Чтобы больше узнать об опциях, вы можете \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmfrashad\u002Fclipit\u002Fblob\u002Fmaster\u002Fclipit.py\"\u003Eпосмотреть \u003C\u002Fa\u003Eисходный код.\u003C\u002Fp\u003E\u003Cp\u003EВот код генерации:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport sys\nsys.path.append(\"clipit\")\nimport clipit\n\n# To reset settings to default\nclipit.reset_settings()\n\n# You can use \"|\" to separate multiple prompts\nprompts = \"underwater city\"\n\n# You can trade off speed for quality: draft, normal, better, best\nquality = \"normal\"\n\n# Aspect ratio: widescreen, square\naspect = \"widescreen\"\n\n# Add settings\nclipit.add_settings(prompts=prompts, quality=quality, aspect=aspect)\n\n# Apply these settings and run\nsettings = clipit.apply_settings()\nclipit.do_init(settings)\ncliptit.do_run(settings)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКогда вы запустите код, он сгенерирует изображение. На каждой итерации сгенерированное изображение будет приближаться к тексту, который вы ввели.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Итерации по заросу “underwater city”\" title=\"Итерации по заросу “underwater city”\" height=\"304\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F175\u002Fd56\u002Ff21\u002F175d56f21f0ae9f5f89834decc07f356.png\" data-width=\"714\"\u002F\u003E\u003Cfigcaption\u003EИтерации по заросу “underwater city”\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EКоличество итераций\u003C\u002Fh3\u003E\u003Cp\u003EВот так можно установить количество итераций, им управляет \u003Ccode\u003Eiterations\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eclipit.add_settings(iterations=500)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3\u003EГенерация видео\u003C\u002Fh3\u003E\u003Cp\u003EВ любом случае нужно генерировать изображение для каждой итерации, поэтому можно сохранить эти изображения и создать анимацию самой генерации. Для этого добавьте \u003Ccode\u003Emake_video=True\u003C\u002Fcode\u003E перед применением настроек.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eclipit.add_settings(make_video=True)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПолучится этот ролик:\u003C\u002Fp\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Сгенерированный подводный город, запрос “Underwater City”\" title=\"Сгенерированный подводный город, запрос “Underwater City”\" height=\"224\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffd5\u002Fe9f\u002Fed1\u002Ffd5e9fed1f52a259d2a67252c5850ce4.gif\" data-width=\"400\"\u002F\u003E\u003Cfigcaption\u003EСгенерированный подводный город, запрос “Underwater City”\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EУправление размером изображений\u003C\u002Fh3\u003E\u003Cp\u003EРазмер изображения устанавливается опцией \u003Ccode\u003Esize=(width, height)\u003C\u002Fcode\u003E. Сенерируем баннерное изображение с разрешением 800x200. Обратите внимание, что более высокое разрешение требует большего объёма памяти GPU.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eclipit.add_settings(size=(800, 200))\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Баннер 800x200 по запросу “Fantasy Kingdom #artstation”\" title=\"Баннер 800x200 по запросу “Fantasy Kingdom #artstation”\" height=\"192\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F122\u002F217\u002F87d\u002F12221787d7d7f4b0e983e72f44a909c5.png\" data-width=\"800\"\u002F\u003E\u003Cfigcaption\u003EБаннер 800x200 по запросу “Fantasy Kingdom #artstation”\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EГенерация пиксель-арта\u003C\u002Fh3\u003E\u003Cp\u003EМожно генерировать и пиксель-арт. Для этого используется рендерер CLIPDraw за сценой с некоторыми инженерными решениями, такими как ограничение цветов палитры, пикселизация и т.д. Просто включите опцию \u003Ccode\u003Euse_pixeldraw=True\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eclipit.add_settings(use_pixeldraw=True)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Изображение по запросу “Knight in armor #pixelart”\" title=\"Изображение по запросу “Knight in armor #pixelart”\" height=\"280\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa93\u002F027\u002Fcd7\u002Fa93027cd76d9ac1bd1be5dba0a94a8b9.png\" data-width=\"500\"\u002F\u003E\u003Cfigcaption\u003EИзображение по запросу “Knight in armor #pixelart”\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Изображение по запросу “A world of chinese fantasy video game #pixelart”\" title=\"Изображение по запросу “A world of chinese fantasy video game #pixelart”\" height=\"225\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fda9\u002F3ee\u002Fa05\u002Fda93eea05ceb55206d33649f49411f05.png\" data-width=\"400\"\u002F\u003E\u003Cfigcaption\u003EИзображение по запросу “A world of chinese fantasy video game #pixelart”\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EVQGAN+CLIP модификатор ключевых слов\u003C\u002Fh3\u003E\u003Cp\u003EИз-за смещения в CLIP добавление определённых ключевых слов к подсказке может придать определённый эффект генерируемому изображению. Например, добавление слова \"unreal engine\"  к текстовой подсказке, как правило, создаёт реалистичное изображение или HD стиль. Добавление определённых названий сайтов, таких как \"deviantart\", \"artstation\"  или \"flickr\", обычно делает результаты более эстетичными. Мне больше всего нравится использовать ключевое слово \"artstation”, так как я считаю, что помогает создать лучшие картины.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3a\u002F9f9\u002Fbfa\u002Ff3a9f9bfaa3e615a3bf801b17ce3599b.jpeg\" alt=\"Сравнение ключевых слов\" title=\"Сравнение ключевых слов\" width=\"744\" height=\"1111\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff3a\u002F9f9\u002Fbfa\u002Ff3a9f9bfaa3e615a3bf801b17ce3599b.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003EСравнение ключевых слов\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EКроме того, вы можете использовать ключевые слова, чтобы обусловить художественный стиль: \"pencil sketch”, \"low poly\" или даже имя художника — \"Thomas Kinkade\" или \"James Gurney”.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F583\u002Fedd\u002Fb97\u002F583eddb97423a0f94f8d39e5ef2a829a.jpeg\" alt=\"Ключевые слова стиля — сравнение\" title=\"Ключевые слова стиля — сравнение\" width=\"751\" height=\"1077\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F583\u002Fedd\u002Fb97\u002F583eddb97423a0f94f8d39e5ef2a829a.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cfigcaption\u003EКлючевые слова стиля — сравнение\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЧтобы узнать больше о влиянии различных ключевых слов, вы можете ознакомиться с \u003Ca href=\"https:\u002F\u002Fimgur.com\u002Fa\u002FSALxbQm\"\u003Eизображением\u003C\u002Fa\u003E, которое показывает более 200 слов на 4 темы.\u003C\u002Fp\u003E\u003Ch2\u003EUI на Gradio\u003C\u002Fh2\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgradio.app\u002F\"\u003EGradio\u003C\u002Fa\u003E — это библиотека Python, которая упрощает построение демонстраций ML до нескольких строк кода. Демоверсия требует меньше 10 минут работы. Кроме того, вы можете запустить Gradio в Colab, и он сгенерирует ссылку для совместного использования на домене Gradio. Ссылкой можно поделиться.\u003C\u002Fp\u003E\u003Cp\u003EGradio имеет некоторые ограничения, но я считаю, что это самая подходящая библиотека, когда вы просто хотите продемонстрировать одну функцию.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"325\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fef3\u002Fea1\u002F425\u002Fef3ea1425477a84644272b78a798589a.gif\" data-width=\"783\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНиже код простого пользовательского интерфейса для приложения Text2Art. Думаю, что он достаточно понятен, но, если вам нужно больше объяснений, смотрите \u003Ca href=\"https:\u002F\u002Fgradio.app\u002Fdocs\"\u003Eдокументацию \u003C\u002Fa\u003EGradio.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport gradio as gr\nimport torch\nimport clipit\n\n# Define the main function\ndef generate(prompt, quality, style, aspect):\n    torch.cuda.empty_cache()\n    clipit.reset_settings()\n    \n    use_pixeldraw = (style == 'pixel art')\n    use_clipdraw = (style == 'painting')\n    clipit.add_settings(prompts=prompt,\n                        aspect=aspect,\n                        quality=quality,\n                        use_pixeldraw=use_pixeldraw,\n                        use_clipdraw=use_clipdraw,\n                        make_video=True)\n  \n    settings = clipit.apply_settings()\n    clipit.do_init(settings)\n    clipit.do_run(settings)\n\n    return 'output.png', 'output.mp4'\n\n# Create the UI\nprompt = gr.inputs.Textbox(default=\"Underwater city\", label=\"Text Prompt\")\nquality = gr.inputs.Radio(choices=['draft', 'normal', 'better'], label=\"Quality\")\nstyle = gr.inputs.Radio(choices=['image', 'painting','pixel art'], label=\"Type\")\naspect = gr.inputs.Radio(choices=['square', 'widescreen','portrait'], label=\"Size\")\n\n# Launch the demo\niface = gr.Interface(generate, inputs=[prompt, quality, style, aspect], outputs=['image', 'video'], enable_queue=True, live=False)\niface.launch(debug=True)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EКак только вы запустите эту программу в Google Colab или локально, она создаст ссылку, которой можно поделиться, демонстрация будет общедоступной. Не нужно использовать туннелирование SSH вроде ngrok. Кроме того, Gradio также предлагает хостинг за 7 долларов в месяц.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Ссылка в демо, которой можно поделиться.\" title=\"Ссылка в демо, которой можно поделиться.\" height=\"269\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa89\u002Fe28\u002F038\u002Fa89e280384ce65bf050b2823e29ce488.png\" data-width=\"1083\"\u002F\u003E\u003Cfigcaption\u003EСсылка в демо, которой можно поделиться.\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EОднако Gradio хорошо подходит только для демонстрации одной функции. Создание кастомного сайта с дополнительными функциями, такими как галерея, вход в систему или даже просто пользовательский CSS, довольно ограничено или вообще невозможно.\u003C\u002Fp\u003E\u003Cp\u003EОдно быстрое решение — создать демонстрационный сайт отдельно от пользовательского интерфейса Gradio, затем — встроить интерфейс Gradio через iframe.\u003C\u002Fp\u003E\u003Cp\u003EЯ попробовал этот метод, но осознал один важный недостаток: я не могу персонализировать части, которые должны взаимодействовать с самим приложением ML: валидацию ввода, пользовательский прогресс-бар и т. д., невозможны с iframe. И я решил создать API.\u003C\u002Fp\u003E\u003Ch2\u003EFastAPI для модели\u003C\u002Fh2\u003E\u003Cp\u003EЧтобы сделать API быстрее, вместо Flask я воспользовался FastAPI. Кода меньше, а ещё он автоматически генерирует документацию со Swagger UI, что позволяет тестировать API с помощью простого пользовательского интерфейса. \u003C\u002Fp\u003E\u003Cp\u003EКроме того, FastAPI поддерживает асинхронные функции и, как утверждается, он \u003Ca href=\"https:\u002F\u002Ffastapi.tiangolo.com\u002Fbenchmarks\u002F\"\u003Eбыстрее, чем Flask\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Добавляем \u002Fdocs\u002F в URL, чтобы увидеть Swagger\" title=\"Добавляем \u002Fdocs\u002F в URL, чтобы увидеть Swagger\" height=\"548\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fad1\u002F616\u002F948\u002Fad16169487ff6c5a37cd0d8b51deabbb.png\" data-width=\"828\"\u002F\u003E\u003Cfigcaption\u003EДобавляем \u002Fdocs\u002F в URL, чтобы увидеть Swagger\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Тестируем API в UI Swagger\" title=\"Тестируем API в UI Swagger\" height=\"488\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F358\u002Fea4\u002Fb9c\u002F358ea4b9cfe9f658b3af3ea4fd362fda.png\" data-width=\"488\"\u002F\u003E\u003Cfigcaption\u003EТестируем API в UI Swagger\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВот код, который я написал для выполнения функции ML на сервере FastAPI:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport clipit\nimport torch\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi import FastAPI, File, UploadFile, Form, BackgroundTasks\nfrom fastapi.responses import FileResponse\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=['*'],\n    allow_credentials=True,\n    allow_methods=['*'],\n    allow_headers=['*'],\n)\n\n@app.get('\u002F')\nasync def root():\n    return {'hello': 'world'}\n\n@app.post(\"\u002Fgenerate\")\nasync def generate(\n        seed: int = Form(None),\n        iterations: int = Form(None),\n        prompts: str = Form(\"Underwater City\"),\n        quality: str = Form(\"draft\"),\n        aspect: str = Form(\"square\"),\n        scale: float = Form(2.5),\n        style: str = Form('image'),\n        make_video: bool = Form(False),      \n    ):\n    torch.cuda.empty_cache()\n    clipit.reset_settings()\n\n    use_pixeldraw = (style == 'Pixel Art')\n    use_clipdraw = (style == 'Painting')\n    clipit.add_settings(prompts=prompts,\n                        seed=seed,\n                        iterations=iterations,\n                        aspect=aspect,\n                        quality=quality,\n                        scale=scale,\n                        use_pixeldraw=use_pixeldraw,\n                        use_clipdraw=use_clipdraw,\n                        make_video=make_video)\n    \n    settings = clipit.apply_settings()\n    clipit.do_init(settings)\n    clipit.do_run(settings)\n\n    return FileResponse('output.png', media_type=\"image\u002Fpng\")\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПосле определения сервера мы можем запустить его с помощью uvicorn. Кроме того, поскольку Google Colab предоставляет доступ к своему серверу только через интерфейс Colab, мы должны использовать Ngrok, чтобы сделать сервер FastAPI публичным. \u003C\u002Fp\u003E\u003Cp\u003EКод для запуска и демонстрации сервера:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport nest_asyncio\nfrom pyngrok import ngrok\nimport uvicorn\n\nngrok_tunnel = ngrok.connect(8000)\nprint('Public URL:', ngrok_tunnel.public_url)\nprint('Doc URL:', ngrok_tunnel.public_url+'\u002Fdocs')\nnest_asyncio.apply()\nuvicorn.run(app, port=8000)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EЗапустив сервер, мы можем перейти к Swagger UI (добавив \u002Fdocs в сгенерированный ngrok URL) и протестировать API.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Генерация подводного замка при помощи FastAPI Swagger UI\" title=\"Генерация подводного замка при помощи FastAPI Swagger UI\" height=\"678\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F535\u002Fd00\u002Fed8\u002F535d00ed850802bb16f7077ffd522c63.png\" data-width=\"675\"\u002F\u003E\u003Cfigcaption\u003EГенерация подводного замка при помощи FastAPI Swagger UI\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПри тестировании API я понял, что вывод может занять от 3 до 20 минут в зависимости от качества\u002Fитераций. Три минуты само по себе уже считается очень долгим для HTTP-запроса, и пользователи могут не захотеть ждать так долго. \u003C\u002Fp\u003E\u003Cp\u003EЯ решил, что установка вывода в качестве фоновой задачи и отправка пользователю электронного письма после получения результата лучше подходят для этой задачи.\u003C\u002Fp\u003E\u003Cp\u003EТеперь, когда мы определились с планом, напишем функцию для отправки письма. Сначала я использовал почтовый API SendGrid, но после исчерпания квоты бесплатного использования (100 писем в день) перешёл на API Mailgun, который входит в пакет GitHub Student Developer Pack, разрешая студентам отправлять 20 000 писем в месяц. \u003C\u002Fp\u003E\u003Cp\u003EВот код для отправки электронного письма с вложением изображения с помощью API Mailgun:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport requests\ndef email_results_mailgun(email, prompt):\n    return requests.post(\"https:\u002F\u002Fapi.mailgun.net\u002Fv3\u002Ftext2art.com\u002Fmessages\",\n        auth=(\"api\", \"YOUR_MAILGUN_API_KEY\"),\n        files=[(\"attachment\",(\"output.png\", open(\"output.png\", \"rb\").read() )),\n               (\"attachment\", (\"output.mp4\", open(\"output.mp4\", \"rb\").read() ))],\n        data={\"from\": \"Text2Art &lt;YOUR_EMAIL\u003E\",\n              \"to\": email,\n              \"subject\": \"Your Artwork is ready!\",\n              \"text\": f'Your generated arts using the prompt \"{prompt}\".',\n              \"html\": f'Your generated arts using the prompt &lt;strong\u003E\"{prompt}\"&lt;\u002Fstrong\u003E.'})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EДалее мы изменим код нашего сервера, чтобы использовать фоновые задачи в FastAPI и отправить результат по электронной почте в фоновом режиме.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EКод сервера\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003E#@title API Functions\nimport clipit\nimport torch\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi import FastAPI, File, UploadFile, Form, BackgroundTasks\nfrom fastapi.responses import FileResponse\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=['*'],\n    allow_credentials=True,\n    allow_methods=['*'],\n    allow_headers=['*'],\n)\n\n# define function to be run as background tasks\ndef generate(email, settings):\n    clipit.do_init(settings)\n    clipit.do_run(settings)\n\n    prompt = \" | \".join(settings.prompts)\n\n    email_results_mailgun(email, prompt)\n\n@app.get('\u002F')\nasync def root():\n    return {'hello': 'world'}\n\n@app.post(\"\u002Fgenerate\")\nasync def add_task(\n        email: str,\n        background_tasks: BackgroundTasks,\n        seed: int = Form(None),\n        iterations: int = Form(None),\n        prompts: str = Form(\"Underwater City\"),\n        quality: str = Form(\"draft\"),\n        aspect: str = Form(\"square\"),\n        scale: float = Form(2.5),\n        style: str = Form('image'),\n        make_video: bool = Form(False),      \n    ):\n    torch.cuda.empty_cache()\n    clipit.reset_settings()\n\n    use_pixeldraw = (style == 'Pixel Art')\n    use_clipdraw = (style == 'Painting')\n    clipit.add_settings(prompts=prompts,\n                        seed=seed,\n                        iterations=iterations,\n                        aspect=aspect,\n                        quality=quality,\n                        scale=scale,\n                        use_pixeldraw=use_pixeldraw,\n                        use_clipdraw=use_clipdraw,\n                        make_video=make_video)\n    \n    settings = clipit.apply_settings()\n\n    # Run function as background task\n    background_tasks.add_task(generate, email, settings)\n\n    return {\"message\": \"Task is processed in the background\"}\n  \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EС помощью приведённого выше кода сервер быстро ответит на запрос сообщением \"Task is processed in the background\" вместо того, чтобы ждать завершения генерации и ответа с изображением. Когда генерация завершится, сервер по электронной почте отправит пользователю результат.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Изображение и видеозапись отправляются пользователю по электронной почте\" title=\"Изображение и видеозапись отправляются пользователю по электронной почте\" height=\"345\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbe8\u002Fd8d\u002Ff0c\u002Fbe8d8df0cf912659f654bcf4e5d262ca.png\" data-width=\"611\"\u002F\u003E\u003Cfigcaption\u003EИзображение и видеозапись отправляются пользователю по электронной почте\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТеперь, когда всё вроде бы заработало, я создал фронтенд и поделился сайтом со своими друзьями. Однако при тестировании с несколькими пользователями я обнаружил, что есть проблема параллелизма.\u003C\u002Fp\u003E\u003Cp\u003EКогда второй пользователь делает запрос на сервер, в то время как первая задача всё ещё обрабатывается, вторая задача каким-то образом завершает текущий процесс, вместо того чтобы создать параллельный процесс или очередь.\u003C\u002Fp\u003E\u003Cp\u003EНе было уверенности, что вызвало проблему, возможно, это было использование глобальных переменных в коде clipit, а возможно, нет. Я быстро понял, что мне нужно реализовать систему очереди сообщений.\u003C\u002Fp\u003E\u003Cp\u003EПо результатам поисков в Google большинство рекомендует RabbitMQ или Redis. Однако я не был уверен, можно ли установить RabbitMQ или Redis на Google Colab: для этого, похоже, требуется разрешение sudo. \u003C\u002Fp\u003E\u003Cp\u003EВ конце концов, я решил использовать Google Firebase, потому что хотел закончить проект как можно скорее, а с Firebase я знаком лучше всего.\u003C\u002Fp\u003E\u003Cp\u003EВ основном, когда пользователь пытается сгенерировать рисунок во фронтенде, он добавляет запись в queue, которая описывает задачу (введённый текст, тип изображения, размер и т. д.).\u003C\u002Fp\u003E\u003Cp\u003EС другой стороны, мы запустим сценарий на Google Colab, который будет постоянно прослушивать новую запись в очереди и обрабатывать задания одно за другим. \u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EКод бэкенда, который обрабатывает задание и постоянно прослушивает очередь\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eimport torch\nimport clipit\nimport time\nfrom datetime import datetime\nimport firebase_admin\nfrom firebase_admin import credentials, firestore, storage\n\nif not firebase_admin._apps:\n    cred = credentials.Certificate(\"YOUR_CREDENTIAL_FILE\")\n    firebase_admin.initialize_app(cred, {\n        'storageBucket': 'YOUR_BUCKET_URL'\n    })\n\ndb = firestore.client()\nbucket = storage.bucket()\n\ndef generate(doc_id, prompt, quality, style, aspect, email):\n    torch.cuda.empty_cache()\n    clipit.reset_settings()\n\n    use_pixeldraw = (style == 'pixel art')\n    use_clipdraw = (style == 'painting')\n    clipit.add_settings(prompts=prompt,\n                        seed=seed,\n                        aspect=aspect,\n                        quality=quality,\n                        use_pixeldraw=use_pixeldraw,\n                        use_clipdraw=use_clipdraw,\n                        make_video=True)\n    \n    settings = clipit.apply_settings()\n    clipit.do_init(settings)\n    clipit.do_run(settings)\n\n    data = {\n        \"seed\": seed,\n        \"prompt\": prompt,\n        \"quality\": quality,\n        \"aspect\": aspect,\n        \"type\": style,\n        \"user\": email,\n        \"created_at\": datetime.now()\n    }\n    db.collection('generated_images').document(doc_id).set(data)\n    email_results_mailgun(email, prompt)\n\ntransaction = db.transaction()\n\n@firestore.transactional\ndef claim_task(transaction, queue_objects_ref):\n    # query firestore\n    queue_objects = queue_objects_ref.stream(transaction=transaction)\n\n    # pull the document from the iterable\n    next_item = None\n    for doc in queue_objects:\n        next_item = doc\n\n    # if queue is empty return status code of 2\n    if not next_item:\n        return {\"status\": 2}\n\n    # get information from the document \n    next_item_data = next_item.to_dict()\n    next_item_data[\"status\"] = 0\n    next_item_data['id'] = next_item.id\n\n    # delete the document and return the information\n    transaction.delete(next_item.reference)\n    return next_item_data\n\n# initialize query\nqueue_objects_ref = (\n    db.collection(\"queue\")\n    .order_by(\"created_at\", direction=\"ASCENDING\")\n    .limit(1)\n)\n\ntransaction_attempts = 0\nwhile True:\n    try:\n        # apply transaction\n        next_item_data = claim_task(transaction, queue_objects_ref)\n        if next_item_data['status'] == 0:\n            generate(next_item_data['id'],\n                     next_item_data['prompt'],\n                     next_item_data['quality'],\n                     next_item_data['type'],\n                     next_item_data['aspect'],\n                     next_item_data['email'])\n            print(f\"Generated {next_item_data['prompt']} for {next_item_data['email']}\")\n\n    except Exception as e:\n        print(f\"Could not apply transaction. Error: {e}\")\n        time.sleep(5)\n        transaction_attempts += 1\n        if transaction_attempts \u003E 20:\n            db.collection(\"errors\").add({\n                \"exception\": f\"Could not apply transaction. Error: {e}\",\n                \"time\": str(datetime.now())\n            })\n            exit()\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cp\u003EНа фронте нужно только добавить новую задачу в очередь. Убедитесь, что правильно \u003Cspan\u003Eнастроили Firebase\u003C\u002Fspan\u003E на фронтенде:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edb.collection(\"queue\").add({\n        prompt: prompt,\n        email: email,\n        quality: quality,\n        type: type,\n        aspect: aspect,\n        created_at: firebase.firestore.FieldValue.serverTimestamp(),\n})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"476\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b3\u002F1bc\u002Faf3\u002F1b31bcaf366fab3d098e1dffc5a066f5.png\" data-width=\"777\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EМы сделали это! Теперь, когда пользователь попытается создать рисунок на фронтенде, он добавит новую задачу в очередь. Затем рабочий скрипт на сервере Colab обработает задания в очереди, одно за другим. Вы можете \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmfrashad\u002Ftext2art\"\u003Eзаглянуть\u003C\u002Fa\u003E в репозиторий GitHub, чтобы увидеть весь код.\u003C\u002Fp\u003E\u003Cp\u003EЛучше понять нейросети и научиться решать проблемы бизнеса с их помощью вы сможете на наших курсах:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmachine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=conc\"\u003EКурс «Machine Learning и Deep Learning» (6 месяцев)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fdata-scientist-pro?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_dspr_071021&amp;utm_term=conc\"\u003EПрофессия Data Scientist (24 месяца)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТакже вы можете перейти на страницы \u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fcatalogue?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=sf_allcourses_071021&amp;utm_term=conc\"\u003Eиз католога\u003C\u002Fa\u003E, чтобы увидеть, как мы готовим специалистов в других направлениях.\u003C\u002Fp\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EСсылки статьи\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fopenai.com\u002Fblog\u002Fdall-e\u002F\"\u003E[1]\u003C\u002Fa\u003E DALL-E\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fopenai.com\u002Fblog\u002Fclip\u002F\"\u003E[2]\u003C\u002Fa\u003E CLIP\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fljvmiranda921.github.io\u002Fnotebook\u002F2021\u002F08\u002F08\u002Fclip-vqgan\u002F\"\u003E[3]\u003C\u002Fa\u003E CLIP-VQGAN\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Forpatashnik\u002FStyleCLIP\"\u003E[4]\u003C\u002Fa\u003E StyleCLIP\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Ftowardsdatascience.com\u002Funderstanding-flask-vs-fastapi-web-framework-fe12bb58ee75\"\u003E[5]\u003C\u002Fa\u003E Flask против FastAPI\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"200\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3c2\u002F80b\u002F599\u002F3c280b5993e8b243c5d3f9561fc572c7.png\" data-width=\"1000\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПрофессии и курсы\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Cp\u003E\u003Cstrong\u003EData Science и Machine Learning\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fdata-scientist-pro?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_dspr_071021&amp;utm_term=cat\"\u003EПрофессия Data Scientist\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fdata-analyst-pro?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=analytics_dapr_071021&amp;utm_term=cat\"\u003EПрофессия Data Analyst\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmatematika-dlya-data-science#syllabus?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mat_071021&amp;utm_term=cat\"\u003EКурс «Математика для Data Science»\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmatematika-i-machine-learning-dlya-data-science?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_matml_071021&amp;utm_term=cat\"\u003EКурс «Математика и Machine Learning для Data Science»\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fdata-engineer?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_dea_071021&amp;utm_term=cat\"\u003EКурс по Data Engineering\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmachine-learning-i-deep-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_mldl_071021&amp;utm_term=cat\"\u003EКурс «Machine Learning и Deep Learning»\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fmachine-learning?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=data-science_ml_071021&amp;utm_term=cat\"\u003EКурс по Machine Learning\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EPython, веб-разработка\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fpython-fullstack-web-developer?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_fpw_071021&amp;utm_term=cat\"\u003EПрофессия Fullstack-разработчик на Python\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fpython-for-web-developers?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_pws_071021&amp;utm_term=cat\"\u003EКурс «Python для веб-разработки»\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Ffrontend-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_fr_071021&amp;utm_term=cat\"\u003EПрофессия Frontend-разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fwebdev?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_webdev_071021&amp;utm_term=cat\"\u003EПрофессия Веб-разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EМобильная разработка\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fios-razrabotchik-s-nulya?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_ios_071021&amp;utm_term=cat\"\u003EПрофессия iOS-разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fandroid-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_andr_071021&amp;utm_term=cat\"\u003EПрофессия Android-разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EJava и C#\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fjava-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_java_071021&amp;utm_term=cat\"\u003EПрофессия Java-разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fjava-qa-engineer-testirovshik-po?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_qaja_071021&amp;utm_term=cat\"\u003EПрофессия QA-инженер на JAVA\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fc-sharp-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_cdev_071021&amp;utm_term=cat\"\u003EПрофессия C#-разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fgame-razrabotchik-na-unity-i-c-sharp?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_gamedev_071021&amp;utm_term=cat\"\u003EПрофессия Разработчик игр на Unity\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EОт основ — в глубину\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Falgoritmy-i-struktury-dannyh?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_algo_071021&amp;utm_term=cat\"\u003EКурс «Алгоритмы и структуры данных»\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fc-plus-plus-razrabotchik?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_cplus_071021&amp;utm_term=cat\"\u003EПрофессия C++ разработчик\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fcyber-security-etichnij-haker?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_hacker_071021&amp;utm_term=cat\"\u003EПрофессия Этичный хакер\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EА также:\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fskillfactory.ru\u002Fdevops-ingineer?utm_source=habr&amp;utm_medium=habr&amp;utm_campaign=article&amp;utm_content=coding_devops_071021&amp;utm_term=cat\"\u003EКурс по DevOps\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"skillfactory"},{"titleHtml":"gan"},{"titleHtml":"vqgan"},{"titleHtml":"clip"},{"titleHtml":"python"},{"titleHtml":"fastapi"},{"titleHtml":"flask"},{"titleHtml":"github"},{"titleHtml":"mailgun"},{"titleHtml":"студентам"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7f7\u002F0a6\u002Fa95\u002F7f70a6a9554f753bf33b6106489c3a87.jpg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7f7\u002F0a6\u002Fa95\u002F7f70a6a9554f753bf33b6106489c3a87.jpg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fskillfactory\\\u002Fblog\\\u002F581794\\\u002F\"},\"headline\":\"Как написать генератор изображений, который вас понимает\",\"datePublished\":\"2021-10-07T22:33:04+03:00\",\"dateModified\":\"2021-10-08T00:47:20+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"KD637\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Автор статьи рассказывает, как за неделю создал Text2Art.com &mdash; генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изо...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fskillfactory\\\u002Fblog\\\u002F581794\\\u002F#post-content-body\",\"about\":[\"c_skillfactory\",\"h_webdev\",\"h_python\",\"h_programming\",\"h_machine_learning\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F581794\\\u002F7fd6258ed793acfcbd2951cfc2d8ae89\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe50\\\u002Fece\\\u002Fe02\\\u002Fe50ecee023d0fc0e65f2526f438b032c.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F2d6\\\u002Fc01\\\u002F1c4\\\u002F2d6c011c4b6a62824d546e3615d4742e.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa44\\\u002F704\\\u002F034\\\u002Fa4470403409fc60ab0f714a3af85e8a6.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F793\\\u002F83c\\\u002F14a\\\u002F79383c14a586d70b37771580c849e0b3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F488\\\u002Fff1\\\u002Ffb8\\\u002F488ff1fb884211de07658b24f28b38d7.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F599\\\u002F411\\\u002Fece\\\u002F599411ece96236163a842ecce2241625.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa7d\\\u002Fc2a\\\u002Fe02\\\u002Fa7dc2ae02ea7b767111a1041bc8287c8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff47\\\u002Fb0b\\\u002F94b\\\u002Ff47b0b94b1a6139791f2f08bdc3e1664.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Faae\\\u002F0df\\\u002Fca8\\\u002Faae0dfca84a68efa1eb3c65fd4ea5f20.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F39f\\\u002F231\\\u002F441\\\u002F39f231441510f9b03da12206df44437d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F175\\\u002Fd56\\\u002Ff21\\\u002F175d56f21f0ae9f5f89834decc07f356.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ffd5\\\u002Fe9f\\\u002Fed1\\\u002Ffd5e9fed1f52a259d2a67252c5850ce4.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F122\\\u002F217\\\u002F87d\\\u002F12221787d7d7f4b0e983e72f44a909c5.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa93\\\u002F027\\\u002Fcd7\\\u002Fa93027cd76d9ac1bd1be5dba0a94a8b9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fda9\\\u002F3ee\\\u002Fa05\\\u002Fda93eea05ceb55206d33649f49411f05.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff3a\\\u002F9f9\\\u002Fbfa\\\u002Ff3a9f9bfaa3e615a3bf801b17ce3599b.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F583\\\u002Fedd\\\u002Fb97\\\u002F583eddb97423a0f94f8d39e5ef2a829a.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fef3\\\u002Fea1\\\u002F425\\\u002Fef3ea1425477a84644272b78a798589a.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fa89\\\u002Fe28\\\u002F038\\\u002Fa89e280384ce65bf050b2823e29ce488.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fad1\\\u002F616\\\u002F948\\\u002Fad16169487ff6c5a37cd0d8b51deabbb.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F358\\\u002Fea4\\\u002Fb9c\\\u002F358ea4b9cfe9f658b3af3ea4fd362fda.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F535\\\u002Fd00\\\u002Fed8\\\u002F535d00ed850802bb16f7077ffd522c63.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fbe8\\\u002Fd8d\\\u002Ff0c\\\u002Fbe8d8df0cf912659f654bcf4e5d262ca.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1b3\\\u002F1bc\\\u002Faf3\\\u002F1b31bcaf366fab3d098e1dffc5a066f5.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F3c2\\\u002F80b\\\u002F599\\\u002F3c280b5993e8b243c5d3f9561fc572c7.png\"]}","metaDescription":"Автор статьи рассказывает, как за неделю создал Text2Art.com — генератор изображений на основе VQGAN+CLIP, способный рисовать пиксель-арт и живопись, а также изображать то, что вы напишите в текстовом...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"skillfactory":{"alias":"skillfactory","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F9bb\u002F5f7\u002Fd50\u002F9bb5f7d50871bf0981f64b1970f22fe1.png","titleHtml":"SkillFactory","descriptionHtml":"Школа Computer Science. Скидка 45% по коду HABR","relatedData":null,"statistics":{"postsCount":538,"newsCount":3,"vacanciesCount":4,"employeesCount":27,"careerRating":null,"subscribersCount":2671,"rating":146.01,"invest":null},"foundationDate":{"year":"2012","month":"11","day":"01"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Fwww.skillfactory.ru\u002F","staffNumber":"201–500 человек","registrationDate":"2012-12-14T13:25:37+00:00","representativeUser":{"alias":"skillfactory_school","fullname":"Skillfactory School"},"contacts":[{"title":"Сайт","url":"http:\u002F\u002Fwww.skillfactory.ru\u002F"}],"settings":{"analyticsSettings":[{"type":"ym","trackingId":"38813825"}],"branding":null,"status":"active"},"metadata":{"titleHtml":"SkillFactory, Москва - Школа Computer Science. Скидка 45% по коду HABR с 1 ноября 2012 г.","title":"SkillFactory, Москва - Школа Computer Science. Скидка 45% по коду HABR с 1 ноября 2012 г.","keywords":["Программирование","Python","Машинное обучение","Читальный зал","Научно-популярное"],"descriptionHtml":"538 статей от авторов компании SkillFactory","description":"538 статей от авторов компании SkillFactory"},"aDeskSettings":null,"careerAlias":"skillfactory","maxCustomTrackerLinks":0}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
